# Today 페이지 - 플랜 뷰 스켈레톤 디자인

## 📋 개요

`/today` 페이지에서 플랜을 보는 방식을 다양하게 제공합니다. 같은 `plan_number`를 가진 쪼개진 플랜들을 하나로 그룹화하여 표시하며, 각 플랜에 대한 타이머 기능과 타임스템프를 제공합니다.

## 🎯 주요 요구사항

1. **뷰 모드**: 단일 플랜 뷰와 일일 플랜 뷰 지원
2. **플랜 그룹화**: 같은 `plan_number`를 가진 플랜들을 하나로 묶어서 표시
3. **타이머 제어**: 시작/일시정지/완료/재개 버튼 제공
4. **타임스템프 표시**: 시작 시간, 종료 시간, 경과 시간 등 표시

## 📐 스켈레톤 디자인

### 1. 일일 플랜 뷰 (Daily Plan View) - 기본 뷰

하루의 모든 플랜을 표시하는 뷰입니다. 같은 `plan_number`를 가진 플랜들은 하나의 카드로 그룹화됩니다.

```
┌─────────────────────────────────────────────────────────────────┐
│ Today - 2024년 1월 15일 (월요일)                                 │
│                                                                 │
│ [뷰 모드 전환: 📋 일일 | 📌 단일]                               │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│ 플랜 1: 수학 개념 정리 (plan_number: 1)                          │
│ ┌───────────────────────────────────────────────────────────┐   │
│ │ 📚 수학 개념 정리 (1-3회차)                                 │   │
│ │                                                            │   │
│ │ 블록 1: 09:00 ~ 10:30 (1-2회차)                           │   │
│ │ 블록 3: 14:00 ~ 15:30 (3회차)                              │   │
│ │                                                            │   │
│ │ ⏱ 학습 시간: 01:23:45                                      │   │
│ │    시작: 2024-01-15 09:00:15                               │   │
│ │    일시정지: 2회 (00:10:30)                                │   │
│ │                                                            │   │
│ │ [▶️ 시작] [⏸ 일시정지] [⏹ 완료] [▶ 재개]                 │   │
│ └───────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│ 플랜 2: 영어 독해 연습 (plan_number: 2)                          │
│ ┌───────────────────────────────────────────────────────────┐   │
│ │ 📚 영어 독해 연습 (1회차)                                   │   │
│ │                                                            │   │
│ │ 블록 2: 11:00 ~ 12:30                                      │   │
│ │                                                            │   │
│ │ [▶️ 시작]                                                  │   │
│ └───────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

### 2. 단일 플랜 뷰 (Single Plan View) - 전체 화면 뷰

하나의 플랜 그룹을 전체 화면으로 크게 보여주는 뷰입니다. 플랜 선택 드롭다운 또는 좌우 화살표로 다른 플랜으로 전환할 수 있습니다.

```
┌──────────────────────────────────────────────────────────────────────────────┐
│ Today - 2024년 1월 15일 (월요일)                                              │
│                                                                              │
│ [뷰 모드 전환: 📋 일일 | 📌 단일]                                            │
│                                                                              │
│ 플랜 선택: [◀ 이전] [▼ 수학 개념 정리 (1-3회차)] [다음 ▶]                  │
│           ├─ 📚 수학 개념 정리 (1-3회차) ⏱ 01:23:45 | 진행 중              │
│           ├─ 📚 영어 독해 연습 (1회차) ⏱ - | 대기 중                       │
│           └─ 📚 물리 문제집 (1회차) ⏱ - | 대기 중                          │
└──────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────┐
│                                                                              │
│                                    📚 수학 개념 정리                          │
│                                   (1-3회차)                                   │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                    전체 진행률                           │ │
│  │                              ████████░░░░░░░░░░░░ 35%                  │ │
│  │                                                                          │ │
│  │                          총 학습 시간: 01:23:45                          │ │
│  │                                                                          │ │
│  │                  시작: 2024-01-15 09:00:15                               │ │
│  │                  일시정지: 2회 (총 00:10:30)                             │ │
│  │                                                                          │ │
│  │                  [▶️ 그룹 시작] [⏸ 그룹 일시정지] [⏹ 그룹 완료]       │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                          블록 1: 09:00 ~ 10:30                          │ │
│  │                                                                          │ │
│  │                          회차: 1-2회차                                  │ │
│  │                          범위: p.10 ~ p.25 (16페이지)                   │ │
│  │                          진행률: ████████░░░░░░░░░░░░ 50%                │ │
│  │                                                                          │ │
│  │                          ┌────────────────────────────┐                 │ │
│  │                          │ ⏱ 학습 시간: 01:23:45     │                 │ │
│  │                          │                            │                 │ │
│  │                          │ 시작: 09:00:15             │                 │ │
│  │                          │ 일시정지: 2회 (00:10:30)   │                 │ │
│  │                          │                            │                 │ │
│  │                          │ [▶ 재개] [⏹ 완료]         │                 │ │
│  │                          └────────────────────────────┘                 │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                          블록 3: 14:00 ~ 15:30                          │ │
│  │                                                                          │ │
│  │                          회차: 3회차                                    │ │
│  │                          범위: p.26 ~ p.35 (10페이지)                   │ │
│  │                          진행률: ░░░░░░░░░░░░░░░░░░░░ 0%                │ │
│  │                                                                          │ │
│  │                          ┌────────────────────────────┐                 │ │
│  │                          │ 상태: 대기 중               │                 │ │
│  │                          │                            │                 │ │
│  │                          │ [▶️ 시작]                  │                 │ │
│  │                          └────────────────────────────┘                 │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                              전체 범위 정보                              │ │
│  │                                                                          │ │
│  │                    p.10 ~ p.35 (총 26페이지)                            │ │
│  │                    완료: 9페이지 | 남은: 17페이지                        │ │
│  │                                                                          │ │
│  │                    활성: 1개 | 완료: 0개 | 대기: 1개                    │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

## 🎨 상세 컴포넌트 구조

### 1. 플랜 그룹 카드 (PlanGroupCard)

같은 `plan_number`를 가진 플랜들을 하나로 묶어서 표시하는 카드입니다. 일일 뷰와 단일 뷰에서 모두 사용되지만, 표시 방식이 다릅니다.

```typescript
type PlanGroup = {
  planNumber: number | null;
  plans: PlanWithContent[]; // 같은 plan_number를 가진 플랜들
  content: Book | Lecture | CustomContent;
  sequence: number | null; // 회차
};

type PlanGroupCardProps = {
  group: PlanGroup;
  viewMode: "daily" | "single";
  onViewDetail?: () => void; // 일일 뷰에서 단일 뷰로 전환할 때 사용
  onSelectPlan?: (planNumber: number | null) => void; // 플랜 선택 시
};
```

**일일 뷰에서의 표시 (컴팩트한 카드 형태):**

```
┌──────────────────────────────────────────────────────────────┐
│ 플랜 1: 수학 개념 정리 (plan_number: 1)                       │
│                                                              │
│ 📚 수학 개념 정리 (1-3회차)                                   │
│                                                              │
│ ┌────────────────────────────────────────────────────────┐  │
│ │ 블록 1: 09:00 ~ 10:30 | 회차: 1-2 | p.10-25 (16p)     │  │
│ │ ⏱ 01:23:45                                            │  │
│ │ 시작: 09:00:15 | 일시정지: 2회 (00:10:30)             │  │
│ │ [▶ 재개] [⏹ 완료]                                     │  │
│ └────────────────────────────────────────────────────────┘  │
│                                                              │
│ ┌────────────────────────────────────────────────────────┐  │
│ │ 블록 3: 14:00 ~ 15:30 | 회차: 3 | p.26-35 (10p)       │  │
│ │ [▶️ 시작]                                              │  │
│ └────────────────────────────────────────────────────────┘  │
│                                                              │
│ 전체 진행률: ████████░░░░░░░░░░░░ 35%                        │
│ 전체 학습 시간: 01:23:45                                     │
│                                                              │
│ [▶️ 그룹 시작] [⏸ 그룹 일시정지] [📋 상세보기] ← 단일 뷰로 전환
└──────────────────────────────────────────────────────────────┘
```

**단일 뷰에서의 표시 (전체 화면 상세 뷰):**

단일 뷰에서는 `PlanGroupCard`가 전체 화면을 차지하며, 모든 정보를 크고 상세하게 표시합니다.

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                                    📚 수학 개념 정리                          │
│                                   (1-3회차)                                   │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────────┐ │
│  │                                    전체 진행률                           │ │
│  │                              ████████░░░░░░░░░░░░ 35%                  │ │
│  │                                                                          │ │
│  │                          총 학습 시간: 01:23:45                          │ │
│  │                  시작: 2024-01-15 09:00:15                               │ │
│  │                  일시정지: 2회 (총 00:10:30)                             │ │
│  │                                                                          │ │
│  │                  [▶️ 그룹 시작] [⏸ 그룹 일시정지] [⏹ 그룹 완료]       │ │
│  └────────────────────────────────────────────────────────────────────────┘ │
│                                                                              │
│  ... 각 블록별 상세 정보 (큰 화면으로 표시) ...                               │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### 2. 플랜 아이템 (PlanItem)

개별 플랜 블록을 표시하는 컴포넌트입니다.

```typescript
type PlanItemProps = {
  plan: PlanWithContent;
  isGrouped: boolean; // 같은 plan_number를 가진 그룹의 일부인지
  isActive: boolean; // 현재 활성화된 플랜인지
  session?: StudySession; // 활성 세션 정보
  showTimer?: boolean; // 타이머 표시 여부
};
```

**표시 예시:**

```
┌──────────────────────────────────────────────────────────────┐
│ 블록 1: 09:00 ~ 10:30                                        │
│                                                              │
│ 회차: 1-2회차                                                │
│ 범위: p.10 ~ p.25 (16페이지)                                 │
│ 진행률: ████████░░░░░░░░░░░░ 50%                             │
│                                                              │
│ ┌────────────────────────────────────────────────────────┐  │
│ │ ⏱ 학습 시간: 01:23:45                                  │  │
│ │                                                         │  │
│ │ 시작: 2024-01-15 09:00:15                              │  │
│ │ 종료: -                                                 │  │
│ │ 일시정지: 2회 (00:10:30)                               │  │
│ │                                                         │  │
│ │ [⏸ 일시정지] [⏹ 완료] [▶ 재개]                       │  │
│ └────────────────────────────────────────────────────────┘  │
└──────────────────────────────────────────────────────────────┘
```

### 3. 타임스템프 표시 컴포넌트 (TimestampDisplay)

플랜의 시간 정보를 표시하는 컴포넌트입니다.

```typescript
type TimestampDisplayProps = {
  actualStartTime?: string | null;
  actualEndTime?: string | null;
  totalDurationSeconds?: number | null;
  pausedDurationSeconds?: number | null;
  pauseCount?: number | null;
  isRunning: boolean;
  isPaused: boolean;
  isCompleted: boolean;
};
```

**표시 형식:**

- **시작 전**: 버튼만 표시
- **실행 중**:
  ```
  ⏱ 학습 시간: 01:23:45 (실시간 업데이트)
  시작: 2024-01-15 09:00:15
  일시정지: 2회 (00:10:30)
  ```
- **일시정지 중**:
  ```
  ⏱ 학습 시간: 01:23:45 (고정)
  시작: 2024-01-15 09:00:15
  일시정지: 2회 (00:10:30)
  마지막 일시정지: 2024-01-15 10:15:30
  ```
- **완료**:
  ```
  ⏱ 총 학습 시간: 01:45:30
  시작: 2024-01-15 09:00:15
  종료: 2024-01-15 10:45:45
  일시정지: 2회 (00:10:30)
  실제 학습: 01:35:00
  ```

### 4. 타이머 제어 버튼 (TimerControlButtons)

플랜의 타이머를 제어하는 버튼들입니다.

```typescript
type TimerControlButtonsProps = {
  planId: string;
  planGroupId?: number | null; // 같은 plan_number를 가진 그룹 ID
  isActive: boolean; // 활성 상태
  isPaused: boolean; // 일시정지 상태
  isCompleted: boolean; // 완료 상태
  onStart: () => void;
  onPause: () => void;
  onResume: () => void;
  onComplete: () => void;
};
```

**버튼 상태별 표시:**

- **시작 전**: `[▶️ 시작]`
- **실행 중**: `[⏸ 일시정지] [⏹ 완료]`
- **일시정지 중**: `[▶ 재개] [⏹ 완료]`
- **완료**: `[📋 상세보기]`

### 5. 플랜 그룹 정보 표시 (PlanGroupInfo)

같은 `plan_number`를 가진 플랜들의 집계 정보를 표시합니다.

```typescript
type PlanGroupInfoProps = {
  group: PlanGroup;
  totalProgress: number; // 전체 진행률
  totalStudyTime: number; // 총 학습 시간
  activePlans: number; // 활성 플랜 수
  completedPlans: number; // 완료 플랜 수
};
```

**표시 예시:**

```
┌──────────────────────────────────────────────────────────────┐
│ 플랜 그룹 정보                                                │
│                                                              │
│ 전체 진행률: ████████░░░░░░░░░░░░ 35%                        │
│ 전체 학습 시간: 01:23:45                                     │
│                                                              │
│ 블록 1: ⏱ 01:23:45 (진행 중)                                │
│ 블록 3: ⏱ - (대기 중)                                       │
│                                                              │
│ 전체 범위: p.10 ~ p.35 (26페이지 중 9페이지 완료)            │
└──────────────────────────────────────────────────────────────┘
```

## 🔄 뷰 모드 전환 및 상호작용

### 뷰 모드 선택 컴포넌트 (ViewModeSelector)

```typescript
type ViewMode = "daily" | "single";

type ViewModeSelectorProps = {
  mode: ViewMode;
  onChange: (mode: ViewMode) => void;
  selectedPlanNumber?: number | null; // 단일 뷰일 때 선택된 플랜 번호
};
```

**UI:**

```
┌──────────────────────────────────────────────────────────────┐
│ [📋 일일 뷰] [📌 단일 뷰]                                    │
└──────────────────────────────────────────────────────────────┘
```

**동작:**

- **일일 뷰 → 단일 뷰**: 현재 선택된 플랜(또는 첫 번째 플랜)을 단일 뷰로 전환
- **단일 뷰 → 일일 뷰**: 모든 플랜을 리스트로 보여주는 일일 뷰로 전환

### 일일 뷰에서 단일 뷰로 전환

일일 뷰의 플랜 카드를 클릭하거나 "상세보기" 버튼을 누르면 해당 플랜의 단일 뷰로 전환됩니다.

**UI 예시:**

```
┌──────────────────────────────────────────────────────────────┐
│ 플랜 1: 수학 개념 정리 (plan_number: 1)                       │
│                                                              │
│ 📚 수학 개념 정리 (1-3회차)                                   │
│                                                              │
│ ... 플랜 정보 ...                                             │
│                                                              │
│ [▶️ 그룹 시작] [⏸ 그룹 일시정지] [📋 상세보기] ← 클릭 시 단일 뷰로 전환
└──────────────────────────────────────────────────────────────┘
```

### 단일 뷰에서 플랜 선택 (PlanSelector)

단일 뷰에서는 드롭다운 또는 좌우 화살표로 다른 플랜으로 전환할 수 있습니다.

```typescript
type PlanSelectorProps = {
  plans: PlanGroup[];
  selectedPlanNumber: number | null;
  onSelect: (planNumber: number | null) => void;
  onPrevious?: () => void;
  onNext?: () => void;
};
```

**UI:**

```
┌──────────────────────────────────────────────────────────────┐
│ [◀ 이전] [▼ 수학 개념 정리 (1-3회차)] [다음 ▶]               │
│           ├─ 📚 수학 개념 정리 (1-3회차)                    │
│           │   ⏱ 01:23:45 | 진행 중                         │
│           ├─ 📚 영어 독해 연습 (1회차)                      │
│           │   ⏱ - | 대기 중                                │
│           └─ 📚 물리 문제집 (1회차)                         │
│               ⏱ - | 대기 중                                │
└──────────────────────────────────────────────────────────────┘
```

**동작:**

- **드롭다운 선택**: 드롭다운에서 플랜을 선택하면 해당 플랜의 단일 뷰로 전환
- **이전/다음 버튼**: 현재 플랜의 이전/다음 플랜으로 순차적으로 전환
- **키보드 단축키**: 좌우 화살표 키로 플랜 전환 (선택사항)

## 📊 데이터 구조

### 플랜 그룹화 로직

```typescript
function groupPlansByPlanNumber(plans: PlanWithContent[]): PlanGroup[] {
  const groups = new Map<number | null, PlanWithContent[]>();

  plans.forEach((plan) => {
    const planNumber = plan.plan_number ?? null;
    if (!groups.has(planNumber)) {
      groups.set(planNumber, []);
    }
    groups.get(planNumber)!.push(plan);
  });

  return Array.from(groups.entries()).map(([planNumber, plans]) => ({
    planNumber,
    plans: plans.sort((a, b) => a.block_index - b.block_index),
    content: plans[0].content, // 모든 플랜이 같은 콘텐츠를 가짐
    sequence: plans[0].sequence, // 모든 플랜이 같은 회차를 가짐
  }));
}
```

### 활성 플랜 확인 로직

```typescript
function getActivePlan(
  planGroup: PlanGroup,
  sessions: StudySession[]
): Plan | null {
  return (
    planGroup.plans.find((plan) => {
      const session = sessions.find((s) => s.plan_id === plan.id);
      return session && !session.ended_at;
    }) ?? null
  );
}
```

### 전체 진행률 계산

```typescript
function calculateGroupProgress(planGroup: PlanGroup): number {
  const totalPages = planGroup.plans.reduce((sum, plan) => {
    const range =
      (plan.planned_end_page_or_time ?? 0) -
      (plan.planned_start_page_or_time ?? 0);
    return sum + range;
  }, 0);

  const completedPages = planGroup.plans.reduce((sum, plan) => {
    return sum + (plan.completed_amount ?? 0);
  }, 0);

  return totalPages > 0 ? Math.round((completedPages / totalPages) * 100) : 0;
}
```

## 🎯 사용자 인터랙션

### 뷰 모드 전환

#### 일일 뷰 → 단일 뷰

1. **플랜 카드 클릭**: 일일 뷰의 플랜 카드를 클릭하면 해당 플랜의 단일 뷰로 전환
2. **상세보기 버튼**: 플랜 카드의 "📋 상세보기" 버튼 클릭
3. **뷰 모드 전환**: 상단의 "📌 단일 뷰" 버튼 클릭 (첫 번째 플랜 선택)

#### 단일 뷰 → 일일 뷰

1. **뷰 모드 전환**: 상단의 "📋 일일 뷰" 버튼 클릭
2. **뒤로가기**: 브라우저 뒤로가기 또는 ESC 키 (선택사항)

#### 단일 뷰에서 플랜 전환

1. **드롭다운 선택**: 상단 플랜 선택 드롭다운에서 다른 플랜 선택
2. **이전/다음 버튼**: 좌우 화살표 버튼으로 순차적으로 전환
3. **키보드 단축키**: 좌우 화살표 키로 전환 (선택사항)

### 플랜 그룹 제어

#### 그룹 단위 제어

- **그룹 시작**: 그룹 내 첫 번째 대기 중인 플랜을 시작
- **그룹 일시정지**: 그룹 내 모든 활성 플랜을 일시정지
- **그룹 완료**: 그룹 내 모든 플랜을 완료 처리

#### 개별 플랜 제어

- 각 플랜 블록은 독립적으로 시작/일시정지/완료 가능
- 같은 `plan_number`를 가진 플랜들 간에는 상태가 연동되지 않음 (개별 제어)

### 타이머 제어

#### 시작

- **시작 전**: `[▶️ 시작]` 버튼 표시
- **클릭 시**: 플랜 시작, 학습 세션 생성, 타이머 시작

#### 일시정지/재개

- **실행 중**: `[⏸ 일시정지]` 버튼 표시
- **일시정지 중**: `[▶ 재개]` 버튼 표시
- 일시정지 시간은 학습 시간에서 제외

#### 완료

- **실행 중/일시정지 중**: `[⏹ 완료]` 버튼 표시
- **클릭 시**: 완료 페이지로 이동 (실제 완료는 완료 페이지에서 처리)
- **완료 후**: `[📋 상세보기]` 버튼 표시

### 타임스템프 표시

- **시작 시간**: 플랜이 처음 시작된 시간 (YYYY-MM-DD HH:mm:ss)
- **종료 시간**: 플랜이 완료된 시간 (완료 시에만 표시)
- **경과 시간**: 실시간으로 업데이트되는 학습 시간 (실행 중일 때만)
- **일시정지 정보**: 일시정지 횟수 및 총 일시정지 시간
- **실제 학습 시간**: 총 소요 시간 - 일시정지 시간 (완료 시 표시)

## 📱 반응형 디자인

### 모바일 뷰

```
┌─────────────────────────────┐
│ Today - 1/15                │
│ [📋 일일] [📌 단일]         │
├─────────────────────────────┤
│                             │
│ 📚 수학 개념 정리            │
│ (1-3회차)                   │
│                             │
│ ┌─────────────────────────┐ │
│ │ 블록 1: 09:00-10:30     │ │
│ │ 1-2회차 | p.10-25       │ │
│ │                         │ │
│ │ ⏱ 01:23:45             │ │
│ │ 시작: 09:00:15          │ │
│ │                         │ │
│ │ [▶ 재개] [⏹ 완료]      │ │
│ └─────────────────────────┘ │
│                             │
│ ┌─────────────────────────┐ │
│ │ 블록 3: 14:00-15:30     │ │
│ │ 3회차 | p.26-35         │ │
│ │                         │ │
│ │ [▶️ 시작]               │ │
│ └─────────────────────────┘ │
│                             │
└─────────────────────────────┘
```

## ✅ 체크리스트

### 구현 필요 사항

- [ ] `PlanGroup` 타입 정의
- [ ] `groupPlansByPlanNumber` 함수 구현
- [ ] `PlanGroupCard` 컴포넌트 구현
- [ ] `PlanItem` 컴포넌트 개선 (타이머 통합)
- [ ] `TimestampDisplay` 컴포넌트 구현
- [ ] `TimerControlButtons` 컴포넌트 구현
- [ ] `PlanGroupInfo` 컴포넌트 구현
- [ ] `ViewModeSelector` 컴포넌트 구현
- [ ] `PlanSelector` 컴포넌트 구현 (단일 뷰)
- [ ] 일일 뷰 레이아웃 구현
- [ ] 단일 뷰 레이아웃 구현
- [ ] 플랜 그룹 타이머 제어 로직 구현
- [ ] 반응형 스타일링 적용

### 데이터 처리

- [ ] 같은 `plan_number`를 가진 플랜 그룹화 로직
- [ ] 플랜 그룹의 전체 진행률 계산
- [ ] 플랜 그룹의 총 학습 시간 집계
- [ ] 활성 플랜 확인 로직
- [ ] 세션 정보 조회 및 매핑

### UI/UX

- [ ] 타임스템프 포맷팅 (YYYY-MM-DD HH:mm:ss)
- [ ] 시간 경과 표시 (실시간 업데이트)
- [ ] 일시정지 횟수 및 시간 표시
- [ ] 진행률 바 표시
- [ ] 버튼 상태별 스타일링
- [ ] 로딩 상태 처리
- [ ] 에러 상태 처리
