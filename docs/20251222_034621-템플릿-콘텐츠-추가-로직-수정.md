# í…œí”Œë¦¿ ì‘ì„± ì‹œ ì½˜í…ì¸  ë²”ìœ„ ì €ì¥ í›„ ì‚¬ë¼ì§€ëŠ” ë¬¸ì œ ìˆ˜ì •

## ğŸ” ë¬¸ì œ ìƒí™©

í…œí”Œë¦¿ ì‘ì„± ì‹œ ì½˜í…ì¸ ë¥¼ ì„ íƒí•˜ê³  ë²”ìœ„ë¥¼ ì…ë ¥í•œ í›„ ì €ì¥í•˜ë©´, í•´ë‹¹ ì½˜í…ì¸ ê°€ ì„ íƒëœ ì½˜í…ì¸  ì˜ì—­ì—ì„œ ì‚¬ë¼ì§€ëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

### ë¬¸ì œì 

1. **ì½˜í…ì¸  ì„ íƒ**: ì½˜í…ì¸ ë¥¼ ì„ íƒí•˜ë©´ ì„ì‹œ ì½˜í…ì¸ (`isLoadingMetadata: true`)ê°€ ì¦‰ì‹œ ì¶”ê°€ë¨
2. **ë²”ìœ„ ì…ë ¥**: ë²”ìœ„ ì„¤ì • ëª¨ë‹¬ì—ì„œ ë²”ìœ„ë¥¼ ì…ë ¥í•˜ê³  ì €ì¥ ë²„íŠ¼ í´ë¦­
3. **ì½˜í…ì¸  ì‚¬ë¼ì§**: ì €ì¥ í›„ì—ë„ ì„ íƒëœ ì½˜í…ì¸  ëª©ë¡ì—ì„œ í•´ë‹¹ ì½˜í…ì¸ ê°€ ì‚¬ë¼ì§

## ğŸ” ì›ì¸ ë¶„ì„

### ë°ì´í„° íë¦„

1. **ì½˜í…ì¸  ì„ íƒ** (`handleContentSelect`):
   - ì„ì‹œ ì½˜í…ì¸ (`tempContent`) ìƒì„± (`isLoadingMetadata: true`)
   - `onUpdate(updated)` í˜¸ì¶œí•˜ì—¬ ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸ (Optimistic UI)
   - ë²”ìœ„ ì„¤ì • ëª¨ë‹¬ ì—´ê¸°

2. **ë²”ìœ„ ì €ì¥** (`handleRangeSave`):
   - `onUpdate(updated)` í˜¸ì¶œí•˜ì—¬ ìµœì¢… ì½˜í…ì¸ ë¡œ ì—…ë°ì´íŠ¸
   - `setRangeModalOpen(false)` í˜¸ì¶œ
   - `setRangeModalContent(null)` í˜¸ì¶œ

3. **ëª¨ë‹¬ ë‹«ê¸°** (`RangeSettingModal`ì˜ `handleSave`):
   - `onSave` í˜¸ì¶œ í›„ `onClose()` í˜¸ì¶œ
   - `onClose` í•¸ë“¤ëŸ¬ê°€ ì‹¤í–‰ë˜ë©´ì„œ ì„ì‹œ ì½˜í…ì¸ ë¥¼ ì œê±°í•˜ë ¤ê³  ì‹œë„

### ë¬¸ì œì˜ ì›ì¸

`RangeSettingModal`ì˜ `handleSave`ì—ì„œ `onSave`ë¥¼ í˜¸ì¶œí•œ í›„ `onClose()`ë¥¼ í˜¸ì¶œí•˜ëŠ”ë°, `onClose` í•¸ë“¤ëŸ¬ëŠ” ì €ì¥ ì—¬ë¶€ë¥¼ êµ¬ë¶„í•˜ì§€ ì•Šê³  í•­ìƒ ì„ì‹œ ì½˜í…ì¸ ë¥¼ ì œê±°í•˜ë ¤ê³  ì‹œë„í–ˆìŠµë‹ˆë‹¤.

```typescript
// RangeSettingModalì˜ handleSave
const handleSave = useCallback(() => {
  // ... ë²”ìœ„ ê²€ì¦ ë° ì €ì¥ ë¡œì§ ...
  onSave({ start, end, start_detail_id, end_detail_id });
  onClose(); // ì—¬ê¸°ì„œ onCloseê°€ í˜¸ì¶œë¨
}, [onSave, onClose]);

// StudentContentsPanelì˜ onClose í•¸ë“¤ëŸ¬
onClose={() => {
  // ì €ì¥ ì—¬ë¶€ë¥¼ êµ¬ë¶„í•˜ì§€ ì•Šê³  í•­ìƒ ì„ì‹œ ì½˜í…ì¸ ë¥¼ ì œê±°í•˜ë ¤ê³  ì‹œë„
  const hasTempContent = selectedContents.some(
    (c) => c.content_id === rangeModalContent.id && c.isLoadingMetadata
  );
  if (hasTempContent) {
    const updated = selectedContents.filter(
      (c) => c.content_id !== rangeModalContent.id
    );
    onUpdate(updated); // ì €ì¥ëœ ì½˜í…ì¸ ë„ ì œê±°ë¨!
  }
  // ...
}}
```

## ğŸ›  ìˆ˜ì • ë‚´ìš©

### StudentContentsPanel.tsx - ì €ì¥ ì—¬ë¶€ ì¶”ì 

**íŒŒì¼**: `app/(student)/plan/new-group/_components/_features/content-selection/components/StudentContentsPanel.tsx`

**ë³€ê²½ ì‚¬í•­**:
1. `isRangeSavedRef` ref ì¶”ê°€í•˜ì—¬ ë²”ìœ„ ì €ì¥ ì—¬ë¶€ ì¶”ì 
2. `handleRangeSave`ì—ì„œ ì €ì¥ í”Œë˜ê·¸ ì„¤ì •
3. `onClose` í•¸ë“¤ëŸ¬ì—ì„œ ì €ì¥ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì—¬ ì„ì‹œ ì½˜í…ì¸  ì œê±° ì—¬ë¶€ ê²°ì •

**ì¶”ê°€ëœ ì½”ë“œ**:
```typescript
// ë²”ìœ„ ì €ì¥ ì—¬ë¶€ ì¶”ì  (onCloseì—ì„œ ì„ì‹œ ì½˜í…ì¸  ì œê±° ì—¬ë¶€ ê²°ì •)
const isRangeSavedRef = useRef(false);
```

**handleRangeSave ìˆ˜ì •**:
```typescript
// ë²”ìœ„ ì €ì¥ í”Œë˜ê·¸ ì„¤ì • (onCloseì—ì„œ ì„ì‹œ ì½˜í…ì¸ ë¥¼ ì œê±°í•˜ì§€ ì•Šë„ë¡)
isRangeSavedRef.current = true;

// onUpdate í˜¸ì¶œ
onUpdate(updated);

setRangeModalOpen(false);
setRangeModalContent(null);

// ë‹¤ìŒ ëª¨ë‹¬ ì—´ê¸°ë¥¼ ìœ„í•´ í”Œë˜ê·¸ ë¦¬ì…‹ (ì•½ê°„ì˜ ì§€ì—° í›„)
setTimeout(() => {
  isRangeSavedRef.current = false;
}, 100);
```

**onClose í•¸ë“¤ëŸ¬ ìˆ˜ì •**:
```typescript
onClose={() => {
  // ë²”ìœ„ê°€ ì €ì¥ëœ ê²½ìš° ì„ì‹œ ì½˜í…ì¸ ë¥¼ ì œê±°í•˜ì§€ ì•ŠìŒ
  if (isRangeSavedRef.current) {
    console.log("[StudentContentsPanel] ë²”ìœ„ê°€ ì €ì¥ë˜ì–´ ì„ì‹œ ì½˜í…ì¸  ì œê±°í•˜ì§€ ì•ŠìŒ");
    setRangeModalOpen(false);
    setRangeModalContent(null);
    return;
  }

  // ëª¨ë‹¬ì„ ë‹«ì„ ë•Œ ì„ì‹œë¡œ ì¶”ê°€í•œ ì½˜í…ì¸  ì œê±°
  // (ì €ì¥í•˜ì§€ ì•Šê³  ë‹«ì€ ê²½ìš°)
  if (rangeModalContent) {
    const hasTempContent = selectedContents.some(
      (c) => c.content_id === rangeModalContent.id && c.isLoadingMetadata
    );
    if (hasTempContent) {
      const updated = selectedContents.filter(
        (c) => c.content_id !== rangeModalContent.id
      );
      onUpdate(updated);
    }
  }
  setRangeModalOpen(false);
  setRangeModalContent(null);
}}
```

## âœ… ìˆ˜ì • ê²°ê³¼

### ë™ì‘ íë¦„

1. **ì½˜í…ì¸  ì„ íƒ**:
   - ì„ì‹œ ì½˜í…ì¸  ì¶”ê°€ (`isLoadingMetadata: true`)
   - ë²”ìœ„ ì„¤ì • ëª¨ë‹¬ ì—´ê¸°

2. **ë²”ìœ„ ì €ì¥**:
   - `handleRangeSave` í˜¸ì¶œ
   - `isRangeSavedRef.current = true` ì„¤ì •
   - ìµœì¢… ì½˜í…ì¸ ë¡œ ì—…ë°ì´íŠ¸ (`onUpdate(updated)`)
   - ëª¨ë‹¬ ë‹«ê¸° (`setRangeModalOpen(false)`)
   - `RangeSettingModal`ì˜ `handleSave`ì—ì„œ `onClose()` í˜¸ì¶œ
   - `onClose` í•¸ë“¤ëŸ¬ì—ì„œ ì €ì¥ ì—¬ë¶€ í™•ì¸ â†’ ì„ì‹œ ì½˜í…ì¸  ì œê±°í•˜ì§€ ì•ŠìŒ âœ…

3. **ëª¨ë‹¬ ë‹«ê¸° (ì €ì¥í•˜ì§€ ì•ŠìŒ)**:
   - `isRangeSavedRef.current = false` (ê¸°ë³¸ê°’)
   - `onClose` í•¸ë“¤ëŸ¬ì—ì„œ ì €ì¥ ì—¬ë¶€ í™•ì¸ â†’ ì„ì‹œ ì½˜í…ì¸  ì œê±° âœ…

## ğŸ“ ì°¸ê³  ì‚¬í•­

### refë¥¼ ì‚¬ìš©í•œ ì´ìœ 

- `useState`ë¥¼ ì‚¬ìš©í•˜ë©´ ìƒíƒœ ì—…ë°ì´íŠ¸ê°€ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬ë˜ì–´ íƒ€ì´ë° ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ
- `useRef`ë¥¼ ì‚¬ìš©í•˜ë©´ ì¦‰ì‹œ ê°’ì„ ì„¤ì •í•˜ê³  í™•ì¸í•  ìˆ˜ ìˆì–´ ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬ ê°€ëŠ¥

### í”Œë˜ê·¸ ë¦¬ì…‹ íƒ€ì´ë°

- ëª¨ë‹¬ì´ ë‹«íŒ í›„ ì•½ê°„ì˜ ì§€ì—°(100ms)ì„ ë‘ê³  í”Œë˜ê·¸ë¥¼ ë¦¬ì…‹
- ë‹¤ìŒ ëª¨ë‹¬ ì—´ê¸°ë¥¼ ìœ„í•´ í”Œë˜ê·¸ê°€ ì˜¬ë°”ë¥´ê²Œ ì´ˆê¸°í™”ë˜ë„ë¡ ë³´ì¥

## ğŸ”— ê´€ë ¨ íŒŒì¼

- `app/(student)/plan/new-group/_components/_features/content-selection/components/StudentContentsPanel.tsx`
- `app/(student)/plan/new-group/_components/_features/content-selection/components/RangeSettingModal.tsx`

