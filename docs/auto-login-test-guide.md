# 자동로그인 기능 테스트 가이드

## 📋 테스트 전 준비사항

1. 개발 서버 실행
   ```bash
   npm run dev
   ```

2. 테스트용 계정 준비 (이메일 인증 완료된 계정)

## 🧪 테스트 시나리오

### 시나리오 1: 자동로그인 체크박스 선택 후 로그인

1. **로그인 페이지 접속**
   - 브라우저에서 `http://localhost:3000/login` 접속

2. **자동로그인 체크박스 확인**
   - "자동로그인" 체크박스가 표시되는지 확인
   - 체크박스를 선택

3. **로그인 수행**
   - 이메일과 비밀번호 입력
   - "로그인" 버튼 클릭

4. **로그인 성공 확인**
   - 로그인 후 대시보드 또는 적절한 페이지로 리다이렉트되는지 확인

### 시나리오 2: 브라우저 쿠키 확인

1. **개발자 도구 열기**
   - `F12` 또는 `Ctrl+Shift+I` (Windows)
   - `Cmd+Option+I` (Mac)

2. **Application 탭 (Chrome) 또는 Storage 탭 (Firefox) 선택**

3. **Cookies 확인**
   - 왼쪽 메뉴에서 `Cookies` > `http://localhost:3000` 선택
   - Supabase 인증 관련 쿠키 확인:
     - `sb-*-auth-token` (세션 토큰)
     - `sb-*-auth-token-code-verifier` (PKCE 코드)

4. **쿠키 만료 시간 확인**
   - 각 쿠키의 `Expires / Max-Age` 값 확인
   - 자동로그인 선택 시: **30일 후**로 설정되어야 함
   - 자동로그인 미선택 시: **세션 종료 시** 또는 **기본 만료 시간**

### 시나리오 3: 브라우저 재시작 후 자동로그인 확인

1. **브라우저 완전 종료**
   - 모든 브라우저 창 닫기
   - 작업 관리자에서 브라우저 프로세스가 완전히 종료되었는지 확인

2. **브라우저 재시작**

3. **자동로그인 확인**
   - `http://localhost:3000` 접속
   - **자동로그인 선택한 경우**: 로그인 페이지를 거치지 않고 바로 대시보드로 이동해야 함
   - **자동로그인 미선택한 경우**: 로그인 페이지로 리다이렉트되어야 함

### 시나리오 4: 자동로그인 미선택 시 테스트

1. **로그인 페이지 접속**

2. **자동로그인 체크박스 미선택**

3. **로그인 수행**

4. **쿠키 확인**
   - 쿠키 만료 시간이 30일이 아닌 기본값으로 설정되어 있는지 확인

5. **브라우저 재시작 후 확인**
   - 브라우저를 닫았다가 다시 열면 로그인 페이지로 리다이렉트되어야 함

### 시나리오 5: 로그아웃 후 자동로그인 해제 확인

1. **자동로그인으로 로그인된 상태에서 로그아웃**

2. **쿠키 확인**
   - 인증 관련 쿠키가 삭제되었는지 확인

3. **페이지 새로고침**
   - 로그인 페이지로 리다이렉트되는지 확인

## 🔍 디버깅 팁

### 쿠키가 제대로 설정되지 않는 경우

1. **브라우저 콘솔 확인**
   ```javascript
   // 브라우저 콘솔에서 실행
   document.cookie
   ```

2. **서버 로그 확인**
   - 터미널에서 서버 로그 확인
   - 쿠키 설정 관련 에러 메시지 확인

3. **네트워크 탭 확인**
   - 개발자 도구 > Network 탭
   - 로그인 요청의 응답 헤더에서 `Set-Cookie` 확인

### 자동로그인이 작동하지 않는 경우

1. **쿠키 만료 시간 확인**
   - Application 탭에서 쿠키의 `Expires` 값 확인
   - 30일 후로 설정되어 있는지 확인

2. **쿠키 이름 확인**
   - Supabase는 `sb-{project-ref}-auth-token` 형식의 쿠키를 사용
   - 쿠키 이름이 올바른지 확인

3. **브라우저 쿠키 설정 확인**
   - 브라우저가 쿠키를 차단하지 않는지 확인
   - 시크릿 모드에서는 쿠키가 저장되지 않을 수 있음

## ✅ 테스트 체크리스트

- [ ] 자동로그인 체크박스가 로그인 페이지에 표시됨
- [ ] 자동로그인 선택 후 로그인 시 쿠키 만료 시간이 30일로 설정됨
- [ ] 자동로그인 미선택 후 로그인 시 쿠키 만료 시간이 기본값으로 설정됨
- [ ] 자동로그인 선택 후 브라우저 재시작 시 자동으로 로그인됨
- [ ] 자동로그인 미선택 후 브라우저 재시작 시 로그인 페이지로 리다이렉트됨
- [ ] 로그아웃 시 인증 쿠키가 삭제됨

## 🐛 알려진 이슈 및 해결 방법

### 이슈 1: 쿠키가 설정되지 않음

**원인**: Next.js 15에서 Server Component에서는 쿠키를 수정할 수 없음

**해결**: Server Action에서만 쿠키 설정이 가능하므로, 로그인은 Server Action을 통해 처리됨

### 이슈 2: 자동로그인 후에도 로그인 페이지로 리다이렉트됨

**원인**: 쿠키가 제대로 설정되지 않았거나, 세션 확인 로직에 문제가 있을 수 있음

**해결**: 
1. 쿠키가 실제로 설정되었는지 확인
2. `getCurrentUserRole` 함수가 올바르게 작동하는지 확인

## 📝 추가 참고사항

- Supabase는 기본적으로 refresh token을 사용하여 세션을 자동 갱신합니다
- 쿠키 만료 시간은 브라우저가 관리하며, 서버에서 설정한 값이 우선됩니다
- 자동로그인 기능은 보안상 공용 컴퓨터에서는 사용하지 않는 것이 좋습니다

