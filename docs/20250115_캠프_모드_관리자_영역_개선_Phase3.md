# 캠프 모드 관리자 영역 개선 - Phase 3 완료

## 작업 일시
2025-01-15

## 완료된 작업

### Phase 3: 핵심 기능 추가

#### 3.1 템플릿 복사 기능 ✅
- **데이터 레이어**: `lib/data/campTemplates.ts`
  - `copyCampTemplate` 함수 추가
  - 템플릿 데이터 전체 복사
  - 블록 세트 연결 복사 (`camp_template_block_sets` 테이블)
  - 초대 정보는 복사하지 않음

- **서버 액션**: `app/(admin)/actions/campTemplateActions.ts`
  - `copyCampTemplateAction` 추가
  - 권한 검증 및 입력값 검증
  - 경로 재검증

- **UI**: `app/(admin)/admin/camp-templates/[id]/CampTemplateDetail.tsx`
  - "템플릿 복사" 버튼 추가
  - 복사 확인 다이얼로그
  - 복사 후 새 템플릿 상세 페이지로 리다이렉트

#### 3.2 캠프 통계 데이터 조회 함수 ✅
- **파일 수정**: `lib/data/campTemplates.ts`
- **추가된 함수**:
  - `getCampStatisticsForTenant`: 테넌트별 전체 캠프 통계
  - `getCampTemplateStatistics`: 템플릿별 통계
- **통계 항목**:
  - 활성 템플릿 수
  - 전체 초대 수 / 수락 수 / 거절 수 / 대기중 수
  - 참여율 계산
  - 플랜 그룹 통계 (템플릿별)

#### 3.3 관리자 대시보드에 캠프 통계 섹션 추가 ✅
- **파일 수정**: `app/(admin)/admin/dashboard/page.tsx`
- **기능**:
  - 캠프 통계 카드 5개 (활성 템플릿, 전체 초대, 수락, 대기중, 참여율)
  - 캠프 관리 페이지로 이동하는 링크
  - 기존 통계 카드와 동일한 스타일 적용

#### 3.4 초대 상태 수동 변경 기능 ✅
- **서버 액션**: `app/(admin)/actions/campTemplateActions.ts`
  - `updateCampInvitationStatusAction` 추가
  - 상태 변경 시 타임스탬프 자동 업데이트 (accepted_at, declined_at)
  - pending 상태로 변경 시 타임스탬프 초기화

- **UI**: `app/(admin)/admin/camp-templates/[id]/CampInvitationList.tsx`
  - 상태 표시를 드롭다운으로 변경
  - 드롭다운에서 직접 상태 변경 가능
  - 변경 후 자동 새로고침

## 주요 변경 사항

### 수정된 파일
1. `lib/data/campTemplates.ts` - 템플릿 복사 및 통계 조회 함수 추가
2. `app/(admin)/actions/campTemplateActions.ts` - 템플릿 복사 및 초대 상태 변경 액션 추가
3. `app/(admin)/admin/camp-templates/[id]/CampTemplateDetail.tsx` - 템플릿 복사 버튼 추가
4. `app/(admin)/admin/dashboard/page.tsx` - 캠프 통계 섹션 추가
5. `app/(admin)/admin/camp-templates/[id]/CampInvitationList.tsx` - 상태 변경 드롭다운 추가

## 구현 세부 사항

### 템플릿 복사
- 원본 템플릿의 모든 데이터 복사 (이름, 설명, 프로그램 유형, template_data 등)
- 블록 세트 연결도 함께 복사
- 새 템플릿 이름은 기본적으로 "{원본 이름} (복사본)" 형식
- 복사 후 새 템플릿 상세 페이지로 자동 이동

### 캠프 통계
- 테넌트별 전체 통계와 템플릿별 통계 분리
- 참여율은 수락 수 / 전체 초대 수로 계산
- 관리자 대시보드에 통계 카드 5개 표시

### 초대 상태 변경
- 드롭다운으로 상태 변경 가능
- 상태 변경 시 타임스탬프 자동 업데이트
- pending → accepted: accepted_at 설정, declined_at 초기화
- pending → declined: declined_at 설정, accepted_at 초기화
- accepted/declined → pending: 모든 타임스탬프 초기화

## 참고 사항

- 템플릿 복사 시 초대 정보는 복사하지 않음 (의도된 동작)
- 블록 세트 연결 실패해도 템플릿 복사는 성공으로 처리 (경고만)
- 통계 데이터는 실시간 조회 (캐싱 미적용)
- 초대 상태 변경은 즉시 반영되며 목록이 자동 새로고침됨




