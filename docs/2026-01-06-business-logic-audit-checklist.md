# ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì ê²€ ì²´í¬ë¦¬ìŠ¤íŠ¸

**ì‘ì„±ì¼**: 2026-01-06  
**ëª©ì **: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ ì•ˆì •ì„±, ì¼ê´€ì„±, ìœ ì§€ë³´ìˆ˜ì„± ì ê²€ ë° ê°œì„  ì‚¬í•­ ë„ì¶œ

---

## ğŸ“‹ ëª©ì°¨

1. [ì „ì²´ ê°œìš”](#1-ì „ì²´-ê°œìš”)
2. [íŠ¸ëœì­ì…˜ ì²˜ë¦¬](#2-íŠ¸ëœì­ì…˜-ì²˜ë¦¬)
3. [ë°ì´í„° ì¼ê´€ì„±](#3-ë°ì´í„°-ì¼ê´€ì„±)
4. [ë™ì‹œì„± ì œì–´](#4-ë™ì‹œì„±-ì œì–´)
5. [íƒ€ì… ì•ˆì „ì„±](#5-íƒ€ì…-ì•ˆì „ì„±)
6. [ì—ëŸ¬ ì²˜ë¦¬](#6-ì—ëŸ¬-ì²˜ë¦¬)
7. [ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦](#7-ë¹„ì¦ˆë‹ˆìŠ¤-ê·œì¹™-ê²€ì¦)
8. [ì„±ëŠ¥ ë° ìµœì í™”](#8-ì„±ëŠ¥-ë°-ìµœì í™”)
9. [ë¯¸ì™„ë£Œ ì‘ì—…](#9-ë¯¸ì™„ë£Œ-ì‘ì—…)
10. [ìš°ì„ ìˆœìœ„ë³„ ê°œì„  ê³„íš](#10-ìš°ì„ ìˆœìœ„ë³„-ê°œì„ -ê³„íš)

---

## 1. ì „ì²´ ê°œìš”

### 1.1 ì ê²€ ë²”ìœ„

ì´ ë¬¸ì„œëŠ” ë‹¤ìŒ ì˜ì—­ì˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì ê²€í•©ë‹ˆë‹¤:

- **í”Œëœ ìƒì„± ë° ê´€ë¦¬**: í”Œëœ ê·¸ë£¹, í”Œëœ, ë‹¨ë°œì„± í”Œëœ
- **ìŠ¤ì¼€ì¤„ë§**: 1730 íƒ€ì„í…Œì´ë¸”, ê¸°ë³¸ ìŠ¤ì¼€ì¤„ëŸ¬
- **í•™ìŠµ ì„¸ì…˜**: íƒ€ì´ë¨¸, ì„¸ì…˜ ê´€ë¦¬
- **ì„±ì  ê´€ë¦¬**: ì„±ì  ì…ë ¥, ë¶„ì„
- **ìº í”„ ê´€ë¦¬**: ìº í”„ ìƒì„±, ì§„í–‰ ê´€ë¦¬
- **ë°°ì¹˜ ì²˜ë¦¬**: ëŒ€ëŸ‰ í”Œëœ ìƒì„±, ì¼ê´„ ì‘ì—…

### 1.2 ì‹¬ê°ë„ ë¶„ë¥˜

| ì‹¬ê°ë„ | ì„¤ëª… | ì¡°ì¹˜ ì‹œê¸° |
|--------|------|----------|
| **ğŸ”´ CRITICAL** | ì¦‰ì‹œ ìˆ˜ì • í•„ìš”, ë°ì´í„° ì†ì‹¤/ë¶ˆì¼ì¹˜ ìœ„í—˜ | ì¦‰ì‹œ |
| **ğŸŸ  HIGH** | ë¹ ë¥¸ ì‹œì¼ ë‚´ ìˆ˜ì • ê¶Œì¥, ì‚¬ìš©ì ê²½í—˜ì— í° ì˜í–¥ | 1ì£¼ì¼ ë‚´ |
| **ğŸŸ¡ MEDIUM** | ì¤‘ê¸° ê°œì„  ê¶Œì¥, ì ì§„ì  ê°œì„  ê°€ëŠ¥ | 1ê°œì›” ë‚´ |
| **ğŸŸ¢ LOW** | ì¥ê¸° ê°œì„ , ìš°ì„ ìˆœìœ„ ë‚®ìŒ | 3ê°œì›” ë‚´ |

---

## 2. íŠ¸ëœì­ì…˜ ì²˜ë¦¬

### 2.1 í˜„ì¬ ìƒíƒœ

#### âœ… ì˜ êµ¬í˜„ëœ ë¶€ë¶„

1. **ì›ìì  íŠ¸ëœì­ì…˜ (RPC í•¨ìˆ˜)**
   - `create_plan_group_atomic`: í”Œëœ ê·¸ë£¹ ìƒì„± ì‹œ ê´€ë ¨ í…Œì´ë¸” ëª¨ë‘ íŠ¸ëœì­ì…˜ ì²˜ë¦¬
   - `generate_plans_atomic`: í”Œëœ ìƒì„± ì‹œ ì‚­ì œ/ì‚½ì…/ìƒíƒœ ì—…ë°ì´íŠ¸ ì›ìì  ì²˜ë¦¬
   - `complete_plan_atomic`: í”Œëœ ì™„ë£Œ ì‹œ ì„¸ì…˜ ì¢…ë£Œì™€ í”Œëœ ìƒíƒœ ì—…ë°ì´íŠ¸ ì›ìì  ì²˜ë¦¬
   - **ìœ„ì¹˜**: `lib/domains/plan/transactions.ts`, `lib/domains/today/transactions.ts`

2. **ë°°ì¹˜ ì‘ì—… ìœ í‹¸ë¦¬í‹°**
   - `withBatchOperations`: ìˆœì°¨ ì‹¤í–‰ + ì—ëŸ¬ ì¶”ì  + ë¡¤ë°± íŒíŠ¸
   - `createTransactionContext`: íŠ¸ëœì­ì…˜ ì»¨í…ìŠ¤íŠ¸ ìƒì„±
   - **ìœ„ì¹˜**: `lib/supabase/transaction.ts`

3. **ì¬ì¡°ì • íŠ¸ëœì­ì…˜**
   - `executeRescheduleTransaction`: í”Œëœ ê·¸ë£¹ ë‹¨ìœ„ ë½ íšë“ í›„ ì‘ì—… ì‹¤í–‰
   - **ìœ„ì¹˜**: `lib/reschedule/transaction.ts`

#### âš ï¸ ê°œì„  í•„ìš” ì‚¬í•­

1. **DELETE â†’ INSERT íŒ¨í„´ ì‚¬ìš©** ğŸŸ¡ MEDIUM

   **ìœ„ì¹˜**: 
   - `lib/domains/camp/actions/student.ts` (745ì¤„, 1070-1073ì¤„, 1178-1181ì¤„)
   - `lib/domains/plan/actions/contentPlanGroup/quickCreate.ts` (504ì¤„)

   **ë¬¸ì œ**:
   ```typescript
   // í˜„ì¬: DELETE í›„ INSERT (íŠ¸ëœì­ì…˜ ì—†ìŒ)
   await supabase.from("plan_contents").delete().eq("plan_group_id", groupId);
   await supabase.from("plan_contents").insert(newContents);
   ```

   **ìœ„í—˜**:
   - DELETE ì„±ê³µ í›„ INSERT ì‹¤íŒ¨ ì‹œ ë°ì´í„° ì†ì‹¤
   - ì¤‘ê°„ ìƒíƒœì—ì„œ ë‹¤ë¥¸ ìš”ì²­ì´ ì¡°íšŒí•˜ë©´ ë°ì´í„° ë¶ˆì¼ì¹˜

   **ê°œì„  ë°©ì•ˆ**:
   ```typescript
   // ì˜µì…˜ 1: RPC í•¨ìˆ˜ë¡œ íŠ¸ëœì­ì…˜ ì²˜ë¦¬
   await supabase.rpc("upsert_plan_contents", {
     p_group_id: groupId,
     p_contents: newContents
   });

   // ì˜µì…˜ 2: ë°°ì¹˜ ì‘ì—…ìœ¼ë¡œ ìˆœì°¨ ì‹¤í–‰
   await withBatchOperations([
     { name: "Delete old", execute: () => deleteOld() },
     { name: "Insert new", execute: () => insertNew() }
   ]);
   ```

2. **íŠ¸ëœì­ì…˜ ë²”ìœ„ ë¶ˆëª…í™•** ğŸŸ¡ MEDIUM

   **ìœ„ì¹˜**: 
   - `lib/domains/plan/llm/actions/generatePlan.ts` (306ì¤„)
   - `lib/domains/admin-plan/actions/planTemplates.ts` (249ì¤„)

   **ë¬¸ì œ**:
   - í”Œëœ ìƒì„± ì‹œ ì—¬ëŸ¬ í…Œì´ë¸” ì—…ë°ì´íŠ¸ê°€ ê°œë³„ ì¿¼ë¦¬ë¡œ ì‹¤í–‰
   - ì¼ë¶€ ì„±ê³µ/ì¼ë¶€ ì‹¤íŒ¨ ì‹œ ë°ì´í„° ë¶ˆì¼ì¹˜ ê°€ëŠ¥

   **ê°œì„  ë°©ì•ˆ**:
   - `generate_plans_atomic` RPC í•¨ìˆ˜ ì‚¬ìš© ë˜ëŠ”
   - ë°°ì¹˜ ì‘ì—…ìœ¼ë¡œ ë¬¶ì–´ì„œ ì²˜ë¦¬

3. **ë¡¤ë°± ë¡œì§ ë¶€ì¬** ğŸŸ  HIGH

   **ìœ„ì¹˜**: `lib/supabase/transaction.ts`

   **ë¬¸ì œ**:
   - `withBatchOperations`ëŠ” ë¡¤ë°± íŒíŠ¸ë§Œ ì œê³µ
   - ì‹¤ì œ ë¡¤ë°±ì€ ìˆ˜ë™ìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ í•¨
   - ë³µì¡í•œ íŠ¸ëœì­ì…˜ì—ì„œ ë¡¤ë°± ëˆ„ë½ ê°€ëŠ¥

   **ê°œì„  ë°©ì•ˆ**:
   ```typescript
   // ë¡¤ë°± í•¨ìˆ˜ ìë™ ì‹¤í–‰
   const result = await withBatchOperations(operations);
   if (!result.success && result.rollbackIds) {
     await rollbackUpdates(supabase, tableName, result.rollbackIds, rollbackData);
   }
   ```

---

## 3. ë°ì´í„° ì¼ê´€ì„±

### 3.1 í˜„ì¬ ìƒíƒœ

#### âœ… ì˜ êµ¬í˜„ëœ ë¶€ë¶„

1. **ì¤‘ë³µ ë°©ì§€**
   - ê¸°ê°„ ì¤‘ë³µ ê²€ì¦ (`checkPlanPeriodOverlap`)
   - Draft ì¤‘ë³µ ìƒì„± ë°©ì§€ (`findExistingDraftPlanGroup`)
   - Unique constraintë¡œ DB ë ˆë²¨ ì¤‘ë³µ ë°©ì§€

2. **ìƒíƒœ ê´€ë¦¬**
   - `PlanStatusManager`ë¡œ ìƒíƒœë³„ ê¶Œí•œ ì²´í¬
   - ìƒíƒœ ì „ì´ ê·œì¹™ ëª…í™•í™”

3. **ì œì™¸ì¼ ê²€ì¦**
   - í”Œëœ ì´ë™ ì‹œ ì œì™¸ì¼ ê²€ì¦ (`checkExclusionDate`)
   - **ìœ„ì¹˜**: `lib/domains/plan/actions/calendarDrag.ts` (112ì¤„)

#### âš ï¸ ê°œì„  í•„ìš” ì‚¬í•­

1. **ì½˜í…ì¸  ì—…ë°ì´íŠ¸ ë°©ì‹** ğŸŸ¡ MEDIUM

   **ìœ„ì¹˜**: `lib/domains/plan/actions/contentPlanGroup/quickCreate.ts`

   **ë¬¸ì œ**:
   - ê¸°ì¡´ ì‚­ì œ í›„ ì¬ìƒì„± (DELETE â†’ INSERT)
   - ì‚­ì œ/ìƒì„± ì‚¬ì´ì— ë°ì´í„° ë¶ˆì¼ì¹˜ ê°€ëŠ¥

   **ê°œì„  ë°©ì•ˆ**:
   - UPSERT íŒ¨í„´ ì‚¬ìš© ë˜ëŠ”
   - íŠ¸ëœì­ì…˜ ë‚´ ì²˜ë¦¬

2. **ì œì™¸ì¼/í•™ì› ì¼ì • ì¤‘ë³µ ê´€ë¦¬** ğŸŸ¡ MEDIUM

   **ìœ„ì¹˜**: í”Œëœ ê·¸ë£¹ë³„ë¡œ ë…ë¦½ ê´€ë¦¬

   **ë¬¸ì œ**:
   - í”Œëœ ê·¸ë£¹ ê°„ ì¤‘ë³µ í—ˆìš©ìœ¼ë¡œ ì¸í•œ ë°ì´í„° ì¤‘ë³µ
   - í•™ìƒë³„ ì „ì—­ ê´€ë¦¬ í•„ìš”

   **ê°œì„  ë°©ì•ˆ**:
   - í•™ìƒë³„ ì „ì—­ ê´€ë¦¬ë¡œ ì „í™˜ (Phase 2 ê³„íš)

3. **í”Œëœ ìƒíƒœì™€ ì§„í–‰ë¥  ë¶ˆì¼ì¹˜** ğŸŸ  HIGH

   **ìœ„ì¹˜**: `lib/domains/plan/actions/core.ts`

   **ë¬¸ì œ**:
   - `status` í•„ë“œì™€ `completed_at` í•„ë“œ ì¼ê´€ì„± ë¶€ì¡±
   - ì§„í–‰ë¥  ê³„ì‚° ë¡œì§ í‘œì¤€í™” í•„ìš”

   **ê°œì„  ë°©ì•ˆ**:
   ```typescript
   // ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹œ ì§„í–‰ë¥  ìë™ ê³„ì‚°
   function updatePlanStatus(plan: Plan, status: PlanStatus) {
     if (status === "completed") {
       plan.completed_at = new Date();
       plan.progress = 100;
     } else if (status === "in_progress") {
       plan.progress = calculateProgress(plan);
     }
   }
   ```

---

## 4. ë™ì‹œì„± ì œì–´

### 4.1 í˜„ì¬ ìƒíƒœ

#### âœ… ì˜ êµ¬í˜„ëœ ë¶€ë¶„

1. **íƒ€ì´ë¨¸ Race Condition ë°©ì§€** âœ…

   **ìœ„ì¹˜**: `lib/domains/today/actions/timer.ts` (134-168ì¤„)

   **êµ¬í˜„**:
   - ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨: activeSessions, activeAdHocPlans ê²€ì‚¬ (1ì°¨ ë°©ì–´ì„ )
   - DB ë ˆë²¨: `idx_unique_active_session_per_student` ìœ ë‹ˆí¬ ì œì•½ (2ì°¨ ë°±ì—… ë°©ì–´ì„ )
   - ë™ì‹œ ìš”ì²­ ì‹œ 1ì°¨ ë°©ì–´ì„ ì„ í†µê³¼í•´ë„ 2ì°¨ì—ì„œ ì°¨ë‹¨

   ```typescript
   // [ê²½í•© ë°©ì§€ ê·œì¹™ 1] ë™ì‹œ ì‹¤í–‰ ê¸ˆì§€
   const conflictCheck = await checkForConflictingTimers(user.userId, {
     excludePlanId: planId,
   });

   // Race Condition ë°©ì§€ ì „ëµ:
   // 1. ì• í”Œë¦¬ì¼€ì´ì…˜ ë ˆë²¨: ìœ„ì—ì„œ activeSessions, activeAdHocPlans ê²€ì‚¬
   // 2. DB ë ˆë²¨: idx_unique_active_session_per_student ìœ ë‹ˆí¬ ì œì•½
   ```

2. **ì¬ì¡°ì • ë½ ë©”ì»¤ë‹ˆì¦˜** âœ…

   **ìœ„ì¹˜**: `lib/reschedule/transaction.ts` (41-70ì¤„)

   **êµ¬í˜„**:
   - í”Œëœ ê·¸ë£¹ ë‹¨ìœ„ ë½ íšë“ (`acquirePlanGroupLock`)
   - ë™ì‹œ ì¬ì¡°ì • ë°©ì§€

#### âš ï¸ ê°œì„  í•„ìš” ì‚¬í•­

1. **í”Œëœ ìƒì„± ë™ì‹œì„± ì œì–´ ë¶€ì¬** ğŸŸ  HIGH

   **ìœ„ì¹˜**: `lib/domains/plan/actions/plan-groups/generatePlansWithServices.ts`

   **ë¬¸ì œ**:
   - ë™ì¼ í”Œëœ ê·¸ë£¹ì— ëŒ€í•œ ë™ì‹œ ìƒì„± ìš”ì²­ ì‹œ ì¤‘ë³µ ìƒì„± ê°€ëŠ¥
   - í”Œëœ ê·¸ë£¹ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹œ Race Condition ê°€ëŠ¥

   **ê°œì„  ë°©ì•ˆ**:
   ```typescript
   // í”Œëœ ê·¸ë£¹ ë½ íšë“
   const lockAcquired = await acquirePlanGroupLock(supabase, groupId);
   if (!lockAcquired) {
     throw new Error("í”Œëœ ìƒì„±ì´ ì´ë¯¸ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.");
   }

   try {
     // í”Œëœ ìƒì„± ë¡œì§
   } finally {
     await releasePlanGroupLock(supabase, groupId);
   }
   ```

2. **í”Œëœ ìˆ˜ì • ë™ì‹œì„± ì œì–´ ë¶€ì¬** ğŸŸ¡ MEDIUM

   **ìœ„ì¹˜**: `lib/domains/plan/actions/calendarDrag.ts`

   **ë¬¸ì œ**:
   - ë™ì¼ í”Œëœì— ëŒ€í•œ ë™ì‹œ ìˆ˜ì • ìš”ì²­ ì‹œ ë§ˆì§€ë§‰ ìš”ì²­ë§Œ ë°˜ì˜
   - Optimistic Locking ë¯¸ì ìš©

   **ê°œì„  ë°©ì•ˆ**:
   ```typescript
   // Optimistic Locking ì ìš©
   const { data, error } = await supabase
     .from("student_plan")
     .update({ ... })
     .eq("id", planId)
     .eq("updated_at", lastUpdatedAt); // ë²„ì „ ì²´í¬

   if (!data || data.length === 0) {
     throw new Error("í”Œëœì´ ì´ë¯¸ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
   }
   ```

---

## 5. íƒ€ì… ì•ˆì „ì„±

### 5.1 í˜„ì¬ ìƒíƒœ

#### âœ… ì˜ êµ¬í˜„ëœ ë¶€ë¶„

1. **íƒ€ì… ì •ì˜ ì²´ê³„í™”**
   - ë„ë©”ì¸ë³„ íƒ€ì… íŒŒì¼ ë¶„ë¦¬ (`lib/domains/*/types.ts`)
   - Zod ìŠ¤í‚¤ë§ˆì™€ íƒ€ì… ë™ê¸°í™”

2. **íƒ€ì… ê°€ë“œ í•¨ìˆ˜**
   - `isRecoverableError`, `isTimeoutError` ë“±

#### âš ï¸ ê°œì„  í•„ìš” ì‚¬í•­

1. **`any` íƒ€ì… ì‚¬ìš©** ğŸŸ¡ MEDIUM

   **ìœ„ì¹˜**:
   - `lib/domains/plan/actions/calendarDrag.ts` (105ì¤„, 143ì¤„, 425ì¤„)
   - `lib/domains/plan/actions/contentIndividualization.ts` (176ì¤„, 256ì¤„, 316ì¤„, 380ì¤„)
   - `lib/domains/gamification/services/gamificationService.ts` (111ì¤„)
   - `lib/domains/habit/actions/crud.ts` (115ì¤„)
   - `lib/domains/habit/actions/logging.ts` (232ì¤„)
   - `lib/domains/plan/llm/providers/gemini.ts` (610ì¤„)

   **ë¬¸ì œ**:
   ```typescript
   // âŒ ë‚˜ìœ ì˜ˆ
   const isOwner = (existingPlan as any).plan_groups?.student_id === user.userId;
   const studentId = (planContent as any).plan_groups?.student_id;
   ```

   **ê°œì„  ë°©ì•ˆ**:
   ```typescript
   // âœ… ì¢‹ì€ ì˜ˆ: íƒ€ì… ì •ì˜
   interface PlanWithGroup extends Plan {
     plan_groups?: {
       student_id: string;
     };
   }

   const planWithGroup = existingPlan as PlanWithGroup;
   const isOwner = planWithGroup.plan_groups?.student_id === user.userId;
   ```

2. **Null ì²´í¬ ë¶€ì¡±** ğŸŸ¡ MEDIUM

   **ìœ„ì¹˜**: Supabase ì¿¼ë¦¬ ê²°ê³¼ ì²˜ë¦¬

   **ë¬¸ì œ**:
   - `data`ê°€ `null`ì¼ ìˆ˜ ìˆëŠ”ë° ì²´í¬ ì—†ì´ ì ‘ê·¼
   - Optional Chaining ë¯¸ì‚¬ìš©

   **ê°œì„  ë°©ì•ˆ**:
   ```typescript
   // âœ… ì¢‹ì€ ì˜ˆ
   const { data, error } = await supabase.from("students").select("*");
   if (error) throw error;
   const studentList = data ?? []; // null ì²´í¬
   ```

---

## 6. ì—ëŸ¬ ì²˜ë¦¬

### 6.1 í˜„ì¬ ìƒíƒœ

#### âœ… ì˜ êµ¬í˜„ëœ ë¶€ë¶„

1. **í‘œì¤€ ì—ëŸ¬ ì²˜ë¦¬**
   - `AppError` í´ë˜ìŠ¤ë¡œ ì¼ê´€ëœ ì—ëŸ¬ í˜•ì‹
   - `ErrorCode` enumìœ¼ë¡œ ì—ëŸ¬ ë¶„ë¥˜
   - **ìœ„ì¹˜**: `lib/errors/handler.ts`

2. **ì—ëŸ¬ ë³µêµ¬ ê°€ì´ë“œ**
   - `recoveryGuide.ts`ë¡œ ë³µêµ¬ ë°©ë²• ì œê³µ
   - **ìœ„ì¹˜**: `lib/errors/recoveryGuide.ts`

3. **ë„ë©”ì¸ë³„ ì—ëŸ¬ ì²˜ë¦¬**
   - `PlanGroupError`, `CampError` ë“± ë„ë©”ì¸ë³„ ì—ëŸ¬ í´ë˜ìŠ¤
   - **ìœ„ì¹˜**: `lib/errors/planGroupErrors.ts`, `lib/domains/camp/errors.ts`

#### âš ï¸ ê°œì„  í•„ìš” ì‚¬í•­

1. **ì—ëŸ¬ ë©”ì‹œì§€ ì¼ê´€ì„±** ğŸŸ¡ MEDIUM

   **ìœ„ì¹˜**: ì—¬ëŸ¬ ì•¡ì…˜ íŒŒì¼

   **ë¬¸ì œ**:
   - ì—ëŸ¬ ë©”ì‹œì§€ í˜•ì‹ì´ ì¼ê´€ë˜ì§€ ì•ŠìŒ
   - ì‚¬ìš©ì ì¹œí™”ì  ë©”ì‹œì§€ì™€ ê¸°ìˆ ì  ë©”ì‹œì§€ í˜¼ì¬

   **ê°œì„  ë°©ì•ˆ**:
   ```typescript
   // í‘œì¤€ ì—ëŸ¬ ë©”ì‹œì§€ í¬ë§·
   throw new AppError(
     "í”Œëœ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", // ì‚¬ìš©ì ë©”ì‹œì§€
     ErrorCode.BUSINESS_LOGIC_ERROR,
     400,
     true, // ì‚¬ìš©ìì—ê²Œ í‘œì‹œ
     { reason: 'insufficient_study_days' } // ê¸°ìˆ ì  ì •ë³´
   );
   ```

2. **ì—ëŸ¬ ë¡œê¹… ë¶€ì¡±** ğŸŸ¡ MEDIUM

   **ìœ„ì¹˜**: ì¼ë¶€ ì•¡ì…˜ íŒŒì¼

   **ë¬¸ì œ**:
   - ì—ëŸ¬ ë°œìƒ ì‹œ ë¡œê¹…ì´ ëˆ„ë½ë˜ê±°ë‚˜ ë¶ˆì¶©ë¶„
   - ë””ë²„ê¹…ì´ ì–´ë ¤ì›€

   **ê°œì„  ë°©ì•ˆ**:
   ```typescript
   // ëª¨ë“  ì—ëŸ¬ ë¡œê¹…
   catch (error) {
     logActionError("í”Œëœ ìƒì„± ì‹¤íŒ¨", {
       action: "generatePlan",
       groupId,
       error: error instanceof Error ? error : new Error(String(error)),
     });
     throw error;
   }
   ```

---

## 7. ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ ê²€ì¦

### 7.1 í˜„ì¬ ìƒíƒœ

#### âœ… ì˜ êµ¬í˜„ëœ ë¶€ë¶„

1. **Wizard ê²€ì¦**
   - `WizardValidator`ë¡œ ë‹¨ê³„ë³„ ê²€ì¦
   - Zod ìŠ¤í‚¤ë§ˆ + ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê²€ì¦
   - **ìœ„ì¹˜**: `lib/validation/wizardValidator.ts`

2. **í”Œëœ ê²€ì¦**
   - `PlanValidationService`ë¡œ í”Œëœ ê²€ì¦
   - `validatePlansEnhanced`ë¡œ AI ìƒì„± í”Œëœ ê²€ì¦
   - **ìœ„ì¹˜**: `lib/domains/plan/services/planValidationService.ts`

3. **ìŠ¬ë¡¯ ê²€ì¦**
   - `SlotValidationService`ë¡œ ìŠ¬ë¡¯ ê²€ì¦
   - **ìœ„ì¹˜**: `lib/domains/plan/services/slotValidationService.ts`

#### âš ï¸ ê°œì„  í•„ìš” ì‚¬í•­

1. **ê²€ì¦ ë¡œì§ ë¶„ì‚°** ğŸŸ¡ MEDIUM

   **ìœ„ì¹˜**: ì—¬ëŸ¬ íŒŒì¼ì— ê²€ì¦ ë¡œì§ ë¶„ì‚°

   **ë¬¸ì œ**:
   - ë™ì¼í•œ ê²€ì¦ ë¡œì§ì´ ì—¬ëŸ¬ ê³³ì— ì¤‘ë³µ
   - ê²€ì¦ ê·œì¹™ ë³€ê²½ ì‹œ ì—¬ëŸ¬ íŒŒì¼ ìˆ˜ì • í•„ìš”

   **ê°œì„  ë°©ì•ˆ**:
   - ê²€ì¦ ë¡œì§ì„ Service ë ˆì´ì–´ë¡œ í†µí•©
   - ë‹¨ì¼ ì§„ì‹¤ì˜ ì›ì²œ(Single Source of Truth) ìœ ì§€

2. **ê²€ì¦ ì‹¤íŒ¨ ì‹œ ë³µêµ¬ ë¡œì§ ë¶€ì¬** ğŸŸ¡ MEDIUM

   **ìœ„ì¹˜**: ê²€ì¦ ì‹¤íŒ¨ ì‹œ ë‹¨ìˆœ ì—ëŸ¬ ë°˜í™˜

   **ë¬¸ì œ**:
   - ê²€ì¦ ì‹¤íŒ¨ ì‹œ ì‚¬ìš©ìê°€ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ê°€ì´ë“œ ë¶€ì¡±
   - ìë™ ë³µêµ¬ ë¡œì§ ì—†ìŒ

   **ê°œì„  ë°©ì•ˆ**:
   ```typescript
   // ê²€ì¦ ì‹¤íŒ¨ ì‹œ ë³µêµ¬ ì œì•ˆ
   const validation = validatePlans(plans);
   if (!validation.isValid) {
     const suggestions = generateRecoverySuggestions(validation.errors);
     return {
       success: false,
       errors: validation.errors,
       suggestions, // ë³µêµ¬ ì œì•ˆ
     };
   }
   ```

---

## 8. ì„±ëŠ¥ ë° ìµœì í™”

### 8.1 í˜„ì¬ ìƒíƒœ

#### âœ… ì˜ êµ¬í˜„ëœ ë¶€ë¶„

1. **ìºì‹± ì „ëµ**
   - React Query ìºì‹±
   - Episode Map ìºì‹± (SchedulerEngine)
   - **ìœ„ì¹˜**: `lib/scheduler/SchedulerEngine.ts`

2. **ë°°ì¹˜ ì²˜ë¦¬**
   - `useBatchProcessor` í›…ìœ¼ë¡œ ëŒ€ëŸ‰ ì²˜ë¦¬
   - ìˆœì°¨/ë³‘ë ¬ ì²˜ë¦¬ ì§€ì›
   - **ìœ„ì¹˜**: `app/(admin)/admin/plan-creation/_hooks/useBatchProcessor.ts`

#### âš ï¸ ê°œì„  í•„ìš” ì‚¬í•­

1. **N+1 ì¿¼ë¦¬ ë¬¸ì œ** ğŸŸ  HIGH

   **ìœ„ì¹˜**: í”Œëœ ìƒì„± ì‹œ ì½˜í…ì¸  ì¡°íšŒ

   **ë¬¸ì œ**:
   - ê° í”Œëœë§ˆë‹¤ ì½˜í…ì¸  ì¡°íšŒ ì¿¼ë¦¬ ì‹¤í–‰
   - ëŒ€ëŸ‰ í”Œëœ ìƒì„± ì‹œ ì„±ëŠ¥ ì €í•˜

   **ê°œì„  ë°©ì•ˆ**:
   ```typescript
   // âœ… ì¢‹ì€ ì˜ˆ: ë°°ì¹˜ ì¡°íšŒ
   const contentIds = plans.map(p => p.content_id);
   const contents = await getContentsBatch(contentIds);
   const contentMap = new Map(contents.map(c => [c.id, c]));
   ```

2. **ë¶ˆí•„ìš”í•œ ì¬ê³„ì‚°** ğŸŸ¡ MEDIUM

   **ìœ„ì¹˜**: `lib/scheduler/SchedulerEngine.ts`

   **ë¬¸ì œ**:
   - Episode Mapì„ ë§¤ë²ˆ ìƒì„±í•˜ì—¬ ì¤‘ë³µ ì‘ì—… ë°œìƒ
   - ì´ë¯¸ í•´ê²°ë¨ (ìºì‹± ì ìš©)

3. **íƒ€ì„ë¼ì¸ ì„±ëŠ¥** ğŸŸ  HIGH

   **ìœ„ì¹˜**: `app/(student)/plan/calendar/_utils/timelineUtils.ts`

   **ë¬¸ì œ**:
   - ëŒ€ëŸ‰ í”Œëœ ì²˜ë¦¬ ì‹œ ì„±ëŠ¥ ì €í•˜
   - ê°€ìƒí™” ë¯¸ì ìš©

   **ê°œì„  ë°©ì•ˆ**:
   - ê°€ìƒí™”(Virtualization) ì ìš©
   - ë©”ëª¨ì´ì œì´ì…˜ ê°•í™”

---

## 9. ë¯¸ì™„ë£Œ ì‘ì—…

### 9.1 TODO ì£¼ì„ ì •ë¦¬

#### ğŸ”´ CRITICAL (ì¦‰ì‹œ ì²˜ë¦¬ í•„ìš”)

1. **í•™ì› ì¼ì • ë¡œë“œ ë¯¸êµ¬í˜„** ğŸŸ  HIGH

   **ìœ„ì¹˜**: `lib/domains/admin-plan/actions/batchPreviewPlans.ts` (414ì¤„)

   ```typescript
   academySchedules: [], // TODO: í•™ì› ì¼ì • ë¡œë“œ
   ```

   **ì˜í–¥**:
   - ë°°ì¹˜ ë¯¸ë¦¬ë³´ê¸°ì—ì„œ í•™ì› ì¼ì •ì´ ë°˜ì˜ë˜ì§€ ì•ŠìŒ
   - í”Œëœ ìƒì„± ì‹œ ì‹œê°„ ì¶©ëŒ ê°€ëŠ¥

   **ê°œì„  ë°©ì•ˆ**:
   ```typescript
   const academySchedules = await getAcademySchedules(studentId, period);
   ```

2. **ë¸”ë¡ ì •ë³´ ë¡œë“œ ë¯¸êµ¬í˜„** ğŸŸ  HIGH

   **ìœ„ì¹˜**: `lib/domains/admin-plan/actions/batchPreviewPlans.ts` (415ì¤„)

   ```typescript
   blockSets: [], // TODO: ë¸”ë¡ ì •ë³´ ë¡œë“œ
   ```

   **ì˜í–¥**:
   - ë°°ì¹˜ ë¯¸ë¦¬ë³´ê¸°ì—ì„œ ë¸”ë¡ì…‹ ì •ë³´ê°€ ë°˜ì˜ë˜ì§€ ì•ŠìŒ
   - ê°€ìš© ì‹œê°„ ê³„ì‚° ë¶€ì •í™•

   **ê°œì„  ë°©ì•ˆ**:
   ```typescript
   const blockSets = await getBlockSets(studentId);
   ```

#### ğŸŸ¡ MEDIUM (ì¤‘ê¸° ê°œì„ )

1. **ì½˜í…ì¸  ì œëª© ì¡°ì¸ ë¯¸êµ¬í˜„**

   **ìœ„ì¹˜**: 
   - `lib/domains/plan/actions/content-calendar.ts` (558ì¤„)
   - `lib/domains/plan/actions/timezone.ts` (347ì¤„)

   ```typescript
   content_title: "", // TODO: ì½˜í…ì¸  ì œëª© ì¡°ì¸
   ```

2. **ì‹œê³„ì—´ ë¶„ì„ ë¯¸êµ¬í˜„**

   **ìœ„ì¹˜**: `lib/domains/plan/actions/statistics.ts` (263ì¤„)

   ```typescript
   trend: "stable" as const, // TODO: ì‹œê³„ì—´ ë¶„ì„
   ```

3. **ë¸”ë¡ì…‹ ê¸°ë°˜ ê³„ì‚° ë¯¸êµ¬í˜„**

   **ìœ„ì¹˜**: `lib/domains/plan/actions/timezone.ts` (385ì¤„)

   ```typescript
   total_study_hours: studyDays * 8, // TODO: ë¸”ë¡ì…‹ ê¸°ë°˜ ê³„ì‚°
   ```

4. **ì‹¤ì œ í‰ì  ì‹œìŠ¤í…œ ì—°ë™ ë¯¸êµ¬í˜„**

   **ìœ„ì¹˜**: `lib/domains/content/actions/recommendations.ts` (497ì¤„)

   ```typescript
   averageRating: 4.0 + Math.random() * 0.9, // TODO: ì‹¤ì œ í‰ì  ì‹œìŠ¤í…œ ì—°ë™
   ```

5. **ì•Œë¦¼ ì „ì†¡ êµ¬í˜„ ë¯¸êµ¬í˜„**

   **ìœ„ì¹˜**: `lib/domains/analysis/services/earlyWarningService.ts` (423ì¤„)

   ```typescript
   // TODO: ì‹¤ì œ ì•Œë¦¼ ì „ì†¡ êµ¬í˜„ (ì´ë©”ì¼, í‘¸ì‹œ ë“±)
   ```

---

## 10. ìš°ì„ ìˆœìœ„ë³„ ê°œì„  ê³„íš

### 10.1 ğŸ”´ CRITICAL (ì¦‰ì‹œ ì²˜ë¦¬)

1. **íŠ¸ëœì­ì…˜ ì²˜ë¦¬ ê°œì„ ** (ì˜ˆìƒ ì†Œìš”: 2-3ì¼)
   - DELETE â†’ INSERT íŒ¨í„´ì„ UPSERT ë˜ëŠ” íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë³€ê²½
   - ë¡¤ë°± ë¡œì§ ìë™í™”
   - **íŒŒì¼**: `lib/domains/camp/actions/student.ts`, `lib/domains/plan/actions/contentPlanGroup/quickCreate.ts`

2. **í”Œëœ ìƒì„± ë™ì‹œì„± ì œì–´** (ì˜ˆìƒ ì†Œìš”: 1-2ì¼)
   - í”Œëœ ê·¸ë£¹ ë½ ë©”ì»¤ë‹ˆì¦˜ ì ìš©
   - **íŒŒì¼**: `lib/domains/plan/actions/plan-groups/generatePlansWithServices.ts`

3. **í•™ì› ì¼ì •/ë¸”ë¡ ì •ë³´ ë¡œë“œ** (ì˜ˆìƒ ì†Œìš”: 1ì¼)
   - ë°°ì¹˜ ë¯¸ë¦¬ë³´ê¸°ì—ì„œ í•™ì› ì¼ì • ë° ë¸”ë¡ì…‹ ì •ë³´ ë¡œë“œ
   - **íŒŒì¼**: `lib/domains/admin-plan/actions/batchPreviewPlans.ts`

### 10.2 ğŸŸ  HIGH (1ì£¼ì¼ ë‚´)

1. **í”Œëœ ìƒíƒœì™€ ì§„í–‰ë¥  ì¼ê´€ì„±** (ì˜ˆìƒ ì†Œìš”: 2-3ì¼)
   - ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹œ ì§„í–‰ë¥  ìë™ ê³„ì‚°
   - `status`ì™€ `completed_at` ì¼ê´€ì„± í™•ë³´
   - **íŒŒì¼**: `lib/domains/plan/actions/core.ts`

2. **N+1 ì¿¼ë¦¬ ë¬¸ì œ í•´ê²°** (ì˜ˆìƒ ì†Œìš”: 2-3ì¼)
   - ë°°ì¹˜ ì¡°íšŒë¡œ ë³€ê²½
   - ì½˜í…ì¸  ì¡°íšŒ ìµœì í™”

3. **íƒ€ì„ë¼ì¸ ì„±ëŠ¥ ìµœì í™”** (ì˜ˆìƒ ì†Œìš”: 3-4ì¼)
   - ê°€ìƒí™” ì ìš©
   - ë©”ëª¨ì´ì œì´ì…˜ ê°•í™”

4. **í”Œëœ ìˆ˜ì • ë™ì‹œì„± ì œì–´** (ì˜ˆìƒ ì†Œìš”: 1-2ì¼)
   - Optimistic Locking ì ìš©
   - **íŒŒì¼**: `lib/domains/plan/actions/calendarDrag.ts`

### 10.3 ğŸŸ¡ MEDIUM (1ê°œì›” ë‚´)

1. **íƒ€ì… ì•ˆì „ì„± ê°œì„ ** (ì˜ˆìƒ ì†Œìš”: 3-4ì¼)
   - `any` íƒ€ì… ì œê±°
   - ëª…ì‹œì  íƒ€ì… ì •ì˜
   - **íŒŒì¼**: `lib/domains/plan/actions/calendarDrag.ts`, `lib/domains/plan/actions/contentIndividualization.ts`

2. **ì—ëŸ¬ ì²˜ë¦¬ í‘œì¤€í™”** (ì˜ˆìƒ ì†Œìš”: 2-3ì¼)
   - ì—ëŸ¬ ë©”ì‹œì§€ ì¼ê´€ì„± í™•ë³´
   - ì—ëŸ¬ ë¡œê¹… ê°•í™”

3. **ê²€ì¦ ë¡œì§ í†µí•©** (ì˜ˆìƒ ì†Œìš”: 3-4ì¼)
   - ê²€ì¦ ë¡œì§ì„ Service ë ˆì´ì–´ë¡œ í†µí•©
   - ë‹¨ì¼ ì§„ì‹¤ì˜ ì›ì²œ ìœ ì§€

4. **ì½˜í…ì¸  ì—…ë°ì´íŠ¸ ë°©ì‹ ê°œì„ ** (ì˜ˆìƒ ì†Œìš”: 2-3ì¼)
   - UPSERT íŒ¨í„´ ì ìš©
   - íŠ¸ëœì­ì…˜ ë‚´ ì²˜ë¦¬

### 10.4 ğŸŸ¢ LOW (3ê°œì›” ë‚´)

1. **ì œì™¸ì¼/í•™ì› ì¼ì • ì „ì—­ ê´€ë¦¬** (ì˜ˆìƒ ì†Œìš”: 5-7ì¼)
   - í•™ìƒë³„ ì „ì—­ ê´€ë¦¬ë¡œ ì „í™˜
   - í”Œëœ ê·¸ë£¹ ê°„ ì¤‘ë³µ ì œê±°

2. **ë¯¸ì™„ë£Œ TODO ì‘ì—… ì™„ë£Œ** (ì˜ˆìƒ ì†Œìš”: 5-7ì¼)
   - ì½˜í…ì¸  ì œëª© ì¡°ì¸
   - ì‹œê³„ì—´ ë¶„ì„
   - ë¸”ë¡ì…‹ ê¸°ë°˜ ê³„ì‚°
   - í‰ì  ì‹œìŠ¤í…œ ì—°ë™
   - ì•Œë¦¼ ì „ì†¡ êµ¬í˜„

---

## 11. ê´€ë ¨ íŒŒì¼ ëª©ë¡

### íŠ¸ëœì­ì…˜ ì²˜ë¦¬
- `lib/supabase/transaction.ts` - ë°°ì¹˜ ì‘ì—… ìœ í‹¸ë¦¬í‹°
- `lib/reschedule/transaction.ts` - ì¬ì¡°ì • íŠ¸ëœì­ì…˜
- `lib/domains/plan/transactions.ts` - í”Œëœ íŠ¸ëœì­ì…˜
- `lib/domains/today/transactions.ts` - í•™ìŠµ ì„¸ì…˜ íŠ¸ëœì­ì…˜

### ë™ì‹œì„± ì œì–´
- `lib/domains/today/actions/timer.ts` - íƒ€ì´ë¨¸ Race Condition ë°©ì§€
- `lib/reschedule/transaction.ts` - ì¬ì¡°ì • ë½ ë©”ì»¤ë‹ˆì¦˜

### íƒ€ì… ì•ˆì „ì„±
- `lib/domains/plan/actions/calendarDrag.ts` - `any` íƒ€ì… ì‚¬ìš©
- `lib/domains/plan/actions/contentIndividualization.ts` - `any` íƒ€ì… ì‚¬ìš©

### ì—ëŸ¬ ì²˜ë¦¬
- `lib/errors/handler.ts` - í‘œì¤€ ì—ëŸ¬ ì²˜ë¦¬
- `lib/errors/planGroupErrors.ts` - í”Œëœ ê·¸ë£¹ ì—ëŸ¬
- `lib/domains/camp/errors.ts` - ìº í”„ ì—ëŸ¬

### ê²€ì¦
- `lib/validation/wizardValidator.ts` - ìœ„ì €ë“œ ê²€ì¦
- `lib/domains/plan/services/planValidationService.ts` - í”Œëœ ê²€ì¦
- `lib/domains/plan/services/slotValidationService.ts` - ìŠ¬ë¡¯ ê²€ì¦

---

## 12. ë‹¤ìŒ ë‹¨ê³„

1. **ì¦‰ì‹œ ì‹œì‘ ê°€ëŠ¥í•œ ì‘ì—…**:
   - í•™ì› ì¼ì •/ë¸”ë¡ ì •ë³´ ë¡œë“œ (ë°°ì¹˜ ë¯¸ë¦¬ë³´ê¸°)
   - íŠ¸ëœì­ì…˜ ì²˜ë¦¬ ê°œì„  (DELETE â†’ INSERT íŒ¨í„´)

2. **ë‹¨ê¸° ê³„íš (1-2ì£¼)**:
   - í”Œëœ ìƒì„± ë™ì‹œì„± ì œì–´
   - í”Œëœ ìƒíƒœì™€ ì§„í–‰ë¥  ì¼ê´€ì„±
   - N+1 ì¿¼ë¦¬ ë¬¸ì œ í•´ê²°

3. **ì¤‘ê¸° ê³„íš (1-2ê°œì›”)**:
   - íƒ€ì… ì•ˆì „ì„± ê°œì„ 
   - ì—ëŸ¬ ì²˜ë¦¬ í‘œì¤€í™”
   - ê²€ì¦ ë¡œì§ í†µí•©

4. **ì¥ê¸° ê³„íš (3ê°œì›” ì´ìƒ)**:
   - ì œì™¸ì¼/í•™ì› ì¼ì • ì „ì—­ ê´€ë¦¬
   - ë¯¸ì™„ë£Œ TODO ì‘ì—… ì™„ë£Œ

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2026-01-06

