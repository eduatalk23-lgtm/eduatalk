# 캠프 기능 개발 체크리스트

## 📋 현재 구현 상태

### ✅ 완료된 기능

#### 관리자 영역
- [x] 캠프 템플릿 목록 조회 (`/admin/camp-templates`)
- [x] 캠프 템플릿 생성 (`/admin/camp-templates/new`)
- [x] 캠프 템플릿 상세 조회 (`/admin/camp-templates/[id]`)
- [x] 캠프 템플릿 수정 (`/admin/camp-templates/[id]/edit`)
- [x] 캠프 템플릿 삭제
- [x] 학생 초대 발송
- [x] 발송된 초대 목록 조회
- [x] 초대 상태 통계 표시

#### 학생 영역
- [x] 캠프 초대 목록 조회 (`/camp`)
- [x] 캠프 초대 상세 조회 (`/camp/[invitationId]`)
- [x] 캠프 참여 정보 제출 (PlanGroupWizard 통합)

#### 데이터베이스
- [x] `camp_templates` 테이블 생성
- [x] `camp_invitations` 테이블 생성
- [x] `plan_groups` 테이블에 캠프 관련 필드 추가
- [x] 인덱스 생성

---

## 🚀 추가 기능 제안

### 1. 관리자 영역 개선

#### 1.1 초대 관리 기능
- [x] **초대 취소/삭제 기능** ✅
  - 대기중인 초대 취소
  - 초대 삭제 (이미 수락된 경우 경고)
  - 일괄 삭제 기능

- [x] **초대 재발송 기능** ✅
  - 거절된 초대 재발송
  - 만료된 초대 재발송
  - 선택한 학생들에게 재발송

- [x] **초대 상태 변경 기능** ✅
  - 수동으로 상태 변경 (대기중 → 수락/거절)
  - 일괄 상태 변경

#### 1.2 템플릿 관리 개선
- [x] **템플릿 복사 기능** ✅
  - 기존 템플릿을 복사하여 새 템플릿 생성
  - 템플릿 이름 자동 생성 (예: "2025 윈터캠프 (복사본)")

- [ ] **템플릿 미리보기 기능**
  - 템플릿 설정을 실제 플랜으로 미리보기
  - 학생 입장에서 보이는 화면 미리보기

- [ ] **템플릿 버전 관리**
  - 템플릿 수정 이력 추적
  - 이전 버전으로 롤백

- [ ] **템플릿 공유 기능**
  - 다른 기관(tenant)과 템플릿 공유
  - 템플릿 가져오기/내보내기

#### 1.3 캠프 참여자 관리
- [x] **참여자 목록 페이지** (`/admin/camp-templates/[id]/participants`) ✅
  - 템플릿별 참여자 목록 조회
  - 참여자별 플랜 그룹 상태 확인
  - 참여자 필터링 (수락/거절/대기중)

- [x] **참여자 상세 정보** ✅
  - 참여자가 제출한 플랜 그룹 정보
  - 참여 일시 및 상태 변경 이력

- [x] **참여자 제외 기능** ✅
  - 특정 참여자 제외
  - 일괄 제외

#### 1.4 통계 및 리포트
- [x] **캠프 통계 대시보드** ✅
  - 템플릿별 초대/참여 통계
  - 참여율 계산
  - 시간대별 참여 추이 (차트 시각화)

- [x] **캠프 리포트 생성** ✅
  - 템플릿별 참여 리포트
  - 학생별 참여 리포트
  - Excel 내보내기 (xlsx)
  - 참여 현황 차트 (recharts 기반)

### 2. 학생 영역 개선

#### 2.1 초대 관리
- [x] **초대 거절 기능** ✅
  - 초대 상세 페이지에서 거절 버튼 추가
  - 거절 사유 입력 (선택사항)
  - `declineCampInvitation` 서버 액션 구현
  - `CampActionDialogs` 컴포넌트에 거절 다이얼로그 추가

- [x] **초대 알림 기능** ✅
  - 새 초대 알림 표시 (NotificationCenter 통합)
  - 이메일 알림 (sendCampInvitationNotification)
  - 인앱 알림 (SSE 실시간 업데이트)
  - 학부모 알림 (sendCampInvitationNotificationToParents)

#### 2.2 참여 관리
- [x] **참여 정보 수정** ✅
  - 이미 제출한 참여 정보 수정
  - `editCampParticipation` 서버 액션 구현
  - 플랜 생성 전까지만 수정 가능

- [x] **참여 취소 기능** ✅
  - 참여 취소 요청
  - 취소 사유 입력
  - `cancelCampParticipation` 서버 액션 구현
  - 플랜 그룹 활성화 전까지만 취소 가능

- [x] **참여 상태 확인** ✅
  - 내가 참여한 캠프 목록 (`/camp` 페이지)
  - 참여 상태 및 플랜 그룹 링크
  - 통합 상태 표시 (PENDING_FORM, WAITING_REVIEW, IN_PROGRESS 등)
  - `CampInvitationCard` 컴포넌트에 상태 뱃지 표시

### 3. 시스템 기능

#### 3.1 알림 시스템
- [x] **이메일 알림** ✅
  - 초대 발송 시 이메일 알림 (sendCampInvitationNotification)
  - 참여 완료 시 관리자에게 알림 (sendCampAcceptanceNotificationToAdmins)
  - 플랜 생성 완료 알림 (sendPlanCreatedNotificationToStudent)
  - React Email 템플릿 (CampInvitationEmail)

- [x] **인앱 알림** ✅
  - 새 초대 알림 (NotificationCenter, SSE)
  - 참여 상태 변경 알림 (sendInAppNotification)
  - 관리자 알림 (sendBulkInAppNotification)
  - 학부모 알림 (sendCampInvitationNotificationToParents)

#### 3.2 권한 관리
- [ ] **역할별 권한 설정**
  - 관리자: 모든 기능 접근
  - 컨설턴트: 템플릿 조회 및 초대 발송만
  - 학생: 자신의 초대만 조회

- [ ] **템플릿별 권한**
  - 특정 관리자만 접근 가능한 템플릿
  - 템플릿 소유자 개념

#### 3.3 검색 및 필터링
- [ ] **고급 검색 기능**
  - 템플릿명, 프로그램 유형, 상태로 검색
  - 날짜 범위 필터링
  - 학생명으로 초대 검색

- [ ] **정렬 기능**
  - 생성일, 수정일, 이름 순 정렬
  - 참여율 순 정렬

#### 3.4 성능 최적화
- [x] **페이지네이션** ✅
  - 템플릿 목록 페이지네이션 (이미 구현됨)
  - 초대 목록 페이지네이션 (이미 구현됨)
  - 참여자 목록 페이지네이션 (새로 구현)

- [ ] **데이터 캐싱**
  - 템플릿 목록 캐싱
  - 초대 목록 캐싱
  - React Query 활용

- [ ] **지연 로딩**
  - 초대 목록 지연 로딩
  - 학생 목록 지연 로딩

### 4. 사용자 경험 개선

#### 4.1 UI/UX 개선
- [ ] **로딩 상태 표시**
  - 초대 발송 중 로딩 표시
  - 템플릿 저장 중 로딩 표시

- [x] **에러 처리 개선** ✅
  - 친화적인 에러 메시지 (`lib/domains/camp/errors.ts`)
  - 에러 복구 가이드 (RecoveryAction)
  - 네트워크 에러 처리 (`isNetworkError`, `createNetworkErrorInfo`)
  - 부분 성공 처리 (`handlePartialSuccess`)
  - 통합 에러 핸들러 (`handleCampError`)

- [ ] **성공 피드백**
  - 작업 완료 토스트 메시지
  - 성공 애니메이션

#### 4.2 접근성
- [ ] **키보드 네비게이션**
  - 모든 기능 키보드로 접근 가능
  - 포커스 관리

- [ ] **스크린 리더 지원**
  - ARIA 레이블 추가
  - 의미 있는 alt 텍스트

- [ ] **반응형 디자인**
  - 모바일 최적화
  - 태블릿 레이아웃

### 5. 데이터 검증 및 보안

#### 5.1 데이터 검증
- [ ] **템플릿 데이터 검증**
  - 필수 필드 검증
  - 날짜 범위 검증
  - 템플릿 데이터 무결성 검증

- [ ] **초대 데이터 검증**
  - 중복 초대 방지
  - 유효한 학생 ID 검증

#### 5.2 보안
- [x] **권한 검증** ✅
  - 서버 사이드 권한 검증 (`lib/domains/camp/permissions.ts`)
  - 템플릿 소유권 검증 (`requireCampTemplateAccess`)
  - 초대 접근 권한 검증 (`requireCampInvitationAccess`)

- [ ] **SQL Injection 방지**
  - 파라미터화된 쿼리 사용
  - 입력값 검증

- [ ] **XSS 방지**
  - 사용자 입력 이스케이프
  - 안전한 HTML 렌더링

### 6. 테스트

#### 6.1 단위 테스트
- [ ] **액션 함수 테스트**
  - 템플릿 CRUD 테스트
  - 초대 발송 테스트
  - 상태 변경 테스트

- [ ] **유틸리티 함수 테스트**
  - 데이터 변환 함수 테스트
  - 검증 함수 테스트

#### 6.2 통합 테스트
- [ ] **템플릿 생성 플로우 테스트**
  - 템플릿 생성 → 초대 발송 → 학생 참여

- [ ] **권한 테스트**
  - 역할별 접근 권한 테스트
  - 크로스 테넌트 접근 방지 테스트

#### 6.3 E2E 테스트
- [ ] **관리자 플로우 테스트**
  - 템플릿 생성 → 초대 발송 → 상태 확인

- [ ] **학생 플로우 테스트**
  - 초대 확인 → 참여 제출 → 플랜 확인

### 7. 문서화

#### 7.1 사용자 문서
- [ ] **관리자 가이드**
  - 템플릿 생성 방법
  - 초대 발송 방법
  - 통계 확인 방법

- [ ] **학생 가이드**
  - 초대 확인 방법
  - 참여 제출 방법

#### 7.2 개발자 문서
- [ ] **API 문서**
  - 액션 함수 문서화
  - 데이터 구조 문서화

- [ ] **아키텍처 문서**
  - 데이터베이스 스키마
  - 컴포넌트 구조
  - 플로우 다이어그램

---

## ⚠️ 고려사항

### 1. 데이터 일관성

#### 1.1 템플릿 수정 시 기존 초대 처리
- **문제**: 템플릿을 수정하면 이미 발송된 초대의 템플릿 데이터와 불일치 발생
- **해결 방안**:
  - 템플릿 수정 시 기존 초대에 영향 주지 않도록 템플릿 데이터 스냅샷 저장
  - 또는 템플릿 수정 시 경고 메시지 표시 및 새 버전 템플릿 생성

#### 1.2 템플릿 삭제 시 초대 처리
- **문제**: 템플릿 삭제 시 관련 초대 및 플랜 그룹 처리
- **해결 방안**:
  - CASCADE 삭제 또는 SOFT DELETE
  - 삭제 전 확인 다이얼로그 표시

### 2. 성능

#### 2.1 대량 초대 발송
- **문제**: 많은 학생에게 초대 발송 시 성능 이슈
- **해결 방안**:
  - 배치 처리로 분할 발송
  - 백그라운드 작업으로 처리
  - 진행률 표시

#### 2.2 초대 목록 조회
- **문제**: 많은 초대가 있을 때 목록 조회 성능
- **해결 방안**:
  - 페이지네이션 구현
  - 인덱스 최적화
  - 캐싱 활용

### 3. 사용자 경험

#### 3.1 초대 만료 처리
- **문제**: 초대 만료 시점 정의 및 처리
- **해결 방안**:
  - 템플릿에 만료일 설정
  - 만료된 초대 자동 처리
  - 만료 알림 발송

#### 3.2 중복 초대 방지
- **문제**: 같은 학생에게 중복 초대 발송 방지
- **해결 방안**:
  - 데이터베이스 UNIQUE 제약 조건 활용
  - 발송 전 중복 확인
  - 친화적인 에러 메시지

### 4. 보안

#### 4.1 템플릿 접근 권한
- **문제**: 다른 기관의 템플릿 접근 방지
- **해결 방안**:
  - tenant_id 기반 필터링
  - 서버 사이드 권한 검증

#### 4.2 초대 접근 권한
- **문제**: 다른 학생의 초대 접근 방지
- **해결 방안**:
  - student_id 기반 필터링
  - 초대 조회 시 권한 검증

### 5. 확장성

#### 5.1 템플릿 버전 관리
- **고려사항**: 템플릿 수정 시 버전 관리 필요 여부
- **제안**: 초기에는 단순화, 필요 시 추가

#### 5.2 템플릿 공유
- **고려사항**: 기관 간 템플릿 공유 기능 필요 여부
- **제안**: 향후 요구사항에 따라 추가

### 6. 알림 시스템

#### 6.1 알림 채널
- **이메일**: 초대 발송, 참여 완료 알림
- **인앱 알림**: 실시간 알림
- **SMS**: 중요 알림 (선택사항)

#### 6.2 알림 설정
- **관리자**: 알림 수신 설정
- **학생**: 알림 수신 설정

### 7. 에러 처리

#### 7.1 네트워크 에러
- **문제**: 네트워크 오류 시 사용자 경험
- **해결 방안**:
  - 재시도 로직
  - 친화적인 에러 메시지
  - 오프라인 모드 지원 (선택사항)

#### 7.2 데이터 검증 에러
- **문제**: 잘못된 데이터 입력 시 처리
- **해결 방안**:
  - 클라이언트 사이드 검증
  - 서버 사이드 검증
  - 상세한 에러 메시지

---

## 📊 우선순위

### 높은 우선순위 (즉시 구현 필요)
1. ✅ 기본 CRUD 기능 (완료)
2. ✅ 초대 발송 기능 (완료)
3. ✅ 초대 취소/삭제 기능 (완료)
4. ✅ 에러 처리 개선 (완료)
5. ✅ 권한 검증 강화 (완료) - `lib/domains/camp/permissions.ts` 중앙 집중화

### 중간 우선순위 (단기간 내 구현)
1. ✅ 초대 재발송 기능 (완료)
2. ✅ 참여자 목록 페이지 (완료)
3. ✅ 템플릿 복사 기능 (완료)
4. ✅ 알림 시스템 (완료) - 이메일, 인앱 알림
5. ✅ 학생 영역 개선 (완료) - 초대 거절, 참여 수정/취소
6. ✅ 페이지네이션 (완료) - 템플릿, 초대, 참여자 목록

### 낮은 우선순위 (장기적으로 구현)
1. 템플릿 버전 관리
2. 템플릿 공유 기능
3. ✅ 통계 대시보드 (완료)
4. ✅ 리포트 생성 (완료)
5. 고급 검색 기능

---

## 🔍 추가 검토 필요 사항

### 1. 비즈니스 로직
- [ ] 초대 만료 정책 정의
- [ ] 참여 취소 정책 정의
- [ ] 템플릿 수정 정책 정의

### 2. 데이터 모델
- [ ] 초대 만료일 필드 추가 필요 여부
- [ ] 템플릿 버전 필드 추가 필요 여부
- [ ] 참여 취소 이력 테이블 필요 여부

### 3. 통합
- [ ] 기존 플랜 그룹 시스템과의 통합 확인
- [ ] 알림 시스템과의 통합
- [ ] 리포트 시스템과의 통합

---

## 📝 참고 사항

- 모든 기능은 기존 가이드라인을 따라야 함
- SOLID 원칙 준수
- 불필요한 추상화 금지
- Spacing-First 정책 준수
- TypeScript 타입 안전성 보장














