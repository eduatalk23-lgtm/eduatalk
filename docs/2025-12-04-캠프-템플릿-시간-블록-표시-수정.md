# ìº í”„ í…œí”Œë¦¿ ì‹œê°„ ë¸”ë¡ í‘œì‹œ ë¬¸ì œ í•´ê²°

## ğŸ” ë¬¸ì œ ìƒí™©

í•™ìƒì˜ ìº í”„ í…œí”Œë¦¿ ìƒì„¸ë³´ê¸° í˜ì´ì§€(`/camp/[invitationId]/submitted`)ì—ì„œ ì‹œê°„ ë¸”ë¡ì´ í‘œì‹œë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

## ğŸ” ì›ì¸ ë¶„ì„

ë‘ ê°€ì§€ ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤:

### ë¬¸ì œ 1: `getPlanGroupById`ì˜ fallback ì¿¼ë¦¬
`getPlanGroupById` í•¨ìˆ˜ì˜ fallback ì¿¼ë¦¬ì—ì„œ `scheduler_options` ì»¬ëŸ¼ì´ ì œì™¸ë˜ì–´ ìˆì—ˆìŠµë‹ˆë‹¤:

1. ë©”ì¸ ì¿¼ë¦¬ì—ì„œëŠ” `scheduler_options`ë¥¼ í¬í•¨í•˜ì—¬ ì¡°íšŒ
2. ì»¬ëŸ¼ ì—ëŸ¬(42703) ë°œìƒ ì‹œ fallback ì¿¼ë¦¬ë¡œ ì „í™˜
3. **fallback ì¿¼ë¦¬ì—ì„œ `scheduler_options`ê°€ ì œì™¸ë¨**
4. ê²°ê³¼ì ìœ¼ë¡œ `scheduler_options`ê°€ `null`ë¡œ ì„¤ì •ë˜ì–´ ë¸”ë¡ ì„¸íŠ¸ IDë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ

### ë¬¸ì œ 2: `template_block_set_id` ì €ì¥ ì‹œì 
`campActions.ts`ì—ì„œ `template_block_set_id`ë¥¼ `scheduler_options`ì— ì €ì¥í•˜ëŠ” ì‹œì ì´ `syncWizardDataToCreationData` í˜¸ì¶œ **ì´í›„**ì˜€ìŠµë‹ˆë‹¤:

1. `syncWizardDataToCreationData`ê°€ `wizardData.scheduler_options`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒˆë¡œìš´ ê°ì²´ ìƒì„±
2. `time_settings` ë³‘í•© ì‹œ `Object.assign`ìœ¼ë¡œ ê¸°ì¡´ ê°’ì´ ë®ì–´ì“¸ ìˆ˜ ìˆìŒ
3. `template_block_set_id`ê°€ ì €ì¥ë˜ê¸° ì „ì— ë®ì–´ì“¸ ìˆ˜ ìˆìŒ

## âœ… í•´ê²° ë°©ë²•

### í•´ê²° 1: `getPlanGroupById`ì˜ fallback ë¡œì§ ê°œì„ 

`getPlanGroupById` í•¨ìˆ˜ì˜ fallback ë¡œì§ì„ ê°œì„ í•˜ì—¬:

1. **ë¨¼ì € `scheduler_options`ë¥¼ í¬í•¨í•œ fallback ì¿¼ë¦¬ ì‹œë„**
   - ëŒ€ë¶€ë¶„ì˜ ê²½ìš° `scheduler_options` ì»¬ëŸ¼ì´ ì¡´ì¬í•˜ë¯€ë¡œ ì •ìƒ ì¡°íšŒë¨

2. **ì—¬ì „íˆ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ `scheduler_options`ë¥¼ ì œì™¸í•œ ìµœì¢… fallback ì¿¼ë¦¬ ì‚¬ìš©**
   - ì˜¤ë˜ëœ ë°ì´í„°ë² ì´ìŠ¤ë‚˜ ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ í™˜ê²½ì„ ìœ„í•œ í•˜ìœ„ í˜¸í™˜ì„±

### í•´ê²° 2: `template_block_set_id` ì €ì¥ ì‹œì  ë³€ê²½

`campActions.ts`ì—ì„œ `template_block_set_id`ë¥¼ `scheduler_options`ì— ì €ì¥í•˜ëŠ” ì‹œì ì„ ë³€ê²½:

1. **`syncWizardDataToCreationData` í˜¸ì¶œ ì „ì— `mergedData.scheduler_options`ì— ì¶”ê°€**
   - `syncWizardDataToCreationData`ê°€ `wizardData.scheduler_options`ë¥¼ ìŠ¤í”„ë ˆë“œ ì—°ì‚°ìë¡œ ë³µì‚¬í•˜ë¯€ë¡œ ë³´ì¡´ë¨

2. **`syncWizardDataToCreationData` í˜¸ì¶œ í›„ì—ë„ í™•ì¸í•˜ì—¬ ì—†ìœ¼ë©´ ì¶”ê°€**
   - ì•ˆì „ì¥ì¹˜ë¡œ ì´ì¤‘ í™•ì¸

## ğŸ“‹ ë³€ê²½ ì‚¬í•­

### 1. `lib/data/planGroups.ts`

**ë³€ê²½ ì „:**
```typescript
// fallback ì¿¼ë¦¬ì—ì„œ scheduler_options ì œì™¸
const fallbackSelect = () =>
  supabase
    .from("plan_groups")
    .select(
      "id,tenant_id,student_id,name,plan_purpose,scheduler_type,period_start,..."
      // scheduler_options ì œì™¸
    )
```

**ë³€ê²½ í›„:**
```typescript
// ë¨¼ì € scheduler_options í¬í•¨í•˜ì—¬ ì‹œë„
const fallbackSelectWithScheduler = () =>
  supabase
    .from("plan_groups")
    .select(
      "id,tenant_id,student_id,name,plan_purpose,scheduler_type,scheduler_options,period_start,..."
      // scheduler_options í¬í•¨
    )

// ì—¬ì „íˆ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ scheduler_options ì œì™¸í•œ ìµœì¢… fallback
if (error && error.code === "42703") {
  const fallbackSelectWithoutScheduler = () =>
    // scheduler_options ì œì™¸
}
```

### 2. `app/(student)/actions/campActions.ts`

**ë³€ê²½ ì „:**
```typescript
const creationData = syncWizardDataToCreationData(mergedData as WizardData);

// ... ë‚˜ì¤‘ì— template_block_set_id ì¶”ê°€
creationData.scheduler_options.template_block_set_id = blockSetId;
```

**ë³€ê²½ í›„:**
```typescript
// syncWizardDataToCreationData í˜¸ì¶œ ì „ì— template_block_set_id ì¶”ê°€
const blockSetId = mergedData.block_set_id || templateBlockSetId;
if (blockSetId) {
  if (!mergedData.scheduler_options) {
    mergedData.scheduler_options = {};
  }
  mergedData.scheduler_options.template_block_set_id = blockSetId;
}

const creationData = syncWizardDataToCreationData(mergedData as WizardData);

// ì•ˆì „ì¥ì¹˜: ì—†ìœ¼ë©´ ì¶”ê°€
if (!creationData.scheduler_options?.template_block_set_id && blockSetId) {
  // ...
}
```

## ğŸ¯ íš¨ê³¼

- `getPlanGroupWithDetails`ë¥¼ í†µí•´ ì¡°íšŒëœ `group` ê°ì²´ì— `scheduler_options`ê°€ ì •ìƒì ìœ¼ë¡œ í¬í•¨ë¨
- `submitted/page.tsx`ì—ì„œ `scheduler_options.template_block_set_id`ë¥¼ í†µí•´ ë¸”ë¡ ì„¸íŠ¸ IDë¥¼ ì°¾ì„ ìˆ˜ ìˆìŒ
- ì‹œê°„ ë¸”ë¡ì´ ì •ìƒì ìœ¼ë¡œ í‘œì‹œë¨

## ğŸ”— ê´€ë ¨ íŒŒì¼

- `lib/data/planGroups.ts` - `getPlanGroupById` í•¨ìˆ˜ ìˆ˜ì •
- `app/(student)/actions/campActions.ts` - `template_block_set_id` ì €ì¥ ì‹œì  ë³€ê²½
- `app/(student)/camp/[invitationId]/submitted/page.tsx` - ë¸”ë¡ ì„¸íŠ¸ ì¡°íšŒ ë¡œì§ (ë³€ê²½ ì—†ìŒ, ì •ìƒ ì‘ë™)

## ğŸ“ ì°¸ê³ 

ì´ ìˆ˜ì •ìœ¼ë¡œ `submitted/page.tsx`ì˜ ì§ì ‘ ì¡°íšŒ ë¡œì§(177-192ë²ˆì§¸ ì¤„)ì€ ì—¬ì „íˆ ì‘ë™í•˜ì§€ë§Œ, ì´ì œëŠ” `getPlanGroupWithDetails`ì—ì„œ ì´ë¯¸ `scheduler_options`ë¥¼ í¬í•¨í•˜ì—¬ ì¡°íšŒí•˜ë¯€ë¡œ ëŒ€ë¶€ë¶„ì˜ ê²½ìš° ì§ì ‘ ì¡°íšŒê°€ í•„ìš” ì—†ìŠµë‹ˆë‹¤.

