# PRD: Notion 스타일 플랜 관리 시스템

## 문서 정보

| 항목 | 내용 |
|------|------|
| 문서 버전 | 1.0 |
| 작성일 | 2026-01-01 |
| 프로젝트 | TimeLevelUp 플랜 도메인 고도화 |
| 상태 | Draft |

---

## 1. 개요

### 1.1 배경

현재 TimeLevelUp의 플랜 관리 시스템은 학생이 직접 플랜을 생성하고 타이머를 통해 완료하는 구조입니다. 하지만 실제 교육 현장에서는:

- 관리자(선생님)가 학습 계획을 설계하고 학생이 수행하는 패턴이 더 일반적
- 모든 학습에 타이머가 필요하지 않으며, 간단한 체크박스 완료로 충분한 경우가 많음
- Notion과 같은 유연한 뷰 시스템으로 다양한 관점에서 플랜을 확인하고 싶은 요구

이러한 니즈를 반영하여 Notion 스타일의 유연한 플랜 관리 시스템으로 개선합니다.

### 1.2 목표

1. **역할 기반 플랜 생성**: 관리자가 템플릿/플랜을 생성하고 학생이 수행
2. **유연한 완료 방식**: 타이머 없이 체크박스만으로 간단 완료 가능
3. **다중 뷰 지원**: 시간×요일 매트릭스, 타임라인, 테이블, 리스트 뷰
4. **Notion 스타일 편집**: 드래그앤드롭, 자유 텍스트/링크 입력

### 1.3 비-목표 (Scope 제외)

- 완전한 Notion 블록 에디터 구현 (1차 범위 외)
- 협업 실시간 편집 기능
- 외부 캘린더 연동 (Google Calendar 등)

---

## 2. 사용자 및 역할

### 2.1 주요 사용자

| 역할 | 설명 | 주요 행동 |
|------|------|----------|
| **관리자 (Admin)** | 학원 선생님, 학습 관리자 | 플랜 템플릿 생성, 학생에게 할당, 진도 모니터링 |
| **학생 (Student)** | 학습 수행자 | 할당된 플랜 수행, 완료 처리, 메모 추가 |
| **학부모 (Parent)** | 학습 현황 확인 | 자녀의 플랜 진행 상황 조회 (읽기 전용) |

### 2.2 권한 매트릭스

| 기능 | 관리자 | 학생 | 학부모 |
|------|:------:|:----:|:------:|
| 플랜 그룹 생성 | ✅ | ✅* | ❌ |
| 플랜 수정 | ✅ | ⚙️ | ❌ |
| 플랜 삭제 | ✅ | ❌ | ❌ |
| 플랜 완료 (타이머) | ✅ | ✅ | ❌ |
| 플랜 완료 (체크박스) | ✅ | ✅ | ❌ |
| 메모 추가 | ✅ | ✅ | ❌ |
| 드래그앤드롭 이동 | ✅ | ⚙️ | ❌ |
| 뷰 전환 | ✅ | ✅ | ✅ |
| 진도 조회 | ✅ | ✅ | ✅ |

- ✅: 항상 가능
- ⚙️: `plan_groups.student_permissions` 설정에 따라 결정
- ✅*: 개인 플랜 그룹만 생성 가능

---

## 3. 기능 요구사항

### 3.1 간단 완료 처리 (Simple Completion)

#### FR-001: 체크박스 기반 완료

**설명**: 타이머를 사용하지 않고 체크박스만으로 플랜을 완료할 수 있습니다.

**수락 기준**:
- [ ] 플랜 아이템에 체크박스 UI 표시
- [ ] 체크박스 클릭 시 즉시 완료 처리
- [ ] 완료 시간(`simple_completed_at`) 자동 기록
- [ ] 완료 시 선택적으로 간단한 메모 입력 가능
- [ ] 기존 타이머 완료와 병존 (mode: 'timer' | 'simple')

#### FR-002: 완료 모드 설정

**설명**: 플랜 그룹 또는 개별 플랜에서 완료 모드를 지정할 수 있습니다.

**수락 기준**:
- [ ] 플랜 그룹 생성 시 기본 완료 모드 선택 가능
- [ ] 개별 플랜에서 완료 모드 오버라이드 가능
- [ ] 완료 모드에 따라 UI 자동 전환

### 3.2 다중 뷰 시스템 (Multi-View)

#### FR-003: 시간×요일 매트릭스 뷰

**설명**: Notion 스타일의 시간대별/요일별 매트릭스 형태로 플랜을 표시합니다.

**수락 기준**:
- [ ] 행: 시간 슬롯 (1교시, 2교시, 점심, ...)
- [ ] 열: 요일 (월~일)
- [ ] 셀 클릭 시 플랜 상세 보기/편집
- [ ] 빈 셀 클릭 시 새 플랜 추가
- [ ] 플랜 드래그앤드롭으로 셀 간 이동

#### FR-004: 타임라인 뷰

**설명**: 하루 일정을 시간 축으로 표시합니다.

**수락 기준**:
- [ ] 24시간 세로 축 표시
- [ ] 플랜을 시간 블록으로 시각화
- [ ] 현재 시간 표시선
- [ ] 블록 크기로 플랜 시간 조절

#### FR-005: 테이블 뷰

**설명**: 스프레드시트 형태로 플랜을 표시합니다.

**수락 기준**:
- [ ] 컬럼: 날짜, 시간, 과목, 콘텐츠, 상태, 메모
- [ ] 컬럼별 정렬 지원
- [ ] 필터링 지원 (과목별, 상태별)
- [ ] 인라인 편집

#### FR-006: 리스트 뷰

**설명**: 간단한 리스트 형태로 플랜을 표시합니다.

**수락 기준**:
- [ ] 날짜별 그룹핑
- [ ] 체크박스와 제목 중심의 간결한 UI
- [ ] 완료/미완료 필터

#### FR-007: 뷰 전환 및 저장

**설명**: 사용자가 선호하는 뷰를 저장하고 전환할 수 있습니다.

**수락 기준**:
- [ ] 뷰 전환 버튼 UI
- [ ] URL 기반 뷰 상태 유지 (`?view=matrix`)
- [ ] 사용자별 기본 뷰 설정 저장
- [ ] 뷰별 필터/정렬 설정 유지

### 3.3 Notion 스타일 편집

#### FR-008: 드래그앤드롭 플랜 이동

**설명**: 플랜을 드래그하여 다른 시간대/날짜로 이동할 수 있습니다.

**수락 기준**:
- [ ] 매트릭스 뷰에서 셀 간 드래그앤드롭
- [ ] 타임라인 뷰에서 시간 조정
- [ ] 권한 검사 (학생은 `canMovePlans` 설정 확인)
- [ ] 이동 시 충돌 검사 및 경고

#### FR-009: 자유 텍스트/링크 입력

**설명**: 플랜 셀에 자유롭게 텍스트와 링크를 입력할 수 있습니다.

**수락 기준**:
- [ ] 셀 내 마크다운 기본 지원 (볼드, 이탤릭, 링크)
- [ ] URL 자동 링크 변환
- [ ] 외부 리소스 링크 저장
- [ ] 링크 미리보기 (선택적)

#### FR-010: 셀 색상 커스터마이징

**설명**: 플랜 셀에 색상을 지정하여 시각적 구분을 할 수 있습니다.

**수락 기준**:
- [ ] 과목별 기본 색상 자동 지정
- [ ] 사용자 커스텀 색상 선택
- [ ] 색상 팔레트 UI

### 3.4 시간 슬롯 관리

#### FR-011: 시간 슬롯 정의

**설명**: 관리자가 학원 맞춤 시간 슬롯을 정의할 수 있습니다.

**수락 기준**:
- [ ] 시간 슬롯 CRUD (1교시, 2교시, 점심, ...)
- [ ] 슬롯 타입 지정 (study, break, meal, free)
- [ ] 테넌트별 기본 슬롯 템플릿
- [ ] 슬롯 순서 관리

### 3.5 권한 및 접근 제어

#### FR-012: 학생 권한 세분화

**설명**: 플랜 그룹별로 학생 권한을 세밀하게 설정할 수 있습니다.

**수락 기준**:
- [ ] `canAddAdHoc`: 단발성 플랜 추가 가능 여부
- [ ] `canEditMemo`: 메모 편집 가능 여부
- [ ] `canMovePlans`: 플랜 이동 가능 여부
- [ ] 관리자 UI에서 권한 설정

---

## 4. 비기능 요구사항

### 4.1 성능

| 지표 | 목표값 |
|------|--------|
| 매트릭스 뷰 초기 로딩 | < 500ms |
| 드래그앤드롭 반응 | < 100ms |
| 뷰 전환 | < 300ms |
| 동시 접속 사용자 | 1,000명 |

### 4.2 접근성

- WCAG 2.1 AA 준수
- 키보드 네비게이션 지원
- 스크린 리더 호환

### 4.3 반응형

- 데스크톱: 매트릭스 뷰 기본
- 태블릿: 매트릭스 뷰 (축소)
- 모바일: 리스트 뷰 기본

---

## 5. 사용자 스토리

### US-001: 관리자가 주간 학습 계획을 매트릭스로 생성

```gherkin
Given 관리자가 플랜 생성 페이지에 접속했을 때
When 시간×요일 매트릭스 뷰를 선택하고
And 각 셀에 플랜을 배치하면
Then 주간 학습 계획이 생성되고
And 해당 학생에게 플랜이 할당된다
```

### US-002: 학생이 체크박스로 플랜을 완료

```gherkin
Given 학생에게 할당된 플랜이 있을 때
When 플랜 옆 체크박스를 클릭하면
Then 플랜이 완료 상태로 변경되고
And 완료 시간이 기록된다
```

### US-003: 학생이 뷰를 전환하여 플랜 확인

```gherkin
Given 학생이 플랜 목록 페이지에 있을 때
When 뷰 전환 버튼에서 "타임라인"을 선택하면
Then 플랜이 타임라인 형태로 표시되고
And URL이 ?view=timeline으로 변경된다
```

### US-004: 관리자가 플랜을 드래그하여 이동

```gherkin
Given 관리자가 매트릭스 뷰에서 플랜을 보고 있을 때
When 월요일 1교시 플랜을 화요일 2교시로 드래그하면
Then 플랜이 해당 시간대로 이동되고
And 학생에게 변경 알림이 전송된다
```

---

## 6. 와이어프레임

### 6.1 매트릭스 뷰

```
┌─────────────────────────────────────────────────────────────┐
│ [뷰 전환: 📊 매트릭스 | ⏱️ 타임라인 | 📋 테이블 | 📝 리스트] │
├─────────┬───────┬───────┬───────┬───────┬───────┬───────────┤
│         │  월   │  화   │  수   │  목   │  금   │   토/일   │
├─────────┼───────┼───────┼───────┼───────┼───────┼───────────┤
│ 1교시   │ ✅수학│ 📐수학│ ⬜수학│ ⬜수학│ ⬜수학│           │
│ 09:00   │       │       │       │       │       │           │
├─────────┼───────┼───────┼───────┼───────┼───────┼───────────┤
│ 2교시   │ ⬜영어│ ⬜영어│ ⬜영어│ ⬜영어│ ⬜영어│           │
│ 10:00   │       │       │       │       │       │           │
├─────────┼───────┼───────┼───────┼───────┼───────┼───────────┤
│ 점심    │       │       │       │       │       │           │
│ 12:00   │       │       │       │       │       │           │
├─────────┼───────┼───────┼───────┼───────┼───────┼───────────┤
│ 3교시   │ ⬜과학│ ⬜과학│ ⬜과학│       │       │           │
│ 13:00   │       │       │       │       │       │           │
└─────────┴───────┴───────┴───────┴───────┴───────┴───────────┘
```

### 6.2 간단 완료 UI

```
┌──────────────────────────────────────────┐
│ ☐ 수학 - 이차방정식 기본 개념            │
│   📅 1월 2일 09:00 | 🏷️ 수학              │
├──────────────────────────────────────────┤
│ ✅ 영어 - 문법 복습                      │ ← 완료됨
│   📅 1월 1일 10:00 | ✓ 완료 15:30         │
├──────────────────────────────────────────┤
│ ☐ 과학 - 실험 보고서 작성                │
│   📅 1월 2일 13:00 | 🔗 실험자료.pdf      │
└──────────────────────────────────────────┘
```

---

## 7. 데이터 모델 변경

### 7.1 새 테이블

#### `time_slots`
| 필드 | 타입 | 설명 |
|------|------|------|
| id | uuid | PK |
| tenant_id | uuid | FK → tenants |
| name | text | 슬롯 이름 (1교시, 점심 등) |
| start_time | time | 시작 시간 |
| end_time | time | 종료 시간 |
| slot_order | integer | 정렬 순서 |
| slot_type | text | study/break/meal/free |
| is_default | boolean | 기본 슬롯 여부 |

#### `plan_views`
| 필드 | 타입 | 설명 |
|------|------|------|
| id | uuid | PK |
| student_id | uuid | FK → students |
| name | text | 뷰 이름 |
| view_type | text | calendar/timeline/table/list/matrix |
| settings | jsonb | 뷰별 설정 (필터, 정렬 등) |
| is_default | boolean | 기본 뷰 여부 |

### 7.2 기존 테이블 확장

#### `student_plan` 추가 필드
| 필드 | 타입 | 설명 |
|------|------|------|
| simple_completion | boolean | 간단 완료 여부 |
| simple_completed_at | timestamptz | 간단 완료 시간 |
| cell_content | jsonb | 셀 내용 (마크다운, 링크 등) |
| linked_urls | jsonb | 연결된 URL 목록 |
| display_color | text | 표시 색상 |

#### `plan_groups` 추가 필드
| 필드 | 타입 | 설명 |
|------|------|------|
| student_permissions | jsonb | 학생 권한 설정 |

---

## 8. API 엔드포인트

### 8.1 플랜 완료

```
POST /api/plans/{planId}/simple-complete
Body: { note?: string }
Response: { success: boolean, completedAt: string }
```

### 8.2 뷰 관리

```
GET /api/students/{studentId}/views
POST /api/students/{studentId}/views
PUT /api/students/{studentId}/views/{viewId}
DELETE /api/students/{studentId}/views/{viewId}
```

### 8.3 시간 슬롯

```
GET /api/tenants/{tenantId}/time-slots
POST /api/tenants/{tenantId}/time-slots
PUT /api/tenants/{tenantId}/time-slots/{slotId}
DELETE /api/tenants/{tenantId}/time-slots/{slotId}
```

---

## 9. 구현 우선순위

| 우선순위 | 기능 | 스토리 포인트 |
|----------|------|--------------|
| P0 | 간단 완료 처리 | 5 |
| P0 | 시간 슬롯 테이블 | 3 |
| P1 | 매트릭스 뷰 기본 | 8 |
| P1 | 학생 권한 분리 | 5 |
| P2 | 타임라인 뷰 | 8 |
| P2 | 테이블 뷰 | 5 |
| P2 | 리스트 뷰 | 3 |
| P3 | 드래그앤드롭 | 8 |
| P3 | 자유 텍스트/링크 | 5 |
| P3 | 셀 색상 | 3 |

---

## 10. 성공 지표

| 지표 | 현재 | 목표 | 측정 방법 |
|------|------|------|----------|
| 플랜 완료율 | 65% | 80% | 완료된 플랜 / 전체 플랜 |
| 일일 활성 사용자 | - | +20% | 플랜 페이지 접속 |
| 플랜 생성 시간 | 5분 | 2분 | 플랜 그룹 생성 소요 시간 |
| 사용자 만족도 | - | 4.0/5.0 | 인앱 설문 |

---

## 11. 릴리스 계획

| 버전 | 내용 | 예상 일정 |
|------|------|----------|
| v1.0 | 간단 완료 + 기본 권한 | 2주 |
| v1.1 | 매트릭스 뷰 기본 | 3주 |
| v1.2 | 다중 뷰 전환 | 2주 |
| v2.0 | 드래그앤드롭 + 편집 | 3주 |

---

## 12. 참고 자료

- [Notion 데이터베이스 뷰](https://www.notion.so/help/database-views)
- [기존 플랜 도메인 구조](/Users/johyeon-u/.claude/plans/typed-marinating-tulip.md)
- [현재 플랜 타입 정의](lib/types/plan/domain.ts)
