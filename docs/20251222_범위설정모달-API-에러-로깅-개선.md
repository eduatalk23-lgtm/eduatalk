# ë²”ìœ„ ì„¤ì • ëª¨ë‹¬ API ì—ëŸ¬ ë¡œê¹… ê°œì„  (ê¶Œí•œ ì²´í¬ ê°•í™”)

## ğŸ“‹ ì‘ì—… ê°œìš”

`RangeSettingModal` ì»´í¬ë„ŒíŠ¸ì—ì„œ API í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ ë¹ˆ ê°ì²´ `{}`ê°€ ì¶œë ¥ë˜ëŠ” ë¬¸ì œë¥¼ í•´ê²°í•˜ê³ , ì—ëŸ¬ ë¡œê¹…ì„ ê°œì„ í–ˆìŠµë‹ˆë‹¤. ë˜í•œ ê¶Œí•œ ê´€ë ¨ ë¬¸ì œë¥¼ ë” ëª…í™•í•˜ê²Œ ê°ì§€í•˜ê³  ì²˜ë¦¬í•˜ë„ë¡ ê°œì„ í–ˆìŠµë‹ˆë‹¤.

## ğŸ› ë¬¸ì œ ìƒí™©

### ì—ëŸ¬ ë©”ì‹œì§€

1. **ì²« ë²ˆì§¸ ì—ëŸ¬**: `[RangeSettingModal] API í˜¸ì¶œ ì‹¤íŒ¨: /api/student-content-details {}`
   - ìœ„ì¹˜: `RangeSettingModal.tsx:159`
   - ë¬¸ì œ: `responseData`ê°€ ë¹ˆ ê°ì²´ë¡œ ì¶œë ¥ë¨

2. **ë‘ ë²ˆì§¸ ì—ëŸ¬**: `[RangeSettingModal] ìƒì„¸ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨: {}`
   - ìœ„ì¹˜: `RangeSettingModal.tsx:269`
   - ë¬¸ì œ: `errorDetails`ê°€ ë¹ˆ ê°ì²´ë¡œ ì¶œë ¥ë¨

### ì›ì¸ ë¶„ì„

1. **ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨**: APIê°€ ì—ëŸ¬ë¥¼ ë°˜í™˜í•  ë•Œ ì‘ë‹µ ë³¸ë¬¸ì´ ë¹„ì–´ìˆê±°ë‚˜ JSONì´ ì•„ë‹ ìˆ˜ ìˆìŒ
2. **ì—ëŸ¬ ê°ì²´ ì§ë ¬í™” ì‹¤íŒ¨**: ì—ëŸ¬ ë¡œê¹… ì‹œ ê°ì²´ê°€ ì œëŒ€ë¡œ ì§ë ¬í™”ë˜ì§€ ì•ŠìŒ
3. **ì—ëŸ¬ ì •ë³´ ì†ì‹¤**: ë¹ˆ ê°ì²´ë¡œ ì¶œë ¥ë˜ì–´ ì‹¤ì œ ì—ëŸ¬ ì›ì¸ì„ íŒŒì•…í•˜ê¸° ì–´ë ¤ì›€

## âœ… í•´ê²° ë°©ë²•

### 1. ì‘ë‹µ ì²˜ë¦¬ ê°œì„ 

**ë³€ê²½ ì „**:
```typescript
let responseData: any;
try {
  responseData = await response.json();
} catch (e) {
  // ì—ëŸ¬ ì²˜ë¦¬
}
```

**ë³€ê²½ í›„**:
```typescript
let responseData: any = null;
let responseText: string | null = null;

try {
  // ì‘ë‹µ ë³¸ë¬¸ì„ í…ìŠ¤íŠ¸ë¡œ ë¨¼ì € ì½ê¸° (ë””ë²„ê¹…ìš©)
  responseText = await response.text();
  
  // ë¹ˆ ì‘ë‹µ ì²´í¬
  if (!responseText || responseText.trim() === "") {
    throw new Error("ì‘ë‹µ ë³¸ë¬¸ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.");
  }
  
  // JSON íŒŒì‹± ì‹œë„
  try {
    responseData = JSON.parse(responseText);
  } catch (parseError) {
    // íŒŒì‹± ì‹¤íŒ¨ ì‹œ ìƒì„¸ ë¡œê¹…
    console.error("[RangeSettingModal] JSON íŒŒì‹± ì‹¤íŒ¨:", {
      status: response.status,
      statusText: response.statusText,
      url,
      responseText: responseText.substring(0, 200),
      parseError,
    });
    throw new Error("ì‘ë‹µì„ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
  }
} catch (e) {
  // ì—ëŸ¬ ì²˜ë¦¬
}
```

**ê°œì„  ì‚¬í•­**:
- ì‘ë‹µ ë³¸ë¬¸ì„ í…ìŠ¤íŠ¸ë¡œ ë¨¼ì € ì½ì–´ ë””ë²„ê¹… ì •ë³´ í™•ë³´
- ë¹ˆ ì‘ë‹µ ì²´í¬ ì¶”ê°€
- JSON íŒŒì‹± ì‹¤íŒ¨ ì‹œ ìƒì„¸ ë¡œê¹… (ì‘ë‹µ í…ìŠ¤íŠ¸ ì¼ë¶€ í¬í•¨)
- ì—ëŸ¬ íƒ€ì…ë³„ ì„¸ë¶„í™”ëœ ì²˜ë¦¬

### 2. ì—ëŸ¬ ë¡œê¹… ê°œì„ 

**ë³€ê²½ ì „**:
```typescript
if (process.env.NODE_ENV === "development") {
  console.error(
    "[RangeSettingModal] ìƒì„¸ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:",
    errorDetails
  );
}
```

**ë³€ê²½ í›„**:
```typescript
if (process.env.NODE_ENV === "development") {
  try {
    // JSON.stringifyë¡œ ì§ë ¬í™” ê°€ëŠ¥í•œì§€ í™•ì¸
    const serialized = JSON.stringify(errorDetails, null, 2);
    console.error(
      "[RangeSettingModal] ìƒì„¸ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:",
      JSON.parse(serialized)
    );
  } catch (serializeError) {
    // ì§ë ¬í™” ì‹¤íŒ¨ ì‹œ ê°œë³„ ì†ì„± ì¶œë ¥
    console.error("[RangeSettingModal] ìƒì„¸ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:");
    console.error("  type:", errorDetails.type);
    console.error("  contentType:", errorDetails.contentType);
    console.error("  contentId:", errorDetails.contentId);
    console.error("  title:", errorDetails.title);
    console.error("  isRecommendedContent:", errorDetails.isRecommendedContent);
    console.error("  apiPath:", errorDetails.apiPath);
    console.error("  errorMessage:", errorDetails.errorMessage);
    console.error("  errorName:", errorDetails.errorName);
    if (errorDetails.errorStack) {
      console.error("  errorStack:", errorDetails.errorStack);
    }
  }
}
```

**ê°œì„  ì‚¬í•­**:
- JSON ì§ë ¬í™” ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸
- ì§ë ¬í™” ì‹¤íŒ¨ ì‹œ ê°œë³„ ì†ì„±ìœ¼ë¡œ ì¶œë ¥í•˜ì—¬ ì •ë³´ ì†ì‹¤ ë°©ì§€
- ì—ëŸ¬ ìŠ¤íƒ ì •ë³´ í¬í•¨

### 3. HTTP ìƒíƒœ ì½”ë“œ ì²´í¬ ê°œì„ 

**ë³€ê²½ ì „**:
```typescript
if (!response.ok) {
  const errorMessage = 
    responseData?.error?.message || 
    responseData?.message ||
    (response.status >= 500
      ? "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."
      : `ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (${response.status})`);
  
  console.error(`[RangeSettingModal] API í˜¸ì¶œ ì‹¤íŒ¨: ${apiPath}`, {
    status: response.status,
    statusText: response.statusText,
    contentType: content.type,
    contentId: content.id,
    isRecommendedContent,
    url,
    responseData,
  });
  throw new Error(errorMessage);
}
```

**ë³€ê²½ í›„**:
```typescript
if (!response.ok) {
  const errorMessage = 
    (responseData && typeof responseData === 'object' && responseData.error?.message) ||
    (responseData && typeof responseData === 'object' && responseData.message) ||
    (response.status >= 500
      ? "ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."
      : `ì„œë²„ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (${response.status})`);
  
  if (process.env.NODE_ENV === "development") {
    console.error(`[RangeSettingModal] API í˜¸ì¶œ ì‹¤íŒ¨: ${apiPath}`, {
      status: response.status,
      statusText: response.statusText,
      contentType: content.type,
      contentId: content.id,
      isRecommendedContent,
      url,
      responseData: responseData || null,
      responseText: responseText?.substring(0, 500),
    });
  }
  throw new Error(errorMessage);
}
```

**ê°œì„  ì‚¬í•­**:
- `responseData` íƒ€ì… ì²´í¬ ê°•í™”
- `responseText`ë„ ë¡œê¹…ì— í¬í•¨í•˜ì—¬ ì›ë³¸ ì‘ë‹µ í™•ì¸ ê°€ëŠ¥
- `responseData`ê°€ nullì¼ ê²½ìš° ëª…ì‹œì ìœ¼ë¡œ ì²˜ë¦¬

## ğŸ“ ìˆ˜ì •ëœ íŒŒì¼

- `app/(student)/plan/new-group/_components/_features/content-selection/components/RangeSettingModal.tsx`
- `app/api/student-content-details/route.ts`

### 4. ê¶Œí•œ ì²´í¬ ê°•í™”

**API ë¼ìš°íŠ¸ ê°œì„ ** (`app/api/student-content-details/route.ts`):

**ë³€ê²½ ì „**:
```typescript
if (!user || (role !== "student" && role !== "admin" && role !== "consultant")) {
  return apiUnauthorized();
}
```

**ë³€ê²½ í›„**:
```typescript
// ê¶Œí•œ ì²´í¬ ë° ìƒì„¸ ë¡œê¹…
if (!user) {
  if (process.env.NODE_ENV === "development") {
    console.error("[api/student-content-details] ì‚¬ìš©ì ì¸ì¦ ì‹¤íŒ¨: userê°€ null");
  }
  return apiUnauthorized("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
}

if (role !== "student" && role !== "admin" && role !== "consultant") {
  if (process.env.NODE_ENV === "development") {
    console.error("[api/student-content-details] ê¶Œí•œ ì—†ìŒ:", {
      userId: user.userId,
      role,
      allowedRoles: ["student", "admin", "consultant"],
    });
  }
  return apiUnauthorized("í•™ìƒ, ê´€ë¦¬ì, ë˜ëŠ” ì»¨ì„¤í„´íŠ¸ ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.");
}
```

**ê°œì„  ì‚¬í•­**:
- ì‚¬ìš©ì ì¸ì¦ ì‹¤íŒ¨ì™€ ê¶Œí•œ ë¶€ì¡±ì„ êµ¬ë¶„í•˜ì—¬ ë¡œê¹…
- ê°œë°œ í™˜ê²½ì—ì„œ ìƒì„¸í•œ ê¶Œí•œ ì •ë³´ ì¶œë ¥
- ëª…í™•í•œ ì—ëŸ¬ ë©”ì‹œì§€ ì œê³µ

### 5. ê¶Œí•œ ì—ëŸ¬ íŠ¹ë³„ ì²˜ë¦¬

**í´ë¼ì´ì–¸íŠ¸ ì¸¡ ê°œì„ **:

```typescript
// ê¶Œí•œ ê´€ë ¨ ì—ëŸ¬ (401, 403) íŠ¹ë³„ ì²˜ë¦¬
if (response.status === 401 || response.status === 403) {
  const authErrorMessage = 
    (responseData && typeof responseData === 'object' && responseData.error?.message) ||
    (responseData && typeof responseData === 'object' && responseData.message) ||
    "ë¡œê·¸ì¸ì´ í•„ìš”í•˜ê±°ë‚˜ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.";
  
  if (process.env.NODE_ENV === "development") {
    console.error(`[RangeSettingModal] ê¶Œí•œ ì—ëŸ¬ (${response.status}): ${apiPath}`, {
      status: response.status,
      statusText: response.statusText,
      contentType: content.type,
      contentId: content.id,
      isRecommendedContent,
      url,
      responseData: responseData || null,
      responseText: responseText?.substring(0, 500),
      suggestion: "ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ì„¸ìš”.",
    });
  }
  throw new Error(authErrorMessage);
}
```

**ê°œì„  ì‚¬í•­**:
- 401/403 ì—ëŸ¬ë¥¼ ë³„ë„ë¡œ ì²˜ë¦¬í•˜ì—¬ ê¶Œí•œ ë¬¸ì œ ëª…í™•íˆ ì‹ë³„
- ì‚¬ìš©ì ì¹œí™”ì ì¸ ì—ëŸ¬ ë©”ì‹œì§€ ì œê³µ
- ì„¸ì…˜ ë§Œë£Œ ì‹œ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì•ˆë‚´

### 6. responseData ìƒì„¸ ë¶„ì„

**ë³€ê²½ ì „**:
```typescript
responseData: responseData || null,
```

**ë³€ê²½ í›„**:
```typescript
// responseData ìƒì„¸ ë¶„ì„
const responseDataInfo: Record<string, unknown> = {
  type: typeof responseData,
  isNull: responseData === null,
  isUndefined: responseData === undefined,
  isEmptyObject: responseData && typeof responseData === 'object' && Object.keys(responseData).length === 0,
  keys: responseData && typeof responseData === 'object' ? Object.keys(responseData) : null,
};

// responseDataë¥¼ ì•ˆì „í•˜ê²Œ ì§ë ¬í™”
let responseDataStringified: string | null = null;
try {
  responseDataStringified = responseData ? JSON.stringify(responseData, null, 2) : null;
} catch (e) {
  responseDataStringified = `[ì§ë ¬í™” ì‹¤íŒ¨: ${e instanceof Error ? e.message : String(e)}]`;
}

console.error(`[RangeSettingModal] API í˜¸ì¶œ ì‹¤íŒ¨: ${apiPath}`, {
  // ... ê¸°íƒ€ ì •ë³´
  responseDataInfo,
  responseData: responseData,
  responseDataStringified,
  responseText: responseText?.substring(0, 500),
});
```

**ê°œì„  ì‚¬í•­**:
- `responseData`ì˜ íƒ€ì…, null ì—¬ë¶€, ë¹ˆ ê°ì²´ ì—¬ë¶€ ë“±ì„ ëª…í™•íˆ í™•ì¸
- ì§ë ¬í™” ì‹¤íŒ¨ ì‹œì—ë„ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
- ë¹ˆ ê°ì²´ `{}`ê°€ ì¶œë ¥ë˜ëŠ” ì›ì¸ì„ ì •í™•íˆ íŒŒì•… ê°€ëŠ¥

## ğŸ¯ ê¸°ëŒ€ íš¨ê³¼

1. **ë””ë²„ê¹… ìš©ì´ì„± í–¥ìƒ**: ì—ëŸ¬ ë°œìƒ ì‹œ ìƒì„¸í•œ ì •ë³´ ì œê³µ
2. **ì—ëŸ¬ ì›ì¸ íŒŒì•… ê°œì„ **: ë¹ˆ ê°ì²´ ëŒ€ì‹  ì‹¤ì œ ì—ëŸ¬ ì •ë³´ ì¶œë ¥
3. **ì‘ë‹µ ì²˜ë¦¬ ì•ˆì •ì„± í–¥ìƒ**: ë¹ˆ ì‘ë‹µ, JSON íŒŒì‹± ì‹¤íŒ¨ ë“± ë‹¤ì–‘í•œ ìƒí™© ì²˜ë¦¬
4. **ê¶Œí•œ ë¬¸ì œ ëª…í™•íˆ ì‹ë³„**: 401/403 ì—ëŸ¬ë¥¼ ë³„ë„ë¡œ ì²˜ë¦¬í•˜ì—¬ ê¶Œí•œ ë¬¸ì œë¥¼ ë¹ ë¥´ê²Œ íŒŒì•…
5. **responseData ë¶„ì„**: ë¹ˆ ê°ì²´ê°€ ì¶œë ¥ë˜ëŠ” ì›ì¸ì„ ì •í™•íˆ íŒŒì•… ê°€ëŠ¥

## ğŸ” í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### 1. ì •ìƒ ì‘ë‹µ
- APIê°€ ì •ìƒì ìœ¼ë¡œ JSON ì‘ë‹µì„ ë°˜í™˜í•˜ëŠ” ê²½ìš°
- ê¸°ì¡´ê³¼ ë™ì¼í•˜ê²Œ ë™ì‘

### 2. ë¹ˆ ì‘ë‹µ
- APIê°€ ë¹ˆ ì‘ë‹µì„ ë°˜í™˜í•˜ëŠ” ê²½ìš°
- "ì‘ë‹µ ë³¸ë¬¸ì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤." ì—ëŸ¬ ë©”ì‹œì§€ ì¶œë ¥

### 3. JSON íŒŒì‹± ì‹¤íŒ¨
- APIê°€ JSONì´ ì•„ë‹Œ ì‘ë‹µì„ ë°˜í™˜í•˜ëŠ” ê²½ìš°
- ì‘ë‹µ í…ìŠ¤íŠ¸ ì¼ë¶€ì™€ í•¨ê»˜ ìƒì„¸ ë¡œê¹…

### 4. HTTP ì—ëŸ¬ ì‘ë‹µ
- APIê°€ 4xx/5xx ì—ëŸ¬ë¥¼ ë°˜í™˜í•˜ëŠ” ê²½ìš°
- ì—ëŸ¬ ë©”ì‹œì§€ì™€ í•¨ê»˜ ìƒì„¸ ë¡œê¹… (ì‘ë‹µ ë³¸ë¬¸ í¬í•¨)

### 5. ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬
- ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì‹¤íŒ¨ ë“±
- ì—ëŸ¬ ìŠ¤íƒê³¼ í•¨ê»˜ ìƒì„¸ ë¡œê¹…

## ğŸ“ ì°¸ê³  ì‚¬í•­

- ê°œë°œ í™˜ê²½ì—ì„œë§Œ ìƒì„¸ ë¡œê¹… ì¶œë ¥ (`process.env.NODE_ENV === "development"`)
- í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œëŠ” ì‚¬ìš©ì ì¹œí™”ì ì¸ ì—ëŸ¬ ë©”ì‹œì§€ë§Œ í‘œì‹œ
- ì—ëŸ¬ê°€ ë°œìƒí•´ë„ ì§ì ‘ ì…ë ¥ ëª¨ë“œëŠ” ê³„ì† ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ ì²˜ë¦¬

---

**ì‘ì—… ì¼ì‹œ**: 2025-12-22  
**ì‘ì—…ì**: AI Assistant

