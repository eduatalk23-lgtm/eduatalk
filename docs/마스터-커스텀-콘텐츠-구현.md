# 마스터 커스텀 콘텐츠 UI 구현 완료

## 작업 개요

마스터 교재/강의와 동일한 역할을 하는 마스터 커스텀 콘텐츠 기능을 구현했습니다.

## 구현 내용

### 1. 데이터베이스 마이그레이션

- **파일**: `supabase/migrations/20251209140747_create_master_custom_contents.sql`
- `master_custom_contents` 테이블 생성
- 인덱스 및 RLS 정책 추가
- 업데이트 트리거 설정

### 2. 타입 정의

- **파일**: `lib/types/plan.ts`
- `MasterCustomContent` 타입 추가
- `MasterContentFields` 기반으로 확장

- **파일**: `lib/data/contentMasters.ts`
- `MasterCustomContentFilters` 타입 추가

### 3. 데이터 레이어 함수

- **파일**: `lib/data/contentMasters.ts`
- `searchMasterCustomContents()` - 검색/필터링
- `getMasterCustomContentById()` - 상세 조회
- `createMasterCustomContent()` - 생성
- `updateMasterCustomContent()` - 수정
- `deleteMasterCustomContent()` - 삭제
- `copyMasterCustomContentToStudent()` - 학생 콘텐츠로 복사
- `copyMasterToStudentContent()` 함수에 커스텀 콘텐츠 케이스 추가

### 4. 관리자 액션

- **파일**: `app/(admin)/actions/masterCustomContentActions.ts` (신규)
- `addMasterCustomContent()` - 등록
- `updateMasterCustomContentAction()` - 수정
- `deleteMasterCustomContentAction()` - 삭제

### 5. 학생 액션

- **파일**: `app/(student)/actions/contentMasterActions.ts`
- `copyMasterToStudentContentAction()` 함수에 커스텀 콘텐츠 지원 추가

### 6. 관리자 페이지

#### 6.1 목록 페이지
- **파일**: `app/(admin)/admin/master-custom-contents/page.tsx`
- 검색 필터 (UnifiedContentFilter 사용)
- 카드 그리드 레이아웃
- 등록 버튼 (admin/consultant만)

#### 6.2 등록 페이지
- **파일**: `app/(admin)/admin/master-custom-contents/new/page.tsx`
- **파일**: `app/(admin)/admin/master-custom-contents/new/MasterCustomContentForm.tsx`
- 폼 필드: title, content_type, total_page_or_time, subject, difficulty_level, notes
- 교육과정/교과/과목 선택 (선택적)

#### 6.3 상세 페이지
- **파일**: `app/(admin)/admin/master-custom-contents/[id]/page.tsx`
- ContentHeader, ContentDetailTable 사용
- 수정/삭제 버튼 (admin/consultant만)

#### 6.4 수정 페이지
- **파일**: `app/(admin)/admin/master-custom-contents/[id]/edit/page.tsx`
- **파일**: `app/(admin)/admin/master-custom-contents/[id]/edit/MasterCustomContentEditForm.tsx`
- 등록 페이지와 유사하나 기존 데이터 로드

### 7. 학생 페이지

#### 7.1 목록 페이지
- **파일**: `app/(student)/contents/master-custom-contents/page.tsx`
- 마스터 교재/강의 목록 페이지와 동일한 구조
- 검색 필터
- 카드 그리드 레이아웃

#### 7.2 상세 페이지
- **파일**: `app/(student)/contents/master-custom-contents/[id]/page.tsx`
- ContentHeader, ContentDetailTable 사용
- **파일**: `app/(student)/contents/master-custom-contents/[id]/_components/CopyMasterCustomContentButton.tsx`
- CopyMasterBookButton과 동일한 패턴

### 8. 통합 작업

#### 8.1 학생 콘텐츠 페이지
- **파일**: `app/(student)/contents/page.tsx`
- "서비스 마스터 커스텀 콘텐츠" 링크 버튼 추가
- "커스텀" 탭 추가
- 커스텀 콘텐츠 목록 표시 기능 추가

#### 8.2 관련 컴포넌트 업데이트
- **파일**: `app/(student)/contents/_components/ContentsList.tsx`
  - `TabKey`에 "custom" 추가
  - `fetchContentsByTab()`에 커스텀 콘텐츠 케이스 추가
  - `getDetailRows()`, `getSubText()`에 커스텀 콘텐츠 케이스 추가

- **파일**: `app/(student)/contents/_components/ContentsListClient.tsx`
  - `TabKey`에 "custom" 추가
  - `deleteCustomContent` prop 추가
  - `getDetailRows()`, `getSubText()`에 커스텀 콘텐츠 케이스 추가

- **파일**: `app/(student)/contents/_components/ContentCard.tsx`
  - `TabKey`에 "custom" 추가
  - 커스텀 콘텐츠는 상세보기 버튼 숨김

- **파일**: `app/(student)/contents/_components/ContentStats.tsx`
  - 커스텀 콘텐츠 통계 추가

- **파일**: `app/(student)/contents/_components/DeleteContentButton.tsx`
  - `contentType`에 "custom" 추가

## 주요 기능

1. **관리자 기능**
   - 마스터 커스텀 콘텐츠 등록/수정/삭제
   - 검색 및 필터링
   - 테넌트별 또는 공통 콘텐츠 관리

2. **학생 기능**
   - 마스터 커스텀 콘텐츠 검색 및 조회
   - 마스터 커스텀 콘텐츠를 자신의 콘텐츠로 복사
   - 자신의 커스텀 콘텐츠 목록 확인 및 삭제

## 데이터베이스 스키마

```sql
CREATE TABLE master_custom_contents (
  id uuid PRIMARY KEY,
  tenant_id uuid REFERENCES tenants(id),
  revision varchar(20),
  content_category varchar(20),
  title text NOT NULL,
  difficulty_level varchar(20),
  notes text,
  content_type varchar(50),
  total_page_or_time integer,
  subject varchar(50),
  subject_category varchar(50),
  curriculum_revision_id uuid REFERENCES curriculum_revisions(id),
  subject_id uuid REFERENCES subjects(id),
  subject_group_id uuid REFERENCES subject_groups(id),
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
);
```

## 다음 단계

- [ ] 마이그레이션 실행 및 테스트
- [ ] UI/UX 개선 (필요시)
- [ ] 성능 최적화 (필요시)

