# ìº í”„ ì œì¶œ í˜ì´ì§€ ë¸”ë¡ ì„¸íŠ¸ ì¡°íšŒ ë¡œì§ ê°œì„  - í…Œë„ŒíŠ¸ ID ì§€ì›

## ğŸ” ê°œì„  ë°°ê²½

ìº í”„ í…œí”Œë¦¿ ì œì¶œ ìƒì„¸ë³´ê¸° í˜ì´ì§€ì—ì„œ ë¸”ë¡ ì„¸íŠ¸ ì¡°íšŒ ì‹œ, í…œí”Œë¦¿ IDë‚˜ í…Œë„ŒíŠ¸ IDë¡œ ë¬¸ì œ ì—†ì´ ì¡°íšŒê°€ ê°€ëŠ¥í•´ì•¼ í•©ë‹ˆë‹¤.

### ê¸°ì¡´ ë¬¸ì œì 

1. **ì¡°íšŒ ìš°ì„ ìˆœìœ„ ë¶€ì¡±**
   - `template_id`ë¡œë§Œ ì¡°íšŒ ì‹œë„
   - ì‹¤íŒ¨ ì‹œ `template_id` ì—†ì´ ì¡°íšŒ (ë³´ì•ˆ ì·¨ì•½)
   - `tenant_id`ë¥¼ í™œìš©í•˜ì§€ ì•ŠìŒ

2. **ë³´ì•ˆ ë° ì •í™•ì„± ë¬¸ì œ**
   - `tenant_id` ê²€ì¦ ì—†ì´ ì¡°íšŒí•˜ì—¬ ë‹¤ë¥¸ í…Œë„ŒíŠ¸ì˜ ë¸”ë¡ ì„¸íŠ¸ì— ì ‘ê·¼ ê°€ëŠ¥
   - `template_id`ê°€ ì¼ì¹˜í•˜ì§€ ì•Šì•„ë„ ì¡°íšŒ ì„±ê³µ

## ğŸ›  ê°œì„  ë‚´ìš©

### ì¡°íšŒ ìš°ì„ ìˆœìœ„ ê°œì„ 

**íŒŒì¼**: `app/(student)/camp/[invitationId]/submitted/page.tsx`

ë¸”ë¡ ì„¸íŠ¸ ì¡°íšŒë¥¼ ë‹¤ìŒ ìš°ì„ ìˆœìœ„ë¡œ ê°œì„ :

1. **`template_id` ê²€ì¦ í¬í•¨ ì¡°íšŒ** (ê°€ì¥ ì •í™•)
   - `block_set_id`ì™€ `template_id` ëª¨ë‘ ì¼ì¹˜í•˜ëŠ” ê²½ìš°
   - ê°€ì¥ ì •í™•í•˜ê³  ì•ˆì „í•œ ì¡°íšŒ

2. **`tenant_id` ê²€ì¦ í¬í•¨ ì¡°íšŒ** (ë³´ì•ˆ ê°•í™”)
   - `template_id`ë¡œ ì¡°íšŒ ì‹¤íŒ¨ ì‹œ
   - ê°™ì€ í…Œë„ŒíŠ¸ ë‚´ì˜ ë¸”ë¡ ì„¸íŠ¸ë§Œ ì¡°íšŒ
   - ë³´ì•ˆì„ ìœ„í•´ í…Œë„ŒíŠ¸ ê²©ë¦¬ ìœ ì§€

3. **IDë§Œìœ¼ë¡œ ì¡°íšŒ** (fallback)
   - ìœ„ ë‘ ë°©ë²• ëª¨ë‘ ì‹¤íŒ¨ ì‹œ
   - ìµœí›„ì˜ ìˆ˜ë‹¨ìœ¼ë¡œ IDë§Œìœ¼ë¡œ ì¡°íšŒ
   - ê²½ê³  ë¡œê·¸ ì¶œë ¥

### ì½”ë“œ ë³€ê²½ ì‚¬í•­

```typescript
// ê°œì„  ì „: template_idë¡œë§Œ ì¡°íšŒ, ì‹¤íŒ¨ ì‹œ IDë§Œìœ¼ë¡œ ì¡°íšŒ
const { data: blockSetWithTemplate } = await supabase
  .from("template_block_sets")
  .select("id, name, template_id")
  .eq("id", blockSetId)
  .eq("template_id", group.camp_template_id)
  .maybeSingle();

if (!blockSetWithTemplate) {
  // template_id ì—†ì´ ì¡°íšŒ (ë³´ì•ˆ ì·¨ì•½)
  const { data: blockSetWithoutTemplate } = await supabase
    .from("template_block_sets")
    .select("id, name, template_id")
    .eq("id", blockSetId)
    .maybeSingle();
}

// ê°œì„  í›„: 3ë‹¨ê³„ ìš°ì„ ìˆœìœ„ ì¡°íšŒ
// 1. template_id ê²€ì¦ í¬í•¨
// 2. tenant_id ê²€ì¦ í¬í•¨ (ë³´ì•ˆ ê°•í™”)
// 3. IDë§Œìœ¼ë¡œ ì¡°íšŒ (fallback)
```

## ğŸ“‹ ë³€ê²½ ì‚¬í•­ ìš”ì•½

### `app/(student)/camp/[invitationId]/submitted/page.tsx`

1. **ì¡°íšŒ ìš°ì„ ìˆœìœ„ ê°œì„ **
   - `template_id` â†’ `tenant_id` â†’ `IDë§Œ` ìˆœì„œë¡œ ì¡°íšŒ
   - ê° ë‹¨ê³„ì—ì„œ ìƒì„¸í•œ ë¡œê¹…

2. **ë³´ì•ˆ ê°•í™”**
   - `tenant_id` ê²€ì¦ ì¶”ê°€ë¡œ í…Œë„ŒíŠ¸ ê²©ë¦¬ ìœ ì§€
   - ë‹¤ë¥¸ í…Œë„ŒíŠ¸ì˜ ë¸”ë¡ ì„¸íŠ¸ ì ‘ê·¼ ë°©ì§€

3. **ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ **
   - ê° ì¡°íšŒ ë‹¨ê³„ë³„ ì—ëŸ¬ ë¡œê¹…
   - í…œí”Œë¦¿ ID ë¶ˆì¼ì¹˜ ì‹œ ê²½ê³  ë¡œê·¸

4. **íƒ€ì… ì•ˆì „ì„±**
   - `template_id`ê°€ `string | null`ì¼ ìˆ˜ ìˆìŒì„ ë°˜ì˜

## âœ… ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] í…œí”Œë¦¿ IDë¡œ ë¸”ë¡ ì„¸íŠ¸ ì¡°íšŒ ì„±ê³µ
- [x] í…œí”Œë¦¿ ID ë¶ˆì¼ì¹˜ ì‹œ í…Œë„ŒíŠ¸ IDë¡œ ì¡°íšŒ ì„±ê³µ
- [x] í…Œë„ŒíŠ¸ IDë„ ì—†ì„ ê²½ìš° IDë§Œìœ¼ë¡œ ì¡°íšŒ (fallback)
- [x] ê° ë‹¨ê³„ë³„ ìƒì„¸ ë¡œê¹…
- [x] ë³´ì•ˆ ê²€ì¦ (í…Œë„ŒíŠ¸ ê²©ë¦¬)

## ğŸ”— ê´€ë ¨ íŒŒì¼

- `app/(student)/camp/[invitationId]/submitted/page.tsx` - í•™ìƒ ì œì¶œ í…œí”Œë¦¿ ìƒì„¸ë³´ê¸° í˜ì´ì§€
- `app/(student)/camp/[invitationId]/page.tsx` - ìº í”„ ì°¸ì—¬ í˜ì´ì§€ (tenant_id ì¡°íšŒ ì°¸ê³ )

## ğŸ“ ì°¸ê³  ì‚¬í•­

### ì¡°íšŒ ìš°ì„ ìˆœìœ„ì˜ ì´ìœ 

1. **`template_id` ìš°ì„ **
   - ê°€ì¥ ì •í™•í•œ ë§¤ì¹­
   - í…œí”Œë¦¿ê³¼ ë¸”ë¡ ì„¸íŠ¸ì˜ ì§ì ‘ì ì¸ ì—°ê²° í™•ì¸

2. **`tenant_id` ì°¨ì„ **
   - ë³´ì•ˆì„ ìœ„í•´ í…Œë„ŒíŠ¸ ê²©ë¦¬ ìœ ì§€
   - ê°™ì€ í…Œë„ŒíŠ¸ ë‚´ì˜ ë¸”ë¡ ì„¸íŠ¸ë§Œ ì ‘ê·¼ ê°€ëŠ¥
   - `template_id`ê°€ NULLì´ê±°ë‚˜ ë‹¤ë¥¸ ê²½ìš°ì—ë„ ì¡°íšŒ ê°€ëŠ¥

3. **IDë§Œ ì¡°íšŒ (fallback)**
   - ìµœí›„ì˜ ìˆ˜ë‹¨
   - ë°ì´í„° ë¬´ê²°ì„± ë¬¸ì œ ê°€ëŠ¥ì„± ìˆìŒ
   - ê²½ê³  ë¡œê·¸ë¡œ ëª¨ë‹ˆí„°ë§

### ë‹¤ë¥¸ í˜ì´ì§€ì™€ì˜ ì¼ê´€ì„±

`app/(student)/camp/[invitationId]/page.tsx`ì—ì„œëŠ” ì´ë¯¸ `tenant_id`ë¡œ ì¡°íšŒí•˜ê³  ìˆìŠµë‹ˆë‹¤:

```typescript
const { data: templateBlockSetData } = await supabase
  .from("template_block_sets")
  .select("id, name")
  .eq("id", templateData.block_set_id)
  .eq("tenant_id", template.tenant_id)
  .single();
```

ì´ì œ `submitted/page.tsx`ë„ ë™ì¼í•œ íŒ¨í„´ì„ ë”°ë¥´ë˜, ë” ìœ ì—°í•œ fallback ë¡œì§ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.

## ë‚ ì§œ

2024-11-24

