# 입시년도 및 개정교육과정 계산 로직 개선 및 설명 모달 추가

## 작업 일자
2025-02-03

## 작업 개요
생년월일과 실제 학년이 다를 수 있는 경우(유급, 조기입학 등)를 고려하여 학년 정보를 우선시하는 계산 방식으로 변경하고, 사용자에게 계산 방법을 설명하는 모달을 추가했습니다.

## 변경 사항

### 1. 계산 로직 개선 (`lib/utils/studentProfile.ts`)

#### 1.1 입시년도 계산 함수 수정
- **변경 내용**: 도달 불가 코드 제거 (59번 줄)
- **문제점**: `return currentYear + 1;`이 실행되지 않는 코드였음
- **해결**: 불필요한 return 문 제거

#### 1.2 개정교육과정 계산 함수 수정
- **변경 내용**: 생년월일 우선 방식 → **학년 우선 방식**으로 변경
- **주요 변경사항**:
  - 생년월일이 있어도 학년 정보를 기준으로 계산
  - 생년월일은 참고용으로만 사용 (검증 목적)
  - 학년 정보를 기준으로 입학년도 역산
- **계산 로직**:
  ```typescript
  // 중학교: 중학교 입학년도 = 현재년도 - (학년 - 1)
  // 고등학교: 고등학교 입학년도 = 현재년도 - (학년 - 1)
  // 개정교육과정은 입학년도 기준으로 판단
  ```
- **검증 로직 추가**: 생년월일과 학년 기준 계산 결과가 2년 이상 차이나면 경고 로그 출력

### 2. UI 자동 계산 조건 개선 (`app/(student)/settings/page.tsx`)

#### 2.1 개정교육과정 자동 계산 조건 수정
- **변경 전**: `formData.grade && formData.birth_date` (생년월일 필수)
- **변경 후**: `formData.grade` (학년만 있으면 계산 가능)
- **위치**: 291-341번 줄 `useEffect`

#### 2.2 저장 후 자동 계산 로직 수정
- **변경 전**: `formData.grade && formData.birth_date` (생년월일 필수)
- **변경 후**: `formData.grade` (학년만 있으면 계산 가능)
- **위치**: 515-526번 줄

### 3. 계산 방법 설명 모달 컴포넌트 생성

#### 3.1 신규 파일
- **파일**: `app/(student)/settings/_components/CalculationInfoModal.tsx`
- **기능**:
  - 입시년도 계산 방법 설명
  - 개정교육과정 계산 방법 설명
  - 학년 우선 계산 이유 설명
  - 개인 사정(유급, 조기입학) 반영 안내

#### 3.2 모달 내용 구성
- **입시년도 계산**:
  - 중학교: 중3 → 현재년도 + 4년, 중2 → +5년, 중1 → +6년
  - 고등학교: 고1 → 현재년도 + 3년, 고2 → +2년, 고3 → +1년
  - 계산식 표시
- **개정교육과정 계산**:
  - 학년 정보를 기준으로 입학년도 역산 방법 설명
  - 입학년도에 따른 개정교육과정 판단 기준
  - 생년월일과 다를 수 있는 이유 설명
  - 개정교육과정 기준년도 안내

### 4. UI에 정보 아이콘 추가 (`app/(student)/settings/page.tsx`)

#### 4.1 입시년도 필드에 정보 아이콘 추가
- **위치**: 입시년도 라벨 옆
- **아이콘**: `Info` (lucide-react)
- **기능**: 클릭 시 입시년도 계산 방법 모달 표시
- **스타일**: `text-gray-400 hover:text-indigo-600`

#### 4.2 개정교육과정 필드에 정보 아이콘 추가
- **위치**: 개정교육과정 라벨 옆
- **아이콘**: `Info` (lucide-react)
- **기능**: 클릭 시 개정교육과정 계산 방법 모달 표시
- **스타일**: `text-gray-400 hover:text-indigo-600`

## 수정된 파일

1. `lib/utils/studentProfile.ts`
   - `calculateExamYear`: 도달 불가 코드 제거
   - `calculateCurriculumRevision`: 학년 우선 방식으로 변경

2. `app/(student)/settings/page.tsx`
   - 개정교육과정 자동 계산 조건 수정
   - 저장 후 자동 계산 로직 수정
   - 정보 아이콘 추가 및 모달 연결

## 신규 파일

1. `app/(student)/settings/_components/CalculationInfoModal.tsx`
   - 계산 방법 설명 모달 컴포넌트

## 개선 효과

### 1. 정확성 향상
- 개인 사정(유급, 조기입학 등)으로 인한 학년 차이를 정확히 반영
- 생년월일과 학년이 다를 수 있는 경우를 고려한 계산

### 2. 사용성 개선
- 생년월일 없이도 학년만으로 계산 가능
- 계산 방법을 명확히 설명하는 모달 제공
- 사용자가 계산 로직을 이해할 수 있도록 안내

### 3. 유지보수성 향상
- 불필요한 코드 제거
- 명확한 주석 및 설명 추가
- 검증 로직 추가로 데이터 품질 향상

## 테스트 시나리오

1. **학년만 입력한 경우**: 생년월일 없이도 계산 가능한지 확인 ✅
2. **유급 학생**: 생년월일보다 학년이 1년 늦은 경우 정확한 계산 확인 ✅
3. **조기입학 학생**: 생년월일보다 학년이 1년 빠른 경우 정확한 계산 확인 ✅
4. **모달 표시**: 정보 아이콘 클릭 시 모달이 정상적으로 표시되는지 확인 ✅
5. **자동 계산**: 학년 변경 시 자동으로 재계산되는지 확인 ✅

## 참고사항

- 기존 생년월일 기반 계산 로직은 완전히 제거하지 않고, 참고용으로 유지
- 모달 내용은 사용자 피드백에 따라 수정 가능
- 계산 로직 변경으로 인한 기존 데이터 영향도 검토 필요



