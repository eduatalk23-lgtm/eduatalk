# 필드별 오류 표시 자동 스크롤 수정

**작업 일시**: 2025-02-01  
**작업 내용**: 첫 번째 오류 필드로 자동 스크롤 이동 시 화면 순서 기준으로 올바른 필드로 이동하도록 수정

## 문제점

기존 구현에서는 `Map`의 첫 번째 키를 가져와서 첫 번째 오류 필드로 스크롤했는데, 이는 검증 로직에서 오류를 추가하는 순서에 따라 결정되었습니다. 

하지만 검증 로직의 순서와 화면에 표시되는 필드 순서가 다를 수 있어서, 사용자가 3번째 필드로 이동했다가 다시 다음 버튼을 누르면 첫 번째 필드로 이동하는 문제가 발생했습니다.

예를 들어:
- 검증 순서: `plan_name` → `plan_purpose` → `scheduler_type` → `period_start`
- 화면 순서: `plan_name` → `plan_purpose` → `period_start` → `scheduler_type`

## 해결 방법

### 1. 필드 순서 정의

각 Step별로 화면에 표시되는 필드 순서를 명시적으로 정의:

```typescript
const FIELD_ORDER_BY_STEP: Record<WizardStep, string[]> = {
  1: ["plan_name", "plan_purpose", "period_start", "scheduler_type"],
  2: [],
  3: [],
  4: ["content_selection"],
  5: [],
  6: [],
  7: [],
};
```

### 2. 첫 번째 오류 필드 찾기 함수 추가

화면 순서에 따라 첫 번째 오류 필드를 찾는 함수 구현:

```typescript
export function getFirstErrorFieldId(
  fieldErrors: FieldErrors,
  step: WizardStep
): string | undefined {
  if (fieldErrors.size === 0) return undefined;

  const fieldOrder = FIELD_ORDER_BY_STEP[step];
  if (!fieldOrder || fieldOrder.length === 0) {
    // 필드 순서가 정의되지 않은 경우 Map의 첫 번째 키 반환
    return Array.from(fieldErrors.keys())[0];
  }

  // 화면 순서에 따라 첫 번째 오류 필드 찾기
  for (const fieldId of fieldOrder) {
    if (fieldErrors.has(fieldId)) {
      return fieldId;
    }
  }

  // 순서에 없는 필드인 경우 Map의 첫 번째 키 반환
  return Array.from(fieldErrors.keys())[0];
}
```

### 3. PlanGroupWizard에서 함수 사용

`scrollToFirstError` 함수에서 `getFirstErrorFieldId`를 사용하여 화면 순서 기준으로 첫 번째 오류 필드를 찾도록 수정:

```typescript
const scrollToFirstError = useCallback(() => {
  if (fieldErrors.size === 0) return;

  // 화면 순서에 따라 첫 번째 오류 필드 찾기
  const firstFieldId = getFirstErrorFieldId(fieldErrors, currentStep);
  if (!firstFieldId) return;

  // DOM 업데이트 후 스크롤 실행
  setTimeout(() => {
    scrollToField(firstFieldId);
  }, 100);
}, [fieldErrors, currentStep]);
```

## 변경된 파일

1. `app/(student)/plan/new-group/_components/hooks/useWizardValidation.ts`
   - `FIELD_ORDER_BY_STEP` 상수 추가
   - `getFirstErrorFieldId` 함수 추가 및 export

2. `app/(student)/plan/new-group/_components/PlanGroupWizard.tsx`
   - `getFirstErrorFieldId` import 추가
   - `scrollToFirstError` 함수에서 `getFirstErrorFieldId` 사용

## 테스트 시나리오

1. **Step 1에서 여러 필드 오류 발생 시**:
   - 플랜 이름, 플랜 목적, 학습 기간, 스케줄러 유형 모두 비어있는 상태
   - 다음 버튼 클릭 → 플랜 이름 필드로 스크롤 (화면 첫 번째 필드)

2. **Step 1에서 중간 필드 오류 발생 시**:
   - 플랜 이름은 입력, 플랜 목적은 선택, 학습 기간은 미설정, 스케줄러 유형은 미선택
   - 다음 버튼 클릭 → 학습 기간 필드로 스크롤 (화면 순서 기준)

3. **Step 4에서 콘텐츠 미선택 시**:
   - 콘텐츠 선택 영역으로 스크롤

## 향후 개선 사항

- 다른 Step에서도 필드 순서가 필요한 경우 `FIELD_ORDER_BY_STEP`에 추가
- 필드 순서를 동적으로 관리할 수 있는 방법 고려 (예: 각 Step 컴포넌트에서 필드 순서 정의)

