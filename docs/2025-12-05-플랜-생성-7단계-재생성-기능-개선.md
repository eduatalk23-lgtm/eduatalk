# 플랜 생성 7단계 재생성 기능 개선

## 작업 일자
2025-12-05

## 작업 개요
플랜 생성하기 7단계(Step7ScheduleResult)에서 불필요한 플랜 미리보기 다이얼로그를 제거하고, 재생성 기능을 간소화했습니다.

## 변경 사항

### 1. Step7ScheduleResult.tsx 수정

#### 제거된 항목
- `useState`의 `previewOpen` state
- `PlanPreviewDialog` import
- "플랜 미리보기 및 재생성" 버튼
- `PlanPreviewDialog` 컴포넌트 렌더링

#### 추가된 항목
- `handleRegenerate` 함수: 재생성 핸들러
  - 확인 다이얼로그 표시 (`confirm`)
  - 재생성 실행 (`generatePlansMutation.mutate()`)
- "플랜 재생성" 버튼
  - 재생성 중 로딩 상태 표시
  - 비활성화 처리 (`disabled` prop)

## 개선 효과

### 사용자 경험 개선
- 불필요한 다이얼로그 제거로 단계 축소
- 이미 상세한 스케줄 결과가 표시되므로 추가 미리보기 불필요
- 재생성 버튼 클릭 → 확인 → 재생성으로 간소화

### 기능 분리
- **Step 7**: 재생성만 담당 (이미 결과 확인 가능)
- **플랜 그룹 상세 페이지**: 생성 전 미리보기 담당 (`PlanPreviewDialog` 유지)

### 코드 간소화
- Step 7에서 `PlanPreviewDialog` 의존성 제거
- 재생성 로직 단순화 (다이얼로그 없이 바로 실행)

## 사용자 플로우

### 이전 플로우
```
Step 7 진입
  ↓
스케줄 결과 표시
  ↓
"플랜 미리보기 및 재생성" 버튼 클릭
  ↓
PlanPreviewDialog 열림
  ↓
"미리보기" 버튼 클릭
  ↓
테이블로 플랜 확인
  ↓
"재생성하기" 버튼 클릭
  ↓
플랜 재생성
```

### 개선 후 플로우
```
Step 7 진입
  ↓
스케줄 결과 표시 (이미 상세한 정보)
  ↓
"플랜 재생성" 버튼 클릭
  ↓
확인 다이얼로그
  ↓
플랜 재생성 (자동 갱신)
```

## 기술적 세부사항

### 재생성 핸들러 구현
```typescript
const handleRegenerate = () => {
  if (
    !confirm(
      "플랜을 재생성하시겠습니까? 기존 플랜이 삭제되고 새로 생성됩니다."
    )
  ) {
    return;
  }

  generatePlansMutation.mutate();
};
```

### 재생성 버튼
```typescript
<button
  type="button"
  onClick={handleRegenerate}
  disabled={generatePlansMutation.isPending}
  className="..."
>
  {generatePlansMutation.isPending ? "재생성 중..." : "플랜 재생성"}
</button>
```

### 쿼리 캐시 무효화
재생성 성공 시 자동으로 다음 쿼리들이 무효화되어 데이터가 갱신됩니다:
- `["plansExist", groupId]`
- `["planSchedule", groupId]`

## 유지된 기능

### PlanPreviewDialog
- 플랜 그룹 상세 페이지(`GeneratePlansButton`)에서 계속 사용
- 생성 전 미리보기 용도로만 활용
- Step 7에서는 더 이상 사용하지 않음

## 주의사항

- 재생성 시 기존 플랜이 삭제되고 새로 생성됨을 확인 다이얼로그로 명확히 안내
- 재생성 중에는 버튼이 비활성화되어 중복 실행 방지
- 재생성 성공 후 스케줄 결과가 자동으로 갱신됨 (React Query 캐시 무효화)

## 관련 파일

- `app/(student)/plan/new-group/_components/Step7ScheduleResult.tsx` (수정)
- `app/(student)/plan/group/[id]/_components/PlanPreviewDialog.tsx` (유지)
- `app/(student)/plan/group/[id]/_components/GeneratePlansButton.tsx` (유지)

