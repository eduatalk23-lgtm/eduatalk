# 출석 관리 페이지 UI 개선

## 작업 일자
2025-01-15

## 개요

학생 목록 페이지(`/admin/students`)의 성공적인 패턴을 출석 관리 페이지(`/admin/attendance`)에 적용하여 일관성 있는 UI/UX를 제공하고, 테이블 형식으로 전환하여 페이지네이션 및 필터링 기능을 개선했습니다.

## 작업 내용

### 1. 공통 유틸리티 함수 추출

**파일**: `lib/utils/attendanceUtils.ts` (신규)

- `getAttendanceStatusBadgeClass()`: 출석 상태별 배지 스타일 클래스 반환
- `formatAttendanceTime()`: 출석 시간 포맷팅 (HH:mm)
- `formatAttendanceDate()`: 출석 날짜 포맷팅 (YYYY년 MM월 DD일)
- `getCheckMethodLabel()`: 체크 방법 라벨 반환
- `getAttendanceStatusLabel()`: 출석 상태 라벨 반환

### 2. 상수 정의

**파일**: `lib/constants/attendance.ts` (신규)

- `ATTENDANCE_LIST_PAGE_SIZE`: 페이지당 20개 기록
- `ATTENDANCE_SORT_OPTIONS`: 정렬 옵션 (날짜순, 학생명순, 상태순)

### 3. Repository 레이어 개선

**파일**: `lib/domains/attendance/repository.ts`

#### 추가된 함수

- `findAttendanceRecordsWithPagination()`: 페이지네이션 지원 출석 기록 조회
  - 학생 정보 배치 조회로 N+1 문제 해결
  - 정렬 옵션 지원 (날짜, 학생명, 상태)
  - 학생명 정렬은 클라이언트 사이드에서 처리

- `countAttendanceRecords()`: 출석 기록 개수 조회

#### 타입 추가

- `AttendanceRecordWithStudent`: 학생명이 포함된 출석 기록 타입
- `AttendancePaginationParams`: 페이지네이션 파라미터
- `AttendancePaginationResult`: 페이지네이션 결과

### 4. 컴포넌트 생성

#### AttendanceTable 컴포넌트

**파일**: `app/(admin)/admin/attendance/_components/AttendanceTable.tsx` (신규)

- 학생 목록 페이지의 `StudentTable` 패턴 적용
- 체크박스 선택 기능
- 컬럼: 날짜, 학생명, 상태, 입실시간, 입실방법, 퇴실시간, 퇴실방법, 비고, 작업
- 다크모드 지원
- 반응형 디자인

#### AttendanceListClient 컴포넌트

**파일**: `app/(admin)/admin/attendance/_components/AttendanceListClient.tsx` (신규)

- 체크박스 선택 상태 관리
- `AttendanceTable` 컴포넌트 래핑

#### AttendanceSearchFilter 컴포넌트

**파일**: `app/(admin)/admin/attendance/_components/AttendanceSearchFilter.tsx` (신규)

- 학생명 검색
- 시작/종료 날짜 필터
- 상태 필터
- 입실 방법 필터
- 정렬 옵션
- 초기화 버튼

#### AttendancePagination 컴포넌트

**파일**: `app/(admin)/admin/attendance/_components/AttendancePagination.tsx` (신규)

- URL 쿼리 파라미터 기반 페이지네이션
- 이전/다음 버튼
- 현재 페이지 / 전체 페이지 표시

#### 타입 정의

**파일**: `app/(admin)/admin/attendance/_components/types.ts` (신규)

- `AttendanceTableRow`: 테이블 행 타입

### 5. 메인 페이지 리팩토링

**파일**: `app/(admin)/admin/attendance/page.tsx`

#### 변경 사항

- 기존 `AttendanceList` 컴포넌트 대신 `AttendanceListClient` 사용
- 페이지네이션 적용 (URL 쿼리 파라미터 기반)
- 필터 개선 (학생명 검색, 정렬 옵션 추가)
- `findAttendanceRecordsWithPagination()` 함수 사용

#### 필터 파라미터

- `student_name`: 학생명 검색
- `start_date`: 시작 날짜
- `end_date`: 종료 날짜
- `status`: 출석 상태
- `sort`: 정렬 옵션 (date, student_name, status)
- `page`: 페이지 번호

### 6. 타입 정의 확장

**파일**: `lib/domains/attendance/types.ts`

- `AttendanceFilters` 타입에 `student_ids` 필드 추가 (여러 학생 ID 필터링 지원)

## 기술적 개선 사항

### N+1 문제 해결

기존에는 각 출석 기록마다 학생 정보를 개별 조회했지만, 이제는 배치 조회 방식으로 변경하여 성능을 개선했습니다.

```typescript
// 학생 정보 배치 조회
const studentIds = [...new Set(records.map((r) => r.student_id).filter(Boolean))];
const { data: students } = await supabase
  .from("students")
  .select("id, name")
  .in("id", studentIds);
```

### 학생명 정렬

학생명 정렬은 서버 사이드에서 JOIN 쿼리 대신 클라이언트 사이드에서 처리하여 안정성을 높였습니다.

## UI/UX 개선

1. **일관성**: 학생 목록 페이지와 동일한 테이블 스타일 적용
2. **가독성**: 테이블 형식으로 정보를 한눈에 확인 가능
3. **필터링**: 학생명 검색 및 다양한 필터 옵션 제공
4. **페이지네이션**: 대량 데이터 처리 시 성능 개선
5. **다크모드**: 다크모드 지원

## 주의사항

1. **기존 AttendanceList 컴포넌트**: 학생 상세 페이지에서도 사용 중이므로 deprecated 처리하지 않음 (향후 마이그레이션 필요)
2. **통계 계산**: 현재는 페이지네이션된 데이터 기준으로 통계를 계산하므로, 전체 통계가 필요한 경우 별도 조회 필요

## 향후 개선 사항

1. **일괄 작업 기능**: 체크박스 선택 후 일괄 상태 변경, 일괄 삭제
2. **전체 통계**: 필터링된 전체 데이터 기준 통계 계산
3. **내보내기 기능**: CSV/Excel 내보내기
4. **실시간 업데이트**: Supabase Realtime 구독

## 참고 파일

- `app/(admin)/admin/students/_components/StudentTable.tsx` (참고)
- `app/(admin)/admin/students/_components/StudentSearchFilter.tsx` (참고)
- `app/(admin)/admin/students/_components/StudentPagination.tsx` (참고)





