# ìº í”„ ëª¨ë“œ Episode ì¡°íšŒ ì ê²€

## ğŸ“‹ ì ê²€ ê°œìš”

ì¼ë°˜ ëª¨ë“œì™€ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ `getStudentLectureEpisodesBatch` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ëŠ” ìº í”„ ëª¨ë“œì—ì„œ, ë§ˆìŠ¤í„° ì½˜í…ì¸ ì˜ episodesê°€ ì •ìƒì ìœ¼ë¡œ ì¡°íšŒë˜ëŠ”ì§€ ì ê²€í•©ë‹ˆë‹¤.

## ğŸ” í˜„ì¬ ìƒí™©

### 1. `getStudentLectureEpisodesBatch` í•¨ìˆ˜ì˜ Fallback ë¡œì§

ì´ë¯¸ ë§ˆìŠ¤í„° ì½˜í…ì¸  fallback ë¡œì§ì´ ì¶”ê°€ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

```typescript
// 1ì°¨ ì¡°íšŒ: student_lecture_episodes
const { data, error } = await supabase
  .from("student_lecture_episodes")
  .select("id, lecture_id, episode_number, episode_title, duration")
  .in("lecture_id", lectureIds)
  ...

// Fallback: ì¡°íšŒ ê²°ê³¼ê°€ ì—†ëŠ” ê°•ì˜ë“¤ì— ëŒ€í•´
if (emptyLectureIds.length > 0) {
  // lectures í…Œì´ë¸”ì—ì„œ master_lecture_id ì¡°íšŒ
  const { data: studentLectures } = await supabase
    .from("lectures")
    .select("id, master_lecture_id")
    .in("id", emptyLectureIds)
    .eq("student_id", studentId);

  // master_lecture_idê°€ ìˆìœ¼ë©´ lecture_episodesì—ì„œ ì¡°íšŒ
  if (masterLectureIds.length > 0) {
    const { data: masterEpisodesData } = await supabase
      .from("lecture_episodes")
      .select("id, lecture_id, episode_number, episode_title, duration")
      .in("lecture_id", masterLectureIds)
      ...
  }
}
```

### 2. ìº í”„ ëª¨ë“œì—ì„œì˜ ì‚¬ìš©

**íŒŒì¼**: `lib/data/campLearning.ts`

```typescript
// í•™ìƒë³„ë¡œ ë°°ì¹˜ ì¡°íšŒ
for (const [studentId, studentLectureIds] of studentLectureMap.entries()) {
  if (studentLectureIds.length > 0) {
    const episodes = await getStudentLectureEpisodesBatch(
      studentLectureIds,
      studentId
    );
    lectureEpisodesMap.set(studentId, episodes);
  }
}
```

âœ… **ì •ìƒ ë™ì‘**: ê° í•™ìƒë³„ë¡œ `getStudentLectureEpisodesBatch`ë¥¼ í˜¸ì¶œí•˜ë¯€ë¡œ, fallback ë¡œì§ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.

### 3. ìº í”„ ëª¨ë“œì˜ Episode í¬ë§·íŒ…

**íŒŒì¼**: `lib/data/campLearning.ts` - `formatLectureRange` í•¨ìˆ˜

```typescript
const formatLectureRange = (
  episodes: Array<{...}>,
  startEpisodeNumber: number,
  endEpisodeNumber: number
): string => {
  // episodesê°€ ì—†ì„ ë•Œ: ê¸°ë³¸ ê°• ë²ˆí˜¸ í˜•ì‹ìœ¼ë¡œ ë°˜í™˜
  if (episodes.length === 0) {
    return `${startEpisodeNumber}ê°•${startEpisodeNumber !== endEpisodeNumber ? ` ~ ${endEpisodeNumber}ê°•` : ""}`;
  }

  // startEpisodeë¥¼ ì°¾ì§€ ëª»í•  ë•Œ: ê¸°ë³¸ ê°• ë²ˆí˜¸ í˜•ì‹ìœ¼ë¡œ ë°˜í™˜
  if (!startEpisode) {
    return `${startEpisodeNumber}ê°•${startEpisodeNumber !== endEpisodeNumber ? ` ~ ${endEpisodeNumber}ê°•` : ""}`;
  }

  // episodesê°€ ìˆì„ ë•Œ: episode_title ë˜ëŠ” ê°• ë²ˆí˜¸ í˜•ì‹ìœ¼ë¡œ ë°˜í™˜
  ...
}
```

### 4. ì¼ë°˜ ëª¨ë“œì˜ Episode í¬ë§·íŒ…

**íŒŒì¼**: `app/(student)/actions/plan-groups/queries.ts` - `createLectureEpisodeString` í•¨ìˆ˜

```typescript
const createLectureEpisodeString = (
  episodes: Array<{...}>,
  startEpisodeNumber: number,
  endEpisodeNumber: number
): string | null => {
  // episodesê°€ ì—†ì„ ë•Œ: null ë°˜í™˜
  if (episodes.length === 0) return null;

  // startEpisodeë¥¼ ì°¾ì§€ ëª»í•  ë•Œ: null ë°˜í™˜
  if (!startEpisode) return null;

  // episodesê°€ ìˆì„ ë•Œ: episode_title ë˜ëŠ” ê°• ë²ˆí˜¸ í˜•ì‹ìœ¼ë¡œ ë°˜í™˜
  ...
}
```

## ğŸ“Š ë¹„êµ ë¶„ì„

| í•­ëª©                     | ì¼ë°˜ ëª¨ë“œ                                | ìº í”„ ëª¨ë“œ                                       |
| ------------------------ | ---------------------------------------- | ----------------------------------------------- |
| **Fallback ë¡œì§**        | âœ… `getStudentLectureEpisodesBatch` ì‚¬ìš© | âœ… `getStudentLectureEpisodesBatch` ì‚¬ìš©        |
| **Episodes ì—†ì„ ë•Œ**     | `null` ë°˜í™˜                              | ê¸°ë³¸ ê°• ë²ˆí˜¸ í˜•ì‹ ë°˜í™˜ (ì˜ˆ: "1ê°•", "1ê°• ~ 5ê°•") |
| **StartEpisode ì—†ì„ ë•Œ** | `null` ë°˜í™˜                              | ê¸°ë³¸ ê°• ë²ˆí˜¸ í˜•ì‹ ë°˜í™˜                          |

## âœ… ê²°ë¡ 

### 1. Fallback ë¡œì§ ì •ìƒ ì‘ë™

- ìº í”„ ëª¨ë“œì—ì„œë„ `getStudentLectureEpisodesBatch` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ, ë§ˆìŠ¤í„° ì½˜í…ì¸ ì˜ episodesë¥¼ ì •ìƒì ìœ¼ë¡œ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ê° í•™ìƒë³„ë¡œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë¯€ë¡œ, `student_id` ì¡°ê±´ë„ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤.

### 2. Episodesê°€ ì—†ì„ ë•Œì˜ ì²˜ë¦¬

**ì¼ë°˜ ëª¨ë“œ**:

- `null`ì„ ë°˜í™˜í•˜ì—¬, ìƒìœ„ ë¡œì§ì—ì„œ fallback ì²˜ë¦¬ (ì˜ˆ: `sequence` ì‚¬ìš©)

**ìº í”„ ëª¨ë“œ**:

- ê¸°ë³¸ ê°• ë²ˆí˜¸ í˜•ì‹ìœ¼ë¡œ í‘œì‹œ (ì˜ˆ: "1ê°•", "1ê°• ~ 5ê°•")
- ì´ëŠ” ìº í”„ ëª¨ë“œì˜ UI ìš”êµ¬ì‚¬í•­ì— ë§ëŠ” ì˜ë„ëœ ë™ì‘ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 3. ê°œì„  ì œì•ˆ

ìº í”„ ëª¨ë“œì—ì„œë„ ì¼ë°˜ ëª¨ë“œì™€ ë™ì¼í•˜ê²Œ `null`ì„ ë°˜í™˜í•˜ë„ë¡ ë³€ê²½í•˜ëŠ” ê²ƒì„ ê³ ë ¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```typescript
const formatLectureRange = (
  episodes: Array<{...}>,
  startEpisodeNumber: number,
  endEpisodeNumber: number
): string => {
  // episodesê°€ ì—†ì„ ë•Œ: null ë°˜í™˜ (ì¼ë°˜ ëª¨ë“œì™€ ë™ì¼)
  if (episodes.length === 0) {
    return null; // ë˜ëŠ” "-" ë°˜í™˜
  }

  // startEpisodeë¥¼ ì°¾ì§€ ëª»í•  ë•Œ: null ë°˜í™˜
  if (!startEpisode) {
    return null; // ë˜ëŠ” "-" ë°˜í™˜
  }

  // episodesê°€ ìˆì„ ë•Œ: episode_title ë˜ëŠ” ê°• ë²ˆí˜¸ í˜•ì‹ìœ¼ë¡œ ë°˜í™˜
  ...
}
```

í•˜ì§€ë§Œ í˜„ì¬ êµ¬í˜„ë„ ìœ íš¨í•œ ì„ íƒì…ë‹ˆë‹¤:

- Fallback ë¡œì§ì´ ì •ìƒ ì‘ë™í•˜ë¯€ë¡œ, ëŒ€ë¶€ë¶„ì˜ ê²½ìš° episodesë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- Episodesê°€ ì—†ëŠ” ê²½ìš°ëŠ” ë§¤ìš° ë“œë¬¼ë©°, ê¸°ë³¸ ê°• ë²ˆí˜¸ í˜•ì‹ìœ¼ë¡œ í‘œì‹œí•˜ëŠ” ê²ƒë„ ì‚¬ìš©ìì—ê²Œ ìœ ìš©í•œ ì •ë³´ì…ë‹ˆë‹¤.

## ğŸ¯ ìµœì¢… í™•ì¸ ì‚¬í•­

1. âœ… **Fallback ë¡œì§**: ì •ìƒ ì‘ë™ (ë§ˆìŠ¤í„° ì½˜í…ì¸ ì—ì„œ episodes ì¡°íšŒ ê°€ëŠ¥)
2. âœ… **ìº í”„ ëª¨ë“œ í˜¸ì¶œ**: í•™ìƒë³„ë¡œ í˜¸ì¶œí•˜ë¯€ë¡œ ì •ìƒ ì‘ë™
3. âš ï¸ **Episodes ì—†ì„ ë•Œ**: ê¸°ë³¸ ê°• ë²ˆí˜¸ í˜•ì‹ìœ¼ë¡œ í‘œì‹œ (ì¼ë°˜ ëª¨ë“œëŠ” `null`)

## ğŸ“… ì ê²€ ì¼ì‹œ

2025-12-22


