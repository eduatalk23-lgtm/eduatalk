# Session Manager headers() ì—ëŸ¬ ìˆ˜ì •

## ğŸ“‹ ì‘ì—… ê°œìš”

Next.js 15ì—ì„œ `headers()` í•¨ìˆ˜ê°€ ë°˜í™˜í•˜ëŠ” ê°ì²´ê°€ ì˜ˆìƒê³¼ ë‹¤ë¥¸ í˜•íƒœì¼ ë•Œ ë°œìƒí•˜ëŠ” `TypeError: headersList.get is not a function` ì—ëŸ¬ë¥¼ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.

## ğŸ” ë¬¸ì œ ìƒí™©

### ì—ëŸ¬ ë°œìƒ ìœ„ì¹˜
- íŒŒì¼: `lib/auth/sessionManager.ts`
- ë¼ì¸: 92ë²ˆì§¸ ì¤„ (`saveUserSession` í•¨ìˆ˜)
- ì—ëŸ¬: `TypeError: headersList.get is not a function`

### ì›ì¸ ë¶„ì„
Next.js 15ì—ì„œ Server Actions ì»¨í…ìŠ¤íŠ¸ì—ì„œ `headers()` í•¨ìˆ˜ê°€ ë°˜í™˜í•˜ëŠ” ê°ì²´ê°€ í‘œì¤€ `Headers` ê°ì²´ê°€ ì•„ë‹ ìˆ˜ ìˆì–´, `.get()` ë©”ì„œë“œê°€ ì—†ëŠ” ê²½ìš°ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

## âœ… í•´ê²° ë°©ë²•

### 1. í—¬í¼ í•¨ìˆ˜ ìƒì„±
`headers()`ì—ì„œ ì•ˆì „í•˜ê²Œ í—¤ë” ê°’ì„ ì¶”ì¶œí•˜ëŠ” `getHeaderValue()` í—¬í¼ í•¨ìˆ˜ë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤:

```typescript
/**
 * headersì—ì„œ ì•ˆì „í•˜ê²Œ í—¤ë” ê°’ ì¶”ì¶œ
 */
function getHeaderValue(name: string): string | null {
  try {
    const headersList = headers();
    if (!headersList || typeof headersList.get !== 'function') {
      return null;
    }
    return headersList.get(name);
  } catch {
    return null;
  }
}
```

### 2. í•¨ìˆ˜ ë¦¬íŒ©í† ë§

#### `getClientIP()` í•¨ìˆ˜
- ê¸°ì¡´: ì§ì ‘ `headers()` í˜¸ì¶œ í›„ `.get()` ì‚¬ìš©
- ë³€ê²½: `getHeaderValue()` í—¬í¼ í•¨ìˆ˜ ì‚¬ìš©
- íš¨ê³¼: ì¤‘ë³µ ì½”ë“œ ì œê±° ë° ì•ˆì „ì„± í–¥ìƒ

#### `saveUserSession()` í•¨ìˆ˜
- ê¸°ì¡´: ì§ì ‘ `headers()` í˜¸ì¶œ í›„ `.get()` ì‚¬ìš© (ì—ëŸ¬ ë°œìƒ)
- ë³€ê²½: `getHeaderValue()` í—¬í¼ í•¨ìˆ˜ ì‚¬ìš©
- íš¨ê³¼: ì—ëŸ¬ ë°©ì§€ ë° ì½”ë“œ ë‹¨ìˆœí™”

#### `getUserSessions()` í•¨ìˆ˜
- ê¸°ì¡´: try-catch ë‚´ë¶€ì—ì„œ ì§ì ‘ `headers()` í˜¸ì¶œ
- ë³€ê²½: `getHeaderValue()` í—¬í¼ í•¨ìˆ˜ ì‚¬ìš©
- íš¨ê³¼: ì½”ë“œ ì¼ê´€ì„± í–¥ìƒ

## ğŸ“ ë³€ê²½ ì‚¬í•­

### ìˆ˜ì •ëœ íŒŒì¼
- `lib/auth/sessionManager.ts`

### ì£¼ìš” ë³€ê²½ ë‚´ìš©
1. **í—¬í¼ í•¨ìˆ˜ ì¶”ê°€**: `getHeaderValue()` - ì•ˆì „í•œ í—¤ë” ê°’ ì¶”ì¶œ
2. **ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ **: `headers()` ë°˜í™˜ê°’ ê²€ì¦ ë¡œì§ ì¶”ê°€
3. **ì½”ë“œ ì¤‘ë³µ ì œê±°**: ì¤‘ë³µëœ í—¤ë” ì ‘ê·¼ ë¡œì§ì„ í—¬í¼ í•¨ìˆ˜ë¡œ í†µí•©
4. **ë¶ˆí•„ìš”í•œ ì£¼ì„ ì œê±°**: "ì„¸ì…˜ ì €ì¥ ì‹¤íŒ¨ëŠ” ë¡œê·¸ì¸ì„ ë§‰ì§€ ì•ŠìŒ" ë“± ì¤‘ë³µ ì£¼ì„ ì •ë¦¬

## ğŸ§ª í…ŒìŠ¤íŠ¸ í™•ì¸

- [x] Linter ì˜¤ë¥˜ ì—†ìŒ í™•ì¸
- [x] ê¸°ì¡´ ì½”ë“œ ë¡œì§ ìœ ì§€ í™•ì¸
- [x] ì—ëŸ¬ ì²˜ë¦¬ ë¡œì§ ê²€ì¦

## ğŸ”— ê´€ë ¨ íŒŒì¼

- `lib/auth/sessionManager.ts` - ì„¸ì…˜ ê´€ë¦¬ ëª¨ë“ˆ
- `app/actions/auth.ts` - ì¸ì¦ ì•¡ì…˜ (saveUserSession í˜¸ì¶œ)

## ğŸ“Œ ì°¸ê³  ì‚¬í•­

- `getHeaderValue()` í•¨ìˆ˜ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ try-catchë¡œ ê°ì‹¸ì ¸ ìˆì–´ ì•ˆì „í•˜ê²Œ ì‚¬ìš© ê°€ëŠ¥
- `headers()` í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ `null`ì„ ë°˜í™˜í•˜ì—¬ ì—ëŸ¬ ì—†ì´ ì²˜ë¦¬
- ì„¸ì…˜ ì •ë³´(device_name, user_agent, ip_address)ëŠ” ì„ íƒì  í•„ë“œì´ë¯€ë¡œ, í—¤ë” ì¶”ì¶œ ì‹¤íŒ¨ ì‹œì—ë„ ë¡œê·¸ì¸ì€ ì •ìƒì ìœ¼ë¡œ ì§„í–‰ë¨

## âœ… ì™„ë£Œ ë‚ ì§œ

2025-01-XX

