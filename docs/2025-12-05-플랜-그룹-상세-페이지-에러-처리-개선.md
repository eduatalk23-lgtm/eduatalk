# 플랜 그룹 상세 페이지 에러 처리 개선

**작업 일시**: 2025-12-05  
**작업 범위**: 에러 처리 로직 개선

---

## 🐛 문제 상황

`PlanGroupDetailPage`에서 템플릿 블록 세트 조회 시 에러가 발생했지만, 에러 정보가 제대로 추출되지 않아 콘솔에 빈 객체(`{} {}`)로 출력되었습니다.

```
[PlanGroupDetailPage] 템플릿 블록 세트 조회 에러: {} {}
```

---

## 🔍 원인 분석

기존 에러 처리 로직이 Supabase 에러 객체의 속성을 안전하게 추출하지 못했습니다:

1. **에러 객체 타입 불일치**: Supabase 에러 객체가 `Error` 인스턴스가 아닐 수 있음
2. **속성 접근 실패**: 에러 객체의 속성에 접근할 때 예외가 발생할 수 있음
3. **원본 에러 정보 손실**: 에러 정보 추출 실패 시 원본 에러 정보가 손실됨

---

## ✅ 해결 방법

### 1. 안전한 에러 속성 추출 로직 구현

에러 객체를 더 안전하게 처리하도록 개선:

```typescript
// Supabase 에러 객체의 주요 속성 추출 (더 안전한 처리)
const errorInfo: Record<string, unknown> = {};

try {
  if (blockSetError instanceof Error) {
    errorInfo.message = blockSetError.message;
    errorInfo.name = blockSetError.name;
    errorInfo.stack = blockSetError.stack;
  } else if (typeof blockSetError === "object" && blockSetError !== null) {
    // 일반 객체인 경우 모든 속성 복사
    Object.keys(blockSetError).forEach((key) => {
      try {
        errorInfo[key] = (blockSetError as Record<string, unknown>)[key];
      } catch {
        // 속성 접근 실패 시 무시
      }
    });
  } else {
    errorInfo.value = String(blockSetError);
  }
  
  // Supabase 에러의 표준 속성들 확인
  const standardKeys = ["message", "code", "details", "hint", "statusCode"];
  standardKeys.forEach((key) => {
    if (key in blockSetError) {
      try {
        errorInfo[key] = (blockSetError as Record<string, unknown>)[key];
      } catch {
        // 속성 접근 실패 시 무시
      }
    }
  });
} catch (extractError) {
  errorInfo.extractionError = String(extractError);
  errorInfo.rawError = String(blockSetError);
}

// 최소한의 정보라도 보장
if (Object.keys(errorInfo).length === 0) {
  errorInfo.message = String(blockSetError);
}
```

### 2. 원본 에러 정보 보존

에러 로그에 원본 에러 객체도 함께 출력:

```typescript
console.error(
  "[PlanGroupDetailPage] 템플릿 블록 세트 조회 에러:",
  errorInfo,
  {
    block_set_id: blockSetId,
    template_id: group.camp_template_id,
  },
  "원본 에러:",
  blockSetError
);
```

### 3. 모든 에러 처리 지점 개선

다음 세 가지 에러 처리 지점 모두 개선:

1. **템플릿 조회 에러** (라인 ~170)
2. **템플릿 블록 세트 조회 에러** (라인 ~243)
3. **템플릿 블록 조회 에러** (라인 ~293)

---

## 📝 변경 파일

- `app/(student)/plan/group/[id]/page.tsx`
  - 에러 처리 로직 개선 (3곳)
  - 원본 에러 정보 보존 및 출력

---

## 🎯 개선 효과

1. **상세한 에러 정보**: 에러 발생 시 더 상세한 정보를 콘솔에서 확인 가능
2. **디버깅 용이성**: 원본 에러 객체를 함께 출력하여 문제 원인 파악 용이
3. **안정성 향상**: 에러 정보 추출 실패 시에도 최소한의 정보는 보장

---

## 🔄 향후 작업

1. 실제 에러 발생 시 로그 확인하여 근본 원인 파악
2. 필요 시 데이터베이스 쿼리 로직 검토
3. 에러 발생 시 사용자에게 적절한 메시지 표시 (현재는 콘솔 로그만)

