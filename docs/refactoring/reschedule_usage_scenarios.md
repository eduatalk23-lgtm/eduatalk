# 플랜 재조정 기능 사용 시나리오

## 📋 문서 정보

- **작성일**: 2025-01-22
- **버전**: 1.0
- **관련 문서**:
  - `docs/refactoring/logical_plan_reschedule_integration_todo.md`
  - `docs/refactoring/reschedule_feature_todo.md`

---

## 📊 개요

이 문서는 통합된 플랜 재조정 기능의 실제 사용 시나리오를 단계별로 설명합니다.

재조정 기능은 다음을 제공합니다:
- **날짜 범위 선택 재생성**: 특정 날짜 범위만 선택하여 재생성
- **전체 재생성**: 모든 플랜을 재생성
- **스마트 추천**: 시스템이 자동으로 추천하는 날짜 범위 (Phase 3)
- **일괄 조정**: 여러 콘텐츠를 한 번에 조정 (Phase 5)
- **자동 제안**: 학습 지연 감지 시 자동 제안 (Phase 6)

---

## 🎯 시나리오 1: 날짜 범위 선택 재조정 (기본)

### 상황
- 학생이 2주 전에 생성한 플랜 그룹이 있음
- 현재 1주차 학습을 완료했고, 2주차 플랜의 범위를 조정하고 싶음
- 1주차 완료된 플랜은 유지하고, 2주차만 재생성하고 싶음

### 사용자 행동

#### Step 1: 재조정 시작

1. **플랜 그룹 상세 페이지 접근**
   - `/plan/group/[id]` 페이지로 이동
   - 플랜 그룹 정보 확인

2. **재조정 버튼 클릭**
   - 상단 액션 버튼 영역의 "재조정" 아이콘 클릭
   - 또는 "재조정" 링크 클릭
   - `/plan/group/[id]/reschedule` 페이지로 이동

#### Step 2: 콘텐츠 선택 (Step 1)

1. **콘텐츠 목록 확인**
   - 화면에 플랜 그룹의 모든 콘텐츠 목록 표시
   - 각 콘텐츠의 상태 표시:
     - ✅ 재조정 가능
     - ⚠️ 부분 재조정 가능 (일부 완료)
     - ❌ 재조정 불가 (전체 완료)

2. **재조정할 콘텐츠 선택**
   - 수학 교재 A 체크박스 선택
   - 영어 교재 B 체크박스 선택
   - 선택된 콘텐츠는 하이라이트 표시

3. **재생성 범위 선택**
   - "재생성 범위 선택" 섹션 표시
   - "전체 재생성" / "날짜 범위 선택" 라디오 버튼
   - "날짜 범위 선택" 라디오 버튼 선택

4. **날짜 범위 선택**
   - 캘린더 컴포넌트 표시
   - 2주차 시작일(2025-01-15) 클릭
   - 2주차 종료일(2025-01-21) 클릭
   - 선택된 날짜 범위가 하이라이트 표시
   - 완료된 플랜이 있는 날짜는 자동으로 회색 처리 (선택 불가)
   - 선택된 범위 표시: "2025-01-15 ~ 2025-01-21"

5. **다음 단계로 진행**
   - "다음" 버튼 클릭
   - Step 2로 이동

#### Step 3: 상세 조정 (Step 2)

1. **선택한 콘텐츠 확인**
   - 수학 교재 A, 영어 교재 B 표시
   - 각 콘텐츠의 현재 범위 표시

2. **수학 교재 A 범위 수정**
   - "수학 교재 A" 카드 클릭
   - 조정 타입 선택: "범위 수정"
   - 현재 범위: 1~50p
   - 새 범위 입력: 1~60p
   - "적용" 버튼 클릭

3. **영어 교재 B 콘텐츠 교체**
   - "영어 교재 B" 카드 클릭
   - 조정 타입 선택: "콘텐츠 교체"
   - 현재 콘텐츠: 영어 교재 B
   - 새 콘텐츠 선택: 영어 교재 C
   - "적용" 버튼 클릭

4. **조정 내역 확인**
   - 조정 요약 표시:
     - 범위 수정: 1개
     - 콘텐츠 교체: 1개

5. **다음 단계로 진행**
   - "다음" 버튼 클릭
   - Step 3로 이동

#### Step 4: 미리보기 & 확인 (Step 3)

1. **변경 요약 확인**
   - 기존 플랜 수: 14개
   - 새 플랜 수: 16개
   - 영향받는 날짜: 7일 (2025-01-15 ~ 2025-01-21)
   - 선택한 날짜 범위: 2025-01-15 ~ 2025-01-21 (표시됨)
   - 예상 시간: 28시간

2. **조정 내역 확인**
   - 범위 수정: 1개
   - 콘텐츠 교체: 1개
   - 전체 재생성: 0개

3. **경고 메시지 확인**
   - "⚠️ 총 14개의 기존 플랜이 비활성화되고, 16개의 새 플랜이 생성됩니다."
   - "완료된 플랜은 유지되며, 롤백은 최대 24시간 내에만 가능합니다."
   - "선택한 날짜 범위: 2025-01-15 ~ 2025-01-21"

4. **재조정 실행**
   - "재조정 실행" 버튼 클릭
   - 확인 다이얼로그 표시
   - "실행" 버튼 클릭
   - 재조정 진행 중 표시

5. **완료 확인**
   - "재조정이 완료되었습니다." 메시지 표시
   - 플랜 그룹 상세 페이지로 자동 이동

---

## 🎯 시나리오 2: 전체 재생성

### 상황
- 플랜 그룹의 모든 콘텐츠를 재생성하고 싶음
- 날짜 범위 선택 없이 전체 재생성

### 사용자 행동

#### Step 1: 재조정 시작
- 시나리오 1과 동일

#### Step 2: 콘텐츠 선택 (Step 1)

1. **전체 콘텐츠 선택**
   - "전체 선택" 체크박스 클릭
   - 모든 콘텐츠 자동 선택

2. **전체 재생성 옵션 선택**
   - "재생성 범위 선택" 섹션에서 "전체 재생성" 라디오 버튼 선택
   - 날짜 범위 선택 UI 숨김

3. **다음 단계로 진행**
   - "다음" 버튼 클릭

#### Step 3: 상세 조정 (Step 2)
- 시나리오 1과 동일

#### Step 4: 미리보기 & 확인 (Step 3)

1. **변경 요약 확인**
   - 기존 플랜 수: 100개
   - 새 플랜 수: 105개
   - 영향받는 날짜: 전체 (30일)
   - 예상 시간: 200시간

2. **재조정 실행**
   - "재조정 실행" 버튼 클릭
   - 확인 다이얼로그 표시
   - "실행" 버튼 클릭

---

## 🎯 시나리오 3: 스마트 추천 활용 (Phase 3)

### 상황
- 학습 지연이 발생하여 재조정이 필요함
- 시스템이 자동으로 추천하는 날짜 범위를 활용하고 싶음

### 사용자 행동

#### Step 1: 재조정 시작
- 시나리오 1과 동일

#### Step 2: 콘텐츠 선택 (Step 1)

1. **콘텐츠 선택**
   - 지연된 콘텐츠 선택

2. **날짜 범위 선택 모드 선택**
   - "날짜 범위 선택" 라디오 버튼 선택

3. **스마트 추천 확인** (Phase 3 기능)
   - "추천 날짜 범위" 섹션에 여러 추천 표시:
     - "미완료 플랜만 (2025-01-15 ~ 2025-01-21)" - 이유: 학습 지연 감지
     - "과부하 날짜 제외 (2025-01-10 ~ 2025-01-14)" - 이유: 일일 학습 시간 과부하
     - "전체 재생성" - 이유: 모든 플랜 재조정 필요

4. **추천 선택**
   - "미완료 플랜만" 추천의 "원클릭 선택" 버튼 클릭
   - 날짜 범위 자동 선택
   - 영향받는 날짜: 7일 자동 표시

5. **다음 단계로 진행**
   - "다음" 버튼 클릭

#### Step 3-4: 상세 조정 및 미리보기
- 시나리오 1과 동일

---

## 🎯 시나리오 4: 일괄 조정 (Phase 5)

### 상황
- 여러 콘텐츠의 범위를 동일한 비율로 조정하고 싶음
- 예: 모든 교재의 범위를 10% 증가

### 사용자 행동

#### Step 1: 재조정 시작
- 시나리오 1과 동일

#### Step 2: 콘텐츠 선택 (Step 1)

1. **여러 콘텐츠 선택**
   - 수학 교재 A 체크박스 선택
   - 영어 교재 B 체크박스 선택
   - 과학 교재 C 체크박스 선택
   - 국어 교재 D 체크박스 선택

2. **날짜 범위 선택**
   - "날짜 범위 선택" 라디오 버튼 선택
   - 날짜 범위 선택

3. **다음 단계로 진행**
   - "다음" 버튼 클릭

#### Step 3: 상세 조정 (Step 2)

1. **일괄 조정 모드 활성화** (Phase 5 기능)
   - "일괄 조정" 토글 버튼 클릭
   - 일괄 조정 UI 표시

2. **일괄 범위 조정 설정**
   - 조정 타입: "범위 조정"
   - 조정 방식: "비율 적용"
   - 조정 비율: 10% 증가
   - "일괄 적용" 버튼 클릭

3. **조정 결과 확인**
   - 수학 교재 A: 1~50p → 1~55p (10% 증가)
   - 영어 교재 B: 1~40p → 1~44p (10% 증가)
   - 과학 교재 C: 1~60p → 1~66p (10% 증가)
   - 국어 교재 D: 1~30p → 1~33p (10% 증가)

4. **개별 조정 (선택)**
   - 특정 콘텐츠는 개별 조정 가능
   - "수학 교재 A" 카드 클릭
   - 개별 범위 수정

5. **다음 단계로 진행**
   - "다음" 버튼 클릭

#### Step 4: 미리보기 & 확인
- 시나리오 1과 동일

---

## 🎯 시나리오 5: 자동 제안 활용 (Phase 6)

### 상황
- 학습 지연이 감지되어 시스템이 자동으로 재조정 제안
- 제안을 확인하고 적용하고 싶음

### 사용자 행동

#### Step 1: 자동 제안 확인

1. **플랜 그룹 상세 페이지 접근**
   - `/plan/group/[id]` 페이지로 이동

2. **자동 제안 배너 확인** (Phase 6 기능)
   - 상단에 노란색 배너 표시:
     - "⚠️ 학습 지연이 감지되었습니다."
     - "재조정을 제안합니다."
     - "자세히 보기" 버튼

3. **제안 상세 확인**
   - "자세히 보기" 버튼 클릭
   - 제안 상세 모달 표시:
     - 제안 이유: "1주차 학습이 계획보다 20% 지연되었습니다."
     - 제안 조정: "2주차 플랜 범위를 15% 감소"
     - 예상 효과: "완료율 85% → 95% 예상"

4. **제안 적용**
   - "제안 적용" 버튼 클릭
   - 재조정 Wizard로 자동 이동
   - 제안된 조정이 자동으로 적용됨

#### Step 2-4: 재조정 진행
- 시나리오 1과 동일

---

## 🎯 시나리오 6: 롤백 (되돌리기)

### 상황
- 재조정을 실행했지만 결과가 마음에 들지 않음
- 24시간 이내이므로 롤백 가능

### 사용자 행동

#### Step 1: 롤백 확인

1. **플랜 그룹 상세 페이지 접근**
   - `/plan/group/[id]` 페이지로 이동

2. **재조정 히스토리 확인** (Phase 7 기능)
   - "재조정 히스토리" 탭 클릭
   - 최근 재조정 이력 목록 표시

3. **롤백 가능한 재조정 확인**
   - 최근 재조정 항목에 "롤백 가능" 배지 표시
   - 재조정 일시: 2시간 전
   - 롤백 가능 시간: 22시간 남음

4. **롤백 상세 확인**
   - 재조정 항목 클릭
   - 재조정 상세 정보 표시:
     - 조정 내역
     - 변경 전/후 비교
     - 영향받는 플랜 수

#### Step 2: 롤백 실행

1. **롤백 확인**
   - "롤백" 버튼 클릭
   - 확인 다이얼로그 표시:
     - "이전 상태로 되돌리시겠습니까?"
     - "롤백 후에는 다시 되돌릴 수 없습니다."

2. **롤백 실행**
   - "롤백 실행" 버튼 클릭
   - 롤백 진행 중 표시

3. **완료 확인**
   - "롤백이 완료되었습니다." 메시지 표시
   - 플랜 그룹이 이전 상태로 복원됨

---

## 🎯 시나리오 7: 충돌 감지 및 해결 (Phase 4)

### 상황
- 재조정 시 시간 충돌이 발생
- 충돌을 확인하고 해결하고 싶음

### 사용자 행동

#### Step 1: 재조정 진행
- 시나리오 1과 동일 (Step 1-2)

#### Step 2: 미리보기에서 충돌 확인 (Step 3)

1. **충돌 경고 확인** (Phase 4 기능)
   - 미리보기 화면에 빨간색 경고 배너 표시:
     - "⚠️ 시간 충돌이 감지되었습니다."
     - "충돌 상세 보기" 버튼

2. **충돌 상세 확인**
   - "충돌 상세 보기" 버튼 클릭
   - 충돌 목록 표시:
     - 2025-01-15 14:00-16:00: 수학 교재 A와 영어 교재 B 시간 겹침
     - 2025-01-16 10:00-12:00: 과학 교재 C와 국어 교재 D 시간 겹침

3. **충돌 해결 옵션 확인**
   - 각 충돌에 대해 해결 옵션 표시:
     - "자동 조정" 버튼: 시스템이 자동으로 시간 조정
     - "수동 조정" 버튼: 사용자가 직접 시간 조정

4. **자동 조정 선택**
   - "자동 조정" 버튼 클릭
   - 시스템이 충돌 해결
   - 조정된 시간 표시

5. **재조정 실행**
   - 충돌이 해결되었는지 확인
   - "재조정 실행" 버튼 클릭

---

## 📊 시나리오 요약

| 시나리오 | 주요 기능 | Phase | 사용 시점 |
|---------|----------|-------|----------|
| 시나리오 1 | 날짜 범위 선택 재생성 | Phase 1 | 특정 기간만 재생성하고 싶을 때 |
| 시나리오 2 | 전체 재생성 | Phase 1 | 모든 플랜을 재생성하고 싶을 때 |
| 시나리오 3 | 스마트 추천 활용 | Phase 3 | 시스템 추천을 활용하고 싶을 때 |
| 시나리오 4 | 일괄 조정 | Phase 5 | 여러 콘텐츠를 한 번에 조정하고 싶을 때 |
| 시나리오 5 | 자동 제안 활용 | Phase 6 | 학습 지연 시 자동 제안을 받고 싶을 때 |
| 시나리오 6 | 롤백 | Phase 1 | 재조정 결과가 마음에 들지 않을 때 |
| 시나리오 7 | 충돌 감지 및 해결 | Phase 4 | 시간 충돌이 발생했을 때 |

---

## 🔍 주요 UI 컴포넌트

### Step 1: 콘텐츠 선택
- 콘텐츠 목록 (체크박스)
- 재생성 범위 선택 (라디오 버튼)
  - 전체 재생성
  - 날짜 범위 선택
- 날짜 범위 선택 (캘린더)
  - 시작 날짜 선택
  - 종료 날짜 선택
  - 완료된 플랜 날짜 자동 제외
- 스마트 추천 (카드 목록) - Phase 3

### Step 2: 상세 조정
- 콘텐츠 카드 (개별 조정)
- 일괄 조정 모드 (토글) - Phase 5
- 조정 타입 선택 (드롭다운)
- 조정 값 입력 (입력 필드)

### Step 3: 미리보기 & 확인
- 변경 요약 (통계 카드)
  - 기존 플랜 수
  - 새 플랜 수
  - 영향받는 날짜 (선택한 날짜 범위 표시)
  - 예상 시간
- 조정 내역 (목록)
- 변경 전/후 비교 (테이블) - Phase 4
- 충돌 경고 (배너) - Phase 4
- 재조정 실행 버튼

---

## 📝 참고사항

### 완료된 플랜 보호
- `status = 'completed'`인 플랜은 자동으로 재조정에서 제외됩니다.
- 완료된 플랜이 있는 날짜는 날짜 범위 선택에서 회색으로 표시됩니다.
- 완료된 플랜은 비활성화되지 않습니다.

### 롤백 제한
- 롤백은 재조정 실행 후 24시간 이내에만 가능합니다.
- 롤백 후에는 다시 되돌릴 수 없습니다.

### 동시 재조정 방지
- 같은 플랜 그룹에 대해 동시에 여러 재조정을 실행할 수 없습니다.
- 다른 사용자가 재조정 중이면 "다른 사용자가 재조정 중입니다." 메시지가 표시됩니다.

### 재조정 히스토리
- 모든 재조정 이력은 `reschedule_log` 테이블에 저장됩니다.
- 재조정 히스토리에서 이전 재조정을 확인하고 롤백할 수 있습니다.

### 날짜 범위 선택
- 날짜 범위를 선택하면 해당 범위의 플랜만 재생성됩니다.
- 전체 재생성을 선택하면 모든 플랜이 재생성됩니다 (완료된 플랜 제외).

---

## 📚 관련 문서

- `docs/refactoring/logical_plan_reschedule_integration_todo.md` - 통합 TODO
- `docs/refactoring/reschedule_feature_todo.md` - 재조정 기능 TODO
- `app/(student)/plan/group/[id]/reschedule/page.tsx` - 재조정 페이지
- `app/(student)/actions/plan-groups/reschedule.ts` - 재조정 Server Actions

---

## 📝 변경 기록

| 날짜 | 버전 | 내용 |
|------|------|------|
| 2025-01-22 | 1.0 | 초안 작성 |

