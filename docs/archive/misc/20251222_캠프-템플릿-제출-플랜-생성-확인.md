# 캠프 템플릿 제출 시 플랜 생성 확인

**작업 일시**: 2025-12-22  
**확인 사항**: 학생의 캠프 템플릿 제출 시 플랜이 생성되지 않는지 확인

---

## 현재 동작 확인

### `submitCampParticipation` 함수 분석

**파일**: `app/(student)/actions/campActions.ts`

**확인 결과**:
1. ✅ **플랜 그룹만 생성**: `createPlanGroupAction` 호출하여 플랜 그룹만 생성
2. ✅ **플랜(student_plan)은 생성하지 않음**: `generatePlansFromGroupAction` 호출 없음
3. ✅ **플랜 그룹 상태를 "saved"로 변경**: 제출 완료 시 상태 변경

**코드 흐름**:
```typescript
// 1. 플랜 그룹 생성/업데이트
const result = await createPlanGroupAction(planGroupData, {
  skipContentValidation: true,
});

// 2. 플랜 그룹 상태를 "saved"로 변경
await supabase
  .from("plan_groups")
  .update({ status: "saved", updated_at: new Date().toISOString() })
  .eq("id", groupId);

// 3. 초대 상태 업데이트
await updateCampInvitationStatus(invitationId, "accepted");

// ❌ 플랜(student_plan) 생성 코드 없음 - 정상
```

---

## 문제점

### 플랜 그룹 생성 실패

**에러 로그**:
```
⨯ Error [AppError]: 플랜 그룹 생성 실패
   at _createPlanGroup (app/(student)/actions/plan-groups/create.ts:211:11)
```

**원인 분석 필요**:
- RLS 정책 위반 가능성
- 데이터 검증 실패 가능성
- 제약 조건 위반 가능성

**해결 방법**:
- 에러 로깅 강화 완료 (`lib/data/planGroups.ts`)
- 실제 에러 로그 확인 필요

---

## 확인 사항

### 1. 플랜 그룹 생성 확인

- [ ] `createPlanGroupAction`이 성공적으로 실행되는지 확인
- [ ] 플랜 그룹이 데이터베이스에 생성되는지 확인
- [ ] 플랜 그룹 상태가 "saved"로 변경되는지 확인

### 2. 플랜(student_plan) 생성 확인

- [ ] `submitCampParticipation`에서 플랜을 생성하지 않는지 확인
- [ ] `generatePlansFromGroupAction`이 호출되지 않는지 확인
- [ ] `student_plan` 테이블에 레코드가 생성되지 않는지 확인

### 3. 관리자 영역 확인

- [ ] 관리자가 "남은 작업 이어하기"로 플랜을 생성할 수 있는지 확인
- [ ] 관리자가 플랜 생성 후 학생이 학습을 시작할 수 있는지 확인

---

## 다음 단계

1. **실제 에러 로그 확인**
   - 학생이 캠프 템플릿을 제출할 때 발생하는 실제 에러 로그 확인
   - 에러 코드와 메시지를 통해 구체적인 원인 파악

2. **플랜 그룹 생성 실패 원인 해결**
   - RLS 정책 위반: RLS 정책 확인 및 수정
   - 데이터 검증 실패: 데이터 검증 로직 확인
   - 제약 조건 위반: 데이터베이스 제약 조건 확인

3. **플랜 생성 방지 확인**
   - `submitCampParticipation`에서 플랜을 생성하지 않는지 재확인
   - 다른 경로에서 플랜이 생성되는지 확인

---

## 참고 사항

- `submitCampParticipation` 함수는 플랜 그룹만 생성하고 플랜은 생성하지 않습니다.
- 관리자가 "남은 작업 이어하기"로 플랜을 생성해야 합니다.
- 플랜 그룹 생성 실패 시 초대 상태는 업데이트되지 않습니다.




