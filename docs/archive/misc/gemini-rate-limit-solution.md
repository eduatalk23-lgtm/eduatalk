# Gemini API Rate Limit 분석 및 해결 방안

## 1. 개요
현재 Gemini API 사용 시 `429 Too Many Requests` 에러가 발생하며 AI 플랜 생성 기능 테스트가 중단되었습니다. 본 문서는 해당 에러의 원인을 분석하고, 구체적인 해결 방안을 제시합니다.

## 2. 현상 분석
- **에러 메시지**: `Quota exceeded for metric: generativelanguage.googleapis.com/generate_content_free_tier_requests`
- **의미**: **무료 등급(Free Tier)**에 할당된 **일일 요청 횟수(RPD)** 또는 **분당 요청 횟수(RPM)**를 초과했습니다.
- **특이사항**: Gemini 모델별로 별도의 할당량이 적용되지만, 인기 있는 모델(`gemini-2.0-flash`, `gemini-1.5-pro` 등)은 무료 등급 제한이 매우 엄격합니다.

## 3. Gemini API 티어 비교

| 구분 | 무료 등급 (Free of Charge) | 유료 등급 (Pay-as-you-go) |
| :--- | :--- | :--- |
| **비용** | 무료 | 사용량 기반 과금 (매우 저렴함) |
| **RPM (분당 요청)** | 15 RPM (Gemini 1.5 Pro)<br>15 RPM (Gemini 1.5 Flash) | 1,000 ~ 2,000 RPM |
| **RPD (일일 요청)** | 1,500 RPD (대부분 모델) | **제한 없음** (할당량 상향 요청 가능) |
| **데이터 정책** | 입력/출력 데이터가 **구글의 모델 학습에 사용될 수 있음** | 데이터가 학습에 **사용되지 않음** (기업용 권장) |

> **참고**: Rate Limit은 태평양 표준시(PST) 자정을 기준으로 초기화됩니다. (한국 시간 오후 4~5시 경)

## 4. 해결 방안

### 방안 A: 유료 등급(Pay-as-you-go) 전환 (권장) 👍
가장 확실하고 안정적인 해결책입니다. Gemini API 가격은 다른 LLM 대비 매우 저렴합니다.

1.  **Google Cloud Console** 접속
2.  사용 중인 프로젝트에 **결제 계정(Billing Account)** 연결
3.  [Google AI Studio](https://aistudio.google.com/plan_information)에서 요금제 확인

**예상 비용 (Gemini 1.5 Flash 기준):**
- **입력**: $0.075 / 100만 토큰 (약 100원 -> 책 10권 분량)
- **출력**: $0.30 / 100만 토큰
- **테스트 용도로는 월 1,000원도 나오기 힘든 수준입니다.**

### 방안 B: 모델 변경 (임시 방편)
할당량은 모델별로 분리되어 있을 수 있습니다. 덜 붐비는 모델이나 경량화 모델을 시도해 보세요.

- **추천 모델**: `gemini-2.0-flash-lite-preview-02-05`, `gemini-1.5-flash`
- **방법**: `test-gemini-plan.ts` 스크립트나 코드에서 `modelId`를 변경하여 테스트.

### 방안 C: 개발/테스트 프로세스 개선
무료 등급을 유지해야 한다면 다음 규칙을 준수해야 합니다.

1.  **재시도 로직 강화**: `429` 에러 발생 시 충분한 시간(예: 60초 이상) 대기 후 재시도하는 로직은 이미 `GeminiProvider`에 구현되어 있습니다. 하지만 **일일 한도(RPD)** 초과 시에는 대기가 소용없습니다.
2.  **Mocking 활용**: 개발 단계에서는 실제 API 호출 대신 Mock 데이터를 사용하여 UI 및 로직을 테스트합니다.
    - `scripts/test-llm-mock.ts` 활용 권장
    - 실제 API는 최종 검증 시에만 호출

## 5. 결론 및 제안
현재 프로젝트는 **"AI 플랜 생성"**이라는 핵심 기능을 다루고 있으므로, 안정적인 서비스 제공과 데이터 개인정보 보호(무료 등급은 학습 데이터로 사용됨)를 위해 **유료 등급 전환을 강력히 권장**합니다.

비용 부담이 거의 없으며, 개발 생산성을 크게 높일 수 있습니다.
