# νμ›κ°€μ… μ‹ ν…λ„νΈ μ΅°ν λ¬Έμ  ν•΄κ²°

## π“‹ λ¬Έμ  μƒν™©

νμ›κ°€μ… νμ΄μ§€μ—μ„ ν…λ„νΈ λ©λ΅μ„ μ΅°νν•  μ μ—†λ” λ¬Έμ κ°€ λ°μƒν–μµλ‹λ‹¤.

### μ›μΈ λ¶„μ„

1. **μΈμ¦ μ „ μƒνƒ**: νμ›κ°€μ… μ‹μ μ—λ” μ•„μ§ μΈμ¦λμ§€ μ•μ€ μ‚¬μ©μμ…λ‹λ‹¤.
2. **RLS μ •μ±… μ μ•½**: `createSupabaseServerClient()`λ” μΈμ¦λ μ‚¬μ©μμ μ„Έμ…μ„ κΈ°λ°μΌλ΅ μ‘λ™ν•λ©°, RLS(Row Level Security) μ •μ±…μ— λ”°λΌ μΈμ¦λμ§€ μ•μ€ μ‚¬μ©μλ” `tenants` ν…μ΄λΈ”μ„ μ΅°νν•  μ μ—†μµλ‹λ‹¤.
3. **μ—λ¬ μ²λ¦¬ λ¶€μ΅±**: μ—λ¬ λ°μƒ μ‹ μ‚¬μ©μμ—κ² λ…ν™•ν• ν”Όλ“λ°±μ΄ μ κ³µλμ§€ μ•μ•μµλ‹λ‹¤.

## π”§ ν•΄κ²° λ°©λ²•

### 1. Admin ν΄λΌμ΄μ–ΈνΈ μ‚¬μ©

νμ›κ°€μ…μ© ν…λ„νΈ μ΅°νλ” κ³µκ° μ •λ³΄μ΄λ―€λ΅, RLSλ¥Ό μ°νν•λ” Admin ν΄λΌμ΄μ–ΈνΈλ¥Ό μ‚¬μ©ν•λ„λ΅ λ³€κ²½ν–μµλ‹λ‹¤.

**λ³€κ²½ νμΌ**: `app/actions/tenants.ts`

```typescript
// λ³€κ²½ μ „
const supabase = await createSupabaseServerClient();

// λ³€κ²½ ν›„
const adminClient = createSupabaseAdminClient();
```

### 2. μ£Όμ” λ³€κ²½ μ‚¬ν•­

#### `app/actions/tenants.ts`

- `createSupabaseServerClient()` β†’ `createSupabaseAdminClient()`λ΅ λ³€κ²½
- Admin ν΄λΌμ΄μ–ΈνΈκ°€ μ—†μ„ κ²½μ° μ—λ¬ μ²λ¦¬ μ¶”κ°€
- `status` μ»¬λΌ μ΅΄μ¬ μ—¬λ¶€ ν™•μΈ ν›„ ν™μ„±ν™”λ κΈ°κ΄€λ§ ν•„ν„°λ§ν•λ” λ΅μ§ κ°μ„ 

#### `app/signup/page.tsx`

- μ—λ¬ λ°μƒ μ‹ λΉ λ°°μ—΄λ΅ μ„¤μ •ν•μ—¬ UIκ°€ μ μ ν ν‘μ‹λλ„λ΅ κ°μ„ 
- μ—λ¬ λ΅κΉ… κ°μ„  (μ½μ†”μ— λ” λ…ν™•ν• λ©”μ‹μ§€ μ¶λ ¥)

## β… κ°μ„  ν¨κ³Ό

1. **μΈμ¦ μ „ μ‚¬μ©μ μ ‘κ·Ό κ°€λ¥**: νμ›κ°€μ… μ‹μ μ μΈμ¦λμ§€ μ•μ€ μ‚¬μ©μλ„ ν…λ„νΈ λ©λ΅μ„ μ΅°νν•  μ μμµλ‹λ‹¤.
2. **RLS μ°ν**: Admin ν΄λΌμ΄μ–ΈνΈλ¥Ό μ‚¬μ©ν•μ—¬ RLS μ •μ±…μ„ μ°νν•κ³  λ¨λ“  ν™μ„±ν™”λ ν…λ„νΈλ¥Ό μ΅°νν•©λ‹λ‹¤.
3. **μ—λ¬ μ²λ¦¬ κ°μ„ **: Admin ν΄λΌμ΄μ–ΈνΈ μƒμ„± μ‹¤ν¨ μ‹ λ…ν™•ν• μ—λ¬ λ©”μ‹μ§€λ¥Ό μ κ³µν•©λ‹λ‹¤.

## π”’ λ³΄μ• κ³ λ ¤μ‚¬ν•­

- Admin ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„ μ‚¬μ΄λ“μ—μ„λ§ μ‚¬μ©λλ©°, `SUPABASE_SERVICE_ROLE_KEY` ν™κ²½ λ³€μκ°€ ν•„μ”ν•©λ‹λ‹¤.
- νμ›κ°€μ…μ© ν…λ„νΈ λ©λ΅μ€ κ³µκ° μ •λ³΄μ΄λ―€λ΅ RLSλ¥Ό μ°νν•΄λ„ λ³΄μ•μƒ λ¬Έμ κ°€ μ—†μµλ‹λ‹¤.
- λ―Όκ°ν• μ •λ³΄(μ: κΈ°κ΄€ μ„¤μ •, μ‚¬μ©μ μ λ“±)λ” ν¬ν•¨ν•μ§€ μ•κ³  κΈ°λ³Έ μ •λ³΄(id, name, type)λ§ λ°ν™ν•©λ‹λ‹¤.

## π“ ν…μ¤νΈ μ²΄ν¬λ¦¬μ¤νΈ

- [ ] νμ›κ°€μ… νμ΄μ§€μ—μ„ ν…λ„νΈ λ©λ΅μ΄ μ •μƒμ μΌλ΅ λ΅λ“λλ”μ§€ ν™•μΈ
- [ ] `SUPABASE_SERVICE_ROLE_KEY`κ°€ μ„¤μ •λμ§€ μ•μ€ κ²½μ° μ μ ν• μ—λ¬ μ²λ¦¬κ°€ λλ”μ§€ ν™•μΈ
- [ ] ν™μ„±ν™”λ ν…λ„νΈλ§ ν‘μ‹λλ”μ§€ ν™•μΈ (status μ»¬λΌμ΄ μλ” κ²½μ°)
- [ ] λ¨λ“  ν…λ„νΈκ°€ ν‘μ‹λλ”μ§€ ν™•μΈ (status μ»¬λΌμ΄ μ—†λ” κ²½μ°)

## π€ λ°°ν¬ μ „ ν™•μΈ μ‚¬ν•­

1. **ν™κ²½ λ³€μ ν™•μΈ**: `SUPABASE_SERVICE_ROLE_KEY`κ°€ ν”„λ΅λ•μ… ν™κ²½μ— μ„¤μ •λμ–΄ μλ”μ§€ ν™•μΈ
2. **RLS μ •μ±… ν™•μΈ**: `tenants` ν…μ΄λΈ”μ RLS μ •μ±…μ΄ Admin ν΄λΌμ΄μ–ΈνΈ μ‚¬μ©μ„ ν—μ©ν•λ”μ§€ ν™•μΈ
3. **μ—λ¬ λ¨λ‹ν„°λ§**: ν”„λ΅λ•μ… ν™κ²½μ—μ„ ν…λ„νΈ μ΅°ν μ‹¤ν¨ μ‹ μ μ ν• λ΅κΉ…μ΄ λλ”μ§€ ν™•μΈ

---

**μ‘μ—… μΌμ**: 2025-01-31  
**κ΄€λ ¨ νμΌ**:
- `app/actions/tenants.ts`
- `app/signup/page.tsx`

