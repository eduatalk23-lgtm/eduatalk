# Step 6 플랜 생성 버그 수정

## 문제 상황

최종 확인 단계(Step 6)에서 다음 버튼을 클릭했을 때 플랜 생성이 되지 않는 문제가 발생했습니다.

## 원인 분석

Step 6에서 다음 버튼을 클릭했을 때 `handleNext` 함수가 호출되는데, 일반 모드에서는 `setCurrentStep(7)`만 호출하고 있었습니다. 플랜 생성 로직은 `handleSubmit` 함수 내부에 있었기 때문에, `handleSubmit()`을 호출하지 않으면 플랜이 생성되지 않았습니다.

**문제 코드**:
```typescript
// Step 6 (최종 확인)에서 다음 버튼 클릭 시
if (currentStep === 6) {
  // 관리자 continue 모드: 데이터만 저장 후 Step 7로 이동
  // 일반 모드: Step 7로 이동 (플랜은 이미 Step 5에서 생성됨)
  if (isAdminContinueMode) {
    handleSubmit(false); // 플랜 생성하지 않고 데이터만 저장
  } else {
    setCurrentStep(7); // Step 7로 이동 (플랜 생성 로직이 실행되지 않음!)
  }
  return;
}
```

## 해결 방안

Step 6에서 다음 버튼을 클릭했을 때 `handleSubmit(true)`를 호출하여 플랜 생성 로직이 실행되도록 수정했습니다.

## 수정 내용

### 1. PlanGroupWizard.tsx - handleNext 함수 수정

**변경 전**:
```typescript
// Step 6 (최종 확인)에서 다음 버튼 클릭 시
if (currentStep === 6) {
  // 관리자 continue 모드: 데이터만 저장 후 Step 7로 이동
  // 일반 모드: Step 7로 이동 (플랜은 이미 Step 5에서 생성됨)
  if (isAdminContinueMode) {
    handleSubmit(false); // 플랜 생성하지 않고 데이터만 저장
  } else {
    setCurrentStep(7); // Step 7로 이동
  }
  return;
}
```

**변경 후**:
```typescript
// Step 6 (최종 확인)에서 다음 버튼 클릭 시
if (currentStep === 6) {
  // 관리자 continue 모드: 데이터만 저장 후 Step 7로 이동
  // 일반 모드: 플랜 생성 후 Step 7로 이동
  if (isAdminContinueMode) {
    handleSubmit(false); // 플랜 생성하지 않고 데이터만 저장
  } else {
    handleSubmit(true); // 플랜 생성 후 Step 7로 이동
  }
  return;
}
```

### 2. Step 5에서 플랜 생성 로직 제거

Step 5에서는 플랜을 생성하지 않고, Step 6 → Step 7 전환 시에만 플랜을 생성하도록 수정했습니다.

**변경 전**:
```typescript
// Step 5 (학습범위 점검)에서 다음 버튼 클릭 시
if (currentStep === 5) {
  // 일반 모드: 플랜 생성 후 Step 6으로 이동
  // 캠프 모드: 데이터만 저장 후 Step 6으로 이동 (플랜 생성은 Step 7에서)
  if (isAdminContinueMode) {
    handleSubmit(false); // 플랜 생성하지 않고 데이터만 저장
  } else {
    handleSubmit(true); // 플랜 생성 후 Step 6으로 이동
  }
  return;
}
```

**변경 후**:
```typescript
// Step 5 (학습범위 점검)에서 다음 버튼 클릭 시
if (currentStep === 5) {
  // 일반 모드: 데이터만 저장 후 Step 6으로 이동 (플랜 생성은 Step 6 → Step 7 전환 시)
  // 캠프 모드: 데이터만 저장 후 Step 6으로 이동 (플랜 생성은 Step 7에서)
  if (isAdminContinueMode) {
    handleSubmit(false); // 플랜 생성하지 않고 데이터만 저장
  } else {
    handleSubmit(false); // 플랜 생성하지 않고 데이터만 저장 (플랜은 Step 6 → Step 7 전환 시 생성)
  }
  return;
}
```

## 결과

이제 Step 6에서 다음 버튼을 클릭하면:

1. ✅ `handleSubmit(true)`가 호출됨
2. ✅ 플랜 그룹 데이터가 저장됨
3. ✅ 플랜이 자동으로 생성됨 (없는 경우)
4. ✅ Step 7로 이동하여 스케줄 결과 표시

## 테스트 시나리오

1. 일반 모드에서 플랜 그룹 생성
2. Step 5까지 진행
3. Step 5에서 다음 버튼 클릭 → Step 6으로 이동 (플랜 생성 안 됨)
4. Step 6에서 다음 버튼 클릭 → 플랜 생성 후 Step 7로 이동
5. Step 7에서 스케줄 결과가 표시되는지 확인

## 관련 파일

- `app/(student)/plan/new-group/_components/PlanGroupWizard.tsx`

