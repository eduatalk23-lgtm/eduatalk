# í…œí”Œë¦¿ ìƒì„¸ë³´ê¸° ë¸”ë¡ ì„¸íŠ¸ ì¡°íšŒ ë¡œì§ ìˆ˜ì •

## ğŸ” ë¬¸ì œ ìƒí™©

í…œí”Œë¦¿ ìƒì„± ì‹œ ì„ íƒí•œ ë¸”ë¡ ì„¸íŠ¸ê°€ ì €ì¥ í›„ ê´€ë¦¬ìì™€ í•™ìƒì˜ ìƒì„¸ ë³´ê¸°ì—ì„œ ë³´ì´ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

## ğŸ“Š ì›ì¸ ë¶„ì„

### 1. í…œí”Œë¦¿ ì €ì¥ ì‹œ ë¸”ë¡ ì„¸íŠ¸ ì²˜ë¦¬

**íŒŒì¼**: `app/(admin)/actions/campTemplateActions.ts`

- `template_data`ì—ì„œ `block_set_id`ë¥¼ **ì œê±°**í•˜ê³  ì €ì¥
- `camp_template_block_sets` í…Œì´ë¸”ì—ë§Œ ë¸”ë¡ ì„¸íŠ¸ ì—°ê²° ì €ì¥ (486-493ì¤„)
- ìƒˆë¡œìš´ êµ¬ì¡°: í…œí”Œë¦¿ê³¼ ë¸”ë¡ ì„¸íŠ¸ê°€ ë¶„ë¦¬ëœ í…Œì´ë¸”ë¡œ ê´€ë¦¬

```typescript
// block_set_idë¥¼ ì¶”ì¶œí•˜ê³  template_dataì—ì„œ ì œê±° (ì—°ê²° í…Œì´ë¸”ë¡œ ê´€ë¦¬)
const blockSetId = templateData.block_set_id && templateData.block_set_id !== "" 
  ? templateData.block_set_id 
  : null;

// template_dataì—ì„œ block_set_id ì œê±°
const { block_set_id, ...templateDataWithoutBlockSetId } = templateData;

// ë¸”ë¡ ì„¸íŠ¸ ì—°ê²° ì²˜ë¦¬
if (blockSetId) {
  try {
    await linkBlockSetToTemplate(result.templateId, blockSetId);
  } catch (linkError) {
    console.error("[createCampTemplateAction] ë¸”ë¡ ì„¸íŠ¸ ì—°ê²° ì‹¤íŒ¨:", linkError);
  }
}
```

### 2. ìƒì„¸ ë³´ê¸° ì¡°íšŒ ì‹œ ë¬¸ì œì 

**íŒŒì¼**: `app/(admin)/admin/camp-templates/[id]/page.tsx` (ìˆ˜ì • ì „)

1. âŒ **êµ¬ í…Œì´ë¸” ì¡°íšŒ**: `template_block_sets`, `template_blocks` í…Œì´ë¸”ì„ ì§ì ‘ ì¡°íšŒ
2. âŒ **ì˜ëª»ëœ ì¡°íšŒ ê²½ë¡œ**: `template_data.block_set_id`ì—ì„œ ë¸”ë¡ ì„¸íŠ¸ IDë¥¼ ì°¾ìœ¼ë ¤ ì‹œë„ (í•˜ì§€ë§Œ ì €ì¥ ì‹œ ì œê±°ë¨)
3. âŒ **ì¤‘ë³µ ë¡œì§**: ì´ë¯¸ ì¡´ì¬í•˜ëŠ” `getTemplateBlockSet` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ

```typescript
// âŒ ì˜ëª»ëœ ì¡°íšŒ ë¡œì§ (ìˆ˜ì • ì „)
const blockSetId = templateData?.block_set_id; // í•­ìƒ undefined (ì œê±°ë¨)

if (blockSetId) {
  // êµ¬ í…Œì´ë¸” ì¡°íšŒ
  const { data: blockSet } = await supabase
    .from("template_block_sets")  // âŒ êµ¬ í…Œì´ë¸”
    .select("id, name, template_id")
    .eq("id", blockSetId)
    .eq("template_id", id)
    .maybeSingle();
}
```

## ğŸ›  í•´ê²° ë°©ë²•

### ë³€ê²½ ì‚¬í•­

**íŒŒì¼**: `app/(admin)/admin/camp-templates/[id]/page.tsx`

1. âœ… **ì˜¬ë°”ë¥¸ í•¨ìˆ˜ ì‚¬ìš©**: `getTemplateBlockSet` í•¨ìˆ˜ë¡œ ë³€ê²½
2. âœ… **ìƒˆë¡œìš´ êµ¬ì¡° ì¡°íšŒ**: `camp_template_block_sets` â†’ `tenant_block_sets` â†’ `tenant_blocks` ê²½ë¡œë¡œ ì¡°íšŒ
3. âœ… **ì½”ë“œ ê°„ì†Œí™”**: ë¶ˆí•„ìš”í•œ ë¡œì§ ì œê±°

### ìˆ˜ì • ë‚´ìš©

```typescript
// âœ… ìˆ˜ì • í›„ - ê°„ë‹¨í•˜ê³  ì˜¬ë°”ë¥¸ ì¡°íšŒ
import { getTemplateBlockSet } from "@/app/(admin)/actions/campTemplateBlockSets";

// í…œí”Œë¦¿ ë¸”ë¡ ì„¸íŠ¸ ì •ë³´ ì¡°íšŒ (camp_template_block_sets í…Œì´ë¸”ì„ í†µí•´ ì¡°íšŒ)
const templateBlockSet = await getTemplateBlockSet(id);
```

### ì£¼ìš” ë³€ê²½ ì‚¬í•­

1. **Import ë³€ê²½**
   - âŒ ì œê±°: `createSupabaseServerClient`, `getTenantContext`
   - âœ… ì¶”ê°€: `getTemplateBlockSet`

2. **ì¡°íšŒ ë¡œì§ ê°„ì†Œí™”**
   - âŒ ì œê±°: 70ì¤„ ì´ìƒì˜ ë³µì¡í•œ ì¡°íšŒ ë¡œì§
   - âœ… ì¶”ê°€: 1ì¤„ì˜ í•¨ìˆ˜ í˜¸ì¶œ

3. **ë°ì´í„° êµ¬ì¡°**
   - âœ… `camp_template_block_sets` í…Œì´ë¸”ì„ í†µí•´ ì—°ê²° ì¡°íšŒ
   - âœ… `tenant_block_sets` í…Œì´ë¸”ì—ì„œ ë¸”ë¡ ì„¸íŠ¸ ì •ë³´ ì¡°íšŒ
   - âœ… `tenant_blocks` í…Œì´ë¸”ì—ì„œ ë¸”ë¡ ì •ë³´ ì¡°íšŒ

## ğŸ“‹ ë°ì´í„° íë¦„

### í…œí”Œë¦¿ ì €ì¥ ì‹œ
```
í…œí”Œë¦¿ ìƒì„± (createCampTemplateAction)
  â†“
template_dataì—ì„œ block_set_id ì¶”ì¶œ ë° ì œê±°
  â†“
camp_template_block_sets í…Œì´ë¸”ì— ì—°ê²° ì €ì¥
  (camp_template_id, tenant_block_set_id)
```

### ìƒì„¸ ë³´ê¸° ì¡°íšŒ ì‹œ (ìˆ˜ì • í›„)
```
í…œí”Œë¦¿ ID
  â†“
getTemplateBlockSet(templateId)
  â†“
camp_template_block_sets ì¡°íšŒ (camp_template_idë¡œ)
  â†“
tenant_block_sets ì¡°íšŒ (tenant_block_set_idë¡œ)
  â†“
tenant_blocks ì¡°íšŒ (tenant_block_set_idë¡œ)
  â†“
ë¸”ë¡ ì„¸íŠ¸ ì •ë³´ + ë¸”ë¡ ëª©ë¡ ë°˜í™˜
```

## âœ… ê¸°ëŒ€ íš¨ê³¼

1. âœ… **ì •ìƒ í‘œì‹œ**: í…œí”Œë¦¿ì— ì—°ê²°ëœ ë¸”ë¡ ì„¸íŠ¸ê°€ ìƒì„¸ ë³´ê¸°ì—ì„œ ì •ìƒì ìœ¼ë¡œ í‘œì‹œë¨
2. âœ… **ì½”ë“œ ê°„ì†Œí™”**: 70ì¤„ ì´ìƒì˜ ë³µì¡í•œ ë¡œì§ì„ 1ì¤„ë¡œ ë‹¨ìˆœí™”
3. âœ… **ì¼ê´€ì„±**: ë‹¤ë¥¸ í˜ì´ì§€ë“¤ê³¼ ë™ì¼í•œ í•¨ìˆ˜ ì‚¬ìš©ìœ¼ë¡œ ì¼ê´€ì„± í™•ë³´
4. âœ… **ìœ ì§€ë³´ìˆ˜ì„±**: ì¤‘ì•™ ì§‘ì¤‘ì‹ í•¨ìˆ˜ ì‚¬ìš©ìœ¼ë¡œ í–¥í›„ ë³€ê²½ ì‹œ ê´€ë¦¬ ìš©ì´

## ğŸ”— ê´€ë ¨ íŒŒì¼

- `app/(admin)/admin/camp-templates/[id]/page.tsx` - ìˆ˜ì •ëœ íŒŒì¼
- `app/(admin)/actions/campTemplateBlockSets.ts` - ì‚¬ìš©ëœ í•¨ìˆ˜
- `app/(admin)/actions/campTemplateActions.ts` - í…œí”Œë¦¿ ì €ì¥ ë¡œì§

## ğŸ“ ì°¸ê³ 

- `getTemplateBlockSet` í•¨ìˆ˜ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ê¶Œí•œ í™•ì¸ ë° ì—ëŸ¬ ì²˜ë¦¬ë¥¼ í¬í•¨í•˜ê³  ìˆì–´ ì•ˆì „í•˜ê²Œ ì‚¬ìš© ê°€ëŠ¥
- ë¸”ë¡ ì„¸íŠ¸ê°€ ì—°ê²°ë˜ì§€ ì•Šì€ ê²½ìš° `null`ì„ ë°˜í™˜í•˜ë©°, ì»´í¬ë„ŒíŠ¸ì—ì„œ ì˜µì…”ë„ ì²´ì´ë‹ìœ¼ë¡œ ì²˜ë¦¬ë¨

---

**ì‘ì—… ì¼ì**: 2025ë…„ 12ì›” 5ì¼

