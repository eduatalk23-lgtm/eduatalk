# 일반 모드 스케줄 결과 표시 문제 수정

## 문제 상황

일반 모드에서 최종 확인(Step 6) 후 Step 7로 이동했을 때 스케줄 결과가 표시되지 않는 문제가 발생했습니다.

## 원인 분석

1. **Step7ScheduleResult.tsx**에서 플랜이 없을 때 `if (!data) { return null; }`로 아무것도 렌더링하지 않음
2. 플랜이 없으면 스케줄 결과 쿼리가 실행되지 않음 (`enabled: Boolean(plansCheck?.hasPlans || generatePlansMutation.isSuccess)`)
3. 사용자가 Step 7로 이동했을 때 플랜이 없으면 빈 화면이 표시됨

## 해결 방안

### 1. 플랜이 없을 때도 UI 표시

- 플랜이 없을 때 "플랜 생성하기" 버튼과 안내 메시지를 표시
- 사용자가 플랜을 생성할 수 있도록 명확한 UI 제공

### 2. 플랜 생성 후 스케줄 결과 자동 표시

- 플랜 생성 성공 시 쿼리 무효화 및 재조회
- `plansCheck` 쿼리를 즉시 재조회하여 `hasPlans` 상태 업데이트
- 스케줄 결과 쿼리가 자동으로 실행되어 결과 표시

## 수정 내용

### Step7ScheduleResult.tsx

1. **플랜이 없을 때 UI 표시 추가**
   - `if (!data && !isLoadingData && !isGenerating)` 조건 추가
   - 플랜이 없을 때 안내 메시지와 "플랜 생성하기" 버튼 표시

```typescript
// 수정 전
if (!data) {
  return null;
}

// 수정 후
// 플랜이 없을 때 UI 표시
if (!data && !isLoadingData && !isGenerating) {
  return (
    <div className="space-y-6">
      <div>
        <h2 className="text-xl font-semibold text-gray-900">스케줄 결과</h2>
        <p className="mt-1 text-sm text-gray-500">
          플랜을 생성하면 학습 스케줄을 확인할 수 있습니다.
        </p>
      </div>
      <div className="rounded-lg border border-dashed border-gray-300 bg-gray-50 p-12 text-center">
        <p className="mb-4 text-sm text-gray-600">
          아직 플랜이 생성되지 않았습니다. 아래 버튼을 클릭하여 플랜을 생성하세요.
        </p>
        <button
          type="button"
          onClick={() => {
            if (generatePlansMutation.isPending || generatePlansMutation.isSuccess) {
              return;
            }
            generatePlansMutation.mutate();
          }}
          disabled={generatePlansMutation.isPending || generatePlansMutation.isSuccess}
          className="inline-flex items-center justify-center rounded-lg bg-indigo-600 px-6 py-3 text-sm font-semibold text-white hover:bg-indigo-700 disabled:cursor-not-allowed disabled:bg-indigo-400"
        >
          {generatePlansMutation.isPending ? "플랜 생성 중..." : "플랜 생성하기"}
        </button>
      </div>
    </div>
  );
}
```

2. **플랜 생성 후 쿼리 재조회 강화**
   - `onSuccess`에서 `invalidateQueries`와 함께 `refetchQueries` 추가
   - `plansCheck` 쿼리를 즉시 재조회하여 상태 업데이트

```typescript
// 수정 전
onSuccess: () => {
  queryClient.invalidateQueries({ queryKey: ["plansExist", groupId] });
  queryClient.invalidateQueries({ queryKey: ["planSchedule", groupId] });
}

// 수정 후
onSuccess: async () => {
  await queryClient.invalidateQueries({ queryKey: ["plansExist", groupId] });
  await queryClient.invalidateQueries({ queryKey: ["planSchedule", groupId] });
  // plansCheck를 즉시 재조회하여 hasPlans 상태 업데이트
  await queryClient.refetchQueries({ queryKey: ["plansExist", groupId] });
}
```

## 결과

이제 Step 7로 이동했을 때:

1. ✅ 플랜이 없을 때도 명확한 UI가 표시됨
2. ✅ "플랜 생성하기" 버튼을 통해 플랜 생성 가능
3. ✅ 플랜 생성 후 스케줄 결과가 자동으로 표시됨
4. ✅ 사용자가 다음 단계를 진행할 수 있도록 명확한 안내 제공

## 테스트 시나리오

1. 일반 모드에서 플랜 그룹 생성
2. Step 6까지 진행
3. Step 7로 이동
4. 플랜이 없을 때 "플랜 생성하기" 버튼이 표시되는지 확인
5. "플랜 생성하기" 버튼 클릭
6. 플랜 생성 후 스케줄 결과가 자동으로 표시되는지 확인

## 관련 파일

- `app/(student)/plan/new-group/_components/Step7ScheduleResult.tsx`

