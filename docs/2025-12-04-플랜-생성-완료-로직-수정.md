# 플랜 생성 완료 로직 수정

## 작업 일자

2025-12-04

## 문제점

일반 모드에서 Step 5에서 플랜이 생성되어, 사용자가 설정을 수정하고 전 단계로 돌아갔다가 다시 Step 5로 오면 플랜이 계속 중복 생성되는 문제가 발생했습니다.

## 수정 내용

### 1. Step 5에서 플랜 생성 로직 제거

- **파일**: `app/(student)/plan/new-group/_components/PlanGroupWizard.tsx`
- **변경 사항**:
  - Step 5에서 플랜 생성 로직 제거 (1115-1157줄)
  - Step 5에서는 데이터만 저장하고 Step 6으로 이동
  - Step 6에서는 데이터만 저장하고 Step 7로 이동
  - 플랜 생성은 Step 7 완료 버튼에서만 수행

### 2. Step 7 완료 버튼에서 플랜 생성 로직 추가

- **파일**: `app/(student)/plan/new-group/_components/PlanGroupWizard.tsx`
- **변경 사항**:
  - 일반 모드에서 Step 7 완료 버튼 클릭 시:
    1. 플랜이 없으면 `generatePlansFromGroupAction` 호출하여 플랜 생성
    2. 플랜 생성 후 플랜 존재 확인
    3. 다른 활성 플랜 그룹 확인 후 활성화 및 리다이렉트

### 3. Step 5 버튼 텍스트 변경

- **파일**: `app/(student)/plan/new-group/_components/PlanGroupWizard.tsx`
- **변경 사항**:
  - 일반 모드에서 Step 5 버튼 텍스트: "플랜 생성하기" → "스케줄 미리보기로 이동"
  - Step 6과 동일한 텍스트로 통일

### 4. Step7ScheduleResult 완료 버튼 개선

- **파일**: `app/(student)/plan/new-group/_components/Step7ScheduleResult.tsx`
- **변경 사항**:
  - 완료 버튼 클릭 시 플랜이 없으면 생성 후 완료
  - 플랜 생성 중에는 버튼 비활성화
  - 플랜 생성 실패 시 에러 메시지 표시

## 수정된 플로우

### 일반 플랜 생성 플로우

1. **Step 1-4**: 기본 정보 및 설정 입력
2. **Step 5**: 데이터 저장 후 Step 6으로 이동 (플랜 생성 안 함)
3. **Step 6**: 데이터 저장 후 Step 7로 이동 (플랜 생성 안 함)
4. **Step 7**:
   - 플랜이 없으면 자동 생성 (Step7ScheduleResult의 useEffect)
   - 완료 버튼 클릭 시:
     - 플랜이 없으면 생성
     - 플랜 생성 후 활성화 및 리다이렉트

### 캠프 플랜 생성 플로우 (학생 모드)

- **변경 없음**: Step 4에서 제출만, 플랜 생성은 나중에 (관리자 검토 후)

### 캠프 플랜 생성 플로우 (관리자 모드)

- **변경 없음**: Step 7에서 플랜 생성 (이미 정상)

## 테스트 확인 사항

- [ ] 일반 모드에서 Step 5에서 플랜이 생성되지 않는지 확인
- [ ] 일반 모드에서 Step 7 완료 버튼 클릭 시 플랜이 생성되는지 확인
- [ ] 설정 수정 후 전 단계로 돌아갔다가 다시 Step 5로 와도 플랜이 중복 생성되지 않는지 확인
- [ ] 캠프 학생 모드에서 Step 4 제출 후 플랜이 생성되지 않는지 확인 (정상)
- [ ] 캠프 관리자 모드에서 Step 7에서 플랜이 생성되는지 확인 (정상)
