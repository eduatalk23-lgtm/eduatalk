# Schools 테이블 위계 구성 및 속성 제안

## 개요

학교 관리 데이터베이스의 테이블 위계 구조와 속성에 대한 선택지를 제시합니다. 교과/과목 관리 구조(`curriculum_revisions` → `subject_groups` → `subjects`)를 참고하여 설계되었습니다.

**작성일**: 2025-02-07  
**참고 구조**: 교과/과목 관리 (curriculum_revisions → subject_groups → subjects)

---

## 현재 구조

```
regions (지역)
  └─▶ schools (학교)
```

**특징**:
- 단순한 2단계 구조
- 지역별로 학교 관리
- 중고등학교와 대학교 모두 동일한 구조

---

## 위계 구조 선택지

### 선택지 1: 단순 구조 (현재 구조 유지)

```
regions (지역)
  └─▶ schools (학교)
```

**테이블 구성**:
- `regions`: 지역 정보
- `schools`: 학교 정보 (region_id FK)

**장점**:
- ✅ 구조가 단순하고 이해하기 쉬움
- ✅ 쿼리가 간단함
- ✅ 유지보수가 쉬움
- ✅ 현재 구현 완료 상태

**단점**:
- ❌ 교육청 정보를 학교 테이블에 직접 저장해야 함
- ❌ 대학교 캠퍼스 정보를 학교 테이블에 직접 저장해야 함
- ❌ 확장성이 제한적

**적용 시나리오**:
- 교육청 정보가 중요하지 않은 경우
- 대학교 캠퍼스 구분이 필요 없는 경우
- 빠른 구현이 필요한 경우

---

### 선택지 2: 교육청 포함 구조 (중고등학교 중심)

```
regions (지역)
  └─▶ offices_of_education (교육청)
        └─▶ schools (학교)
```

**테이블 구성**:
- `regions`: 지역 정보
- `offices_of_education`: 교육청 정보 (region_id FK)
- `schools`: 학교 정보 (office_of_education_id FK, region_id FK는 제거)

**장점**:
- ✅ 교육청별 학교 관리 가능
- ✅ 교육청 통계 및 분석 용이
- ✅ 나이스 API 구조와 일치 (교육청 단위 관리)
- ✅ 중고등학교 관리에 적합

**단점**:
- ❌ 대학교는 교육청이 없어서 NULL 처리 필요
- ❌ 구조가 복잡해짐
- ❌ 마이그레이션 필요

**적용 시나리오**:
- 중고등학교 관리가 주요 목적인 경우
- 교육청별 통계가 중요한 경우
- 나이스 API와 완전히 일치시키고 싶은 경우

---

### 선택지 3: 캠퍼스 포함 구조 (대학교 중심)

```
regions (지역)
  └─▶ schools (학교)
        └─▶ campuses (캠퍼스) - 대학교만
```

**테이블 구성**:
- `regions`: 지역 정보
- `schools`: 학교 정보 (region_id FK)
- `campuses`: 캠퍼스 정보 (school_id FK, type='대학교'인 경우만 사용)

**장점**:
- ✅ 대학교 캠퍼스 관리 용이
- ✅ 같은 대학교의 여러 캠퍼스 관리 가능
- ✅ 중고등학교는 캠퍼스 없이 사용 가능

**단점**:
- ❌ 중고등학교는 campuses 테이블 미사용
- ❌ 구조가 복잡해짐
- ❌ 마이그레이션 필요

**적용 시나리오**:
- 대학교 관리가 주요 목적인 경우
- 캠퍼스별 통계가 중요한 경우
- 같은 대학교의 여러 캠퍼스를 구분해야 하는 경우

---

### 선택지 4: 복합 구조 (교육청 + 캠퍼스)

```
regions (지역)
  ├─▶ offices_of_education (교육청) - 중고등학교용
  │     └─▶ schools (중고등학교)
  └─▶ schools (대학교)
        └─▶ campuses (캠퍼스) - 대학교만
```

**테이블 구성**:
- `regions`: 지역 정보
- `offices_of_education`: 교육청 정보 (region_id FK, 중고등학교용)
- `schools`: 학교 정보
  - 중고등학교: `office_of_education_id` FK 사용
  - 대학교: `region_id` FK 직접 사용
- `campuses`: 캠퍼스 정보 (school_id FK, type='대학교'인 경우만)

**장점**:
- ✅ 중고등학교와 대학교 모두 최적화된 구조
- ✅ 교육청별, 캠퍼스별 관리 가능
- ✅ 확장성 최대

**단점**:
- ❌ 구조가 가장 복잡함
- ❌ 쿼리가 복잡해짐
- ❌ 마이그레이션 복잡
- ❌ 유지보수 어려움

**적용 시나리오**:
- 중고등학교와 대학교 모두 중요하게 관리해야 하는 경우
- 교육청별, 캠퍼스별 통계가 모두 필요한 경우
- 장기적인 확장성을 고려하는 경우

---

### 선택지 5: 하이브리드 구조 (학교 타입별 분리)

```
regions (지역)
  ├─▶ middle_schools (중학교)
  │     └─▶ office_of_education_id (FK)
  ├─▶ high_schools (고등학교)
  │     └─▶ office_of_education_id (FK)
  └─▶ universities (대학교)
        └─▶ campuses (캠퍼스)
```

**테이블 구성**:
- `regions`: 지역 정보
- `offices_of_education`: 교육청 정보 (region_id FK)
- `middle_schools`: 중학교 (office_of_education_id FK)
- `high_schools`: 고등학교 (office_of_education_id FK)
- `universities`: 대학교 (region_id FK)
- `campuses`: 캠퍼스 (university_id FK)

**장점**:
- ✅ 학교 타입별로 최적화된 필드 구성 가능
- ✅ 타입별 특화 필드 관리 용이
- ✅ 쿼리 성능 최적화 가능

**단점**:
- ❌ 테이블이 많아짐
- ❌ 공통 쿼리 작성이 복잡함
- ❌ UNION 쿼리 필요
- ❌ 마이그레이션 매우 복잡

**적용 시나리오**:
- 학교 타입별로 완전히 다른 필드가 필요한 경우
- 타입별 특화 기능이 많은 경우
- **권장하지 않음** (복잡도 대비 이점 적음)

---

## 속성(필드) 구성 선택지

### 공통 속성 (모든 선택지 공통)

| 필드명 | 타입 | 설명 | 필수 |
|--------|------|------|------|
| `id` | uuid | 고유 ID (PK) | ✅ |
| `name` | text | 이름 | ✅ |
| `display_order` | integer | 표시 순서 | ✅ |
| `is_active` | boolean | 활성화 여부 | ✅ |
| `created_at` | timestamptz | 생성일시 | ✅ |
| `updated_at` | timestamptz | 수정일시 | ✅ |

### regions 테이블 속성

| 필드명 | 타입 | 설명 | 필수 | 비고 |
|--------|------|------|------|------|
| `name` | text | 지역명 | ✅ | 예: "서울특별시", "부산광역시" |
| `code` | varchar(10) | 지역 코드 | 선택 | 행정구역 코드 |
| `parent_id` | uuid | 상위 지역 ID | 선택 | 시도 → 시군구 계층 구조용 |

### offices_of_education 테이블 속성 (선택지 2, 4)

| 필드명 | 타입 | 설명 | 필수 | 비고 |
|--------|------|------|------|------|
| `region_id` | uuid | 지역 ID (FK) | ✅ | |
| `name` | text | 교육청명 | ✅ | 예: "서울특별시교육청" |
| `code` | varchar(20) | 교육청 코드 | 선택 | 나이스 API 코드 |
| `address` | text | 주소 | 선택 | |
| `phone` | text | 전화번호 | 선택 | |

### schools 테이블 속성 (기본)

| 필드명 | 타입 | 설명 | 필수 | 선택지 | 비고 |
|--------|------|------|------|--------|------|
| `name` | text | 학교명 | ✅ | 모두 | |
| `type` | text | 학교 타입 | ✅ | 모두 | '중학교', '고등학교', '대학교' |
| `region_id` | uuid | 지역 ID (FK) | 선택 | 1,3,4 | 선택지 2에서는 제거 |
| `office_of_education_id` | uuid | 교육청 ID (FK) | 선택 | 2,4 | 중고등학교만 |
| `code` | varchar(20) | 학교 코드 | 선택 | 모두 | 나이스 API 코드 |
| `establishment_type` | varchar(50) | 설립유형 | 선택 | 모두 | '국립', '공립', '사립' |
| `address` | text | 주소 | 선택 | 모두 | |
| `phone` | text | 전화번호 | 선택 | 모두 | |
| `website` | text | 홈페이지 | 선택 | 모두 | |
| `email` | text | 이메일 | 선택 | 모두 | |

### campuses 테이블 속성 (선택지 3, 4)

| 필드명 | 타입 | 설명 | 필수 | 비고 |
|--------|------|------|------|------|
| `school_id` | uuid | 학교 ID (FK) | ✅ | type='대학교'인 경우만 |
| `name` | text | 캠퍼스명 | ✅ | 예: "서울캠퍼스", "안성캠퍼스" |
| `address` | text | 주소 | 선택 | |
| `phone` | text | 전화번호 | 선택 | |
| `is_main` | boolean | 본캠퍼스 여부 | 선택 | 기본값: false |

---

## 선택지별 비교표

| 항목 | 선택지 1 (단순) | 선택지 2 (교육청) | 선택지 3 (캠퍼스) | 선택지 4 (복합) | 선택지 5 (분리) |
|------|----------------|------------------|------------------|----------------|----------------|
| **테이블 수** | 2개 | 3개 | 3개 | 4개 | 6개 |
| **구조 복잡도** | 낮음 | 중간 | 중간 | 높음 | 매우 높음 |
| **쿼리 복잡도** | 낮음 | 중간 | 중간 | 높음 | 매우 높음 |
| **중고등학교 관리** | 보통 | 우수 | 보통 | 우수 | 우수 |
| **대학교 관리** | 보통 | 보통 | 우수 | 우수 | 우수 |
| **마이그레이션 난이도** | 낮음 | 중간 | 중간 | 높음 | 매우 높음 |
| **유지보수** | 쉬움 | 보통 | 보통 | 어려움 | 매우 어려움 |
| **확장성** | 낮음 | 중간 | 중간 | 높음 | 높음 |
| **권장도** | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ | ⭐ |

---

## 추천안

### 추천 1: 선택지 1 (단순 구조) - 현재 구조 유지

**이유**:
- 현재 구현 완료 상태
- 구조가 단순하고 이해하기 쉬움
- 교육청/캠퍼스 정보는 schools 테이블의 필드로 관리 가능
- 대부분의 사용 사례에 충분함

**구현**:
- `schools.office_of_education` (text) - 교육청명
- `schools.campus_name` (text) - 캠퍼스명 (대학교만)

### 추천 2: 선택지 2 (교육청 포함) - 중고등학교 중심

**이유**:
- 나이스 API 구조와 일치
- 교육청별 통계 및 관리 용이
- 중고등학교 관리에 최적화

**구현**:
- `offices_of_education` 테이블 추가
- `schools.office_of_education_id` FK 추가
- 대학교는 `office_of_education_id` NULL

### 추천 3: 선택지 3 (캠퍼스 포함) - 대학교 중심

**이유**:
- 대학교 캠퍼스 관리 용이
- 같은 대학교의 여러 캠퍼스 구분 가능
- 중고등학교는 영향 없음

**구현**:
- `campuses` 테이블 추가
- `schools.type='대학교'`인 경우만 사용

---

## 질문

다음 질문에 답변해주시면 최적의 구조를 선택할 수 있습니다:

1. **교육청 정보가 중요한가요?**
   - 예: 교육청별 통계, 교육청별 학교 목록이 필요한 경우
   - 아니오: 학교 정보만 필요하고 교육청은 참고용인 경우

2. **대학교 캠퍼스를 별도로 관리해야 하나요?**
   - 예: 같은 대학교의 여러 캠퍼스를 구분해야 하는 경우
   - 아니오: 학교 단위로만 관리하면 되는 경우

3. **중고등학교와 대학교 중 어느 것이 더 중요한가요?**
   - 중고등학교: 교육청 구조 권장
   - 대학교: 캠퍼스 구조 권장
   - 동등: 단순 구조 권장

4. **복잡도 vs 기능성 중 어느 것을 우선하나요?**
   - 단순함 우선: 선택지 1
   - 기능성 우선: 선택지 2 또는 3
   - 최대 기능성: 선택지 4

---

## 다음 단계

선택한 구조에 따라:
1. 테이블 스키마 설계
2. 마이그레이션 파일 작성
3. 타입 정의 업데이트
4. 조회 함수 업데이트
5. UI 컴포넌트 업데이트

---

**마지막 업데이트**: 2025-02-07









