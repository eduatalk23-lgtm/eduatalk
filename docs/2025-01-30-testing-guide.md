# 제외일/학원일정 불러오기 기능 테스트 가이드

**날짜**: 2025-01-30  
**관련 작업**: 제외일 중복 에러 수정

---

## 🎯 테스트 목적

1. **제외일 불러오기 기능** - 시간 관리에서 제외일을 불러올 때 중복 에러가 발생하지 않는지 확인
2. **학원 일정 불러오기 기능** - 시간 관리에서 학원 일정을 불러올 때 중복 에러가 발생하지 않는지 확인
3. **여러 플랜 그룹 간 제외일 중복 방지** - 다른 플랜 그룹에 이미 등록된 제외일은 등록하지 못하도록 함

---

## 📋 테스트 시나리오

### 시나리오 1: 제외일 불러오기 (기본)

**목적**: 시간 관리에서 제외일을 불러와 정상 등록되는지 확인

**Steps**:

1. **시간 관리 메뉴** → **제외일 관리**로 이동
2. 제외일 등록:
   ```
   날짜: 2025-12-04
   유형: 휴가
   사유: 가족 여행
   ```
3. **플랜 생성** → **새 플랜 그룹 만들기** 클릭
4. Step 1: 기본 정보 입력
   ```
   플랜명: 테스트 플랜 1
   학습 목적: 내신
   플랜 기간: 2025-12-01 ~ 2025-12-31
   ```
5. Step 2: **"시간 관리에서 불러오기"** 버튼 클릭
6. 모달에서 `2025-12-04` 선택
7. **"선택 항목 등록"** 클릭

**Expected**:
- ✅ 에러 없이 모달 닫힘
- ✅ 제외일 목록에 `2025-12-04 (휴가 - 가족 여행)` 표시
- ✅ 출처 배지: "시간 관리"

---

### 시나리오 2: 제외일 중복 불러오기 (동일 플랜 그룹)

**목적**: 같은 플랜 그룹에서 이미 등록한 제외일을 다시 불러올 때 정상 처리되는지 확인

**Steps** (시나리오 1 이후):

1. 같은 플랜 그룹 편집 화면에서 **"임시저장"** 클릭
2. 다시 **"시간 관리에서 불러오기"** 버튼 클릭
3. 모달에서 `2025-12-04` 확인

**Expected**:
- ✅ 모달에 `2025-12-04`가 표시됨
- ✅ "등록됨" 배지가 함께 표시됨
- ✅ 체크박스가 비활성화됨 (선택 불가)
- ✅ "선택 항목 등록" 버튼 클릭 시 에러 없음 (0개 선택)

---

### 시나리오 3: 제외일 여러 개 불러오기

**목적**: 한 번에 여러 제외일을 불러올 수 있는지 확인

**Steps**:

1. **시간 관리** → 제외일 추가 등록:
   ```
   2025-12-10 (개인사정 - 병원 방문)
   2025-12-15 (휴일지정 - 공휴일)
   2025-12-25 (휴가 - 크리스마스)
   ```
2. **새 플랜 그룹** 생성 (Step 2까지 진행)
3. **"시간 관리에서 불러오기"** 클릭
4. **"전체 선택"** 체크박스 클릭
5. **"선택 항목 등록"** 클릭

**Expected**:
- ✅ 4개의 제외일 모두 등록됨
- ✅ 각 제외일마다 올바른 유형과 사유 표시
- ✅ 모든 제외일에 "시간 관리" 배지 표시

---

### 시나리오 4: 여러 플랜 그룹 간 제외일 중복 방지

**목적**: 다른 플랜 그룹에 이미 등록된 제외일은 등록되지 않도록 함

**Steps**:

1. **플랜 그룹 A** 생성 및 `2025-12-04` 제외일 등록
2. **플랜 그룹 B** 생성 시작
3. Step 2에서 수동으로 `2025-12-04` 제외일 추가 시도

**Expected**:
- ❌ "이미 다른 플랜 그룹에 등록된 제외일이 있습니다: 2025-12-04" 에러 발생
- ✅ 다른 날짜는 정상 등록 가능

**참고**: 현재 구현에서는 플랜 그룹 간 중복을 허용하지 않습니다. 만약 허용해야 한다면 옵션 1 (전역 제외일) 적용 필요.

---

### 시나리오 5: 학원 일정 불러오기 (기본)

**목적**: 시간 관리에서 학원 일정을 불러와 정상 등록되는지 확인

**Steps**:

1. **시간 관리** → **학원 일정 관리**로 이동
2. 학원 일정 등록:
   ```
   요일: 월요일
   시간: 18:00 ~ 20:00
   학원: 수학 학원
   과목: 수학
   이동시간: 60분
   ```
3. **새 플랜 그룹** 생성 (Step 2까지 진행)
4. **"시간 관리에서 불러오기"** 버튼 클릭 (학원 일정 섹션)
5. 모달에서 `월요일 18:00 ~ 20:00` 선택
6. **"선택 항목 등록"** 클릭

**Expected**:
- ✅ 에러 없이 모달 닫힘
- ✅ 학원 일정 목록에 표시:
  ```
  월요일 18:00 ~ 20:00
  수학 학원 - 수학 · 이동시간: 60분
  출처: 시간 관리
  ```

---

### 시나리오 6: 학원 일정 중복 불러오기

**목적**: 같은 플랜 그룹에서 이미 등록한 학원 일정을 다시 불러올 때 정상 처리되는지 확인

**Steps** (시나리오 5 이후):

1. 같은 플랜 그룹에서 **"임시저장"** 클릭
2. 다시 **"시간 관리에서 불러오기"** 클릭
3. 모달 확인

**Expected**:
- ✅ `월요일 18:00 ~ 20:00`가 표시됨
- ✅ "등록됨" 배지가 함께 표시됨
- ✅ 체크박스가 비활성화됨
- ✅ "불러올 새로운 학원 일정이 없습니다" 메시지 (모든 일정이 등록된 경우)

---

### 시나리오 7: 학원 일정 시간 겹침 경고

**목적**: 등록하려는 학원 일정이 기존 일정과 시간이 겹칠 때 경고 표시

**Steps**:

1. **시간 관리** → 학원 일정 추가:
   ```
   월요일 19:00 ~ 21:00 (영어 학원)
   ```
2. **플랜 그룹** 편집에서 **"시간 관리에서 불러오기"** 클릭
3. `월요일 19:00 ~ 21:00` 선택 시도

**Expected**:
- ⚠️ "시간 겹침" 배지 표시
- ⚠️ 경고 메시지: "선택한 일정 중 1개의 일정이 기존 일정과 겹칩니다"
- ⚠️ 겹치는 일정 정보 표시
- ❌ "선택 항목 등록" 버튼 비활성화 (겹치는 일정이 있을 때)

---

### 시나리오 8: 제외일 유형별 동작 확인 (1730 Timetable)

**목적**: "휴일지정" 유형이 다른 유형과 다르게 동작하는지 확인

**Steps**:

1. **플랜 생성** → 스케줄러 타입: **"1730 Timetable"** 선택
2. Step 2에서 제외일 등록:
   ```
   2025-12-10 (휴일지정 - 공휴일)
   ```

**Expected**:
- ✅ 제외일 목록에 노란색 배경으로 표시
- ✅ "자율 학습 가능" 배지 표시
- ✅ 안내 메시지:
  ```
  지정휴일 안내
  • 학습 분량은 배정되지 않습니다
  • 자율 학습은 가능합니다 (설정된 시간대)
  • 주차 계산에서 제외되어 7일 단위 학습 패턴에 영향을 주지 않습니다
  ```

---

### 시나리오 9: 캠프 모드 제외일 관리

**목적**: 캠프 플랜에서 템플릿 제외일과 학생 제외일이 구분되는지 확인

**Steps**:

1. **관리자** → 캠프 템플릿 생성 시 제외일 추가:
   ```
   2025-12-20 (템플릿 제외일)
   ```
2. **학생** → 캠프 초대 수락 후 플랜 생성
3. 제외일 목록 확인
4. 학생이 추가로 제외일 등록 시도

**Expected**:
- ✅ 템플릿 제외일에 "템플릿" 배지 및 잠금 아이콘 표시
- ✅ 템플릿 제외일은 삭제 버튼 비활성화
- ✅ 학생이 추가로 제외일 등록 가능 (허용된 경우)
- ✅ 학생이 등록한 제외일에는 "직접 입력" 배지 표시

---

## 🔍 확인 사항

### UI/UX 체크리스트

#### 제외일 섹션

- [ ] "시간 관리에서 불러오기" 버튼이 보이는가?
- [ ] 불러올 수 있는 제외일 개수 배지가 표시되는가? (예: `3개`)
- [ ] 모달이 정상적으로 열리는가?
- [ ] 모달에 플랜 기간이 표시되는가?
- [ ] 전체 선택 체크박스가 작동하는가?
- [ ] 이미 등록된 제외일은 "등록됨" 배지와 함께 비활성화되는가?
- [ ] 선택한 항목 수가 실시간으로 업데이트되는가?
- [ ] 등록 후 제외일 목록에 올바르게 표시되는가?
- [ ] 출처 배지 (시간 관리/직접 입력/템플릿)가 올바르게 표시되는가?

#### 학원 일정 섹션

- [ ] "시간 관리에서 불러오기" 버튼이 보이는가?
- [ ] 불러올 수 있는 학원 일정 개수 배지가 표시되는가?
- [ ] 모달에서 요일별로 그룹화되어 표시되는가?
- [ ] 시간 겹침 경고가 올바르게 표시되는가?
- [ ] 겹치는 일정이 있을 때 등록 버튼이 비활성화되는가?
- [ ] 등록 후 학원 일정 목록에 올바르게 표시되는가?

### 기능 체크리스트

#### 제외일

- [ ] 시간 관리에서 등록한 제외일이 정상적으로 조회되는가?
- [ ] 플랜 기간 외의 제외일은 필터링되는가?
- [ ] 여러 개 선택 후 일괄 등록이 가능한가?
- [ ] 같은 플랜 그룹에서 중복 등록 시 무시되는가? (에러 없음)
- [ ] 다른 플랜 그룹에 등록된 제외일 등록 시 에러가 발생하는가?
- [ ] 임시저장 후 다시 불러올 때 정상 작동하는가?

#### 학원 일정

- [ ] 시간 관리에서 등록한 학원 일정이 정상적으로 조회되는가?
- [ ] 요일, 시간, 학원명, 과목이 올바르게 표시되는가?
- [ ] 이동시간이 올바르게 표시되는가?
- [ ] 시간 겹침 검증이 작동하는가?
- [ ] 같은 학원 일정 중복 등록 시 무시되는가?
- [ ] 여러 플랜 그룹에서 같은 학원 일정을 공유할 수 있는가?

### 에러 처리

- [ ] 네트워크 에러 시 적절한 에러 메시지가 표시되는가?
- [ ] 권한 없는 사용자는 접근할 수 없는가?
- [ ] 유효하지 않은 데이터 입력 시 검증 에러가 발생하는가?
- [ ] 데이터베이스 에러 시 사용자에게 친화적인 메시지가 표시되는가?

---

## 🐛 알려진 이슈 및 제한사항

### 제외일

1. **플랜 그룹 간 중복 방지**: 현재는 여러 플랜 그룹에서 같은 날짜를 제외일로 등록할 수 없습니다. 이는 의도된 동작이지만, 향후 전역 제외일로 변경 시 개선될 수 있습니다.

2. **템플릿 제외일**: 캠프 플랜에서 템플릿 제외일은 학생이 삭제할 수 없습니다.

### 학원 일정

1. **시간 겹침**: 학원 일정 간 시간이 겹치면 등록할 수 없습니다. 의도적으로 겹치는 시간대를 등록해야 하는 경우 시간을 조정해야 합니다.

2. **전역 관리**: 학원 일정은 학생 전역으로 관리되므로, 한 플랜 그룹에서 수정하면 모든 플랜 그룹에 영향을 줍니다.

---

## 📊 테스트 결과 기록

### 테스트 환경

- **날짜**: _____
- **테스터**: _____
- **브라우저**: _____
- **환경**: Development / Staging / Production

### 결과 요약

| 시나리오 | 결과 | 비고 |
|---------|------|------|
| 1. 제외일 불러오기 (기본) | ⏳ | |
| 2. 제외일 중복 불러오기 | ⏳ | |
| 3. 제외일 여러 개 불러오기 | ⏳ | |
| 4. 플랜 그룹 간 제외일 중복 방지 | ⏳ | |
| 5. 학원 일정 불러오기 (기본) | ⏳ | |
| 6. 학원 일정 중복 불러오기 | ⏳ | |
| 7. 학원 일정 시간 겹침 경고 | ⏳ | |
| 8. 제외일 유형별 동작 확인 | ⏳ | |
| 9. 캠프 모드 제외일 관리 | ⏳ | |

### 발견된 버그

1. _____
2. _____

### 개선 제안

1. _____
2. _____

---

## 📝 참고 사항

### 관련 파일

- **제외일 UI**: `app/(student)/plan/new-group/_components/_panels/ExclusionsPanel.tsx`
- **제외일 모달**: `app/(student)/plan/new-group/_components/_panels/_modals/ExclusionImportModal.tsx`
- **학원 일정 UI**: `app/(student)/plan/new-group/_components/_panels/AcademySchedulePanel.tsx`
- **학원 일정 모달**: `app/(student)/plan/new-group/_components/_panels/_modals/AcademyScheduleImportModal.tsx`
- **제외일 Action**: `app/(student)/actions/plan-groups/exclusions.ts`
- **학원 일정 Action**: `app/(student)/actions/plan-groups/academy.ts`
- **데이터 레이어**: `lib/data/planGroups.ts`

### 수정 사항

1. **`createPlanExclusions` 함수** (lib/data/planGroups.ts:920-953)
   - 중복 체크 로직 개선: 현재 플랜 그룹의 제외일은 중복으로 간주하지 않음
   - 에러 메시지 명확화: "이미 다른 플랜 그룹에 등록된 제외일"

2. **`updatePlanGroupDraftAction` 함수** (app/(student)/actions/plan-groups/update.ts:208-217)
   - 에러 메시지 패턴 업데이트

---

**작성 완료**: 2025-01-30

