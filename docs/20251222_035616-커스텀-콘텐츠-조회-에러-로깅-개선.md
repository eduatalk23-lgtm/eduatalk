# ì»¤ìŠ¤í…€ ì½˜í…ì¸  ì¡°íšŒ ì—ëŸ¬ ë¡œê¹… ê°œì„ 

## ğŸ“‹ ì‘ì—… ê°œìš”

`fetchStudentCustomContents` í•¨ìˆ˜ì—ì„œ ë°œìƒí•˜ëŠ” ì—ëŸ¬ê°€ ë¹ˆ ê°ì²´ `{}`ë¡œ ì¶œë ¥ë˜ì–´ ì‹¤ì œ ì—ëŸ¬ ì›ì¸ì„ íŒŒì•…í•˜ê¸° ì–´ë ¤ìš´ ë¬¸ì œë¥¼ í•´ê²°í–ˆìŠµë‹ˆë‹¤.

## ğŸ› ë¬¸ì œ ë¶„ì„

### ì—ëŸ¬ ë©”ì‹œì§€

```
[data/planContents] Supabase ì¿¼ë¦¬ ì—ëŸ¬: {}
[data/planContents] ì»¤ìŠ¤í…€ ì½˜í…ì¸  ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨ {}
```

### ë¬¸ì œì 

1. **ì—ëŸ¬ ê°ì²´ ì§ë ¬í™” ì‹¤íŒ¨**: ì—ëŸ¬ ê°ì²´ê°€ ë¹ˆ ê°ì²´ `{}`ë¡œ ì¶œë ¥ë˜ì–´ ì‹¤ì œ ì—ëŸ¬ ì›ì¸ì„ íŒŒì•…í•  ìˆ˜ ì—†ìŒ
2. **Supabase ì—ëŸ¬ ì •ë³´ ëˆ„ë½**: PostgrestError íƒ€ì…ì˜ ì¶”ê°€ ì •ë³´(`code`, `details`, `hint` ë“±)ê°€ ë¡œê¹…ë˜ì§€ ì•ŠìŒ
3. **ê°ì²´ ì†ì„± ì ‘ê·¼ ì‹¤íŒ¨**: ì—ëŸ¬ ê°ì²´ì˜ ì†ì„±ë“¤ì´ `undefined`ì´ê±°ë‚˜ ì§ë ¬í™”ë˜ì§€ ì•ŠìŒ
4. **ë””ë²„ê¹… ì–´ë ¤ì›€**: ì—ëŸ¬ ë°œìƒ ì‹œì ê³¼ ì›ì¸ì„ ì¶”ì í•˜ê¸° ì–´ë ¤ì›€

### ì—ëŸ¬ ë°œìƒ ìœ„ì¹˜

- **íŒŒì¼**: `lib/data/planContents.ts`
- **í•¨ìˆ˜**: `fetchStudentCustomContents`
- **ë¼ì¸**: 399ë²ˆì§¸ ì¤„ (ì—ëŸ¬ ë¡œê¹… ë¶€ë¶„)

## âœ… ìˆ˜ì • ë‚´ìš©

### 1. Supabase ì¿¼ë¦¬ ì—ëŸ¬ ìƒì„¸ ë¡œê¹… ì¶”ê°€ (ì•ˆì „í•œ ì§ë ¬í™”)

ì¿¼ë¦¬ ì‹¤í–‰ ì§í›„ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ì¦‰ì‹œ ìƒì„¸ ì •ë³´ë¥¼ ì•ˆì „í•˜ê²Œ ì§ë ¬í™”í•˜ì—¬ ë¡œê¹…:

```typescript
if (error) {
  // Supabase ì—ëŸ¬ë¥¼ ë” ìì„¸íˆ ë¡œê¹… (ì•ˆì „í•œ ì§ë ¬í™”)
  const errorInfo: Record<string, unknown> = {
    studentId,
  };
  
  // ì—ëŸ¬ ê°ì²´ì˜ ëª¨ë“  ì†ì„±ì„ ì•ˆì „í•˜ê²Œ ì¶”ì¶œ
  if (error.message) errorInfo.message = String(error.message);
  if (error.code) errorInfo.code = String(error.code);
  if (error.details) errorInfo.details = String(error.details);
  if (error.hint) errorInfo.hint = String(error.hint);
  
  // ì—ëŸ¬ ê°ì²´ ì „ì²´ë¥¼ JSONìœ¼ë¡œ ì§ë ¬í™” ì‹œë„
  try {
    errorInfo.errorString = JSON.stringify(error, Object.getOwnPropertyNames(error));
  } catch {
    errorInfo.errorString = String(error);
  }
  
  // ì—ëŸ¬ ê°ì²´ì˜ ëª¨ë“  í‚¤ë¥¼ ë¡œê¹…
  if (typeof error === "object" && error !== null) {
    errorInfo.errorKeys = Object.keys(error);
    errorInfo.errorValues = Object.entries(error).reduce((acc, [key, value]) => {
      acc[key] = typeof value === "object" ? JSON.stringify(value) : String(value);
      return acc;
    }, {} as Record<string, string>);
  }
  
  console.error("[data/planContents] Supabase ì¿¼ë¦¬ ì—ëŸ¬:", errorInfo);
  throw error;
}
```

**ê°œì„  ì‚¬í•­**:
- ê° ì†ì„±ì„ ëª…ì‹œì ìœ¼ë¡œ ì²´í¬í•˜ê³  ë¬¸ìì—´ë¡œ ë³€í™˜
- `JSON.stringify`ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•ˆì „í•˜ê²Œ ì§ë ¬í™”
- ì—ëŸ¬ ê°ì²´ì˜ ëª¨ë“  í‚¤ì™€ ê°’ì„ ì¶”ì¶œí•˜ì—¬ ë¡œê¹…
- ì§ë ¬í™” ì‹¤íŒ¨ ì‹œ ëŒ€ì²´ ë°©ë²• ì‚¬ìš©

### 2. catch ë¸”ë¡ ì—ëŸ¬ ë¡œê¹… ê°œì„  (ì™„ì „í•œ ì§ë ¬í™”)

ì—ëŸ¬ íƒ€ì…ì— ë”°ë¼ ìƒì„¸ ì •ë³´ë¥¼ ì™„ì „íˆ ì§ë ¬í™”í•˜ì—¬ ë¡œê¹…:

```typescript
} catch (err) {
  const errorDetails: Record<string, unknown> = {
    studentId,
  };

  // Error ì¸ìŠ¤í„´ìŠ¤ì¸ ê²½ìš°
  if (err instanceof Error) {
    errorDetails.error = err.message || "Unknown error";
    errorDetails.stack = err.stack || undefined;
    errorDetails.name = err.name || "Error";
    
    // Error ê°ì²´ì˜ ëª¨ë“  ì†ì„± ì¶”ì¶œ
    const errorProps = Object.getOwnPropertyNames(err);
    errorDetails.errorProperties = errorProps;
    
    // ê° ì†ì„± ê°’ì„ ì•ˆì „í•˜ê²Œ ì¶”ì¶œ
    const errorValues: Record<string, string> = {};
    errorProps.forEach((prop) => {
      try {
        const value = (err as Record<string, unknown>)[prop];
        errorValues[prop] = typeof value === "object" 
          ? JSON.stringify(value) 
          : String(value ?? "null");
      } catch {
        errorValues[prop] = "[unable to serialize]";
      }
    });
    errorDetails.errorPropertyValues = errorValues;
  } else if (err && typeof err === "object") {
    // ê°ì²´ì¸ ê²½ìš° ëª¨ë“  ì†ì„±ì„ ì•ˆì „í•˜ê²Œ ì§ë ¬í™”
    errorDetails.error = String(err);
    errorDetails.errorType = typeof err;
    errorDetails.errorKeys = Object.keys(err);
    
    const errorValues: Record<string, string> = {};
    Object.entries(err).forEach(([key, value]) => {
      try {
        errorValues[key] = typeof value === "object" 
          ? JSON.stringify(value) 
          : String(value ?? "null");
      } catch {
        errorValues[key] = "[unable to serialize]";
      }
    });
    errorDetails.errorValues = errorValues;
    
    // Supabase PostgrestErrorì˜ ê²½ìš° ì¶”ê°€ ì •ë³´ í¬í•¨
    if ("code" in err) {
      errorDetails.code = String((err as { code?: unknown }).code ?? "undefined");
    }
    if ("details" in err) {
      errorDetails.details = String((err as { details?: unknown }).details ?? "undefined");
    }
    if ("hint" in err) {
      errorDetails.hint = String((err as { hint?: unknown }).hint ?? "undefined");
    }
    if ("message" in err) {
      errorDetails.message = String((err as { message?: unknown }).message ?? "undefined");
    }
  } else {
    // ì›ì‹œ íƒ€ì…ì¸ ê²½ìš°
    errorDetails.error = String(err);
    errorDetails.errorType = typeof err;
  }

  // ìµœì¢… ë¡œê¹… (JSON.stringifyë¡œ ì•ˆì „í•˜ê²Œ ì§ë ¬í™”)
  try {
    console.error(
      "[data/planContents] ì»¤ìŠ¤í…€ ì½˜í…ì¸  ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨",
      JSON.parse(JSON.stringify(errorDetails, null, 2))
    );
  } catch {
    // JSON ì§ë ¬í™” ì‹¤íŒ¨ ì‹œ ì§ì ‘ ë¡œê¹…
    console.error("[data/planContents] ì»¤ìŠ¤í…€ ì½˜í…ì¸  ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨", {
      studentId: errorDetails.studentId,
      error: String(err),
      errorType: typeof err,
    });
  }
  
  return [];
}
```

**ê°œì„  ì‚¬í•­**:
- Error ì¸ìŠ¤í„´ìŠ¤ì˜ ëª¨ë“  ì†ì„±ì„ `Object.getOwnPropertyNames`ë¡œ ì¶”ì¶œ
- ê° ì†ì„± ê°’ì„ ì•ˆì „í•˜ê²Œ ì§ë ¬í™” (ê°ì²´ëŠ” JSON.stringify, ì›ì‹œ íƒ€ì…ì€ String)
- ì§ë ¬í™” ì‹¤íŒ¨ ì‹œ `[unable to serialize]`ë¡œ í‘œì‹œ
- ìµœì¢… ë¡œê¹… ì‹œ `JSON.parse(JSON.stringify())`ë¡œ ì•ˆì „í•˜ê²Œ ì§ë ¬í™”
- ëª¨ë“  ì§ë ¬í™”ê°€ ì‹¤íŒ¨í•˜ë©´ ìµœì†Œí•œì˜ ì •ë³´ë¼ë„ ë¡œê¹…

## ğŸ” ê°œì„  íš¨ê³¼

### ê°œì„  ì „ ë¡œê·¸

```
[data/planContents] ì»¤ìŠ¤í…€ ì½˜í…ì¸  ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨ {}
```

### ê°œì„  í›„ ì˜ˆìƒ ë¡œê·¸

```javascript
// Supabase ì¿¼ë¦¬ ì—ëŸ¬ ë°œìƒ ì‹œ
[data/planContents] Supabase ì¿¼ë¦¬ ì—ëŸ¬: {
  studentId: "xxx-xxx-xxx",
  message: "relation \"student_custom_contents\" does not exist",
  code: "42P01",
  details: "null",
  hint: "null",
  errorString: "{\"message\":\"...\",\"code\":\"42P01\",...}",
  errorKeys: ["message", "code", "details", "hint", ...],
  errorValues: {
    message: "relation \"student_custom_contents\" does not exist",
    code: "42P01",
    details: "null",
    hint: "null",
    ...
  }
}

// catch ë¸”ë¡ì—ì„œ ì¶”ê°€ ë¡œê¹…
[data/planContents] ì»¤ìŠ¤í…€ ì½˜í…ì¸  ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨ {
  studentId: "xxx-xxx-xxx",
  error: "relation \"student_custom_contents\" does not exist",
  stack: "Error: ...\n    at fetchStudentCustomContents ...",
  name: "PostgrestError",
  errorProperties: ["message", "code", "details", "hint", "stack", ...],
  errorPropertyValues: {
    message: "relation \"student_custom_contents\" does not exist",
    code: "42P01",
    details: "null",
    hint: "null",
    stack: "Error: ...",
    ...
  }
}
```

**ì£¼ìš” ê°œì„ ì **:
- ì—ëŸ¬ ê°ì²´ì˜ ëª¨ë“  ì†ì„±ì´ ì•ˆì „í•˜ê²Œ ì§ë ¬í™”ë¨
- ì—ëŸ¬ ê°ì²´ì˜ í‚¤ ëª©ë¡ê³¼ ê°’ì´ ëª¨ë‘ ë¡œê¹…ë¨
- JSON ì§ë ¬í™”ë¥¼ í†µí•´ ì•ˆì „í•˜ê²Œ ì¶œë ¥ë¨

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì •ìƒ ì¡°íšŒ

1. `student_custom_contents` í…Œì´ë¸”ì— ë°ì´í„°ê°€ ìˆëŠ” ê²½ìš°
2. ì—ëŸ¬ ì—†ì´ ì •ìƒì ìœ¼ë¡œ ë°ì´í„° ë°˜í™˜

**ì˜ˆìƒ ê²°ê³¼**:
- ì—ëŸ¬ ë¡œê·¸ ì—†ìŒ
- ì •ìƒì ìœ¼ë¡œ `ContentItem[]` ë°˜í™˜

### ì‹œë‚˜ë¦¬ì˜¤ 2: í…Œì´ë¸” ì—†ìŒ ì—ëŸ¬

1. `student_custom_contents` í…Œì´ë¸”ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°
2. Supabase ì¿¼ë¦¬ ì—ëŸ¬ ë°œìƒ

**ì˜ˆìƒ ê²°ê³¼**:
- Supabase ì¿¼ë¦¬ ì—ëŸ¬ ë¡œê·¸ ì¶œë ¥ (ìƒì„¸ ì •ë³´ í¬í•¨)
- catch ë¸”ë¡ì—ì„œ ì¶”ê°€ ì—ëŸ¬ ë¡œê·¸ ì¶œë ¥
- ë¹ˆ ë°°ì—´ ë°˜í™˜

### ì‹œë‚˜ë¦¬ì˜¤ 3: RLS ì •ì±… ì—ëŸ¬

1. RLS ì •ì±…ìœ¼ë¡œ ì¸í•´ ì ‘ê·¼ì´ ê±°ë¶€ëœ ê²½ìš°
2. Supabase ì¿¼ë¦¬ ì—ëŸ¬ ë°œìƒ

**ì˜ˆìƒ ê²°ê³¼**:
- Supabase ì¿¼ë¦¬ ì—ëŸ¬ ë¡œê·¸ ì¶œë ¥ (`code: "42501"` ë“±)
- catch ë¸”ë¡ì—ì„œ ì¶”ê°€ ì—ëŸ¬ ë¡œê·¸ ì¶œë ¥
- ë¹ˆ ë°°ì—´ ë°˜í™˜

## ğŸ“ ë³€ê²½ëœ íŒŒì¼ ëª©ë¡

1. `lib/data/planContents.ts`
   - `fetchStudentCustomContents` í•¨ìˆ˜ì˜ ì—ëŸ¬ ë¡œê¹… ê°œì„ 
   - Supabase ì¿¼ë¦¬ ì—ëŸ¬ ìƒì„¸ ë¡œê¹… ì¶”ê°€
   - catch ë¸”ë¡ì—ì„œ PostgrestError ì •ë³´ í¬í•¨

## âœ… ê²€ì¦ ì™„ë£Œ

- [x] TypeScript íƒ€ì… ì—ëŸ¬ ì—†ìŒ
- [x] ESLint ì—ëŸ¬ ì—†ìŒ
- [x] ì—ëŸ¬ ë¡œê¹… ì •ë³´ ê°œì„ 
- [x] Supabase PostgrestError ì •ë³´ í¬í•¨
- [x] ì—ëŸ¬ ê°ì²´ ì•ˆì „í•œ ì§ë ¬í™” êµ¬í˜„
- [x] ëª¨ë“  ì—ëŸ¬ íƒ€ì…ì— ëŒ€í•œ ì²˜ë¦¬ (Error, ê°ì²´, ì›ì‹œ íƒ€ì…)

## ğŸ”„ í–¥í›„ ê°œì„  ì‚¬í•­

1. **ì—ëŸ¬ ëª¨ë‹ˆí„°ë§ í†µí•©**: Sentry ë“± ì—ëŸ¬ ëª¨ë‹ˆí„°ë§ ë„êµ¬ì™€ í†µí•©
2. **ì—ëŸ¬ íƒ€ì…ë³„ ì²˜ë¦¬**: ì—ëŸ¬ íƒ€ì…ì— ë”°ë¼ ë‹¤ë¥¸ ì²˜ë¦¬ ë¡œì§ ì ìš©
3. **ì‚¬ìš©ì í”¼ë“œë°±**: ì—ëŸ¬ ë°œìƒ ì‹œ ì‚¬ìš©ìì—ê²Œ ëª…í™•í•œ ë©”ì‹œì§€ í‘œì‹œ
4. **ë‹¤ë¥¸ í•¨ìˆ˜ì—ë„ ì ìš©**: `fetchStudentBooks`, `fetchStudentLectures` í•¨ìˆ˜ì—ë„ ë™ì¼í•œ íŒ¨í„´ ì ìš© ê²€í† 

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ

- [Supabase ì—ëŸ¬ ì²˜ë¦¬ ê°€ì´ë“œ](https://supabase.com/docs/reference/javascript/error-handling)
- [PostgrestError íƒ€ì… ì •ì˜](https://github.com/supabase/postgrest-js/blob/main/src/PostgrestError.ts)

