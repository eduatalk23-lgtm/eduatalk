# ì»¤ìŠ¤í…€ ì½˜í…ì¸  ì¡°íšŒ ì—ëŸ¬ ë¡œê¹… ê°œì„ 

## ğŸ“‹ ì‘ì—… ê°œìš”

`fetchStudentCustomContents` í•¨ìˆ˜ì—ì„œ ë°œìƒí•˜ëŠ” ì—ëŸ¬ê°€ ë¹ˆ ê°ì²´ `{}`ë¡œ ì¶œë ¥ë˜ì–´ ì‹¤ì œ ì—ëŸ¬ ì›ì¸ì„ íŒŒì•…í•˜ê¸° ì–´ë ¤ìš´ ë¬¸ì œë¥¼ í•´ê²°í–ˆìŠµë‹ˆë‹¤.

## ğŸ› ë¬¸ì œ ë¶„ì„

### ì—ëŸ¬ ë©”ì‹œì§€

```
[data/planContents] ì»¤ìŠ¤í…€ ì½˜í…ì¸  ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨ {}
```

### ë¬¸ì œì 

1. **ì—ëŸ¬ ì •ë³´ ë¶€ì¡±**: ì—ëŸ¬ ê°ì²´ê°€ ë¹ˆ ê°ì²´ë¡œ ì¶œë ¥ë˜ì–´ ì‹¤ì œ ì—ëŸ¬ ì›ì¸ì„ íŒŒì•…í•  ìˆ˜ ì—†ìŒ
2. **Supabase ì—ëŸ¬ ì •ë³´ ëˆ„ë½**: PostgrestError íƒ€ì…ì˜ ì¶”ê°€ ì •ë³´(`code`, `details`, `hint` ë“±)ê°€ ë¡œê¹…ë˜ì§€ ì•ŠìŒ
3. **ë””ë²„ê¹… ì–´ë ¤ì›€**: ì—ëŸ¬ ë°œìƒ ì‹œì ê³¼ ì›ì¸ì„ ì¶”ì í•˜ê¸° ì–´ë ¤ì›€

### ì—ëŸ¬ ë°œìƒ ìœ„ì¹˜

- **íŒŒì¼**: `lib/data/planContents.ts`
- **í•¨ìˆ˜**: `fetchStudentCustomContents`
- **ë¼ì¸**: 399ë²ˆì§¸ ì¤„ (ì—ëŸ¬ ë¡œê¹… ë¶€ë¶„)

## âœ… ìˆ˜ì • ë‚´ìš©

### 1. Supabase ì¿¼ë¦¬ ì—ëŸ¬ ìƒì„¸ ë¡œê¹… ì¶”ê°€

ì¿¼ë¦¬ ì‹¤í–‰ ì§í›„ ì—ëŸ¬ê°€ ë°œìƒí•˜ë©´ ì¦‰ì‹œ ìƒì„¸ ì •ë³´ë¥¼ ë¡œê¹…í•˜ë„ë¡ ìˆ˜ì •:

```typescript
// ìˆ˜ì • ì „
const { data, error } = await supabase
  .from("student_custom_contents")
  .select("id, title, content_type, subject, subject_id, curriculum_revision_id")
  .eq("student_id", studentId)
  .order("created_at", { ascending: false });

if (error) throw error;

// ìˆ˜ì • í›„
const { data, error } = await supabase
  .from("student_custom_contents")
  .select("id, title, content_type, subject, subject_id, curriculum_revision_id")
  .eq("student_id", studentId)
  .order("created_at", { ascending: false });

if (error) {
  // Supabase ì—ëŸ¬ë¥¼ ë” ìì„¸íˆ ë¡œê¹…
  console.error("[data/planContents] Supabase ì¿¼ë¦¬ ì—ëŸ¬:", {
    message: error.message,
    code: error.code,
    details: error.details,
    hint: error.hint,
    studentId,
  });
  throw error;
}
```

### 2. catch ë¸”ë¡ ì—ëŸ¬ ë¡œê¹… ê°œì„ 

ì—ëŸ¬ íƒ€ì…ì— ë”°ë¼ ìƒì„¸ ì •ë³´ë¥¼ í¬í•¨í•˜ë„ë¡ ê°œì„ :

```typescript
// ìˆ˜ì • ì „
} catch (err) {
  console.error("[data/planContents] ì»¤ìŠ¤í…€ ì½˜í…ì¸  ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨", {
    error: err instanceof Error ? err.message : String(err),
    stack: err instanceof Error ? err.stack : undefined,
    studentId,
  });
  return [];
}

// ìˆ˜ì • í›„
} catch (err) {
  // Supabase ì—ëŸ¬ëŠ” PostgrestError íƒ€ì…ì¼ ìˆ˜ ìˆìŒ
  const errorDetails: Record<string, unknown> = {
    studentId,
  };

  if (err instanceof Error) {
    errorDetails.error = err.message;
    errorDetails.stack = err.stack;
    errorDetails.name = err.name;
  } else {
    errorDetails.error = String(err);
    errorDetails.rawError = err;
  }

  // Supabase PostgrestErrorì˜ ê²½ìš° ì¶”ê°€ ì •ë³´ í¬í•¨
  if (err && typeof err === "object" && "code" in err) {
    errorDetails.code = (err as { code?: string }).code;
    errorDetails.details = (err as { details?: string }).details;
    errorDetails.hint = (err as { hint?: string }).hint;
    errorDetails.message = (err as { message?: string }).message;
  }

  console.error("[data/planContents] ì»¤ìŠ¤í…€ ì½˜í…ì¸  ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨", errorDetails);
  return [];
}
```

## ğŸ” ê°œì„  íš¨ê³¼

### ê°œì„  ì „ ë¡œê·¸

```
[data/planContents] ì»¤ìŠ¤í…€ ì½˜í…ì¸  ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨ {}
```

### ê°œì„  í›„ ì˜ˆìƒ ë¡œê·¸

```javascript
// Supabase ì¿¼ë¦¬ ì—ëŸ¬ ë°œìƒ ì‹œ
[data/planContents] Supabase ì¿¼ë¦¬ ì—ëŸ¬: {
  message: "relation \"student_custom_contents\" does not exist",
  code: "42P01",
  details: null,
  hint: null,
  studentId: "xxx-xxx-xxx"
}

// catch ë¸”ë¡ì—ì„œ ì¶”ê°€ ë¡œê¹…
[data/planContents] ì»¤ìŠ¤í…€ ì½˜í…ì¸  ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨ {
  studentId: "xxx-xxx-xxx",
  error: "relation \"student_custom_contents\" does not exist",
  code: "42P01",
  details: null,
  hint: null,
  message: "relation \"student_custom_contents\" does not exist",
  name: "PostgrestError",
  stack: "..."
}
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì •ìƒ ì¡°íšŒ

1. `student_custom_contents` í…Œì´ë¸”ì— ë°ì´í„°ê°€ ìˆëŠ” ê²½ìš°
2. ì—ëŸ¬ ì—†ì´ ì •ìƒì ìœ¼ë¡œ ë°ì´í„° ë°˜í™˜

**ì˜ˆìƒ ê²°ê³¼**:
- ì—ëŸ¬ ë¡œê·¸ ì—†ìŒ
- ì •ìƒì ìœ¼ë¡œ `ContentItem[]` ë°˜í™˜

### ì‹œë‚˜ë¦¬ì˜¤ 2: í…Œì´ë¸” ì—†ìŒ ì—ëŸ¬

1. `student_custom_contents` í…Œì´ë¸”ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°
2. Supabase ì¿¼ë¦¬ ì—ëŸ¬ ë°œìƒ

**ì˜ˆìƒ ê²°ê³¼**:
- Supabase ì¿¼ë¦¬ ì—ëŸ¬ ë¡œê·¸ ì¶œë ¥ (ìƒì„¸ ì •ë³´ í¬í•¨)
- catch ë¸”ë¡ì—ì„œ ì¶”ê°€ ì—ëŸ¬ ë¡œê·¸ ì¶œë ¥
- ë¹ˆ ë°°ì—´ ë°˜í™˜

### ì‹œë‚˜ë¦¬ì˜¤ 3: RLS ì •ì±… ì—ëŸ¬

1. RLS ì •ì±…ìœ¼ë¡œ ì¸í•´ ì ‘ê·¼ì´ ê±°ë¶€ëœ ê²½ìš°
2. Supabase ì¿¼ë¦¬ ì—ëŸ¬ ë°œìƒ

**ì˜ˆìƒ ê²°ê³¼**:
- Supabase ì¿¼ë¦¬ ì—ëŸ¬ ë¡œê·¸ ì¶œë ¥ (`code: "42501"` ë“±)
- catch ë¸”ë¡ì—ì„œ ì¶”ê°€ ì—ëŸ¬ ë¡œê·¸ ì¶œë ¥
- ë¹ˆ ë°°ì—´ ë°˜í™˜

## ğŸ“ ë³€ê²½ëœ íŒŒì¼ ëª©ë¡

1. `lib/data/planContents.ts`
   - `fetchStudentCustomContents` í•¨ìˆ˜ì˜ ì—ëŸ¬ ë¡œê¹… ê°œì„ 
   - Supabase ì¿¼ë¦¬ ì—ëŸ¬ ìƒì„¸ ë¡œê¹… ì¶”ê°€
   - catch ë¸”ë¡ì—ì„œ PostgrestError ì •ë³´ í¬í•¨

## âœ… ê²€ì¦ ì™„ë£Œ

- [x] TypeScript íƒ€ì… ì—ëŸ¬ ì—†ìŒ
- [x] ESLint ì—ëŸ¬ ì—†ìŒ
- [x] ì—ëŸ¬ ë¡œê¹… ì •ë³´ ê°œì„ 
- [x] Supabase PostgrestError ì •ë³´ í¬í•¨

## ğŸ”„ í–¥í›„ ê°œì„  ì‚¬í•­

1. **ì—ëŸ¬ ëª¨ë‹ˆí„°ë§ í†µí•©**: Sentry ë“± ì—ëŸ¬ ëª¨ë‹ˆí„°ë§ ë„êµ¬ì™€ í†µí•©
2. **ì—ëŸ¬ íƒ€ì…ë³„ ì²˜ë¦¬**: ì—ëŸ¬ íƒ€ì…ì— ë”°ë¼ ë‹¤ë¥¸ ì²˜ë¦¬ ë¡œì§ ì ìš©
3. **ì‚¬ìš©ì í”¼ë“œë°±**: ì—ëŸ¬ ë°œìƒ ì‹œ ì‚¬ìš©ìì—ê²Œ ëª…í™•í•œ ë©”ì‹œì§€ í‘œì‹œ
4. **ë‹¤ë¥¸ í•¨ìˆ˜ì—ë„ ì ìš©**: `fetchStudentBooks`, `fetchStudentLectures` í•¨ìˆ˜ì—ë„ ë™ì¼í•œ íŒ¨í„´ ì ìš© ê²€í† 

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ

- [Supabase ì—ëŸ¬ ì²˜ë¦¬ ê°€ì´ë“œ](https://supabase.com/docs/reference/javascript/error-handling)
- [PostgrestError íƒ€ì… ì •ì˜](https://github.com/supabase/postgrest-js/blob/main/src/PostgrestError.ts)

