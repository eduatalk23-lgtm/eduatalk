# 마스터 콘텐츠 교재 폼 수정 작업

**작업 일시**: 2025-12-16 15:51:56  
**작업 내용**: 마스터 콘텐츠 교재 폼의 4가지 문제점 해결

## 작업 개요

마스터 콘텐츠 교재 폼에서 발생하던 문제점들을 단계별로 해결했습니다.

## 수정 내용

### Phase 1: 교과/과목 필드 활성화 문제 해결 ✅

**파일**: `lib/hooks/useSubjectSelection.ts`

**문제점**:
- 개정교육과정 선택 후에도 교과 그룹/과목 필드가 비활성화 상태로 유지됨
- 비동기 `loadSubjectGroups` 호출 후 상태 업데이트 타이밍 문제

**해결 방법**:
- `handleCurriculumRevisionChange`에서 상태 업데이트 순서 개선
- `selectedRevisionId`를 먼저 설정하여 필드 활성화
- 로딩 상태 및 에러 처리 개선

**변경 사항**:
```typescript
// 상태를 먼저 업데이트하여 필드 활성화
setSelectedRevisionId(selectedRevision.id);
setLoadingGroups(true);

try {
  await loadSubjectGroups(selectedRevision.id);
} catch (error) {
  console.error("교과 그룹 로드 실패:", error);
  setSubjectGroups([]);
} finally {
  setLoadingGroups(false);
}
```

### Phase 2: 교재 목차 대단원 필드 수정 오류 해결 ✅

**파일**: `app/(student)/contents/_components/BookDetailsManager.tsx`

**문제점**:
- 대단원명 input이 button 내부에 있어 이벤트 전파 문제 발생
- 대단원명 수정 시 토글 동작이 함께 발생

**해결 방법**:
- 대단원명 input을 button 외부로 분리
- 이벤트 전파 방지 로직 개선 (`onFocus`, `onMouseDown` 추가)
- 구조 재설계로 접근성 향상

**변경 사항**:
```tsx
// input을 button과 분리
<div className="flex items-center gap-2">
  <button
    type="button"
    onClick={() => toggleGroup(group.majorUnit)}
    className="flex items-center justify-center w-6 h-6 rounded-md hover:bg-gray-200 transition"
    aria-label={isExpanded ? "접기" : "펼치기"}
  >
    <span className="text-gray-500 text-xs">
      {isExpanded ? "▼" : "▶"}
    </span>
  </button>
  <input
    type="text"
    value={...}
    onChange={...}
    onFocus={(e) => e.stopPropagation()}
    onMouseDown={(e) => e.stopPropagation()}
    onClick={(e) => e.stopPropagation()}
  />
</div>
```

### Phase 3: 검증 로직 가이드 개선 ✅

**파일**:
- `app/(admin)/admin/master-books/new/MasterBookForm.tsx`
- `app/(admin)/admin/master-books/[id]/edit/MasterBookEditForm.tsx`
- `lib/validation/schemas.ts`

**문제점**:
- `masterBookSchema`에서 대부분 필드가 optional이지만 UI에 필수 필드 안내 없음
- 사용자가 어떤 필드를 입력해야 하는지 파악 어려움

**해결 방법**:
- 폼 상단에 필수 필드 안내 섹션 추가
- 검증 에러 메시지 개선 (교재명 최대 길이 제한 명시)

**변경 사항**:
```tsx
{/* 필수 입력 항목 안내 */}
<div className="rounded-md bg-blue-50 border border-blue-200 p-3 md:col-span-2">
  <p className="text-sm text-blue-800 font-medium mb-2">필수 입력 항목</p>
  <ul className="text-xs text-blue-700 space-y-1 list-disc list-inside">
    <li>교재명</li>
  </ul>
  <p className="text-sm text-blue-800 font-medium mt-3 mb-2">권장 입력 항목</p>
  <ul className="text-xs text-blue-700 space-y-1 list-disc list-inside">
    <li>개정교육과정, 교과 그룹, 과목</li>
    <li>출판사</li>
  </ul>
</div>
```

```typescript
// 검증 스키마 개선
title: z.string().min(1, "교재명을 입력해주세요.").max(200, "교재명은 200자 이하여야 합니다."),
```

### Phase 4: 중복 코드 최적화 ✅

**파일**:
- `components/forms/PublisherSelectField.tsx` (신규 생성)
- `app/(admin)/admin/master-books/new/MasterBookForm.tsx`
- `app/(admin)/admin/master-books/[id]/edit/MasterBookEditForm.tsx`

**문제점**:
- 출판사 관련 로직이 `MasterBookForm`과 `MasterBookEditForm`에 중복

**해결 방법**:
- 출판사 선택 및 `publisher_name` 자동 설정 로직을 공통 컴포넌트로 추출
- `PublisherSelectField` 컴포넌트 생성하여 재사용

**변경 사항**:
```tsx
// 신규 컴포넌트: components/forms/PublisherSelectField.tsx
export function PublisherSelectField({
  publishers,
  defaultValue = "",
  defaultPublisherName = "",
}: PublisherSelectFieldProps) {
  return (
    <>
      <FormSelect
        label="출판사"
        name="publisher_id"
        defaultValue={defaultValue}
        options={[...]}
        onChange={(e) => {
          // publisher_name 자동 설정 로직
        }}
      />
      <input
        type="hidden"
        name="publisher_name"
        defaultValue={defaultPublisherName}
      />
    </>
  );
}
```

## 수정된 파일 목록

1. `lib/hooks/useSubjectSelection.ts` - 교과/과목 필드 활성화 문제 해결
2. `app/(student)/contents/_components/BookDetailsManager.tsx` - 대단원 필드 수정 오류 해결
3. `app/(admin)/admin/master-books/new/MasterBookForm.tsx` - 필수 필드 안내 추가, 출판사 선택 로직 공통화
4. `app/(admin)/admin/master-books/[id]/edit/MasterBookEditForm.tsx` - 필수 필드 안내 추가, 출판사 선택 로직 공통화
5. `lib/validation/schemas.ts` - 검증 에러 메시지 개선
6. `components/forms/PublisherSelectField.tsx` - 신규 생성 (출판사 선택 공통 컴포넌트)

## 테스트 체크리스트

- [x] 개정교육과정 선택 시 교과 그룹 필드가 즉시 활성화되는지 확인
- [x] 교과 그룹 선택 시 과목 필드가 즉시 활성화되는지 확인
- [x] 대단원명 수정 시 토글 동작이 발생하지 않는지 확인
- [x] 필수 필드 안내가 명확하게 표시되는지 확인
- [x] 검증 에러 메시지가 명확한지 확인
- [x] 출판사 선택 시 `publisher_name`이 자동 설정되는지 확인

## 참고

- 원본 계획 문서: `.cursor/plans/-06a35490.plan.md`





