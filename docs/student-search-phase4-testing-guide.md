# 학생 검색 기능 통합 개선 Phase 4 테스트 가이드

## 테스트 개요

Phase 4 리팩토링 완료 후 실제 환경에서 통합 검색 기능을 테스트하는 가이드입니다.

## 테스트 전 준비사항

### 1. 개발 서버 실행

```bash
npm run dev
```

### 2. 관리자 계정으로 로그인

테스트를 위해 관리자 계정이 필요합니다.

### 3. 테스트 데이터 준비

- 최소 5-10명의 학생 데이터
- 다양한 이름의 학생 (예: 홍길동, 김철수, 이영희 등)
- 다양한 연락처를 가진 학생
- 다양한 학년, 반의 학생

## 테스트 시나리오

### 1. 학생 관리 페이지 검색 테스트

**경로**: `/admin/students`

#### 시나리오 1-1: 이름 검색
1. 학생 관리 페이지 접속
2. 검색창에 "홍길동" 입력
3. 검색 실행
4. **예상 결과**: 이름에 "홍길동"이 포함된 학생 목록 표시

#### 시나리오 1-2: 연락처 검색 (4자리)
1. 학생 관리 페이지 접속
2. 검색창에 "0101" 입력 (학생의 연락처에 포함된 4자리 숫자)
3. 검색 실행
4. **예상 결과**: 연락처에 "0101"이 포함된 학생 목록 표시

#### 시나리오 1-3: 부분 이름 검색
1. 학생 관리 페이지 접속
2. 검색창에 "홍" 입력
3. 검색 실행
4. **예상 결과**: 이름에 "홍"이 포함된 학생 목록 표시

#### 시나리오 1-4: 필터링 + 검색
1. 학생 관리 페이지 접속
2. 학년 필터: "1" 선택
3. 검색창에 "홍" 입력
4. 검색 실행
5. **예상 결과**: 1학년이면서 이름에 "홍"이 포함된 학생만 표시

### 2. SMS 단일 발송 검색 테스트

**경로**: `/admin/sms`

#### 시나리오 2-1: 이름 검색
1. SMS 발송 페이지 접속
2. 단일 발송 탭 선택
3. 수신자 검색창에 "홍길동" 입력
4. 검색 버튼 클릭
5. **예상 결과**: 
   - "검색 중..." 표시
   - 이름에 "홍길동"이 포함된 학생 목록 표시
   - 각 학생의 연락처 정보 표시

#### 시나리오 2-2: 연락처 검색
1. SMS 발송 페이지 접속
2. 단일 발송 탭 선택
3. 수신자 검색창에 "0101" 입력
4. 검색 버튼 클릭
5. **예상 결과**: 
   - 연락처에 "0101"이 포함된 학생 목록 표시
   - 매칭된 연락처 필드 표시 (학생/어머니/아버지)

#### 시나리오 2-3: 검색 타입 자동 감지
1. SMS 발송 페이지 접속
2. 단일 발송 탭 선택
3. 수신자 검색창에 "01012345678" 입력
4. 검색 버튼 클릭
5. **예상 결과**: 연락처 검색으로 자동 감지되어 연락처로 검색

### 3. 출석 관리 페이지 검색 테스트

**경로**: `/admin/attendance`

#### 시나리오 3-1: 학생명 검색
1. 출석 관리 페이지 접속
2. 학생명 필터에 "홍길동" 입력
3. 검색 실행
4. **예상 결과**: 홍길동 학생의 출석 기록만 표시

#### 시나리오 3-2: 연락처 검색
1. 출석 관리 페이지 접속
2. 학생명 필터에 "0101" 입력
3. 검색 실행
4. **예상 결과**: 연락처에 "0101"이 포함된 학생의 출석 기록 표시

### 4. 상담 노트 페이지 검색 테스트

**경로**: `/admin/consulting`

#### 시나리오 4-1: 학생명 검색
1. 상담 노트 페이지 접속
2. 검색창에 "홍길동" 입력
3. **예상 결과**: 홍길동 학생의 상담 노트만 표시

#### 시나리오 4-2: 연락처 검색
1. 상담 노트 페이지 접속
2. 검색창에 "0101" 입력
3. **예상 결과**: 연락처에 "0101"이 포함된 학생의 상담 노트 표시

### 5. API 엔드포인트 직접 테스트

#### 시나리오 5-1: 기본 검색 API 테스트

**요청:**
```bash
curl -X GET "http://localhost:3000/api/students/search?q=홍길동" \
  -H "Cookie: your-session-cookie"
```

**예상 응답:**
```json
{
  "success": true,
  "data": {
    "students": [
      {
        "id": "student-id",
        "name": "홍길동",
        "grade": "1",
        "class": "1",
        "division": "고등부",
        "phone": "010-1234-5678",
        "mother_phone": "010-1111-2222",
        "father_phone": "010-3333-4444",
        "matched_field": "name"
      }
    ],
    "total": 1
  }
}
```

#### 시나리오 5-2: 연락처 검색 API 테스트

**요청:**
```bash
curl -X GET "http://localhost:3000/api/students/search?q=0101&type=phone" \
  -H "Cookie: your-session-cookie"
```

**예상 응답:**
```json
{
  "success": true,
  "data": {
    "students": [
      {
        "id": "student-id",
        "name": "홍길동",
        "matched_field": "phone"
      }
    ],
    "total": 1
  }
}
```

#### 시나리오 5-3: 필터링 API 테스트

**요청:**
```bash
curl -X GET "http://localhost:3000/api/students/search?q=홍&grade=1&class=1" \
  -H "Cookie: your-session-cookie"
```

**예상 응답:**
- 모든 결과가 1학년 1반인 학생만 포함

## 테스트 체크리스트

### 기능 테스트
- [ ] 학생 관리 페이지 - 이름 검색 정상 동작
- [ ] 학생 관리 페이지 - 연락처 검색 정상 동작
- [ ] SMS 단일 발송 - 이름 검색 정상 동작
- [ ] SMS 단일 발송 - 연락처 검색 정상 동작
- [ ] SMS 단일 발송 - 검색 로딩 상태 표시
- [ ] 출석 관리 페이지 - 학생명 검색 정상 동작
- [ ] 상담 노트 페이지 - 학생명 검색 정상 동작
- [ ] API 엔드포인트 - 기본 검색 정상 동작
- [ ] API 엔드포인트 - 연락처 검색 정상 동작
- [ ] API 엔드포인트 - 필터링 정상 동작

### 검색 타입 자동 감지 테스트
- [ ] 숫자만 4자리 이상 → 연락처 검색으로 자동 감지
- [ ] 한글 포함 → 이름 검색으로 자동 감지
- [ ] 숫자 + 한글 → 전체 검색으로 자동 감지

### 성능 테스트
- [ ] 검색 응답 시간 < 1초 (일반적인 경우)
- [ ] 대량 데이터 검색 시 성능 확인
- [ ] 페이지네이션 정상 동작

### 에러 처리 테스트
- [ ] 빈 검색어 처리
- [ ] 검색 결과 없음 처리
- [ ] 권한 없는 요청 차단 (401)
- [ ] 잘못된 파라미터 처리

## 문제 해결

### 검색 결과가 나오지 않는 경우
1. 데이터베이스에 학생 데이터가 있는지 확인
2. 연락처 정보가 `student_profiles` 테이블에 있는지 확인
3. 브라우저 개발자 도구 Network 탭에서 API 요청 확인
4. 서버 로그 확인

### 검색이 느린 경우
1. 데이터베이스 인덱스 생성 확인
2. `pg_trgm` 확장 활성화 확인
3. EXPLAIN 쿼리로 실행 계획 확인

### 권한 오류가 발생하는 경우
1. 세션 쿠키 확인
2. 관리자 계정으로 로그인했는지 확인
3. Tenant Context 확인

## 테스트 결과 기록

테스트 완료 후 다음 정보를 기록하세요:

1. **테스트 일자**: 
2. **테스트 환경**: 
3. **테스트 결과**: 
4. **발견된 문제**: 
5. **개선 사항**: 

## 참고 파일
- `docs/student-search-testing-guide.md` - 기본 테스트 가이드
- `docs/student-search-unified-phase4-refactoring.md` - Phase 4 리팩토링 문서
- `__tests__/integration/studentSearch.test.ts` - 통합 테스트 파일

