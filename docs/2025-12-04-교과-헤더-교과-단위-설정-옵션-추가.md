# 교과 헤더에 교과 단위 설정 옵션 추가

## 작업 일자
2025-12-04

## 작업 내용

### 목표
- 교과 헤더에 교과 단위/콘텐츠별 설정 토글 추가
- 교과 단위 설정 시 해당 교과의 모든 콘텐츠에 적용
- 교과 단위 설정한 교과의 콘텐츠는 콘텐츠별 설정 불가능
- 교과별로 독립적으로 설정 가능 (일부는 교과 단위, 일부는 콘텐츠별)

### 1. Step6Simplified의 SubjectAllocationEditor 개선

**파일**: `app/(student)/plan/new-group/_components/Step6Simplified.tsx`

#### 1.1 교과별 설정 모드 판단 로직 추가

각 교과에 대해 설정 모드를 판단하는 `getSubjectAllocationMode` 함수 추가:

- `subject_allocations`에 해당 교과가 있으면 → 교과 단위 설정 모드
- `content_allocations`에 해당 교과의 콘텐츠가 있으면 → 콘텐츠별 설정 모드
- 둘 다 없으면 → 기본값 (교과 단위 설정 모드)

#### 1.2 교과 헤더에 토글 버튼 추가

교과 헤더에 "교과 단위 설정" / "콘텐츠별 설정" 토글 버튼 추가:
- 선택된 모드에 따라 배경색 변경 (선택: bg-gray-900, 미선택: 기본)
- 클릭 시 해당 모드로 전환

#### 1.3 교과 단위 설정 핸들러

`handleSubjectAllocationChange` 함수:
- 교과 단위 설정 선택 시:
  - `subject_allocations`에 해당 교과 추가/업데이트
  - 해당 교과의 모든 콘텐츠를 `content_allocations`에서 제거
  - 교과 단위 설정 UI 표시

#### 1.4 설정 모드 전환 핸들러

`handleModeChange` 함수:
- 교과 단위 설정 모드로 전환:
  - `subject_allocations`에 기본값(취약과목) 추가
  - 해당 교과의 `content_allocations`에서 제거
- 콘텐츠별 설정 모드로 전환:
  - `subject_allocations`에서 해당 교과 제거
  - 콘텐츠별 설정 UI 활성화

#### 1.5 콘텐츠별 설정 비활성화 로직

교과 단위 설정 모드일 때:
- 콘텐츠별 설정 UI 숨김
- 콘텐츠 목록에 "교과 단위 설정 적용 중" 메시지 표시
- 교과 단위 설정 값 표시

## UI 구조

```
┌─────────────────────────────────────────┐
│ 국어 (3개 콘텐츠)  [교과 단위 설정] [콘텐츠별 설정] │
│                                         │
│ [교과 단위 설정 선택 시]                │
│ ┌─────────────────────────────────┐   │
│ │ [취약과목] [전략과목] [주당 일수] │   │
│ └─────────────────────────────────┘   │
│                                         │
│ 📚 교재 1 (교과 단위 설정 적용 중)      │
│ 📚 교재 2 (교과 단위 설정 적용 중)      │
│                                         │
│ [콘텐츠별 설정 선택 시]                 │
│ ┌─────────────────────────────────┐   │
│ │ 📚 교재 1                        │   │
│ │ [취약과목] [전략과목] [주당 일수] │   │
│ └─────────────────────────────────┘   │
│ ┌─────────────────────────────────┐   │
│ │ 📚 교재 2                        │   │
│ │ [취약과목] [전략과목] [주당 일수] │   │
│ └─────────────────────────────────┘   │
└─────────────────────────────────────────┘
```

## 데이터 흐름

### 교과 단위 설정 선택 시
1. `subject_allocations`에 해당 교과 추가/업데이트
2. 해당 교과의 모든 콘텐츠를 `content_allocations`에서 제거
3. UI에서 해당 교과의 콘텐츠별 설정 숨김
4. 교과 단위 설정 UI 표시

### 콘텐츠별 설정 선택 시
1. `subject_allocations`에서 해당 교과 제거
2. UI에서 해당 교과의 콘텐츠별 설정 활성화
3. 교과 단위 설정 UI 숨김
4. 기존 `content_allocations`는 유지 (사용자가 개별 설정 가능)

## 수정된 파일 목록

1. `app/(student)/plan/new-group/_components/Step6Simplified.tsx`
   - SubjectAllocationEditor 컴포넌트에 교과 헤더 토글 추가
   - 교과별 설정 모드 판단 로직 추가
   - 교과 단위/콘텐츠별 설정 전환 로직 추가
   - 교과 단위 설정 시 콘텐츠별 설정 UI 숨김

## 테스트 시나리오

1. **교과 단위 설정 선택**
   - 교과 헤더에서 "교과 단위 설정" 선택
   - 교과 단위 설정 UI 표시
   - 콘텐츠별 설정 UI 숨김 및 "교과 단위 설정 적용 중" 표시

2. **콘텐츠별 설정 선택**
   - 교과 헤더에서 "콘텐츠별 설정" 선택
   - 교과 단위 설정 UI 숨김
   - 콘텐츠별 설정 UI 활성화

3. **교과별 독립 설정**
   - 교과 A: 교과 단위 설정
   - 교과 B: 콘텐츠별 설정
   - 각 교과가 독립적으로 동작하는지 확인

4. **설정 전환**
   - 교과 단위 → 콘텐츠별 전환 시 기존 교과 단위 설정 제거
   - 콘텐츠별 → 교과 단위 전환 시 기존 콘텐츠별 설정 제거

## 예상 효과

- ✅ 교과 헤더에서 설정 모드를 명확하게 선택 가능
- ✅ 교과 단위 설정 시 해당 교과의 모든 콘텐츠에 일괄 적용
- ✅ 교과 단위 설정한 교과의 콘텐츠는 콘텐츠별 설정 불가능
- ✅ 교과별로 독립적으로 설정 가능 (일부는 교과 단위, 일부는 콘텐츠별)
- ✅ UI가 더 직관적이고 사용하기 쉬움

