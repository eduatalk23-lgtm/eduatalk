# 학생 목록 성별 및 계정 필드 추가

## 작업 개요

학생 목록 테이블에 성별(이름 오른쪽)과 계정(이메일, 부 연락처 오른쪽) 컬럼을 추가하고, 학생 상세정보 페이지에 계정 정보를 표시하도록 구현했습니다.

## 작업 일시

2025년 12월 19일

## 구현 내용

### 1. 타입 정의 수정

**파일**: `app/(admin)/admin/students/_components/types.ts`

`StudentListRow` 타입에 `gender`와 `email` 필드를 추가했습니다.

```typescript
export type StudentListRow = {
  // ... 기존 필드들 ...
  gender: "남" | "여" | null;
  email: string | null;
};
```

### 2. 배치 조회 함수 생성

**파일**: `lib/data/studentProfiles.ts`

여러 학생의 성별 정보를 일괄 조회하는 `getStudentGendersBatch` 함수를 추가했습니다. 기존 배치 조회 패턴(`getStudentPhonesBatch`, `getStudentSchoolsBatch`)과 동일한 방식으로 구현하여 일관성을 유지했습니다.

- Admin Client를 사용하여 RLS를 우회
- `student_profiles` 테이블에서 성별 정보 조회
- Map 자료구조로 반환하여 O(1) 조회 성능 유지

### 3. 학생 목록 페이지 데이터 조회 수정

**파일**: `app/(admin)/admin/students/page.tsx`

성별과 이메일을 병렬로 조회하도록 수정했습니다. 기존 `Promise.all` 패턴에 두 개의 배치 조회를 추가했습니다:

- `getStudentGendersBatch`: 성별 정보 조회
- `getAuthUserMetadata`: 이메일 정보 조회 (기존 유틸리티 함수 활용)

`studentsWithData` 매핑 시 `gender`와 `email` 필드를 포함하도록 수정했습니다.

### 4. 테이블 컴포넌트 수정

**파일**: `app/(admin)/admin/students/_components/StudentTable.tsx`

테이블 헤더와 본문에 성별과 계정 컬럼을 추가했습니다:

- **성별 컬럼**: 이름 컬럼 바로 오른쪽에 배치
- **계정 컬럼**: 부 연락처 컬럼 바로 오른쪽에 배치

컬럼 순서:
1. 체크박스
2. 이름
3. **성별** (추가)
4. 구분
5. 학교
6. 학년
7. 학생 연락처
8. 모 연락처
9. 부 연락처
10. **계정** (추가)
11. 상태

### 5. 학생 상세정보 페이지 수정

**파일**: 
- `app/(admin)/admin/students/[id]/page.tsx`
- `app/(admin)/admin/students/[id]/_components/StudentInfoEditForm.tsx`
- `app/(admin)/admin/students/[id]/_components/sections/ProfileInfoSection.tsx`

학생 상세정보 페이지에 계정(이메일) 정보를 표시하도록 구현했습니다:

- `page.tsx`에서 `getAuthUserMetadata`를 사용하여 이메일 조회
- `StudentInfoEditForm`에 `studentEmail` prop 추가
- `ProfileInfoSection`에 이메일을 읽기 전용 필드로 표시 (수정 불가)

이메일은 Supabase Auth에서 관리되므로 편집할 수 없으며, 읽기 전용으로 표시됩니다.

### 6. 스켈레톤 UI 생성

**파일**: `app/(admin)/admin/students/_components/StudentTableSkeleton.tsx` (신규)

학생 목록 테이블의 로딩 상태를 표시하기 위한 스켈레톤 컴포넌트를 생성했습니다. 실제 테이블 구조와 동일한 컬럼 수와 배치로 구현했습니다.

## 성능 최적화

- **배치 조회 패턴 활용**: N+1 문제 방지
- **Promise.all을 사용한 병렬 처리**: 데이터 조회 시간 최소화
- **Map 자료구조 사용**: O(1) 조회 성능 유지
- **Admin Client 사용**: RLS 우회로 필요한 데이터 직접 조회

## 데이터베이스 스키마 확인

- `student_profiles.gender`: 성별 필드 (CHECK 제약: '남', '여')
- `auth.users.email`: 이메일 필드 (Auth 테이블)
- `students.id = auth.users.id`: 관계

## 파일 변경 목록

1. ✅ `app/(admin)/admin/students/_components/types.ts` - 타입 정의 수정
2. ✅ `lib/data/studentProfiles.ts` - 배치 조회 함수 추가
3. ✅ `app/(admin)/admin/students/page.tsx` - 데이터 조회 로직 수정
4. ✅ `app/(admin)/admin/students/_components/StudentTable.tsx` - 테이블 컬럼 추가
5. ✅ `app/(admin)/admin/students/[id]/page.tsx` - 이메일 조회 추가
6. ✅ `app/(admin)/admin/students/[id]/_components/StudentInfoEditForm.tsx` - email prop 추가
7. ✅ `app/(admin)/admin/students/[id]/_components/sections/ProfileInfoSection.tsx` - 계정 정보 표시
8. ✅ `app/(admin)/admin/students/_components/StudentTableSkeleton.tsx` - 신규 생성

## 테스트 확인 사항

- [ ] 학생 목록 페이지에서 성별과 계정 컬럼이 올바르게 표시되는지 확인
- [ ] 학생 상세정보 페이지에서 계정 정보가 표시되는지 확인
- [ ] 스켈레톤 UI가 올바르게 렌더링되는지 확인
- [ ] 데이터가 없는 경우 "-" 표시 확인
- [ ] 타입 에러 없이 빌드되는지 확인

## 참고 사항

- 이메일 정보는 Supabase Auth에서 관리되므로 수정할 수 없습니다.
- 성별 정보는 `student_profiles` 테이블에서 관리됩니다.
- 기존 배치 조회 패턴을 준수하여 코드 일관성을 유지했습니다.


