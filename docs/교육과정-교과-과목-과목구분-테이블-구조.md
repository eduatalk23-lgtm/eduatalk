# êµìœ¡ê³¼ì •, êµê³¼, ê³¼ëª©, ê³¼ëª©êµ¬ë¶„ í…Œì´ë¸” êµ¬ì¡°

## ğŸ“‹ ìœ„ê³„ êµ¬ì¡°

```
ê°œì •êµìœ¡ê³¼ì • (curriculum_revisions)
  â””â”€â–¶ êµê³¼ (subject_groups)
        â””â”€â–¶ ê³¼ëª© (subjects)
              â””â”€â–¶ ê³¼ëª©êµ¬ë¶„ (subject_types)
```

## ğŸ“‹ í…Œì´ë¸” êµ¬ì¡° ë° ê´€ê³„

### 1. curriculum_revisions (ê°œì •êµìœ¡ê³¼ì •)

**í…Œì´ë¸” êµ¬ì¡°:**
```sql
CREATE TABLE curriculum_revisions (
  id uuid PRIMARY KEY,
  name varchar(50) NOT NULL UNIQUE,
  year integer, -- ê°œì •êµìœ¡ê³¼ì • ì—°ë„ (ì˜ˆ: 2015, 2022)
  display_order integer NOT NULL DEFAULT 0,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now()
);
```

**ì„¤ëª…:**
- ê°œì •êµìœ¡ê³¼ì •ì„ ê´€ë¦¬í•˜ëŠ” í…Œì´ë¸” (ì˜ˆ: 2015ê°œì •êµìœ¡ê³¼ì •, 2022ê°œì •êµìœ¡ê³¼ì •)
- ê° ê°œì •êµìœ¡ê³¼ì •ì€ ê³ ìœ í•œ ì´ë¦„ê³¼ ì—°ë„ë¥¼ ê°€ì§
- `year` í•„ë“œë¡œ ê°œì •êµìœ¡ê³¼ì • ì—°ë„ ê´€ë¦¬ (ì˜ˆ: 2015, 2022)
- `display_order`ë¡œ ì •ë ¬ ìˆœì„œ ê´€ë¦¬
- `is_active`ë¡œ í™œì„±í™” ì—¬ë¶€ ê´€ë¦¬

**ì£¼ìš” í•„ë“œ:**
- `id`: ê³ ìœ  ì‹ë³„ì (UUID)
- `name`: ê°œì •êµìœ¡ê³¼ì •ëª… (ì˜ˆ: "2022ê°œì •êµìœ¡ê³¼ì •")
- `year`: ê°œì •êµìœ¡ê³¼ì • ì—°ë„ (ì˜ˆ: 2022)
- `display_order`: í‘œì‹œ ìˆœì„œ
- `is_active`: í™œì„±í™” ì—¬ë¶€

---

### 2. subject_groups (êµê³¼)

**í…Œì´ë¸” êµ¬ì¡°:**
```sql
CREATE TABLE subject_groups (
  id uuid PRIMARY KEY,
  curriculum_revision_id uuid NOT NULL REFERENCES curriculum_revisions(id) ON DELETE RESTRICT,
  name varchar(50) NOT NULL,
  display_order integer NOT NULL DEFAULT 0,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now(),
  UNIQUE(curriculum_revision_id, name)
);
```

**ì„¤ëª…:**
- êµê³¼ ê·¸ë£¹ì„ ê´€ë¦¬í•˜ëŠ” í…Œì´ë¸” (ì˜ˆ: êµ­ì–´, ìˆ˜í•™, ì˜ì–´, ì‚¬íšŒ, ê³¼í•™)
- **ì „ì—­ ê´€ë¦¬**: `tenant_id` ì œê±°ë¨ (2025-02-04 ë§ˆì´ê·¸ë ˆì´ì…˜)
- ê°œì •êµìœ¡ê³¼ì •ë³„ë¡œ ê´€ë¦¬ë¨ (`curriculum_revision_id`)

**ì£¼ìš” í•„ë“œ:**
- `id`: ê³ ìœ  ì‹ë³„ì (UUID)
- `curriculum_revision_id`: ê°œì •êµìœ¡ê³¼ì • ID (FK â†’ `curriculum_revisions`)
- `name`: êµê³¼ ê·¸ë£¹ëª… (ì˜ˆ: "êµ­ì–´", "ìˆ˜í•™", "ì˜ì–´")
- `display_order`: í‘œì‹œ ìˆœì„œ

**ì œì•½ì¡°ê±´:**
- `UNIQUE(curriculum_revision_id, name)`: ê°™ì€ ê°œì •êµìœ¡ê³¼ì • ë‚´ì—ì„œ êµê³¼ ê·¸ë£¹ëª…ì€ ê³ ìœ í•´ì•¼ í•¨

---

### 3. subjects (ê³¼ëª©)

**í…Œì´ë¸” êµ¬ì¡°:**
```sql
CREATE TABLE subjects (
  id uuid PRIMARY KEY,
  subject_group_id uuid NOT NULL REFERENCES subject_groups(id) ON DELETE RESTRICT,
  name varchar(50) NOT NULL,
  display_order integer NOT NULL DEFAULT 0,
  subject_type_id uuid REFERENCES subject_types(id) ON DELETE SET NULL,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now(),
  UNIQUE(subject_group_id, name)
);
```

**ì„¤ëª…:**
- ê³¼ëª©ì„ ê´€ë¦¬í•˜ëŠ” í…Œì´ë¸” (ì˜ˆ: ìˆ˜í•™â… , ìˆ˜í•™â…¡, ë¯¸ì ë¶„, í™•ë¥ ê³¼ í†µê³„)
- **ì „ì—­ ê´€ë¦¬**: `tenant_id` ì œê±°ë¨ (2025-02-04 ë§ˆì´ê·¸ë ˆì´ì…˜)
- êµê³¼ ê·¸ë£¹ë³„ë¡œ ê´€ë¦¬ë¨ (`subject_group_id`)
- ê³¼ëª©êµ¬ë¶„ì€ `subject_type_id`ë¡œ ì—°ê²°ë¨ (FK â†’ `subject_types`)
- **ì£¼ì˜**: `subject_type` (text) ì»¬ëŸ¼ì€ ì œê±°ë¨ (2025-02-06 ë§ˆì´ê·¸ë ˆì´ì…˜). `subject_type_id`ë§Œ ì‚¬ìš©

**ì£¼ìš” í•„ë“œ:**
- `id`: ê³ ìœ  ì‹ë³„ì (UUID)
- `subject_group_id`: êµê³¼ ê·¸ë£¹ ID (FK â†’ `subject_groups`)
- `name`: ê³¼ëª©ëª… (ì˜ˆ: "ìˆ˜í•™â… ", "ìˆ˜í•™â…¡", "ë¯¸ì ë¶„")
- `display_order`: í‘œì‹œ ìˆœì„œ
- `subject_type_id`: ê³¼ëª©êµ¬ë¶„ ID (FK â†’ `subject_types`, nullable)

**ì œì•½ì¡°ê±´:**
- `UNIQUE(subject_group_id, name)`: ê°™ì€ êµê³¼ ê·¸ë£¹ ë‚´ì—ì„œ ê³¼ëª©ëª…ì€ ê³ ìœ í•´ì•¼ í•¨

---

### 4. subject_types (ê³¼ëª©êµ¬ë¶„)

**í…Œì´ë¸” êµ¬ì¡°:**
```sql
CREATE TABLE subject_types (
  id uuid PRIMARY KEY,
  curriculum_revision_id uuid NOT NULL REFERENCES curriculum_revisions(id) ON DELETE RESTRICT,
  name varchar(50) NOT NULL,
  display_order integer NOT NULL DEFAULT 0,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamptz DEFAULT now(),
  updated_at timestamptz DEFAULT now(),
  UNIQUE(curriculum_revision_id, name)
);
```

**ì„¤ëª…:**
- ê³¼ëª©êµ¬ë¶„ì„ ê´€ë¦¬í•˜ëŠ” í…Œì´ë¸” (ì˜ˆ: ê³µí†µ, ì¼ë°˜ì„ íƒ, ì§„ë¡œì„ íƒ)
- **ê°œì •êµìœ¡ê³¼ì •ë³„ ê´€ë¦¬**: ê° ê°œì •êµìœ¡ê³¼ì •ë§ˆë‹¤ ë‹¤ë¥¸ ê³¼ëª©êµ¬ë¶„ì„ ê°€ì§ˆ ìˆ˜ ìˆìŒ
- ê³¼ëª©êµ¬ë¶„ì€ ê°œì •êµìœ¡ê³¼ì •ì— ì¢…ì†ë¨ (`curriculum_revision_id`)

**ì£¼ìš” í•„ë“œ:**
- `id`: ê³ ìœ  ì‹ë³„ì (UUID)
- `curriculum_revision_id`: ê°œì •êµìœ¡ê³¼ì • ID (FK â†’ `curriculum_revisions`)
- `name`: ê³¼ëª©êµ¬ë¶„ëª… (ì˜ˆ: "ê³µí†µ", "ì¼ë°˜ì„ íƒ", "ì§„ë¡œì„ íƒ")
- `display_order`: í‘œì‹œ ìˆœì„œ
- `is_active`: í™œì„±í™” ì—¬ë¶€

**ì œì•½ì¡°ê±´:**
- `UNIQUE(curriculum_revision_id, name)`: ê°™ì€ ê°œì •êµìœ¡ê³¼ì • ë‚´ì—ì„œ ê³¼ëª©êµ¬ë¶„ëª…ì€ ê³ ìœ í•´ì•¼ í•¨

**ê°€ëŠ¥í•œ ê°’ (2022ê°œì • êµìœ¡ê³¼ì • ê¸°ì¤€):**
- `'ê³µí†µ'`: ê³µí†µ ê³¼ëª©
- `'ì¼ë°˜ì„ íƒ'`: ì¼ë°˜ì„ íƒ ê³¼ëª©
- `'ì§„ë¡œì„ íƒ'`: ì§„ë¡œì„ íƒ ê³¼ëª©

---

## ğŸ”— í…Œì´ë¸” ê´€ê³„ë„

```
curriculum_revisions (ê°œì •êµìœ¡ê³¼ì •)
  â”‚
  â”œâ”€ id (PK)
  â”œâ”€ name
  â”œâ”€ year (ê°œì •êµìœ¡ê³¼ì • ì—°ë„)
  â”‚
  â”œâ”€â–¶ subject_groups (êµê³¼)
  â”‚     â”‚
  â”‚     â”œâ”€ id (PK)
  â”‚     â”œâ”€ curriculum_revision_id (FK â†’ curriculum_revisions)
  â”‚     â”œâ”€ name
  â”‚     â”‚
  â”‚     â””â”€â–¶ subjects (ê³¼ëª©)
  â”‚           â”‚
  â”‚           â”œâ”€ id (PK)
  â”‚           â”œâ”€ subject_group_id (FK â†’ subject_groups)
  â”‚           â”œâ”€ name
  â”‚           â””â”€ subject_type_id (FK â†’ subject_types)
  â”‚
  â””â”€â–¶ subject_types (ê³¼ëª©êµ¬ë¶„)
        â”‚
        â”œâ”€ id (PK)
        â”œâ”€ curriculum_revision_id (FK â†’ curriculum_revisions)
        â””â”€ name
```

---

## ğŸ“Š ë°ì´í„° íë¦„

### 1. ê°œì •êµìœ¡ê³¼ì • â†’ êµê³¼ ê·¸ë£¹
```
curriculum_revisions (2022ê°œì •êµìœ¡ê³¼ì •, year: 2022)
  â””â”€â–¶ subject_groups (êµ­ì–´, ìˆ˜í•™, ì˜ì–´, ...)
```

### 2. êµê³¼ ê·¸ë£¹ â†’ ê³¼ëª©
```
subject_groups (ìˆ˜í•™)
  â””â”€â–¶ subjects (ìˆ˜í•™â… , ìˆ˜í•™â…¡, ë¯¸ì ë¶„, í™•ë¥ ê³¼ í†µê³„, ...)
```

### 3. ê°œì •êµìœ¡ê³¼ì • â†’ ê³¼ëª©êµ¬ë¶„
```
curriculum_revisions (2022ê°œì •êµìœ¡ê³¼ì •)
  â””â”€â–¶ subject_types (ê³µí†µ, ì¼ë°˜ì„ íƒ, ì§„ë¡œì„ íƒ)
```

### 4. ê³¼ëª© â†’ ê³¼ëª©êµ¬ë¶„
```
subjects (ìˆ˜í•™â… )
  â””â”€â–¶ subject_types (ê³µí†µ) via subject_type_id
```

---

## ğŸ”„ ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ë ¥

### 2025-02-06: subject_type ì»¬ëŸ¼ ì œê±°
- `subjects` í…Œì´ë¸”ì—ì„œ `subject_type` (text) ì»¬ëŸ¼ ì œê±°
- `subject_type_id` (FK)ë§Œ ì‚¬ìš©í•˜ë„ë¡ ì™„ì „íˆ ì „í™˜
- ì •ê·œí™”ëœ êµ¬ì¡°ë¡œ í†µì¼

### 2025-02-05: ê³¼ëª©êµ¬ë¶„ ë³„ë„ í…Œì´ë¸”ë¡œ ë¶„ë¦¬ ë° ê°œì •êµìœ¡ê³¼ì • ì—°ë„ ì¶”ê°€
- `curriculum_revisions` í…Œì´ë¸”ì— `year` í•„ë“œ ì¶”ê°€
- `subject_types` í…Œì´ë¸” ìƒì„± (ê°œì •êµìœ¡ê³¼ì •ë³„ ê³¼ëª©êµ¬ë¶„ ê´€ë¦¬)
- `subjects` í…Œì´ë¸”ì˜ `subject_type`ì„ `subject_type_id` FKë¡œ ë³€ê²½
- ê¸°ì¡´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ (í…ìŠ¤íŠ¸ â†’ FK)

### 2025-02-05: default_subject_type ì œê±°
- `subject_groups` í…Œì´ë¸”ì—ì„œ `default_subject_type` ì»¬ëŸ¼ ì œê±°
- ê³¼ëª©êµ¬ë¶„ì€ `subjects.subject_type_id`ì—ì„œë§Œ ê´€ë¦¬

### 2025-02-04: ì „ì—­ ê´€ë¦¬ë¡œ ë³€ê²½
- `subject_groups`ì™€ `subjects` í…Œì´ë¸”ì—ì„œ `tenant_id` ì œê±°
- `subject_groups`ì— `curriculum_revision_id` ì¶”ê°€
- ì „ì—­ ë°ì´í„°ë¡œ í†µí•© ê´€ë¦¬

### 2025-02-04: subject_categories ì œê±°
- `subject_categories` í…Œì´ë¸” deprecated
- `subject_groups`ë¡œ ëŒ€ì²´ë¨

---

## ğŸ“ ì£¼ìš” ì¿¼ë¦¬ ì˜ˆì‹œ

### 1. ê°œì •êµìœ¡ê³¼ì •ë³„ êµê³¼ ê·¸ë£¹ ì¡°íšŒ
```sql
SELECT sg.*, cr.name as curriculum_name, cr.year
FROM subject_groups sg
JOIN curriculum_revisions cr ON sg.curriculum_revision_id = cr.id
WHERE cr.year = 2022
ORDER BY sg.display_order, sg.name;
```

### 2. êµê³¼ ê·¸ë£¹ë³„ ê³¼ëª© ì¡°íšŒ (ê³¼ëª©êµ¬ë¶„ í¬í•¨)
```sql
SELECT 
  s.*,
  sg.name as subject_group_name,
  st.name as subject_type_name
FROM subjects s
JOIN subject_groups sg ON s.subject_group_id = sg.id
LEFT JOIN subject_types st ON s.subject_type_id = st.id
WHERE sg.id = '...'
ORDER BY s.display_order, s.name;
```

### 3. ê°œì •êµìœ¡ê³¼ì •ë³„ ê³¼ëª©êµ¬ë¶„ ì¡°íšŒ
```sql
SELECT st.*, cr.name as curriculum_name, cr.year
FROM subject_types st
JOIN curriculum_revisions cr ON st.curriculum_revision_id = cr.id
WHERE cr.year = 2022
ORDER BY st.display_order, st.name;
```

### 4. ì „ì²´ ê³„ì¸µ êµ¬ì¡° ì¡°íšŒ
```sql
SELECT 
  cr.name as curriculum_name,
  cr.year,
  sg.name as subject_group_name,
  s.name as subject_name,
  st.name as subject_type_name
FROM curriculum_revisions cr
JOIN subject_groups sg ON sg.curriculum_revision_id = cr.id
LEFT JOIN subjects s ON s.subject_group_id = sg.id
LEFT JOIN subject_types st ON s.subject_type_id = st.id
WHERE cr.is_active = true
ORDER BY cr.display_order, sg.display_order, s.display_order;
```

---

## âœ… í™•ì¸ ì‚¬í•­

### í˜„ì¬ êµ¬ì¡° í™•ì¸
- âœ… `curriculum_revisions` í…Œì´ë¸” ì¡´ì¬ (year í•„ë“œ ì¶”ê°€ë¨)
- âœ… `subject_groups` í…Œì´ë¸”ì´ `curriculum_revision_id`ë¡œ ì—°ê²°ë¨
- âœ… `subjects` í…Œì´ë¸”ì´ `subject_group_id`ë¡œ ì—°ê²°ë¨
- âœ… `subject_types` í…Œì´ë¸” ìƒì„±ë¨ (ê°œì •êµìœ¡ê³¼ì •ë³„ ê´€ë¦¬)
- âœ… `subjects.subject_type_id`ê°€ `subject_types.id`ë¡œ ì—°ê²°ë¨
- âœ… `subjects.subject_type` ì»¬ëŸ¼ ì œê±°ë¨ (2025-02-06 ë§ˆì´ê·¸ë ˆì´ì…˜)
- âœ… `subject_categories` í…Œì´ë¸”ì€ ì œê±°ë¨ (deprecated)

### ê´€ê³„ ë¬´ê²°ì„±
- âœ… `subject_groups.curriculum_revision_id` â†’ `curriculum_revisions.id` (FK)
- âœ… `subjects.subject_group_id` â†’ `subject_groups.id` (FK)
- âœ… `subjects.subject_type_id` â†’ `subject_types.id` (FK)
- âœ… `subject_types.curriculum_revision_id` â†’ `curriculum_revisions.id` (FK)
- âœ… UNIQUE ì œì•½ì¡°ê±´: `(curriculum_revision_id, name)` on `subject_groups`
- âœ… UNIQUE ì œì•½ì¡°ê±´: `(subject_group_id, name)` on `subjects`
- âœ… UNIQUE ì œì•½ì¡°ê±´: `(curriculum_revision_id, name)` on `subject_types`

---

## ğŸ“š ê´€ë ¨ íŒŒì¼

- **íƒ€ì… ì •ì˜**: 
  - `lib/data/subjects.ts` (SubjectGroup, Subject, SubjectType)
  - `lib/data/contentMetadata.ts` (CurriculumRevision)
- **ì•¡ì…˜ í•¨ìˆ˜**: `app/(admin)/actions/subjectActions.ts`
- **ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼**:
  - `supabase/migrations/20250204000000_make_subject_groups_global.sql`
  - `supabase/migrations/20250204000001_migrate_subject_data_to_global.sql`
  - `supabase/migrations/20250204000002_deprecate_subject_categories.sql`
  - `supabase/migrations/20250205000000_remove_default_subject_type.sql`
  - `supabase/migrations/20250205000001_add_curriculum_year_and_subject_types.sql`
  - `supabase/migrations/20250206000000_remove_subject_type_column.sql`

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025-02-06

