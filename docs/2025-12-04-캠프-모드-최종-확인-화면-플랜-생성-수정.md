# 캠프 모드 최종 확인 화면 플랜 생성 수정

## 문제 상황

캠프 모드에서 "남은 단계 이어하기" 기능을 사용할 때, 최종 확인 화면(Step 7)에서 다음 버튼을 클릭해도 플랜이 생성되지 않는 문제가 발생했습니다.

### 원인 분석

1. **Step 6 → Step 7 전환 시 플랜 생성 누락**
   - `PlanGroupWizard`의 `handleNext` 함수에서 Step 6에서 다음 버튼 클릭 시 `continueCampStepsForAdmin`을 호출하지만, 이 함수는 `step === 7`일 때만 플랜을 생성합니다.
   - Step 6에서 호출하면 데이터만 저장하고 Step 7로 이동하므로 플랜이 생성되지 않습니다.

2. **Step 7 진입 시 플랜 자동 생성 로직 부재**
   - `Step7ScheduleResult` 컴포넌트는 플랜이 없을 때 에러 메시지만 표시하고 자동 생성 로직이 없었습니다.
   - `PlanGroupWizard`의 `onComplete`에서 `continueCampStepsForAdmin`을 호출하지만, 이는 완료 버튼 클릭 시에만 실행됩니다.

## 해결 방법

### 1. Step7ScheduleResult 컴포넌트에 플랜 자동 생성 로직 추가

**파일**: `app/(student)/plan/new-group/_components/Step7ScheduleResult.tsx`

#### 변경 사항

1. **자동 생성 중복 방지 ref 추가**
   ```typescript
   const hasAutoGeneratedRef = useRef(false); // 자동 생성 중복 방지
   ```

2. **useEffect로 플랜 자동 생성 로직 추가**
   ```typescript
   useEffect(() => {
     // 플랜 확인이 완료되고, 플랜이 없고, 아직 자동 생성하지 않았고, 생성 중이 아닐 때만 실행
     if (
       !isCheckingPlans &&
       plansCheck &&
       !plansCheck.hasPlans &&
       !hasAutoGeneratedRef.current &&
       !generatePlansMutation.isPending &&
       !generatePlansMutation.isSuccess
     ) {
       console.log("[Step7ScheduleResult] 플랜이 없어 자동 생성 시작:", groupId);
       hasAutoGeneratedRef.current = true;
       generatePlansMutation.mutate();
     }
   }, [
     isCheckingPlans,
     plansCheck,
     groupId,
     generatePlansMutation.isPending,
     generatePlansMutation.isSuccess,
   ]);
   ```

3. **플랜이 없을 때 에러 처리 개선**
   - 자동 생성 시도 후에도 실패한 경우 재생성 버튼 제공
   - 에러 메시지 개선

4. **완료 버튼 클릭 시 메시지 개선**
   - 자동 생성이 시도되었지만 실패한 경우 재생성 안내 메시지 표시

## 동작 흐름

### 이전 동작
1. Step 6에서 다음 버튼 클릭
2. `continueCampStepsForAdmin` 호출 (데이터만 저장)
3. Step 7로 이동
4. 플랜이 없어 에러 메시지 표시
5. 사용자가 수동으로 플랜 재생성 버튼 클릭 필요

### 개선된 동작
1. Step 6에서 다음 버튼 클릭
2. `continueCampStepsForAdmin` 호출 (데이터만 저장)
3. Step 7로 이동
4. **Step 7 진입 시 플랜이 없으면 자동 생성 시작**
5. 플랜 생성 완료 후 스케줄 결과 표시
6. 완료 버튼 클릭 시 플랜 상세보기로 이동

## 주요 변경 파일

1. `app/(student)/plan/new-group/_components/Step7ScheduleResult.tsx`
   - 플랜 자동 생성 로직 추가
   - 에러 처리 개선
   - 완료 버튼 메시지 개선

## 테스트 시나리오

1. **정상 케이스**
   - Step 6에서 다음 버튼 클릭
   - Step 7 진입 시 플랜이 없으면 자동 생성
   - 플랜 생성 완료 후 스케줄 결과 표시
   - 완료 버튼 클릭 시 정상 동작

2. **플랜 생성 실패 케이스**
   - Step 7 진입 시 플랜 자동 생성 시도
   - 생성 실패 시 에러 메시지 및 재생성 버튼 표시
   - 재생성 버튼 클릭 시 다시 시도 가능

3. **플랜이 이미 있는 케이스**
   - Step 7 진입 시 플랜이 이미 있으면 자동 생성 스킵
   - 기존 플랜 결과 표시

## 참고 사항

- 자동 생성은 한 번만 실행되도록 `hasAutoGeneratedRef`로 중복 방지
- 플랜 생성 중에는 로딩 화면 표시
- 플랜 생성 실패 시 사용자가 수동으로 재생성할 수 있도록 버튼 제공

