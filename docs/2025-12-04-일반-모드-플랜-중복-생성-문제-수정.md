# 일반 모드 플랜 중복 생성 문제 수정

## 문제 상황

일반 모드에서 플랜 생성 시 한 번의 작업을 진행했는데 플랜 목록에 4개의 목록이 생성되는 문제가 발생했습니다.

## 원인 분석

플랜 생성이 세 곳에서 중복 호출되고 있었습니다:

1. **Step7ScheduleResult.tsx**의 `useEffect` (58-74줄): 플랜이 없으면 자동으로 생성
2. **PlanGroupWizard.tsx**의 `onComplete` 핸들러 (1377-1408줄): 완료 시 플랜이 없으면 생성
3. **Step7ScheduleResult.tsx**의 완료 버튼 (191-222줄): 완료 버튼 클릭 시 플랜이 없으면 생성

이 세 곳에서 동시에 플랜 생성이 호출되어 여러 개의 플랜 그룹이 생성되었습니다.

## 해결 방안

### 1. Step7ScheduleResult의 자동 생성 로직 제거

- `useEffect`에서 자동으로 플랜을 생성하는 로직을 완전히 제거
- 완료 버튼에서만 플랜 생성하도록 변경

### 2. PlanGroupWizard의 onComplete 핸들러 수정

- Step 7에서 `onComplete` 호출 시 플랜 생성 로직 제거
- 플랜 존재 여부 확인만 수행하고, 플랜이 없으면 경고만 표시
- Step7ScheduleResult에서 이미 플랜 생성을 처리하므로 중복 제거

### 3. 완료 버튼의 플랜 생성 로직 유지 및 중복 체크 강화

- 완료 버튼에서만 플랜 생성하도록 유지
- `isPending` 또는 `isSuccess` 상태일 때는 생성하지 않도록 중복 체크 강화

## 수정 내용

### Step7ScheduleResult.tsx

1. **useEffect 자동 생성 로직 제거**
   - 58-74줄의 자동 플랜 생성 useEffect 완전 제거
   - `useEffect` import도 제거 (더 이상 사용하지 않음)

2. **완료 버튼 중복 체크 강화**
   - `isPending` 상태뿐만 아니라 `isSuccess` 상태도 확인하여 중복 생성 방지
   - disabled 속성에도 `isSuccess` 상태 추가

```typescript
// 수정 전
onClick={() => {
  if (generatePlansMutation.isPending) {
    return;
  }
  // ...
}}
disabled={generatePlansMutation.isPending || isLoadingData}

// 수정 후
onClick={() => {
  if (generatePlansMutation.isPending || generatePlansMutation.isSuccess) {
    return;
  }
  // ...
}}
disabled={generatePlansMutation.isPending || generatePlansMutation.isSuccess || isLoadingData}
```

### PlanGroupWizard.tsx

1. **onComplete 핸들러에서 플랜 생성 로직 제거**
   - 1377-1408줄의 플랜 생성 로직 완전 제거
   - 플랜 존재 여부 확인만 수행
   - 플랜이 없으면 경고만 표시하고 return

```typescript
// 수정 전
try {
  const checkResult = await checkPlansExistAction(draftGroupId);
  if (!checkResult.hasPlans) {
    // 플랜이 없으면 생성
    await generatePlansFromGroupAction(draftGroupId);
    // ...
  }
} catch (error) {
  // ...
}

// 수정 후
try {
  const checkResult = await checkPlansExistAction(draftGroupId);
  if (!checkResult.hasPlans) {
    // 플랜이 없으면 경고만 표시 (Step7ScheduleResult에서 생성해야 함)
    alert("플랜이 생성되지 않았습니다. 완료 버튼을 눌러 플랜을 생성해주세요.");
    return;
  }
} catch (error) {
  // 플랜 확인 실패는 경고만 표시하고 계속 진행
  console.warn("[PlanGroupWizard] 플랜 확인 실패:", error);
}
```

## 결과

이제 플랜 생성은 **Step7ScheduleResult의 완료 버튼에서만** 수행되므로 중복 생성 문제가 해결되었습니다.

- ✅ 자동 생성 로직 제거로 의도하지 않은 플랜 생성 방지
- ✅ 완료 버튼에서만 플랜 생성하여 사용자 의도에 맞게 생성
- ✅ 중복 체크 강화로 동시 호출 방지

## 테스트 시나리오

1. 일반 모드에서 플랜 그룹 생성
2. Step 7까지 진행
3. 완료 버튼 클릭하여 플랜 생성
4. 플랜 목록에서 1개의 플랜 그룹만 생성되었는지 확인

## 관련 파일

- `app/(student)/plan/new-group/_components/Step7ScheduleResult.tsx`
- `app/(student)/plan/new-group/_components/PlanGroupWizard.tsx`

