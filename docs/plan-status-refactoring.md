# 플랜 상태 관리 리팩토링

## 📋 변경 사항

### 1. 중단(cancelled) → 일시정지(paused) 통합

**변경 이유:**
- `cancelled`(중단)와 `paused`(일시정지)의 기능적 차이가 불명확
- 상태 관리 복잡도 감소
- 사용자 혼란 방지

**변경 내용:**
- 새로운 전이 규칙: `active` → `paused` (일시정지/중단)
- 기존 `cancelled` 상태는 기존 데이터 호환성을 위해 유지 (새로는 사용하지 않음)
- UI 표시: `cancelled` → "중단"으로 표시 (기존에는 "취소"였음)

### 2. 삭제 버튼 조건

**현재 삭제 가능 상태:**
- ✅ `draft` (초안)
- ✅ `saved` (저장됨)
- ❌ `active` (활성) - 실행 중인 플랜은 삭제 불가
- ❌ `paused` (일시정지/중단) - 중단된 플랜도 삭제 불가 (재개 가능성 고려)
- ❌ `completed` (완료) - 완료된 플랜은 삭제 불가
- ❌ `cancelled` (중단) - 기존 데이터 호환성 (삭제 불가)

**삭제 제한 이유:**
- 실행 중이거나 중단된 플랜은 나중에 재개할 수 있으므로 삭제 방지
- 완료된 플랜은 기록 보존 차원에서 삭제 불가

### 3. 상태 전이 규칙

#### 새로운 전이 규칙

```
초안(draft)
  ├─ 저장 → 저장됨(saved)
  └─ 중단 → 일시정지(paused)

저장됨(saved)
  ├─ 활성화 → 활성(active)
  ├─ 초안으로 변경 → 초안(draft)
  └─ 중단 → 일시정지(paused)

활성(active)
  ├─ 일시정지 → 일시정지(paused)
  └─ 완료 → 완료(completed)

일시정지(paused)
  └─ 재개 → 활성(active)

완료(completed)
  └─ (변경 불가)

중단(cancelled) - 기존 데이터 호환성
  └─ 재개 → 활성(active)
```

### 4. 초안으로 변경 기능

**기능 설명:**
- `saved` (저장됨) → `draft` (초안) 전이
- 저장된 플랜을 다시 수정 가능한 초안 상태로 되돌림
- 메타데이터, 콘텐츠, 제외일 등 모든 수정 가능

**사용 사례:**
- 저장 후 추가 수정이 필요한 경우
- 플랜 생성 후 설정을 변경하고 싶은 경우

## 🔄 상태별 권한

| 상태 | 수정 | 삭제 | 콘텐츠 수정 | 제외일 수정 | 설명 |
|------|------|------|------------|------------|------|
| 초안(draft) | ✅ | ✅ | ✅ | ✅ | 모든 수정 가능 |
| 저장됨(saved) | ✅ | ✅ | ✅ | ✅ | 수정 및 삭제 가능 |
| 활성(active) | ❌ | ❌ | ❌ | ✅ | 실행 중, 제한적 수정 |
| 일시정지(paused) | ❌ | ❌ | ❌ | ✅ | 중단됨, 재개 가능 |
| 완료(completed) | ❌ | ❌ | ❌ | ❌ | 읽기 전용 |
| 중단(cancelled) | ❌ | ❌ | ❌ | ❌ | 기존 데이터 호환성 |

## 🎯 UI 변경 사항

### 상태 라벨
- `draft`: "초안"
- `saved`: "저장됨"
- `active`: "활성"
- `paused`: "일시정지"
- `completed`: "완료"
- `cancelled`: "중단" (기존: "취소")

### 상태 버튼 라벨
- `draft->saved`: "저장"
- `draft->paused`: "중단"
- `saved->active`: "활성화"
- `saved->draft`: "초안으로 변경"
- `saved->paused`: "중단"
- `active->paused`: "일시정지"
- `active->completed`: "완료"
- `paused->active`: "재개"

## 📝 마이그레이션 고려사항

### 기존 데이터 처리

기존 `cancelled` 상태 데이터는 다음과 같이 처리:
1. UI에서는 "중단"으로 표시
2. 상태 전이는 `active`로만 가능 (재개)
3. 새로운 플랜은 `cancelled` 상태로 생성하지 않음
4. 향후 데이터 마이그레이션 시 `paused`로 변경 가능

### 권장 마이그레이션 (선택사항)

```sql
-- cancelled 상태를 paused로 일괄 변경
UPDATE plan_groups
SET status = 'paused'
WHERE status = 'cancelled';

-- 마이그레이션 후 타입에서 cancelled 제거 가능
-- 하지만 기존 코드 호환성을 위해 유지 권장
```

## ✅ 요약

1. ✅ **삭제 버튼**: `draft`, `saved` 상태에서만 표시
2. ✅ **중단 통합**: `cancelled` → `paused`로 통합
3. ✅ **상태 라벨**: `cancelled` → "중단"으로 표시
4. ✅ **초안으로 변경**: `saved` → `draft` 전이 기능 유지
5. ✅ **기존 데이터 호환성**: `cancelled` 상태 유지 (새로는 사용 안 함)

