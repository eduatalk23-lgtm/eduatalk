# Today 페이지 - 플랜 메모 및 범위 조정 스켈레톤 디자인

## 📋 개요

플랜 그룹별(논리 플랜 기준, `plan_number` 기준)로 메모를 작성하고, 범위를 조정할 수 있는 기능을 제공합니다. 각 기능은 아이콘 버튼으로 접근할 수 있으며, 모달 또는 드로어 형태로 UI를 제공합니다.

## 🎯 주요 요구사항

1. **메모 기능**: 플랜 그룹별 메모 작성/수정/조회
2. **범위 조정 기능**: 플랜 그룹 내 모든 플랜의 범위를 일괄 조정
3. **논리 플랜 기준**: 같은 `plan_number`를 가진 플랜 그룹 단위로 작동
4. **직관적인 UI**: 메모 아이콘과 설정 아이콘으로 접근

## 📐 스켈레톤 디자인

### 1. 플랜 그룹 카드 헤더 (아이콘 배치)

플랜 그룹 카드의 헤더 영역에 메모 아이콘과 설정 아이콘을 추가합니다.

#### 일일 뷰

```
┌──────────────────────────────────────────────────────────────┐
│ 플랜 1: 수학 개념 정리 (plan_number: 1)                       │
│                                                              │
│ ┌──────────────────────────────────────────────────────────┐ │
│ │ 📚 수학 개념 정리 (1-3회차)                              │ │
│ │                                                          │ │
│ │ [📝 메모] [⚙️ 범위 조정] [📋 상세보기]                │ │
│ │ ↑ 헤더에 아이콘 버튼 배치                                │ │
│ └──────────────────────────────────────────────────────────┘ │
│                                                              │
│ ... 플랜 블록들 ...                                          │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

#### 단일 뷰

```
┌──────────────────────────────────────────────────────────────┐
│                                    📚 수학 개념 정리          │
│                                   (1-3회차)                   │
│                                                                
│ ┌──────────────────────────────────────────────────────────┐ │
│ │ [📝 메모] [⚙️ 범위 조정]                                │ │
│ │ ↑ 헤더 오른쪽 상단에 아이콘 버튼 배치                   │ │
│ └──────────────────────────────────────────────────────────┘ │
│                                                              │
│ ... 플랜 상세 정보 ...                                       │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

### 2. 메모 아이콘 (📝) - 메모 작성/조회

메모 아이콘을 클릭하면 메모 작성/수정 모달이 열립니다.

#### 메모 모달 UI

```
┌──────────────────────────────────────────────────────────────┐
│ 플랜 메모                            [✕ 닫기]                │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│ 📚 수학 개념 정리 (1-3회차)                                   │
│                                                              │
│ ┌──────────────────────────────────────────────────────────┐ │
│ │ 메모 입력                                                │ │
│ │ ──────────────────────────────────────────────────────── │ │
│ │                                                          │ │
│ │ [텍스트 입력 영역]                                       │ │
│ │                                                          │ │
│ │ 오늘은 1-2장을 집중적으로 공부해야 한다.                │ │
│ │ 수학 공식 정리가 중요하다.                               │ │
│ │                                                          │ │
│ │                                                          │ │
│ │ (0/500자)                                               │ │
│ └──────────────────────────────────────────────────────────┘ │
│                                                              │
│ ┌──────────────────────────────────────────────────────────┐ │
│ │ 💡 추천 메모                                             │ │
│ │                                                          │ │
│ │ 자주 사용되는 메모 템플릿:                               │ │
│ │                                                          │ │
│ │ [📌 핵심 정리]                                          │ │
│ │ [📌 복습 필요]                                          │ │
│ │ [📌 질문 사항]                                          │ │
│ │ [📌 추가 자료]                                          │ │
│ │                                                          │ │
│ │ 빠른 입력:                                               │ │
│ │ [🚀 오늘 목표: ...]                                     │ │
│ │ [⚠️ 주의사항: ...]                                      │ │
│ │ [✅ 완료 체크: ...]                                     │ │
│ └──────────────────────────────────────────────────────────┘ │
│                                                              │
│ [취소] [저장]                                               │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

#### 메모 아이콘 상태 표시

- **메모 없음**: 📝 (회색)
- **메모 있음**: 📝 (파란색, 배지 표시)
- **호버 시**: 메모 미리보기 툴팁 표시

```
┌──────────────────────────────────────────────────────────────┐
│ [📝] ← 메모 없음 (회색)                                      │
│                                                              │
│ [📝·] ← 메모 있음 (파란색, 작은 점 배지)                     │
│                                                              │
│ [📝2] ← 메모 있음 (파란색, 글자 수 배지)                    │
│                                                              │
│ 호버 시 툴팁:                                                │
│ ┌──────────────────────────┐                                │
│ │ 오늘은 1-2장을 집중적으로 │                                │
│ │ 공부해야 한다.           │                                │
│ │ ...                      │                                │
│ └──────────────────────────┘                                │
└──────────────────────────────────────────────────────────────┘
```

### 3. 범위 조정 아이콘 (⚙️) - 범위 설정

범위 조정 아이콘을 클릭하면 범위 조정 모달이 열립니다.

#### 범위 조정 모달 UI

```
┌──────────────────────────────────────────────────────────────┐
│ 플랜 범위 조정                      [✕ 닫기]                │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│ 📚 수학 개념 정리 (1-3회차)                                   │
│                                                              │
│ ┌──────────────────────────────────────────────────────────┐ │
│ │ 현재 범위                                                │ │
│ │ ──────────────────────────────────────────────────────── │ │
│ │                                                          │ │
│ │ 블록 1: 09:00 ~ 10:30                                   │ │
│ │   시작: 10 페이지                                        │ │
│ │   종료: 25 페이지                                        │ │
│ │   범위: 15 페이지                                        │ │
│ │                                                          │ │
│ │ 블록 3: 14:00 ~ 15:30                                   │ │
│ │   시작: 26 페이지                                        │ │
│ │   종료: 35 페이지                                        │ │
│ │   범위: 9 페이지                                         │ │
│ │                                                          │ │
│ │ 전체 범위: 10 ~ 35 페이지 (총 25 페이지)                │ │
│ └──────────────────────────────────────────────────────────┘ │
│                                                              │
│ ┌──────────────────────────────────────────────────────────┐ │
│ │ 범위 조정 방법 선택                                      │ │
│ │ ──────────────────────────────────────────────────────── │ │
│ │                                                          │ │
│ │ [ ] 전체 범위 일괄 조정                                  │ │
│ │     모든 블록에 동일한 비율로 범위 분배                 │ │
│ │                                                          │ │
│ │ [✓] 개별 블록 조정                                      │ │
│ │     각 블록의 범위를 개별적으로 조정                    │ │
│ │                                                          │ │
│ │ [ ] 스마트 조정 (AI 추천)                               │ │
│ │     콘텐츠 난이도와 학습 속도 기반 자동 조정            │ │
│ └──────────────────────────────────────────────────────────┘ │
│                                                              │
│ ┌──────────────────────────────────────────────────────────┐ │
│ │ 새 범위 입력                                             │ │
│ │ ──────────────────────────────────────────────────────── │ │
│ │                                                          │ │
│ │ 전체 시작: [10] 페이지                                   │ │
│ │ 전체 종료: [35] 페이지                                   │ │
│ │                                                          │ │
│ │ 또는                                                     │ │
│ │                                                          │ │
│ │ 조정 방식:                                               │ │
│ │ [▼ 앞으로 당기기]                                        │ │
│ │   - 5페이지 앞으로                                      │ │
│ │   - 10페이지 앞으로                                     │ │
│ │                                                          │ │
│ │ [▼ 뒤로 미루기]                                         │ │
│ │   - 5페이지 뒤로                                        │ │
│ │   - 10페이지 뒤로                                       │ │
│ └──────────────────────────────────────────────────────────┘ │
│                                                              │
│ ┌──────────────────────────────────────────────────────────┐ │
│ │ 미리보기                                                 │ │
│ │ ──────────────────────────────────────────────────────── │ │
│ │                                                          │ │
│ │ 블록 1: 09:00 ~ 10:30                                   │ │
│ │   10 ~ 25 페이지 (15 페이지)                            │ │
│ │                                                          │ │
│ │ 블록 3: 14:00 ~ 15:30                                   │ │
│ │   26 ~ 35 페이지 (9 페이지)                             │ │
│ │                                                          │ │
│ │ [🔄 원래대로 되돌리기]                                  │ │
│ └──────────────────────────────────────────────────────────┘ │
│                                                              │
│ ┌──────────────────────────────────────────────────────────┐ │
│ │ ⚠️ 주의사항                                             │ │
│ │                                                          │ │
│ │ • 범위 조정 시 진행 중인 플랜은 일시정지됩니다.         │ │
│ │ • 기존 진행률은 유지됩니다.                              │ │
│ │ • 조정 후 학습 시간이 재계산될 수 있습니다.              │ │
│ └──────────────────────────────────────────────────────────┘ │
│                                                              │
│ [취소] [적용]                                               │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

#### 범위 조정 방식

1. **전체 범위 일괄 조정**
   - 새로운 전체 시작/종료 페이지 입력
   - 기존 블록 비율 유지하여 자동 분배

2. **개별 블록 조정**
   - 각 블록별로 시작/종료 페이지 개별 설정
   - 블록 간 겹침 방지 및 검증

3. **스마트 조정 (AI 추천)**
   - 학습 속도 기반 자동 조정
   - 난이도 고려 범위 분배

#### 범위 조정 추천 요소

```
┌──────────────────────────────────────────────────────────────┐
│ 💡 추천 범위 설정                                            │
│                                                              │
│ 빠른 조정:                                                   │
│                                                              │
│ [🚀 앞으로 5페이지] [🚀 앞으로 10페이지]                   │
│ [⏮️ 뒤로 5페이지] [⏮️ 뒤로 10페이지]                       │
│                                                              │
│ 스마트 추천:                                                 │
│                                                              │
│ [📊 학습 속도 기반 조정]                                    │
│   • 평균 학습 속도: 5페이지/시간                            │
│   • 추천 범위: 블록당 5-8페이지                             │
│                                                              │
│ [🎯 난이도 기반 조정]                                       │
│   • 현재 난이도: 중급                                        │
│   • 추천 범위: 블록당 7-10페이지                            │
│                                                              │
│ [⚖️ 균형 조정]                                             │
│   • 모든 블록의 범위를 동일하게 맞춤                        │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

## 🎨 컴포넌트 구조

### 1. PlanGroupActions 컴포넌트

플랜 그룹 헤더에 아이콘 버튼들을 표시하는 컴포넌트입니다.

```typescript
type PlanGroupActionsProps = {
  group: PlanGroup;
  memo?: string | null;
  hasMemo: boolean;
  onMemoClick: () => void;
  onRangeAdjustClick: () => void;
  onViewDetail?: () => void;
  viewMode: "daily" | "single";
};
```

**일일 뷰 UI:**

```
┌──────────────────────────────────────────────────────────────┐
│ 📚 수학 개념 정리 (1-3회차)                                   │
│                                                              │
│ <-- 왼쪽 -->                              [📝] [⚙️] [📋]  │
│                                                  ↑            │
│                                               아이콘들       │
└──────────────────────────────────────────────────────────────┘
```

**단일 뷰 UI:**

```
┌──────────────────────────────────────────────────────────────┐
│                                    📚 수학 개념 정리          │
│                                                              │
│                                              [📝] [⚙️]       │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

### 2. PlanMemoModal 컴포넌트

메모 작성/수정 모달입니다.

```typescript
type PlanMemoModalProps = {
  group: PlanGroup;
  memo: string | null;
  isOpen: boolean;
  onClose: () => void;
  onSave: (memo: string) => Promise<void>;
};
```

**주요 기능:**

- 텍스트 에디터 (최대 500자)
- 추천 메모 템플릿
- 빠른 입력 버튼
- 저장/취소 버튼

**추천 메모 템플릿:**

- 📌 핵심 정리
- 📌 복습 필요
- 📌 질문 사항
- 📌 추가 자료
- 🚀 오늘 목표: ...
- ⚠️ 주의사항: ...
- ✅ 완료 체크: ...

### 3. PlanRangeAdjustModal 컴포넌트

범위 조정 모달입니다.

```typescript
type PlanRangeAdjustModalProps = {
  group: PlanGroup;
  isOpen: boolean;
  onClose: () => void;
  onSave: (ranges: PlanRange[]) => Promise<void>;
  totalPages: number; // 콘텐츠의 총 페이지 수
};
```

**주요 기능:**

- 현재 범위 표시
- 조정 방식 선택 (일괄/개별/스마트)
- 새 범위 입력
- 미리보기
- 검증 (범위 겹침, 총량 초과 등)

**조정 방식:**

1. **전체 범위 일괄 조정**
   - 새로운 시작/종료 입력
   - 기존 비율 유지 분배

2. **개별 블록 조정**
   - 각 블록별 범위 개별 설정
   - 블록 간 겹침 방지

3. **스마트 조정 (선택사항)**
   - 학습 속도 기반
   - 난이도 고려

**추천 범위 설정:**

- 빠른 조정 버튼 (앞으로/뒤로)
- 학습 속도 기반 추천
- 난이도 기반 추천
- 균형 조정

## 📊 데이터 구조

### 플랜 메모

```typescript
type PlanMemo = {
  plan_number: number | null;
  memo: string | null;
  updated_at: string;
};
```

**저장 위치:**
- 옵션 1: `student_plan` 테이블에 `memo` 컬럼 추가 (같은 `plan_number`를 가진 플랜들은 같은 메모 공유)
- 옵션 2: 별도 `plan_memos` 테이블 생성 (`plan_number` 기준)

### 범위 조정

```typescript
type PlanRange = {
  planId: string;
  startPageOrTime: number;
  endPageOrTime: number;
};
```

**업데이트 대상:**
- 같은 `plan_number`를 가진 모든 플랜의 `planned_start_page_or_time`, `planned_end_page_or_time`

## 🔄 사용자 인터랙션

### 메모 기능

1. **메모 작성**
   - 메모 아이콘 클릭 → 모달 열림
   - 텍스트 입력
   - 저장 버튼 클릭

2. **메모 수정**
   - 메모 아이콘 클릭 → 기존 메모 표시
   - 텍스트 수정
   - 저장 버튼 클릭

3. **메모 조회**
   - 메모 아이콘 호버 → 툴팁에 미리보기
   - 메모 아이콘 클릭 → 전체 메모 확인

4. **메모 삭제**
   - 메모 입력란 비우기
   - 저장 버튼 클릭

### 범위 조정 기능

1. **범위 조정 시작**
   - 설정 아이콘 클릭 → 모달 열림
   - 현재 범위 확인

2. **조정 방식 선택**
   - 일괄 조정 / 개별 조정 / 스마트 조정 선택
   - 새 범위 입력

3. **미리보기 확인**
   - 조정 후 미리보기 확인
   - 원래대로 되돌리기 가능

4. **적용**
   - 적용 버튼 클릭
   - 진행 중인 플랜 일시정지 알림
   - 범위 업데이트 및 진행률 재계산

## ⚠️ 주의사항 및 검증

### 범위 조정 시 검증

1. **범위 유효성**
   - 시작 < 종료
   - 시작 >= 0
   - 종료 <= 총량

2. **블록 간 겹침 방지**
   - 블록 간 범위 겹침 없음
   - 순서 유지 (block_index 기준)

3. **진행 중인 플랜 처리**
   - 범위 조정 시 진행 중인 플랜 일시정지
   - 기존 진행률 유지
   - 새로운 범위에 맞게 진행률 조정

4. **총량 초과 방지**
   - 모든 블록의 범위 합이 총량 초과하지 않도록 검증

### 메모 제한

- 최대 500자
- 줄바꿈 허용
- 특수 문자 허용

## 📱 반응형 디자인

### 모바일 뷰

```
┌─────────────────────────────┐
│ 📚 수학 개념 정리            │
│ (1-3회차)                   │
│                             │
│ [📝] [⚙️] [📋]              │
│   ↑ 작은 아이콘 버튼         │
│                             │
└─────────────────────────────┘
```

메모/범위 조정 모달은 모바일에서 전체 화면 또는 바텀 시트 형태로 표시:

```
┌─────────────────────────────┐
│ 플랜 메모           [✕]     │
├─────────────────────────────┤
│                             │
│ [텍스트 입력 영역]           │
│                             │
│ ...                         │
│                             │
│ [저장]                      │
│                             │
└─────────────────────────────┘
```

## ✅ 체크리스트

### 구현 필요 사항

- [ ] PlanGroupActions 컴포넌트 구현
- [ ] PlanMemoModal 컴포넌트 구현
- [ ] PlanRangeAdjustModal 컴포넌트 구현
- [ ] 메모 저장/조회 서버 액션 구현
- [ ] 범위 조정 서버 액션 구현
- [ ] 메모 아이콘 상태 표시 (배지)
- [ ] 메모 툴팁 (호버 시 미리보기)
- [ ] 범위 조정 검증 로직
- [ ] 진행 중인 플랜 처리 로직
- [ ] 반응형 스타일링

### 데이터 처리

- [ ] 플랜 메모 저장/조회 로직
- [ ] 같은 `plan_number`를 가진 플랜들의 범위 일괄 업데이트
- [ ] 범위 조정 시 진행률 재계산
- [ ] 블록 간 범위 겹침 검증

### UI/UX

- [ ] 메모 템플릿 제공
- [ ] 빠른 범위 조정 버튼
- [ ] 범위 조정 미리보기
- [ ] 로딩 상태 처리
- [ ] 에러 상태 처리
- [ ] 성공 피드백 (토스트 등)

