# TimeLevelUp 프로젝트 기획서

> 학습 플랜 및 성적 관리 시스템 v1.0

---

## 목차

1. [프로젝트 개요](#1-프로젝트-개요)
2. [시스템 아키텍처](#2-시스템-아키텍처)
3. [사용자 역할](#3-사용자-역할)
4. [도메인 구조](#4-도메인-구조)
5. [핵심 기능](#5-핵심-기능)
6. [데이터 모델](#6-데이터-모델)
7. [사용자 흐름](#7-사용자-흐름)
8. [기술 스택](#8-기술-스택)

---

## 1. 프로젝트 개요

### 1.1 서비스 소개

**TimeLevelUp**은 학원(학습 관리 기관)을 위한 종합 학습 관리 플랫폼입니다.

학생들의 학습 플랜 수립, 실행, 추적을 지원하며 관리자(학원)와 학부모가 함께 학생의 학습을 관리할 수 있는 멀티 테넌트 SaaS 서비스입니다.

### 1.2 핵심 가치

| 구분 | 내용 |
|------|------|
| **체계적인 학습 관리** | 7단계 위자드를 통한 세밀한 플랜 수립 |
| **실시간 학습 추적** | 타이머 기반 학습 시간 측정 및 진도 관리 |
| **데이터 기반 분석** | 성적 추이, 출석률, 학습 패턴 분석 |
| **협업 학습 관리** | 관리자-학생-학부모 3자 연계 시스템 |
| **유연한 캠프 운영** | 윈터/썸머 캠프 등 집중 학습 프로그램 지원 |

### 1.3 대상 사용자

- **학원/학습관**: 학생 관리 및 커리큘럼 운영
- **학생**: 개인 학습 플랜 수립 및 실행
- **학부모**: 자녀 학습 현황 모니터링

---

## 2. 시스템 아키텍처

### 2.1 기술 스택

```
┌─────────────────────────────────────────────────────────────┐
│                        Frontend                              │
│  Next.js 16 (App Router) + TypeScript 5 + Tailwind CSS 4    │
├─────────────────────────────────────────────────────────────┤
│                     State Management                         │
│        React Query (서버 상태) + Context API (클라이언트)    │
├─────────────────────────────────────────────────────────────┤
│                        Backend                               │
│    Next.js Server Actions + API Routes + Supabase           │
├─────────────────────────────────────────────────────────────┤
│                        Database                              │
│          Supabase (PostgreSQL + Row Level Security)          │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 디렉토리 구조

```
eduatalk/
├── app/                          # Next.js App Router
│   ├── (admin)/                  # 관리자 영역 (/admin/*)
│   ├── (student)/                # 학생 영역 (/dashboard, /today, /plan, etc.)
│   ├── (parent)/                 # 학부모 영역 (/parent/*)
│   ├── (superadmin)/             # 슈퍼관리자 영역
│   ├── api/                      # API Routes
│   └── actions/                  # 공통 Server Actions
├── lib/                          # 핵심 비즈니스 로직
│   ├── domains/                  # 23개 도메인 모듈
│   ├── supabase/                 # DB 클라이언트
│   ├── auth/                     # 인증/권한
│   ├── data/                     # 데이터 fetching
│   └── hooks/                    # Custom React Hooks
├── components/                   # UI 컴포넌트
│   ├── atoms/                    # 기본 컴포넌트
│   ├── molecules/                # 조합 컴포넌트
│   └── organisms/                # 복합 컴포넌트
└── supabase/migrations/          # DB 마이그레이션
```

### 2.3 멀티 테넌트 구조

```
┌─────────────────────────────────────────────────────────────┐
│                    TimeLevelUp Platform                      │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │  학원 A     │  │  학원 B     │  │  학원 C     │ ...     │
│  │  (Tenant)   │  │  (Tenant)   │  │  (Tenant)   │         │
│  ├─────────────┤  ├─────────────┤  ├─────────────┤         │
│  │ - 관리자    │  │ - 관리자    │  │ - 관리자    │         │
│  │ - 학생들    │  │ - 학생들    │  │ - 학생들    │         │
│  │ - 학부모들  │  │ - 학부모들  │  │ - 학부모들  │         │
│  │ - 설정      │  │ - 설정      │  │ - 설정      │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
└─────────────────────────────────────────────────────────────┘
```

---

## 3. 사용자 역할

### 3.1 역할 정의

| 역할 | 설명 | 주요 권한 |
|------|------|----------|
| **슈퍼관리자** | 플랫폼 전체 관리 | 테넌트 생성/관리, 교육과정 설정 |
| **관리자 (Admin)** | 학원 운영자 | 학생 관리, 플랜 관리, 출석/성적 관리, 캠프 운영 |
| **학생 (Student)** | 서비스 주 사용자 | 플랜 생성/실행, 콘텐츠 등록, 학습 기록 |
| **학부모 (Parent)** | 자녀 학습 모니터링 | 학습 현황 조회, 출석 기록 확인, 리포트 열람 |

### 3.2 역할별 주요 페이지

#### 학생 페이지 (Student)

| 경로 | 기능 |
|------|------|
| `/dashboard` | 대시보드 - 오늘의 학습 개요 |
| `/today` | 오늘의 학습 - 컨테이너 기반 플랜 관리, 타이머 |
| `/plan` | 플랜 관리 - 플랜그룹 목록, 생성, 수정 |
| `/plan/calendar` | 캘린더 뷰 - 일간/주간/월간 플랜 시각화 |
| `/plan/new-group` | 플랜 생성 위자드 (7단계) |
| `/contents` | 콘텐츠 관리 - 교재/강의/커스텀 콘텐츠 등록 |
| `/scores` | 성적 관리 - 모의고사/내신 점수 입력 및 조회 |
| `/blocks` | 블록 관리 - 시간표/일정 설정 |
| `/attendance` | 출석 - QR 체크인 |
| `/camp` | 캠프 학습 - 캠프 플랜 실행 |
| `/analysis` | 학습 분석 - 코칭 리포트 |
| `/report` | 리포트 - 종합 학습 보고서 |

#### 관리자 페이지 (Admin)

| 경로 | 기능 |
|------|------|
| `/admin/dashboard` | 관리자 대시보드 |
| `/admin/students` | 학생 관리 - CRUD, 반/분반 관리 |
| `/admin/students/[id]/plans` | 학생별 플랜 관리 - 대리 생성, 이월 처리 |
| `/admin/plan-groups` | 전체 플랜그룹 관리 |
| `/admin/attendance` | 출석 관리 - 기록 조회/수정, 통계 |
| `/admin/consulting` | 상담 관리 |
| `/admin/subjects` | 과목/교과 관리 |
| `/admin/schools` | 학교 관리 |
| `/admin/master-books` | 마스터 교재 관리 |
| `/admin/master-lectures` | 마스터 강의 관리 |
| `/admin/master-custom-contents` | 마스터 커스텀 콘텐츠 |
| `/admin/content-metadata` | 콘텐츠 메타데이터 관리 |
| `/admin/camp-templates` | 캠프 템플릿 관리 |
| `/admin/camp-students` | 캠프 학생 관리 |
| `/admin/camp-plans` | 캠프 플랜 관리 |
| `/admin/camp-live` | 캠프 라이브 현황 |
| `/admin/camp-alerts` | 캠프 알림 관리 |
| `/admin/sms` | SMS 발송 관리 |
| `/admin/parent-links` | 학부모 연결 관리 |
| `/admin/tenant` | 학원(테넌트) 설정 |
| `/admin/settings` | 시스템 설정 - 권한, 스케줄러, 알림 |
| `/admin/time-management` | 시간 관리 - 제외일, 학원 일정 |
| `/admin/reschedule-logs` | 일정 변경 로그 |
| `/admin/reports` | 관리자 리포트 |
| `/admin/compare` | 비교 분석 |
| `/admin/tools` | 관리 도구 |

#### 학부모 페이지 (Parent)

| 경로 | 기능 |
|------|------|
| `/parent/dashboard` | 학부모 대시보드 |
| `/parent/scores` | 자녀 성적 조회 |
| `/parent/goals` | 학습 목표 확인 |
| `/parent/history` | 학습 이력 |
| `/parent/report` | 리포트 열람 |
| `/parent/settings` | 설정 |

---

## 4. 도메인 구조

### 4.1 도메인 개요

23개의 도메인으로 비즈니스 로직이 분리되어 있습니다.

```
lib/domains/
├── plan/              # 플랜 (핵심 도메인)
├── admin-plan/        # 관리자 플랜 관리
├── today/             # 오늘 학습 (컨테이너 기반)
├── camp/              # 캠프 (가장 큰 도메인)
├── student/           # 학생 관리
├── content/           # 콘텐츠 (학생용)
├── master-content/    # 마스터 콘텐츠 (관리자용)
├── content-metadata/  # 콘텐츠 메타데이터
├── score/             # 성적 (모의/학교/내신)
├── attendance/        # 출석
├── block/             # 블록 (시간표)
├── subject/           # 과목/교과
├── school/            # 학교
├── goal/              # 학습 목표
├── parent/            # 학부모
├── tenant/            # 테넌트 (학원)
├── user/              # 사용자 관리
├── auth/              # 인증
├── sms/               # SMS 발송
├── qrCode/            # QR코드 출석
├── analysis/          # 분석/코칭
├── settings/          # 설정
└── superadmin/        # 슈퍼관리자
```

### 4.2 핵심 도메인 상세

#### Plan 도메인 (플랜)

**역할**: 학습 플랜의 생성, 수정, 실행을 담당하는 핵심 도메인

**주요 타입**:

```typescript
// 플랜 그룹 (메타데이터)
type PlanGroup = {
  id: string;
  student_id: string;
  name: string;
  plan_purpose: "내신대비" | "모의고사" | "수능" | "기타";
  period_start: string;  // 시작일
  period_end: string;    // 종료일
  target_date: string;   // D-day (시험일)
  block_set_id: string;  // 시간표 템플릿
  status: PlanStatus;
  scheduler_type: "1730_timetable";
  scheduler_options: SchedulerOptions;
  daily_schedule: DailyScheduleInfo[];  // 일별 스케줄
  // 캠프 관련
  plan_type: "individual" | "integrated" | "camp";
  camp_template_id?: string;
  use_slot_mode?: boolean;  // 슬롯 모드 사용 여부
  content_slots?: SlotTemplate[];
};

// 개별 플랜 항목
type Plan = {
  id: string;
  plan_group_id: string;
  plan_date: string;      // 학습일
  block_index: number;    // 시간대 순서
  content_type: "book" | "lecture" | "custom";
  content_id: string;
  start_time: string;     // 시작 시간
  end_time: string;       // 종료 시간
  planned_start_page_or_time: number;  // 계획 시작 범위
  planned_end_page_or_time: number;    // 계획 종료 범위
  completed_amount: number;
  progress: number;
  status: "pending" | "in_progress" | "completed";
};
```

#### Camp 도메인 (캠프)

**역할**: 집중 학습 프로그램(윈터캠프, 썸머캠프 등) 운영

**주요 기능**:
- 캠프 템플릿 관리 (슬롯 템플릿 포함)
- 캠프 초대 및 참여 관리
- 캠프 전용 학습 진행
- 캠프 알림 및 리마인더
- 캠프/일반 플랜 통합 활성화 제어

**주요 타입**:

```typescript
type CampTemplate = {
  id: string;
  name: string;
  program_type: "윈터캠프" | "썸머캠프" | "파이널캠프" | "기타";
  template_data: JSON;
  slot_templates: SlotTemplate[];
  camp_start_date: string;
  camp_end_date: string;
  camp_location: string;
  reminder_settings: CampReminderSettings;
  allow_normal_plan_activation: boolean;
};

type CampInvitation = {
  id: string;
  camp_template_id: string;
  student_id: string;
  status: "pending" | "accepted" | "declined" | "expired";
  invited_at: string;
  expires_at: string;
};
```

#### Student 도메인 (학생)

**역할**: 학생 정보 및 관계 관리

**주요 기능**:
- 학생 CRUD
- 반/분반 관리
- 학부모 연결
- 상담 기록
- 알림 관리
- 세션 관리

#### Score 도메인 (성적)

**역할**: 3종 성적 관리 (모의고사, 학교 성적, 내신)

**주요 기능**:
- 모의고사 점수 입력/조회
- 학교 성적 입력/조회
- 내신 성적 입력/조회
- 과목별 추이 분석
- 평균 등급 계산

#### Attendance 도메인 (출석)

**역할**: 출석 기록 및 통계

**주요 기능**:
- QR코드 출석 체크
- 수동 출석 기록
- 출석 통계 계산
- SMS 자동 발송 연동
- 출석 기록 검증

---

## 5. 핵심 기능

### 5.1 플랜 생성 위자드 (7단계)

학생이 자신만의 학습 플랜을 생성하는 핵심 기능입니다.

```
┌─────────────────────────────────────────────────────────────┐
│                    7단계 플랜 생성 위자드                     │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Step 1: 기본 정보                                          │
│  └─ 플랜 이름, 블록세트(시간표), 학습 기간, 요일 선택        │
│                                                             │
│  Step 2: 블록 및 제외일                                     │
│  └─ 학습 시간대 설정, 학원 스케줄 임포트, 제외일 지정        │
│                                                             │
│  Step 3: 스케줄 확인                                        │
│  └─ 주간별 스케줄 미리보기, 타임라인 시각화                  │
│                                                             │
│  Step 4: 콘텐츠 선택                                        │
│  └─ 마스터/학생 콘텐츠 선택, 슬롯 모드 지원                  │
│  ※ 템플릿/캠프 모드는 여기서 종료                           │
│                                                             │
│  Step 5: 추천 콘텐츠                                        │
│  └─ AI 기반 콘텐츠 추천, 과목 균형 차트                     │
│                                                             │
│  Step 6: 최종 검토                                          │
│  └─ 콘텐츠 할당 확인, 전략/취약 과목 에디터                  │
│                                                             │
│  Step 7: 결과 확인                                          │
│  └─ 생성된 플랜 목록, 활성화 다이얼로그                      │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**위자드 특징**:
- **오토세이브**: 2초 디바운스 자동 저장
- **키보드 네비게이션**: Alt+→/← (단계 이동), Alt+1~7 (직접 이동)
- **Context 분리**: 데이터/스텝/검증 Context 분리로 성능 최적화
- **동적 임포트**: Step 컴포넌트 lazy loading
- **스켈레톤 UI**: 단계별 맞춤 로딩 UI

**모드별 분기**:

| 모드 | 종료 단계 | 설명 |
|------|----------|------|
| 일반 모드 | Step 7 | 전체 플로우 |
| 템플릿 모드 | Step 4 | 추천/최종검토/결과 스킵 |
| 캠프 모드 (학생) | Step 4 | 콘텐츠 선택 후 종료 |
| 관리자 모드 | Step 7 | 관리자가 대신 생성 |
| 관리자 continue 모드 | Step 7 | 기존 데이터 이어서 편집 |

### 5.2 슬롯 모드 (2단계 콘텐츠 선택)

관리자가 슬롯 템플릿을 구성하면 학생이 슬롯에 콘텐츠를 연결하는 방식입니다.

```
┌─────────────────────────────────────────────────────────────┐
│                      슬롯 모드 흐름                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [관리자]                                                   │
│  ┌─────────────────────────────────────────┐               │
│  │  슬롯 템플릿 편집                        │               │
│  │  - 슬롯 1: 국어 (09:00-10:00)           │               │
│  │  - 슬롯 2: 수학 (10:00-12:00)           │               │
│  │  - 슬롯 3: 영어 (13:00-14:00)           │               │
│  └─────────────────────────────────────────┘               │
│                         ↓                                   │
│  [학생]                                                     │
│  ┌─────────────────────────────────────────┐               │
│  │  콘텐츠 연결                             │               │
│  │  - 슬롯 1 → "비문학 독해 교재"           │               │
│  │  - 슬롯 2 → "수학 인강 1-10강"          │               │
│  │  - 슬롯 3 → "영어 단어장"               │               │
│  └─────────────────────────────────────────┘               │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**슬롯 관계 기능**:
- **연결 슬롯 (Linked)**: 함께 배치되어야 하는 슬롯
- **배타 슬롯 (Exclusive)**: 같은 시간대에 배치되면 안 되는 슬롯
- **AI 추천**: 학생 수준에 맞는 슬롯 자동 추천
- **드래그앤드롭**: 슬롯 순서 변경 지원

### 5.3 컨테이너 기반 플랜 관리 (Today)

오늘의 학습을 효율적으로 관리하기 위한 컨테이너 시스템입니다.

```
┌─────────────────────────────────────────────────────────────┐
│                  오늘의 학습 (Today)                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────┐               │
│  │  Unfinished (미완료)                     │  우선순위 1   │
│  │  - 어제 완료하지 못한 플랜들             │               │
│  │  - 이월된 플랜 표시                      │               │
│  └─────────────────────────────────────────┘               │
│                                                             │
│  ┌─────────────────────────────────────────┐               │
│  │  Daily (일간)                            │  우선순위 2   │
│  │  - 오늘 해야 할 플랜들                   │               │
│  │  - 타임라인 시각화                       │               │
│  └─────────────────────────────────────────┘               │
│                                                             │
│  ┌─────────────────────────────────────────┐               │
│  │  Weekly (주간)                           │  우선순위 3   │
│  │  - 이번 주 내 해야 할 플랜들             │               │
│  │  - 유연한 스케줄링 가능                  │               │
│  └─────────────────────────────────────────┘               │
│                                                             │
│  [기능]                                                     │
│  - 컨테이너 간 플랜 이동 (드래그앤드롭)                     │
│  - Ad-hoc 플랜 추가                                        │
│  - 하루 종료 처리 (processEndOfDay)                        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 5.4 타이머 시스템

학습 시간을 정밀하게 추적하는 상태 머신 기반 타이머입니다.

```
┌─────────────────────────────────────────────────────────────┐
│                    타이머 상태 머신                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                    ┌──────────────┐                        │
│                    │  NOT_STARTED │                        │
│                    └──────┬───────┘                        │
│                           │ START                          │
│                           ▼                                 │
│                    ┌──────────────┐                        │
│              ┌────▶│   RUNNING    │◀────┐                  │
│              │     └──────┬───────┘     │                  │
│              │            │             │                  │
│         RESUME      PAUSE │        COMPLETE                │
│              │            │             │                  │
│              │            ▼             │                  │
│         ┌────┴───────────────┐         │                  │
│         │       PAUSED       ├─────────┘                  │
│         └─────────┬──────────┘     COMPLETE               │
│                   │                                        │
│                   └──────────▶ ┌──────────────┐           │
│                                │  COMPLETED   │           │
│                                └──────────────┘           │
│                                                             │
│  [기능]                                                     │
│  - 오프라인 큐 시스템 (네트워크 끊김 시 로컬 저장)          │
│  - 멀티 디바이스 세션 충돌 감지                            │
│  - 일시정지 시간 별도 추적                                 │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 5.5 이월(Carryover) 시스템

완료하지 못한 플랜을 다음 날로 이월하는 시스템입니다.

```
┌─────────────────────────────────────────────────────────────┐
│                    이월 시스템                               │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [이월 규칙]                                                │
│  - 완료되지 않은 플랜 → 다음 학습일로 자동 이월             │
│  - 이월 횟수 추적                                          │
│  - 시각적 이월 표시 (배지)                                  │
│                                                             │
│  [관리자 기능]                                              │
│  - getCarryoverPreview: 이월 미리보기                      │
│  - runCarryoverForStudent: 학생별 이월 실행                │
│  - runBulkCarryover: 대량 이월 처리                        │
│                                                             │
│  [Ad-hoc 플랜]                                              │
│  - 예정에 없던 즉석 플랜 추가                               │
│  - 이월 플랜과 구분 표시                                    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 5.6 캘린더 뷰

플랜을 시각적으로 확인하고 관리하는 캘린더입니다.

```
┌─────────────────────────────────────────────────────────────┐
│                    캘린더 뷰                                 │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────┬─────────┬─────────┐                           │
│  │  일간   │  주간   │  월간   │  ← 뷰 모드 선택           │
│  └─────────┴─────────┴─────────┘                           │
│                                                             │
│  [일간 뷰]                                                  │
│  ┌─────────────────────────────────────────┐               │
│  │ 09:00  ████████  수학 인강 1강          │               │
│  │ 10:00  ████████  수학 인강 2강          │               │
│  │ 11:00  ░░░░░░░░  (점심시간)             │               │
│  │ 12:00  ████████  국어 교재 p.1-20       │               │
│  │ 13:00  ████████  영어 단어 Day 1        │               │
│  └─────────────────────────────────────────┘               │
│                                                             │
│  [통합 표시]                                                │
│  - 일반 플랜 + 캠프 플랜 함께 표시                         │
│  - 상태별 색상 구분 (완료/진행중/대기)                      │
│  - 타임라인 아이템 클릭 시 상세 정보                        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 5.7 출석 관리

다양한 방식의 출석 체크를 지원합니다.

```
┌─────────────────────────────────────────────────────────────┐
│                    출석 관리 시스템                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [체크 방식]                                                │
│  ┌───────────┬───────────┬───────────┐                     │
│  │    QR     │   수동    │   자동    │                     │
│  │  스캔     │   입력    │   인식    │                     │
│  └───────────┴───────────┴───────────┘                     │
│                                                             │
│  [출석 상태]                                                │
│  - 출석 / 지각 / 조퇴 / 결석 / 기타                        │
│                                                             │
│  [연동 기능]                                                │
│  - SMS 자동 발송 (학부모에게 출석 알림)                     │
│  - 출석 통계 자동 계산                                      │
│  - 출석률 기반 위험 지수 분석                               │
│                                                             │
│  [통계]                                                     │
│  - 일별/주별/월별 출석률                                    │
│  - 학생별 출석 패턴 분석                                    │
│  - 지각/조퇴 추이                                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 5.8 성적 관리

3종 성적을 통합 관리합니다.

```
┌─────────────────────────────────────────────────────────────┐
│                    성적 관리 시스템                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────┐               │
│  │  모의고사 (MockScore)                    │               │
│  │  - 전국 모의고사 점수                    │               │
│  │  - 백분위, 등급, 원점수                  │               │
│  │  - 과목별 추이 분석                      │               │
│  └─────────────────────────────────────────┘               │
│                                                             │
│  ┌─────────────────────────────────────────┐               │
│  │  학교 성적 (SchoolScore)                 │               │
│  │  - 중간/기말고사 성적                    │               │
│  │  - 학교별 석차, 등급                     │               │
│  └─────────────────────────────────────────┘               │
│                                                             │
│  ┌─────────────────────────────────────────┐               │
│  │  내신 (InternalScore)                    │               │
│  │  - 내신 등급                             │               │
│  │  - 과목별 세부 사항                      │               │
│  └─────────────────────────────────────────┘               │
│                                                             │
│  [분석 기능]                                                │
│  - 과목별 성적 추이 그래프                                  │
│  - 평균 등급 자동 계산                                      │
│  - 취약 과목 자동 도출                                      │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 6. 데이터 모델

### 6.1 핵심 테이블 관계

```
┌─────────────────────────────────────────────────────────────┐
│                    핵심 테이블 관계도                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  tenants (학원)                                             │
│     │                                                       │
│     ├──▶ students (학생)                                   │
│     │        │                                             │
│     │        ├──▶ plan_groups (플랜그룹)                   │
│     │        │        │                                    │
│     │        │        ├──▶ student_plans (개별 플랜)       │
│     │        │        ├──▶ plan_group_contents (콘텐츠)    │
│     │        │        └──▶ plan_group_items (논리 항목)    │
│     │        │                                             │
│     │        ├──▶ student_books (교재)                     │
│     │        ├──▶ student_lectures (강의)                  │
│     │        ├──▶ student_custom_contents (커스텀)         │
│     │        │                                             │
│     │        ├──▶ mock_scores (모의고사)                   │
│     │        ├──▶ school_scores (학교성적)                 │
│     │        ├──▶ internal_scores (내신)                   │
│     │        │                                             │
│     │        ├──▶ attendance_records (출석)                │
│     │        ├──▶ academies (학원 일정)                    │
│     │        └──▶ plan_exclusions (제외일)                 │
│     │                                                       │
│     ├──▶ camp_templates (캠프 템플릿)                      │
│     │        │                                             │
│     │        └──▶ camp_invitations (초대)                  │
│     │                                                       │
│     ├──▶ master_books (마스터 교재)                        │
│     │        └──▶ book_details (상세)                      │
│     │                                                       │
│     ├──▶ master_lectures (마스터 강의)                     │
│     │        └──▶ lecture_episodes (에피소드)              │
│     │                                                       │
│     ├──▶ block_sets (블록세트)                             │
│     │        └──▶ blocks (블록)                            │
│     │                                                       │
│     └──▶ subjects / subject_groups (과목/교과)             │
│                                                             │
│  parents (학부모)                                           │
│     │                                                       │
│     └──▶ parent_student_links (학생 연결)                  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 6.2 주요 테이블 설명

| 테이블 | 설명 |
|--------|------|
| `tenants` | 학원/학습관 정보 |
| `students` | 학생 기본 정보, 학교, 학년 등 |
| `plan_groups` | 플랜 그룹 메타데이터 (기간, 목적, 스케줄러 옵션) |
| `student_plans` | 개별 플랜 항목 (일자, 시간, 콘텐츠, 진도) |
| `plan_group_contents` | 플랜그룹에 포함된 콘텐츠 목록 |
| `plan_group_items` | 논리 플랜 아이템 (설계 단위) |
| `student_books` | 학생 소유 교재 |
| `student_lectures` | 학생 소유 강의 |
| `master_books` | 서비스 제공 마스터 교재 |
| `master_lectures` | 서비스 제공 마스터 강의 |
| `book_details` | 교재 상세 (대단원, 중단원, 페이지) |
| `lecture_episodes` | 강의 에피소드 정보 |
| `mock_scores` | 모의고사 점수 |
| `school_scores` | 학교 시험 성적 |
| `attendance_records` | 출석 기록 |
| `camp_templates` | 캠프 템플릿 |
| `camp_invitations` | 캠프 초대 |
| `block_sets` | 시간표 템플릿 |
| `blocks` | 개별 시간 블록 |
| `academies` | 학원 정보 |
| `academy_schedules` | 학원 일정 |
| `plan_exclusions` | 플랜 제외일 |

---

## 7. 사용자 흐름

### 7.1 학생 온보딩

```
┌─────────────────────────────────────────────────────────────┐
│                    학생 온보딩 흐름                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  1. 회원가입                                                │
│     └─ 이메일/비밀번호 또는 소셜 로그인                     │
│                                                             │
│  2. 학생 설정 (/student-setup)                              │
│     ├─ 기본 정보 입력 (이름, 학교, 학년)                    │
│     ├─ 테넌트(학원) 선택 또는 입력                          │
│     └─ 학습 목표 설정                                       │
│                                                             │
│  3. 콘텐츠 등록 (/contents)                                 │
│     ├─ 마스터 콘텐츠에서 선택                               │
│     └─ 또는 커스텀 콘텐츠 직접 등록                         │
│                                                             │
│  4. 블록세트 설정 (/blocks)                                 │
│     ├─ 기본 시간표 선택                                     │
│     └─ 학원 일정 등록                                       │
│                                                             │
│  5. 첫 플랜 생성 (/plan/new-group)                          │
│     └─ 7단계 위자드 진행                                    │
│                                                             │
│  6. 학습 시작 (/today)                                      │
│     └─ 오늘의 플랜 실행                                     │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 7.2 일일 학습 흐름

```
┌─────────────────────────────────────────────────────────────┐
│                    일일 학습 흐름                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  오전                                                       │
│  ┌─────────────────────────────────────────┐               │
│  │  1. 출석 체크 (QR 스캔)                  │               │
│  │  2. 오늘의 플랜 확인 (/today)            │               │
│  │  3. 미완료 플랜 확인 (Unfinished)        │               │
│  └─────────────────────────────────────────┘               │
│                                                             │
│  학습 중                                                    │
│  ┌─────────────────────────────────────────┐               │
│  │  4. 플랜 선택 → 타이머 시작              │               │
│  │  5. 학습 진행                            │               │
│  │  6. 필요시 일시정지                      │               │
│  │  7. 학습 완료 → 진도 입력                │               │
│  │  8. 다음 플랜으로 이동                   │               │
│  └─────────────────────────────────────────┘               │
│                                                             │
│  저녁                                                       │
│  ┌─────────────────────────────────────────┐               │
│  │  9. 하루 학습 마무리                     │               │
│  │  10. 미완료 플랜 → 이월 처리             │               │
│  │  11. 출석 종료 체크                      │               │
│  └─────────────────────────────────────────┘               │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 7.3 관리자 운영 흐름

```
┌─────────────────────────────────────────────────────────────┐
│                    관리자 운영 흐름                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [일간 업무]                                                │
│  ├─ 출석 현황 확인 (/admin/attendance)                     │
│  ├─ 학습 진행률 모니터링 (/admin/dashboard)                │
│  └─ 이상 징후 학생 확인 (위험 지수)                        │
│                                                             │
│  [주간 업무]                                                │
│  ├─ 플랜 이월 처리 (/admin/students/[id]/plans)            │
│  ├─ 상담 진행 및 기록 (/admin/consulting)                  │
│  └─ SMS 발송 (/admin/sms)                                  │
│                                                             │
│  [정기 업무]                                                │
│  ├─ 학생 관리 (등록/수정/반 배정)                          │
│  ├─ 콘텐츠 관리 (마스터 교재/강의 등록)                    │
│  ├─ 캠프 운영 (템플릿 생성, 초대 발송)                     │
│  └─ 성적 입력 및 분석                                      │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 7.4 캠프 운영 흐름

```
┌─────────────────────────────────────────────────────────────┐
│                    캠프 운영 흐름                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [준비 단계 - 관리자]                                       │
│  1. 캠프 템플릿 생성 (/admin/camp-templates)                │
│     ├─ 기본 정보 (이름, 기간, 장소)                         │
│     ├─ 슬롯 템플릿 구성                                     │
│     └─ 리마인더 설정                                        │
│                                                             │
│  2. 학생 초대 발송                                          │
│     └─ 초대 상태: pending → accepted/declined               │
│                                                             │
│  [진행 단계 - 학생]                                         │
│  3. 초대 수락                                               │
│  4. 슬롯에 콘텐츠 연결 (Step 4까지)                         │
│  5. 캠프 플랜 자동 생성                                     │
│  6. 캠프 학습 진행 (/camp/today → /today로 통합)            │
│                                                             │
│  [모니터링 - 관리자]                                        │
│  7. 캠프 라이브 현황 확인 (/admin/camp-live)                │
│  8. 캠프 알림 발송 (/admin/camp-alerts)                     │
│  9. 진행률 모니터링                                         │
│                                                             │
│  [종료 단계]                                                │
│  10. 캠프 종료 처리                                         │
│  11. 성과 리포트 생성                                       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 8. 기술 스택

### 8.1 프론트엔드

| 기술 | 버전 | 용도 |
|------|------|------|
| Next.js | 16 | 프레임워크 (App Router) |
| React | 19 | UI 라이브러리 |
| TypeScript | 5 | 타입 안전성 |
| Tailwind CSS | 4 | 스타일링 |
| React Query | 5 | 서버 상태 관리 |
| Zustand | - | 클라이언트 상태 (타이머 등) |
| @dnd-kit | - | 드래그앤드롭 |
| Recharts | - | 차트 시각화 |
| date-fns | - | 날짜 처리 |
| Zod | - | 스키마 검증 |

### 8.2 백엔드

| 기술 | 용도 |
|------|------|
| Next.js Server Actions | 서버 로직 |
| Next.js API Routes | REST API |
| Supabase | BaaS (DB, Auth, Storage) |
| PostgreSQL | 데이터베이스 |
| Row Level Security | 데이터 접근 제어 |

### 8.3 인프라

| 기술 | 용도 |
|------|------|
| Vercel | 호스팅 |
| Supabase Cloud | 데이터베이스 호스팅 |

### 8.4 개발 도구

| 도구 | 용도 |
|------|------|
| pnpm | 패키지 매니저 |
| ESLint | 코드 린팅 |
| Vitest | 테스트 프레임워크 |
| Playwright | E2E 테스트 |

---

## 부록

### A. 플랜 상태 전이표

| 현재 상태 | 가능한 전이 |
|-----------|-------------|
| `draft` | → `saved` |
| `saved` | → `active`, `draft` |
| `active` | → `paused`, `cancelled` |
| `paused` | → `active`, `cancelled` |
| `pending` | → `in_progress`, `cancelled` |
| `in_progress` | → `completed`, `paused` |
| `completed` | (종료 상태) |
| `cancelled` | (종료 상태) |

### B. 콘텐츠 타입

| 타입 | 설명 |
|------|------|
| `book` | 교재 |
| `lecture` | 강의 |
| `custom` | 커스텀 콘텐츠 |

### C. 캠프 프로그램 유형

| 유형 | 설명 |
|------|------|
| `윈터캠프` | 겨울 집중 캠프 |
| `썸머캠프` | 여름 집중 캠프 |
| `파이널캠프` | 시험 직전 집중 캠프 |
| `기타` | 기타 캠프 |

### D. 출석 상태

| 상태 | 설명 |
|------|------|
| `출석` | 정상 출석 |
| `지각` | 늦은 출석 |
| `조퇴` | 일찍 퇴실 |
| `결석` | 출석하지 않음 |
| `기타` | 기타 사유 |

---

*문서 버전: 1.0*
*마지막 업데이트: 2025-12-27*
