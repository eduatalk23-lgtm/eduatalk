# 캠프 템플릿 학생 입력 제한 수정

## 📋 작업 개요

캠프 템플릿에서 "학생 입력 허용"이 체크되지 않은 필드들이 학생이 캠프 템플릿을 작성할 때 수정 가능한 문제를 수정했습니다.

## 🐛 문제 분석

### 문제 상황

- 캠프 템플릿에서 "학생 입력 허용"이 체크되지 않은 필드는 수정 불가능해야 함
- 하지만 학생이 캠프 템플릿을 작성하려고 하면 모든 필드가 수정 가능한 상태였음

### 원인

`BasePlanWizard` 컴포넌트에서 `Step1BasicInfo`에 `isCampMode` prop을 전달하지 않아서 발생한 문제입니다.

**영향받는 파일**:
- `app/(student)/plan/new-group/_components/BasePlanWizard.tsx`

### 문제 상세

1. `Step1BasicInfo`는 `isCampMode` prop을 받아서 `useFieldPermission` 훅에 전달
2. `useFieldPermission` 훅은 `canStudentInput` 함수를 사용하여 필드 입력 가능 여부를 체크
3. `canStudentInput` 함수는 `isCampMode`가 `false`이면 항상 `true`를 반환:
   ```typescript
   // 일반 모드에서는 항상 허용
   if (!isCampMode) return true;
   ```
4. `BasePlanWizard`에서 `isCampMode` prop이 전달되지 않아 기본값 `false`로 동작
5. 결과적으로 모든 필드가 편집 가능한 상태가 됨

## ✅ 수정 내용

### `BasePlanWizard.tsx`

`Step1BasicInfo` 컴포넌트에 `isCampMode={mode.isCampMode}` prop을 추가했습니다.

```typescript
// 수정 전
<Step1BasicInfo
  blockSets={blockSets}
  onBlockSetsLoaded={onBlockSetsLoaded}
  isTemplateMode={isTemplateMode}
  editable={!mode.isAdminContinueMode}
  campTemplateInfo={...}
  fieldErrors={fieldErrors}
/>

// 수정 후
<Step1BasicInfo
  blockSets={blockSets}
  onBlockSetsLoaded={onBlockSetsLoaded}
  isTemplateMode={isTemplateMode}
  isCampMode={mode.isCampMode}  // 추가
  editable={!mode.isAdminContinueMode}
  campTemplateInfo={...}
  fieldErrors={fieldErrors}
/>
```

## 🔍 동작 원리

### 필드 잠금 체크 흐름

1. **템플릿 모드** (`isTemplateMode={true}`):
   - 관리자가 템플릿을 생성/수정할 때
   - "학생 입력 허용" 체크박스로 각 필드의 학생 입력 허용 여부를 설정
   - `templateLockedFields.step1.allow_student_*` 필드에 저장

2. **캠프 모드** (`isCampMode={true}`):
   - 학생이 캠프 템플릿을 사용하여 플랜을 작성할 때
   - `useFieldPermission` 훅이 `canStudentInput` 함수를 사용하여 필드 입력 가능 여부를 체크
   - `allow_student_*` 필드가 `true`인 경우만 입력 가능
   - `false`이거나 `undefined`인 경우 입력 불가 (읽기 전용)

3. **일반 모드** (`isCampMode={false}`):
   - 일반 플랜 생성 시
   - 모든 필드가 편집 가능

### `canStudentInput` 함수 로직

```typescript
export function canStudentInput(
  fieldName: keyof NonNullable<TemplateLockedFields["step1"]>,
  lockedFields: TemplateLockedFields["step1"] | undefined,
  editable: boolean,
  isCampMode: boolean
): boolean {
  // editable={false}일 때는 모든 필드 입력 불가
  if (!editable) return false;
  
  // 일반 모드에서는 항상 허용
  if (!isCampMode) return true;  // <-- isCampMode가 false면 항상 true 반환
  
  // templateLockedFields가 없으면 모든 필드 입력 가능 (기본값)
  if (!lockedFields) return true;
  
  const fieldValue = lockedFields[fieldName];
  // undefined 또는 true이면 입력 가능, false이면 입력 불가
  return fieldValue !== false;
}
```

## ✅ 검증 방법

1. **템플릿 생성 시**:
   - 관리자가 캠프 템플릿을 생성
   - "학생 입력 허용" 체크박스로 각 필드의 허용 여부를 설정
   - 일부 필드는 체크하지 않음 (예: 플랜 이름, 스케줄러 유형)

2. **학생이 캠프 템플릿 사용 시**:
   - 학생이 캠프 템플릿을 선택하여 플랜 작성
   - "학생 입력 허용"이 체크되지 않은 필드는:
     - 입력 필드가 비활성화되어 있음 (`disabled={true}`)
     - 시각적으로 회색으로 표시됨 (`opacity-60`, `bg-gray-100`)
     - "이 필드는 템플릿에서 고정되어 수정할 수 없습니다." 메시지 표시
   - "학생 입력 허용"이 체크된 필드만 편집 가능

## 📝 관련 파일

- `app/(student)/plan/new-group/_components/BasePlanWizard.tsx` - 수정됨
- `app/(student)/plan/new-group/_components/_features/basic-info/Step1BasicInfo.tsx` - 영향받음
- `app/(student)/plan/new-group/_components/hooks/useFieldPermission.ts` - 관련 훅
- `app/(student)/plan/new-group/_components/utils/fieldLockUtils.ts` - 관련 유틸리티

## 🎯 결과

이제 캠프 템플릿에서 "학생 입력 허용"이 체크되지 않은 필드는 학생이 캠프 템플릿을 작성할 때 수정할 수 없도록 올바르게 제한됩니다.

