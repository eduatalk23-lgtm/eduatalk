# 플랜 그룹 생성 콘텐츠 상세정보 조회 수정

## 작업 일시
2025년 1월 15일

## 문제 상황
플랜 그룹 생성 과정에서 교재 목차와 강의 회차 정보가 조회되지 않는 문제가 발생했습니다.

### 증상
- 회차 정보가 있는 강의 콘텐츠인데 회차 정보가 나오지 않음
- 입력 폼으로 표시됨 (상세 정보가 없을 때의 fallback UI)

### 원인 분석
API 응답 구조가 `{ success: true, data: { details/episodes: [...] } }` 형태인데, 코드에서 `result.details` 또는 `result.episodes`로 직접 접근하고 있었습니다.

## 수정 내용

### 1. API 응답 파싱 유틸리티 함수 생성

**파일**: `lib/api/contentDetails.ts` (신규 생성)

- API 응답 타입 정의
  - `BookDetailsResponseData`: 교재 상세정보 응답 데이터
  - `LectureEpisodesResponseData`: 강의 회차 정보 응답 데이터
  - `ContentDetailsApiResponse`: 통합 응답 타입

- 타입 안전한 파싱 함수
  - `parseContentDetailsResponse()`: API 응답을 파싱하여 타입 안전하게 변환
  - `extractApiData()`: API 응답에서 data 필드를 안전하게 추출
  - 타입 가드 함수들: `isBookDetailsResponse()`, `isLectureEpisodesResponse()`

### 2. useContentDetails 훅 수정

**파일**: `app/(student)/plan/new-group/_components/_features/content-selection/Step6FinalReview/hooks/useContentDetails.ts`

**변경 사항**:
- `parseContentDetailsResponse()` 유틸리티 함수 import 추가
- API 응답 파싱 로직 수정 (79-82줄)
  - 기존: `result.details`, `result.episodes` 직접 접근
  - 수정: `parseContentDetailsResponse(result, content.content_type)` 사용
- 에러 처리 개선
  - 파싱 실패 시 상세한 로그 출력
  - 빈 배열로 fallback 처리

### 3. useRangeEditor 훅 수정

**파일**: `app/(student)/plan/new-group/_components/_features/content-selection/Step4RecommendedContents/hooks/useRangeEditor.ts`

**변경 사항**:
- `parseContentDetailsResponse()` 유틸리티 함수 import 추가
- API 응답 파싱 로직 수정 (145-146줄)
  - 기존: `result.details`, `result.episodes` 직접 접근
  - 수정: `parseContentDetailsResponse(result, content.content_type)` 사용
- 에러 처리 개선
  - 파싱 실패 시 상세한 로그 출력
  - 빈 배열로 fallback 처리

## 기술적 개선 사항

### 타입 안전성 향상
- 명시적 타입 정의로 컴파일 타임 타입 체크 강화
- Optional chaining (`?.`) 활용으로 null/undefined 안전 처리
- 타입 가드 함수로 런타임 타입 검증

### 코드 중복 제거
- 공통 API 응답 파싱 로직을 유틸리티 함수로 추출
- 일관된 에러 처리 패턴 적용

### 하위 호환성 유지
- 기존 API 응답 구조와 새로운 구조 모두 지원
- 점진적 마이그레이션 가능

## 수정된 파일 목록

1. `lib/api/contentDetails.ts` (신규 생성)
2. `app/(student)/plan/new-group/_components/_features/content-selection/Step6FinalReview/hooks/useContentDetails.ts`
3. `app/(student)/plan/new-group/_components/_features/content-selection/Step4RecommendedContents/hooks/useRangeEditor.ts`

## 검증 결과

- ✅ TypeScript 타입 체크 통과
- ✅ ESLint 검사 통과
- ✅ API 응답 구조 일관성 확인

## 예상 효과

1. **기능 수정**: 회차 정보가 올바르게 조회되어 표시됨
2. **코드 품질**: 타입 안전성 향상, 중복 코드 제거
3. **유지보수성**: 일관된 API 응답 처리 패턴
4. **에러 처리**: 더 명확한 에러 메시지 및 디버깅 정보

## 참고 사항

- 다른 파일들(`useContentDetailsBatch.ts`, `useBatchContentDetails.ts` 등)은 이미 `result.data`로 올바르게 접근하고 있어 수정 불필요
- 배치 API는 다른 응답 구조를 사용하므로 별도 처리

