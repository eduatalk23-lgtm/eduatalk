# SMS 설정 가이드

**작성일**: 2025-12-11  
**최종 업데이트**: 2025-12-11  
**버전**: 1.0

---

## 목차

1. [SMS 설정 개요](#sms-설정-개요)
2. [학원 기본 설정](#학원-기본-설정)
3. [학생별 설정](#학생별-설정)
4. [설정 간 관계](#설정-간-관계)
5. [SMS 발송 확인](#sms-발송-확인)
6. [문제 해결](#문제-해결)

---

## SMS 설정 개요

출석 관련 SMS 알림은 다음 두 가지 설정으로 관리됩니다:

1. **학원 기본 설정**: 모든 학생에게 적용되는 기본 설정
2. **학생별 설정**: 개별 학생에 대한 설정 (선택사항)

---

## 학원 기본 설정

### 설정 위치

관리자 페이지 → 출석 관리 → SMS 설정 (`/admin/attendance/settings`)

### 주요 설정 항목

#### 1. 입실 알림 SMS 발송
- **설정명**: 입실 알림 SMS 발송
- **기본값**: 활성화 (true)
- **설명**: 학생이 입실할 때 부모에게 SMS 발송
- **주의**: 관리자가 직접 체크인한 경우에만 발송됩니다

#### 2. 퇴실 알림 SMS 발송
- **설정명**: 퇴실 알림 SMS 발송
- **기본값**: 활성화 (true)
- **설명**: 학생이 퇴실할 때 부모에게 SMS 발송

#### 3. 결석 알림 SMS 발송
- **설정명**: 결석 알림 SMS 발송
- **기본값**: 활성화 (true)
- **설명**: 학생이 결석했을 때 부모에게 SMS 발송

#### 4. 지각 알림 SMS 발송
- **설정명**: 지각 알림 SMS 발송
- **기본값**: 활성화 (true)
- **설명**: 학생이 지각했을 때 부모에게 SMS 발송

#### 5. 학생 직접 체크인 시 발송 ⚠️ **중요**
- **설정명**: 학생 직접 체크인 시 발송
- **기본값**: 비활성화 (false)
- **설명**: 학생이 직접 QR 코드나 위치로 체크인할 때도 SMS 발송
- **주의**: 
  - 이 설정이 꺼져 있으면 학생이 직접 체크인해도 SMS가 발송되지 않습니다
  - 관리자가 직접 체크인한 경우에만 발송됩니다
  - 학생 직접 체크인 시 SMS를 받으려면 이 설정을 반드시 활성화해야 합니다

#### 6. SMS 수신자 선택
- **설정명**: SMS 수신자 선택
- **기본값**: auto (자동)
- **옵션**:
  - `mother`: 어머니만
  - `father`: 아버지만
  - `both`: 둘 다
  - `auto`: 먼저 있는 번호 (기본값)

---

## 학생별 설정

### 설정 위치

학생 프로필 → 알림 설정

### 설정 항목

학생별로 다음 설정을 개별적으로 관리할 수 있습니다:

- 입실 알림 SMS 발송
- 퇴실 알림 SMS 발송
- 결석 알림 SMS 발송
- 지각 알림 SMS 발송

### 설정 우선순위

1. **학생별 설정** (NULL이 아닌 경우)
2. **학원 기본 설정** (학생별 설정이 NULL인 경우)

---

## 설정 간 관계

### SMS 발송 결정 로직

```
학생이 직접 체크인?
  ├─ 예 → "학생 직접 체크인 시 발송" 설정 확인
  │   ├─ 활성화 → SMS 발송
  │   └─ 비활성화 → SMS 발송 안 함
  └─ 아니요 (관리자 체크인) → 입실/퇴실 알림 설정 확인
      ├─ 활성화 → SMS 발송
      └─ 비활성화 → SMS 발송 안 함
```

### 설정 조합 예시

| 학생 직접 체크인 | 학생 직접 체크인 시 발송 | 입실 알림 | 결과 |
|----------------|---------------------|----------|------|
| 예 (QR/위치) | 활성화 | 활성화 | ✅ SMS 발송 |
| 예 (QR/위치) | 비활성화 | 활성화 | ❌ SMS 발송 안 함 |
| 아니요 (관리자) | - | 활성화 | ✅ SMS 발송 |
| 아니요 (관리자) | - | 비활성화 | ❌ SMS 발송 안 함 |

---

## SMS 발송 확인

### SMS 로그 페이지

관리자 페이지 → 출석 관리 → SMS 로그 (`/admin/attendance/sms-logs`)

### 확인 가능한 정보

- 발송 시간
- 학생명
- 수신자 번호 (마스킹 처리)
- SMS 타입 (입실/퇴실/결석/지각)
- 발송 상태 (성공/실패/대기)
- 메시지 내용
- 에러 메시지 (실패 시)

### 필터링 기능

- 날짜 범위
- 학생별
- 상태별 (성공/실패/대기)
- SMS 타입별

---

## 문제 해결

### Q1. 학생이 직접 체크인했는데 SMS가 발송되지 않습니다

**원인**: "학생 직접 체크인 시 발송" 설정이 비활성화되어 있을 가능성

**해결 방법**:
1. 관리자 페이지 → 출석 관리 → SMS 설정 이동
2. "학생 직접 체크인 시 발송" 설정 활성화
3. 저장

### Q2. 관리자가 체크인했는데 SMS가 발송되지 않습니다

**원인**: 입실/퇴실 알림 설정이 비활성화되어 있을 가능성

**해결 방법**:
1. 관리자 페이지 → 출석 관리 → SMS 설정 이동
2. "입실 알림 SMS 발송" 또는 "퇴실 알림 SMS 발송" 설정 활성화
3. 저장

### Q3. 특정 학생에게만 SMS가 발송되지 않습니다

**원인**: 학생별 설정에서 해당 알림이 비활성화되어 있을 가능성

**해결 방법**:
1. 학생 프로필 → 알림 설정 확인
2. 해당 알림 설정 활성화
3. 또는 학생별 설정을 NULL로 변경하여 학원 기본 설정 사용

### Q4. SMS 발송 실패 원인 확인

**해결 방법**:
1. 관리자 페이지 → 출석 관리 → SMS 로그 이동
2. 실패한 SMS 로그 확인
3. 에러 메시지 확인
4. 전화번호 형식 확인 (010-XXXX-XXXX)

---

## 관련 문서

- [출석 기능 사용 가이드](./user-guide.md)
- [관리자 매뉴얼](./admin-manual.md)

---

**마지막 업데이트**: 2025-12-11

