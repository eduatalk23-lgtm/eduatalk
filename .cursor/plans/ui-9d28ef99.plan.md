<!-- 9d28ef99-3310-4f0e-a77d-cfc228c87f01 aaa20109-2688-444c-aced-246e12be1059 -->
# 콘텐츠 등록/수정/상세보기 UI 통일 및 최적화 계획

## 1. 중복 코드 제거 및 FormField 컴포넌트 통일

### 1.1 BookEditForm 리팩토링

**파일**: `app/(student)/contents/books/[id]/edit/BookEditForm.tsx`

**현재 문제점**:

- 직접 구현한 input/select 필드 (33-163줄)
- FormField 컴포넌트 미사용
- 다크모드 클래스 누락

**수정 사항**:

- 모든 input 필드를 `FormField` 컴포넌트로 교체
- 모든 select 필드를 `FormSelect` 컴포넌트로 교체
- 다크모드 클래스 추가 (`dark:` prefix)
- Zod 스키마 검증 추가 (기존 `bookSchema` 활용)

### 1.2 LectureEditForm 리팩토링

**파일**: `app/(student)/contents/lectures/[id]/edit/LectureEditForm.tsx`

**현재 문제점**:

- BookEditForm과 동일한 중복 코드 패턴
- FormField 컴포넌트 미사용

**수정 사항**:

- BookEditForm과 동일한 리팩토링 적용
- `lectureSchema` 활용한 검증 추가

### 1.3 등록 페이지 리팩토링

**파일**:

- `app/(student)/contents/books/new/page.tsx`
- `app/(student)/contents/lectures/new/page.tsx`

**수정 사항**:

- FormField/FormSelect 컴포넌트로 교체
- 다크모드 클래스 통일
- Spacing 일관성 개선

## 2. Toast 시스템으로 에러 처리 통일

### 2.1 alert() 제거 및 Toast 교체

**영향 파일**:

- `app/(student)/contents/books/new/page.tsx` (128줄)
- `app/(student)/contents/books/[id]/edit/BookEditForm.tsx` (24줄)
- `app/(student)/contents/lectures/new/page.tsx` (128줄)
- `app/(student)/contents/lectures/[id]/edit/LectureEditForm.tsx` (24줄)
- `app/(student)/contents/_components/ContentEditForm.tsx` (64줄)
- 기타 alert() 사용 파일들

**수정 사항**:

```typescript
// Before
alert(error instanceof Error ? error.message : "에러 메시지");

// After
const { showError, showSuccess } = useToast();
showError(error instanceof Error ? error.message : "에러 메시지");
```

### 2.2 성공 메시지 추가

- 등록/수정 성공 시 Toast로 피드백 제공
- `showSuccess()` 활용

## 3. Spacing 일관성 개선

### 3.1 페이지 레이아웃 통일

**파일**: 모든 등록/수정 페이지

**현재 문제점**:

- `py-10` 하드코딩 vs `getContainerClass` 혼용
- 섹션 간 간격 불일치

**수정 사항**:

```typescript
// 통일된 패턴
<section className={`${getContainerClass("FORM", "lg")} flex flex-col gap-6`}>
  <div className="flex flex-col gap-2">
    <h1>...</h1>
    <p>...</p>
  </div>
  <div className="rounded-2xl border bg-white dark:bg-gray-800 p-6 md:p-8 shadow-sm">
    {/* 폼 내용 */}
  </div>
</section>
```

### 3.2 폼 내부 Spacing 통일

- 모든 폼 필드: `gap-1.5` (FormField 기본값 활용)
- 폼 섹션 간: `gap-6`
- 버튼 영역: `gap-3` (이미 적용됨)

## 4. 다크모드 지원 통일

### 4.1 폼 컨테이너 다크모드

**파일**: 모든 등록/수정 페이지

**수정 사항**:

```typescript
// Before
className="rounded-2xl border bg-white p-6 shadow-sm"

// After
className="rounded-2xl border bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 p-6 shadow-sm"
```

### 4.2 입력 필드 다크모드

- FormField 컴포넌트는 이미 다크모드 지원 (Input/Select 컴포넌트에서 처리)
- 직접 구현한 필드만 수정 필요

## 5. ContentDetailLayout 사용 통일

### 5.1 상세보기 페이지 리팩토링

**파일**:

- `app/(student)/contents/master-custom-contents/[id]/page.tsx`
- `app/(admin)/admin/master-custom-contents/[id]/page.tsx`

**현재 문제점**:

- ContentDetailLayout 미사용
- 직접 구현한 레이아웃 구조

**수정 사항**:

```typescript
// Before
<section className={`${getContainerClass("CONTENT_DETAIL", "lg")} flex flex-col gap-8`}>
  <div className="rounded-2xl border bg-white p-8 shadow-sm">
    <ContentHeader ... />
    <ContentDetailTable ... />
    <div className="flex flex-col gap-4 border-t pt-8">
      {/* 액션 버튼 */}
    </div>
  </div>
</section>

// After
<ContentDetailLayout
  header={<ContentHeader ... />}
  detailTable={<ContentDetailTable ... />}
  actions={/* 액션 버튼 */}
/>
```

## 6. 버튼 레이아웃 통일

### 6.1 버튼 스타일 통일

**파일**: 모든 등록/수정 페이지

**수정 사항**:

- 등록 페이지: "등록하기" (primary), "취소" (secondary)
- 수정 페이지: "변경사항 저장" (primary), "취소" (secondary)
- 버튼 크기: `px-4 py-2 text-sm font-semibold`
- 버튼 간격: `gap-3`

## 7. 로딩 상태 개선

### 7.1 Suspense 및 스켈레톤 추가

**파일**: 등록/수정 페이지

**수정 사항**:

- 메타데이터 로딩 시 스켈레톤 표시
- `SuspenseFallback` 컴포넌트 활용

## 8. 데이터베이스 스키마 확인 및 타입 안전성

### 8.1 Supabase 스키마 기반 타입 정의

**확인된 테이블**:

- `books`: 50개 컬럼
- `lectures`: 40개 컬럼  
- `master_custom_contents`: 16개 컬럼
- `student_custom_contents`: 11개 컬럼

**수정 사항**:

- FormData 변환 시 null 처리 확인
- 숫자 필드 빈 문자열 → null 변환 (이미 `formDataToObject`에서 처리됨)
- 타입 단언 제거 및 명시적 타입 정의

## 9. 공통 컴포넌트 추출

### 9.1 ContentFormLayout 컴포넌트 생성

**파일**: `app/(student)/contents/_components/ContentFormLayout.tsx`

**용도**: 등록/수정 페이지의 공통 레이아웃

**Props**:

```typescript
type ContentFormLayoutProps = {
  title: string;
  description: string;
  backHref?: string; // 수정 페이지에서만 사용
  children: React.ReactNode;
};
```

### 9.2 ContentFormActions 컴포넌트 생성

**파일**: `app/(student)/contents/_components/ContentFormActions.tsx`

**용도**: 폼 하단 버튼 영역 통일

**Props**:

```typescript
type ContentFormActionsProps = {
  submitLabel: string;
  cancelHref: string;
  isPending: boolean;
  onCancel?: () => void;
};
```

## 10. 검증 로직 통합

### 10.1 Zod 스키마 활용

**파일**: `lib/validation/schemas.ts`

**현재 상태**:

- `masterCustomContentSchema` 존재
- `bookSchema`, `lectureSchema` 존재하나 사용되지 않음

**수정 사항**:

- 학생 콘텐츠용 스키마 추가 (`studentBookSchema`, `studentLectureSchema`)
- FormData 검증 통합
- 에러 메시지 필드별 표시

## 구현 우선순위

### Phase 1: 핵심 통일 (높은 우선순위)

1. FormField 컴포넌트로 통일
2. Toast 시스템으로 에러 처리 통일
3. Spacing 일관성 개선
4. 다크모드 지원 통일

### Phase 2: 레이아웃 통일 (중간 우선순위)

5. ContentDetailLayout 사용 통일
6. getContainerClass 사용 통일
7. 버튼 레이아웃 통일

### Phase 3: 개선 및 최적화 (낮은 우선순위)

8. 공통 컴포넌트 추출
9. 로딩 상태 개선
10. 검증 로직 통합

## 예상 효과

1. **코드 중복 제거**: 약 200줄 이상의 중복 코드 제거
2. **일관성 향상**: 모든 콘텐츠 페이지에서 동일한 UX
3. **유지보수성 향상**: 공통 컴포넌트로 변경 사항 반영 용이
4. **사용자 경험 개선**: Toast 시스템으로 더 나은 피드백
5. **접근성 향상**: FormField의 ARIA 속성 활용

### To-dos

- [ ] BookEditForm, LectureEditForm, 등록 페이지에서 FormField/FormSelect 컴포넌트로 통일
- [ ] 모든 alert() 호출을 Toast 시스템(useToast)으로 교체
- [ ] getContainerClass 사용 통일 및 Spacing-First 정책 준수
- [ ] 모든 폼 컨테이너와 입력 필드에 다크모드 클래스 추가
- [ ] 상세보기 페이지에서 ContentDetailLayout 컴포넌트 사용 통일
- [ ] 등록/수정 페이지의 버튼 레이아웃 및 스타일 통일
- [ ] ContentFormLayout, ContentFormActions 공통 컴포넌트 생성 및 적용
- [ ] Zod 스키마 검증 로직 통합 및 필드별 에러 표시