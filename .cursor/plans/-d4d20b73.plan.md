<!-- d4d20b73-b771-463f-a7f0-47af0be22262 e16a05f0-fe0d-4704-9e94-1dcc8170783c -->
# 배치된 플랜 테이블 뷰 구현 및 코드 최적화 계획

## 목표

1. 배치된 플랜만 보는 전용 테이블 뷰 컴포넌트 생성 (학원, 이동, 점심, 자율 제외)
2. 중복된 포맷팅 함수를 공통 유틸리티로 추출
3. TanStack Table + 가상 스크롤링을 활용한 성능 최적화
4. 스켈레톤 UI 추가

## 1. 공통 유틸리티 함수 추출

### 1.1 플랜 포맷팅 유틸리티 생성

**파일**: `lib/utils/planFormatting.ts` (신규 생성)

- `formatPlanTime(minutes: number): string` - 소요시간 포맷팅 (중복 제거)
- `formatPlanLearningAmount(plan: Plan): string` - 학습 분량 포맷팅 (중복 제거)
- `formatPlanDate(date: string): string` - 날짜 포맷팅 (요일 포함)

**영향 받는 파일**:

- `app/(student)/plan/new-group/_components/_features/scheduling/components/PlanTable.tsx` - formatTime, formatLearningAmount 제거
- `app/(student)/plan/group/[id]/_components/PlanPreviewDialog.tsx` - formatLearningAmount 제거
- `app/(student)/plan/new-group/_components/utils/scheduleTransform.ts` - formatLearningAmount 제거 (또는 통합)

## 2. 배치된 플랜 테이블 뷰 컴포넌트

### 2.1 PlanListView 컴포넌트 생성

**파일**: `app/(student)/plan/group/[id]/_components/PlanListView.tsx` (신규 생성)

**기능**:

- 배치된 플랜만 필터링 (학원, 이동, 점심, 자율 제외)
- 날짜/시간 순 정렬 (기본값)
- TanStack Table을 활용한 정렬, 검색 기능
- 가상 스크롤링으로 성능 최적화 (100개 이상일 때)

**컬럼 구성**:

- 날짜 (plan_date)
- 시간 (start_time ~ end_time)
- 교과 (content_subject_category)
- 과목 (content_subject)
- 유형 (content_type: 교재/강의)
- 콘텐츠명 (content_title)
- 학습내역 (chapter 또는 contentEpisode)
- 회차 (sequence)
- 학습 분량 (planned_start_page_or_time ~ planned_end_page_or_time)
- 소요시간 (계산값)

**데이터 필터링**:

- `content_type !== 'custom'` 또는 시간 정보가 있는 플랜만
- `start_time`과 `end_time`이 모두 있는 플랜만 표시

### 2.2 TanStack Table 설정

**의존성**: `@tanstack/react-table`, `@tanstack/react-virtual` (이미 설치되어 있는지 확인 필요)

**특징**:

- 정렬 가능한 컬럼 (날짜, 시간, 교과, 과목)
- 가상 스크롤링 (100개 이상일 때 자동 활성화)
- 반응형 디자인

### 2.3 스켈레톤 UI 추가

**파일**: `components/ui/DailyScheduleSkeletons.tsx`에 추가 또는 별도 파일

**시나리오**:

- 초기 로딩: 전체 테이블 스켈레톤
- 데이터 없음: 빈 상태 UI

## 3. 통합 및 기존 코드 리팩토링

### 3.1 PlanScheduleView 수정

**파일**: `app/(student)/plan/group/[id]/_components/PlanScheduleView.tsx`

- 탭 또는 뷰 전환 방식으로 일별 스케줄과 플랜 테이블 뷰 전환
- 또는 별도 탭으로 분리

### 3.2 기존 PlanTable 리팩토링

**파일**: `app/(student)/plan/new-group/_components/_features/scheduling/components/PlanTable.tsx`

- 추출한 공통 유틸리티 함수 사용
- 불필요한 로직 정리

## 4. 데이터 처리 최적화

### 4.1 플랜 데이터 변환

**위치**: `PlanListView` 컴포넌트 내부 또는 별도 유틸리티

- `student_plan` 테이블 데이터를 테이블 뷰용으로 변환
- contents Map과 결합하여 콘텐츠 정보 추가
- 날짜/시간 순 정렬 (기본값)

### 4.2 메모이제이션

- `useMemo`로 필터링된 플랜 목록 메모이제이션
- `React.memo`로 테이블 행 컴포넌트 최적화

## 5. 타입 정의

### 5.1 PlanTableRow 타입 정의

**위치**: `PlanListView.tsx` 또는 별도 타입 파일

```typescript
type PlanTableRow = {
  id: string;
  plan_date: string;
  start_time: string;
  end_time: string;
  subject_category: string | null;
  subject: string | null;
  content_type: "book" | "lecture" | "custom";
  content_title: string | null;
  chapter: string | null;
  sequence: number | null;
  planned_start_page_or_time: number | null;
  planned_end_page_or_time: number | null;
  duration_minutes: number; // 계산된 값
};
```

## 6. 구현 순서

1. 공통 유틸리티 함수 추출 및 기존 코드 리팩토링
2. PlanListView 컴포넌트 기본 구조 생성
3. TanStack Table 통합
4. 가상 스크롤링 추가
5. 스켈레톤 UI 추가
6. PlanScheduleView에 통합

## 7. 성능 고려사항

- 100개 미만: 일반 렌더링
- 100개 이상: 가상 스크롤링 자동 활성화
- 정렬/필터링 시 메모이제이션 활용
- React Query 캐시 활용 (이미 구현됨)

### To-dos

- [ ] 공통 포맷팅 유틸리티 함수 추출 (formatPlanTime, formatPlanLearningAmount, formatPlanDate) - lib/utils/planFormatting.ts 생성
- [ ] 기존 코드에서 중복된 포맷팅 함수 제거 및 공통 유틸리티 사용으로 변경
- [ ] PlanListView 컴포넌트 기본 구조 생성 - 배치된 플랜 필터링 및 데이터 변환 로직 구현
- [ ] TanStack Table 통합 - 컬럼 정의, 정렬 기능 구현
- [ ] 가상 스크롤링 추가 - @tanstack/react-virtual 활용 (100개 이상일 때)
- [ ] 스켈레톤 UI 추가 - 초기 로딩 및 빈 상태 처리
- [ ] PlanScheduleView에 통합 - 탭 또는 뷰 전환 방식으로 추가