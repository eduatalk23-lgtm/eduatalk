<!-- 23649b85-cf31-411a-a486-54f8b61aacd6 2644dcf2-1af6-4a83-881c-03e9a081800a -->
# 마스터 콘텐츠 URL 필드 추가 및 최적화 계획

## 1. 현재 상태 분석

### 1.1 데이터베이스 스키마

- **master_books**: `pdf_url`, `source_url`, `cover_image_url` 존재 ✅
- **master_lectures**: `video_url`, `lecture_source_url` 존재 ✅ (cover_image_url 없음)
- **master_custom_contents**: URL 필드 없음 ❌

### 1.2 폼 구현 상태

- **master_books**: 등록 폼에 URL 필드 없음, 수정 폼에 `cover_image_url`만 있음
- **master_lectures**: 등록/수정 폼에 URL 필드 없음
- **master_custom_contents**: 등록/수정 폼에 URL 필드 없음

### 1.3 중복 코드

- URL 입력 필드가 각 폼에 개별적으로 구현되어 있음
- 검증 스키마에 URL 검증 로직이 일관되지 않음

## 2. 구현 작업

### 2.1 데이터베이스 마이그레이션

**파일**: `supabase/migrations/[timestamp]_add_url_fields_to_master_contents.sql`

```sql
-- master_custom_contents에 content_url 필드 추가
ALTER TABLE master_custom_contents 
ADD COLUMN IF NOT EXISTS content_url text;

COMMENT ON COLUMN master_custom_contents.content_url IS '콘텐츠 URL (PDF, 동영상, 문제집 등의 링크)';

-- master_lectures에 cover_image_url 필드 추가 (일관성)
ALTER TABLE master_lectures 
ADD COLUMN IF NOT EXISTS cover_image_url text;

COMMENT ON COLUMN master_lectures.cover_image_url IS '표지 이미지 URL';
```

### 2.2 타입 정의 업데이트

**파일**: `lib/types/plan/domain.ts`

- `MasterCustomContent` 타입에 `content_url: string | null` 추가
- `MasterLecture` 타입에 `cover_image_url: string | null` 추가 (이미 정의되어 있는지 확인)

### 2.3 검증 스키마 업데이트

**파일**: `lib/validation/schemas.ts`

Zod의 URL 검증을 사용하여 일관된 검증 로직 추가:

```typescript
// 공통 URL 검증 헬퍼
const optionalUrlSchema = z.union([
  z.string().url("올바른 URL 형식을 입력해주세요."),
  z.literal(""),
  z.null(),
  z.undefined()
]).optional().nullable();

// masterBookSchema에 추가
pdf_url: optionalUrlSchema,
source_url: optionalUrlSchema,

// masterLectureSchema에 추가
video_url: optionalUrlSchema,
lecture_source_url: optionalUrlSchema,
cover_image_url: optionalUrlSchema,

// masterCustomContentSchema에 추가
content_url: optionalUrlSchema,
```

### 2.4 폼 헬퍼 함수 업데이트

**파일**: `lib/utils/masterContentFormHelpers.ts`

- `parseMasterCustomContentFormData`에 `content_url` 파싱 추가
- `parseMasterCustomContentUpdateFormData`에 `content_url` 파싱 추가

**파일**: `lib/utils/formDataHelpers.ts` (필요시)

- URL 전용 파싱 함수는 기존 `getFormString`으로 충분하므로 추가 불필요

### 2.5 공통 URL 필드 컴포넌트 생성 (중복 코드 최적화)

**파일**: `components/forms/UrlField.tsx` (신규)

재사용 가능한 URL 입력 필드 컴포넌트 생성:

```typescript
type UrlFieldProps = {
  label: string;
  name: string;
  defaultValue?: string;
  placeholder?: string;
  hint?: string;
  required?: boolean;
  className?: string;
};

export function UrlField({ label, name, defaultValue, placeholder, hint, required, className }: UrlFieldProps) {
  return (
    <FormField
      label={label}
      name={name}
      type="url"
      defaultValue={defaultValue}
      placeholder={placeholder}
      hint={hint}
      required={required}
      className={className}
    />
  );
}
```

### 2.6 폼 컴포넌트 업데이트

#### 2.6.1 master_books 폼

**파일**: `app/(admin)/admin/master-books/new/MasterBookForm.tsx`

- `pdf_url` 필드 추가
- `source_url` 필드 추가
- `UrlField` 컴포넌트 사용

**파일**: `app/(admin)/admin/master-books/[id]/edit/MasterBookEditForm.tsx`

- `pdf_url` 필드 추가 (현재 없음)
- `source_url` 필드 추가 (현재 없음)
- 기존 `cover_image_url` 필드는 유지

#### 2.6.2 master_lectures 폼

**파일**: `app/(admin)/admin/master-lectures/new/MasterLectureForm.tsx`

- `video_url` 필드 추가
- `lecture_source_url` 필드 추가
- `cover_image_url` 필드 추가

**파일**: `app/(admin)/admin/master-lectures/[id]/edit/MasterLectureEditForm.tsx`

- `video_url` 필드 추가
- `lecture_source_url` 필드 추가
- `cover_image_url` 필드 추가

#### 2.6.3 master_custom_contents 폼

**파일**: `app/(admin)/admin/master-custom-contents/new/MasterCustomContentForm.tsx`

- `content_url` 필드 추가

**파일**: `app/(admin)/admin/master-custom-contents/[id]/edit/MasterCustomContentEditForm.tsx`

- `content_url` 필드 추가

### 2.7 상세 페이지 업데이트

**파일**: `app/(admin)/admin/master-books/[id]/page.tsx`

- `pdf_url`, `source_url` 표시 추가

**파일**: `app/(admin)/admin/master-lectures/[id]/page.tsx`

- `video_url`, `lecture_source_url`, `cover_image_url` 표시 추가

**파일**: `app/(admin)/admin/master-custom-contents/[id]/page.tsx`

- `content_url` 표시 추가

### 2.8 액션 함수 업데이트

**파일**: `app/(admin)/actions/masterCustomContentActions.ts`

- FormData 파싱에 `content_url` 포함 확인

**파일**: `app/(student)/actions/masterContentActions.ts` (master_books, master_lectures 액션)

- FormData 파싱에 URL 필드 포함 확인

## 3. 최적화 작업

### 3.1 중복 코드 제거

- URL 입력 필드를 `UrlField` 컴포넌트로 통합
- 검증 스키마의 URL 검증 로직을 공통 헬퍼로 추출

### 3.2 일관성 개선

- 모든 마스터 콘텐츠 타입에 동일한 URL 필드 패턴 적용
- 검증 메시지 통일

## 4. 테스트 체크리스트

- [ ] master_books 등록/수정 폼에서 URL 필드 입력 및 검증
- [ ] master_lectures 등록/수정 폼에서 URL 필드 입력 및 검증
- [ ] master_custom_contents 등록/수정 폼에서 URL 필드 입력 및 검증
- [ ] 잘못된 URL 형식 입력 시 검증 에러 표시
- [ ] 상세 페이지에서 URL 링크 표시 및 클릭 가능 여부
- [ ] 데이터베이스에 URL 값 정상 저장 확인

## 5. 참고 사항

- Zod의 `z.string().url()` 사용 (2025년 모범 사례)
- FormField 컴포넌트의 `type="url"` 속성 활용
- URL 필드는 선택사항(optional)으로 처리
- 빈 문자열은 null로 변환하여 저장

### To-dos

- [ ] 데이터베이스 마이그레이션: master_custom_contents에 content_url 추가, master_lectures에 cover_image_url 추가
- [ ] 타입 정의 업데이트: MasterCustomContent, MasterLecture 타입에 URL 필드 추가
- [ ] 검증 스키마 업데이트: Zod URL 검증을 사용하여 masterBookSchema, masterLectureSchema, masterCustomContentSchema에 URL 필드 추가
- [ ] 폼 헬퍼 함수 업데이트: parseMasterCustomContentFormData에 content_url 파싱 추가
- [ ] 공통 URL 필드 컴포넌트 생성: components/forms/UrlField.tsx 생성 (중복 코드 최적화)
- [ ] master_books 폼 업데이트: 등록/수정 폼에 pdf_url, source_url 필드 추가
- [ ] master_lectures 폼 업데이트: 등록/수정 폼에 video_url, lecture_source_url, cover_image_url 필드 추가
- [ ] master_custom_contents 폼 업데이트: 등록/수정 폼에 content_url 필드 추가
- [ ] 상세 페이지 업데이트: 모든 마스터 콘텐츠 상세 페이지에 URL 필드 표시 추가
- [ ] 액션 함수 확인: FormData 파싱에 URL 필드가 포함되는지 확인 및 수정