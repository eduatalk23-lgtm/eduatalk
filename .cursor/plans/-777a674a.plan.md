<!-- 777a674a-bd55-4ab4-9643-c894b57c5fbe 9659ab39-51f5-4328-943b-736b7b24ab1e -->
# 상세 페이지 빈 값 표시 및 코드 최적화 계획

## 1. 현재 상태 분석

### 1.1 문제점

- `ContentDetailTable` 컴포넌트가 값이 없을 때 `null`을 반환하여 항목을 완전히 숨김
- 사용자 요구사항: 값이 없어도 항목은 표시하고, 빈 값은 플레이스홀더로 표시

### 1.2 기존 패턴 분석

- `MockDetailAnalysis.tsx`: `"-"` 사용 (167-170줄)
- `MockScoreCard.tsx`: `"-"` 사용 (71-75줄)
- `EditableField.tsx`: `emptyText` prop으로 `"—"` 기본값 사용 (40줄)

### 1.3 데이터베이스 확인

- `master_books`: `pdf_url`, `source_url`, `cover_image_url` 존재
- `master_lectures`: `video_url`, `lecture_source_url` 존재, `cover_image_url` 추가됨 (마이그레이션 완료)
- `master_custom_contents`: `content_url` 추가됨 (마이그레이션 완료)

## 2. 구현 작업

### 2.1 ContentDetailTable 컴포넌트 수정

**파일**: `app/(student)/contents/_components/ContentDetailTable.tsx`

#### 변경 사항

1. 빈 값 처리 로직 변경: `return null` 제거, 빈 값은 플레이스홀더로 표시
2. 플레이스홀더 텍스트: 기존 패턴(`MockDetailAnalysis`, `MockScoreCard`)과 일관성을 위해 `"-"` 사용
3. URL 링크 처리: 값이 있을 때만 링크로 표시, 빈 값은 일반 텍스트로 표시
4. 접근성 개선: 빈 값에 `aria-label` 추가

#### 코드 변경

```typescript
function DetailRow({
  label,
  value,
  isUrl = false,
}: {
  label: string;
  value: string | number | null | undefined;
  isUrl?: boolean;
}) {
  // 빈 값 처리: null, undefined, 빈 문자열을 "-"로 표시
  const isEmpty = value === null || value === undefined || value === "";
  const displayValue = isEmpty ? "-" : String(value);
  
  // URL 링크 처리: 값이 있고 URL 형식일 때만 링크로 표시
  const isUrlValue = !isEmpty && (
    isUrl || 
    (typeof value === "string" && (value.startsWith("http://") || value.startsWith("https://")))
  );
  
  return (
    <div className="flex flex-col gap-1">
      <p className="text-sm font-medium text-gray-500">{label}</p>
      {isUrlValue ? (
        <a
          href={String(value)}
          target="_blank"
          rel="noopener noreferrer"
          className="text-base text-indigo-600 hover:text-indigo-800 hover:underline break-all"
          aria-label={`${label} 링크 열기`}
        >
          {String(value)}
        </a>
      ) : (
        <p 
          className={cn(
            "text-base",
            isEmpty ? "text-gray-400" : "text-gray-900"
          )}
          aria-label={isEmpty ? `${label}: 정보 없음` : undefined}
        >
          {displayValue}
        </p>
      )}
    </div>
  );
}
```

### 2.2 중복 코드 최적화

#### 2.2.1 빈 값 처리 유틸리티 함수 생성

**파일**: `lib/utils/formatValue.ts` (신규)

공통 빈 값 처리 로직을 유틸리티 함수로 추출:

```typescript
/**
 * 빈 값 체크 및 플레이스홀더 반환
 * @param value - 체크할 값
 * @param placeholder - 빈 값일 때 표시할 텍스트 (기본값: "-")
 * @returns 값이 있으면 문자열로 변환, 없으면 플레이스홀더
 */
export function formatValue(
  value: string | number | null | undefined,
  placeholder: string = "-"
): string {
  if (value === null || value === undefined || value === "") {
    return placeholder;
  }
  return String(value);
}

/**
 * 빈 값 여부 체크
 */
export function isEmptyValue(
  value: string | number | null | undefined
): boolean {
  return value === null || value === undefined || value === "";
}
```

#### 2.2.2 URL 검증 유틸리티 함수 생성

**파일**: `lib/utils/urlHelpers.ts` (신규 또는 기존 파일에 추가)

```typescript
/**
 * URL 형식 검증
 */
export function isValidUrl(value: string | null | undefined): boolean {
  if (!value || typeof value !== "string") {
    return false;
  }
  try {
    new URL(value);
    return value.startsWith("http://") || value.startsWith("https://");
  } catch {
    return false;
  }
}
```

### 2.3 ContentDetailTable 리팩토링

**파일**: `app/(student)/contents/_components/ContentDetailTable.tsx`

유틸리티 함수를 사용하여 코드 간소화:

```typescript
import { formatValue, isEmptyValue } from "@/lib/utils/formatValue";
import { isValidUrl } from "@/lib/utils/urlHelpers";
import { cn } from "@/lib/cn";

function DetailRow({
  label,
  value,
  isUrl = false,
}: {
  label: string;
  value: string | number | null | undefined;
  isUrl?: boolean;
}) {
  const isEmpty = isEmptyValue(value);
  const displayValue = formatValue(value);
  const isUrlValue = !isEmpty && (isUrl || isValidUrl(value as string));
  
  return (
    <div className="flex flex-col gap-1">
      <p className="text-sm font-medium text-gray-500">{label}</p>
      {isUrlValue ? (
        <a
          href={String(value)}
          target="_blank"
          rel="noopener noreferrer"
          className="text-base text-indigo-600 hover:text-indigo-800 hover:underline break-all"
          aria-label={`${label} 링크 열기`}
        >
          {String(value)}
        </a>
      ) : (
        <p 
          className={cn(
            "text-base",
            isEmpty ? "text-gray-400" : "text-gray-900"
          )}
          aria-label={isEmpty ? `${label}: 정보 없음` : undefined}
        >
          {displayValue}
        </p>
      )}
    </div>
  );
}
```

### 2.4 다른 컴포넌트에서 유틸리티 함수 활용 검토

다음 파일들에서 유사한 패턴이 있는지 확인하고 필요시 유틸리티 함수로 교체:

- `app/(student)/scores/analysis/_components/MockDetailAnalysis.tsx` (167-170줄)
- `app/(student)/scores/mock/[grade]/[month]/[exam-type]/_components/MockScoreCard.tsx` (71-75줄)

## 3. 최적화 작업

### 3.1 타입 안전성 개선

`DetailRow`의 타입 정의를 더 명확하게:

```typescript
type DetailRow = {
  label: string;
  value: string | number | null | undefined;
  isUrl?: boolean;
  placeholder?: string; // 커스터마이징 가능하도록 (선택사항)
};
```

### 3.2 접근성 개선

- 빈 값에 `aria-label` 추가
- 스크린 리더를 위한 명확한 설명 제공

### 3.3 스타일 일관성

- 빈 값은 `text-gray-400`로 표시하여 일반 값(`text-gray-900`)과 구분
- 기존 디자인 시스템과 일관성 유지

## 4. 테스트 체크리스트

- [ ] 값이 있는 경우 정상 표시 확인
- [ ] 값이 null인 경우 "-" 표시 확인
- [ ] 값이 undefined인 경우 "-" 표시 확인
- [ ] 값이 빈 문자열인 경우 "-" 표시 확인
- [ ] URL 필드가 값이 있을 때 링크로 표시되는지 확인
- [ ] URL 필드가 빈 값일 때 "-"로 표시되는지 확인
- [ ] 스크린 리더 접근성 테스트
- [ ] 모든 마스터 콘텐츠 상세 페이지에서 동작 확인

## 5. 참고 사항

### 5.1 2025년 React 모범 사례

- 조건부 렌더링: `null` 반환은 완전히 숨기는 경우에만 사용
- 사용자 경험: 빈 값도 표시하여 정보 구조를 명확히 유지
- 접근성: `aria-label`로 스크린 리더 지원

### 5.2 기존 코드 패턴

- `MockDetailAnalysis`: `"-"` 사용
- `MockScoreCard`: `"-"` 사용
- `EditableField`: `"—"` 사용 (유니코드 em dash)

### 5.3 결정 사항

- 플레이스홀더로 `"-"` 사용 (기존 패턴과 일관성)
- `"—"` (em dash)는 `EditableField`에서만 사용하도록 유지
- URL 필드는 값이 있을 때만 링크로 표시

## 6. 파일 변경 목록

1. `app/(student)/contents/_components/ContentDetailTable.tsx` - 빈 값 표시 로직 수정
2. `lib/utils/formatValue.ts` - 빈 값 처리 유틸리티 함수 (신규)
3. `lib/utils/urlHelpers.ts` - URL 검증 유틸리티 함수 (신규 또는 기존 파일에 추가)
4. (선택) `app/(student)/scores/analysis/_components/MockDetailAnalysis.tsx` - 유틸리티 함수 활용
5. (선택) `app/(student)/scores/mock/[grade]/[month]/[exam-type]/_components/MockScoreCard.tsx` - 유틸리티 함수 활용