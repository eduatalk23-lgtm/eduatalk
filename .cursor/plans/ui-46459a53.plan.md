<!-- 46459a53-ae90-4be1-b280-a46790709a93 95c9c238-74cf-409b-9d1d-81713620510b -->
# 캘린더 UI 개선 및 코드 최적화 계획

## 목표

1. 중복 코드 제거 및 공통 로직 추출
2. 2025년 웹 개발 모범 사례 적용 (접근성, 성능, TypeScript)
3. UI/UX 개선 (디자인, 애니메이션, 반응형)
4. 코드 최적화 (메모이제이션, 렌더링 최적화)

## 1. 중복 코드 분석 및 추출

### 1.1 공통 날짜 스타일링 로직 추출

**문제점:**

- `MonthView`, `WeekView`, `DayView`, `DayTimelineModal`에서 동일한 dayType 스타일링 로직 반복
- `getDayTypeColor`, `isHoliday` 계산, `bgColorClass` 생성 로직 중복

**해결:**

- `app/(student)/plan/calendar/_utils/dateStyling.ts` 생성
- `useDayTypeStyling(date, dayType, exclusions)` 커스텀 훅 생성
```typescript
// 공통 스타일링 결과 반환
{
  bgColorClass: string;
  textColorClass: string;
  boldTextColorClass: string;
  dayTypeBadgeClass: string;
  isHoliday: boolean;
  isToday: boolean;
  dayTypeInfo: DayTypeInfo | undefined;
}
```


### 1.2 날짜별 데이터 그룹화 로직 추출

**문제점:**

- `plansByDate`, `exclusionsByDate`, `academySchedulesByDate` 생성 로직이 각 뷰에서 반복

**해결:**

- `app/(student)/plan/calendar/_hooks/useCalendarData.ts` 생성
- `useCalendarData(plans, exclusions, academySchedules, dateRange)` 훅으로 통합

### 1.3 타임라인 슬롯 처리 로직 통합

**문제점:**

- `buildTimelineSlots` 후 정렬/필터링 로직이 각 컴포넌트에서 반복

**해결:**

- `app/(student)/plan/calendar/_hooks/useTimelineSlots.ts` 생성
- `useTimelineSlots(dateStr, dailySchedule, plans, academySchedules, exclusions, showOnlyStudyTime)` 훅 생성

### 1.4 공통 날짜 셀 컴포넌트 생성

**문제점:**

- MonthView와 WeekView에서 날짜 셀 렌더링 로직이 유사하지만 완전히 분리됨

**해결:**

- `app/(student)/plan/calendar/_components/CalendarDayCell.tsx` 생성
- 재사용 가능한 날짜 셀 컴포넌트로 추출 (variant: "month" | "week" | "compact")

## 2. 성능 최적화

### 2.1 함수 메모이제이션

**문제점:**

- `handleDateClick` 같은 이벤트 핸들러가 매 렌더마다 재생성
- Context7 모범 사례: `useCallback` 사용 필요

**해결:**

- 모든 이벤트 핸들러에 `useCallback` 적용
- 의존성 배열 최적화

### 2.2 컴포넌트 메모이제이션

**문제점:**

- `WeekView`, `DayView`는 이미 `memo`로 감싸져 있지만, `MonthView`는 없음
- 자식 컴포넌트들도 메모이제이션 필요

**해결:**

- `MonthView`를 `React.memo`로 감싸기
- `CalendarPlanCard`, `TimelineItem` 등 자식 컴포넌트 메모이제이션 확인

### 2.3 useMemo 최적화

**문제점:**

- 일부 계산이 useMemo로 감싸져 있지만 의존성 배열이 불완전할 수 있음

**해결:**

- 모든 useMemo 의존성 배열 점검 및 최적화
- 불필요한 재계산 방지

## 3. 접근성 개선 (2025년 모범 사례)

### 3.1 ARIA 속성 추가

**현재 상태:**

- 일부 버튼에만 `aria-label` 존재

**개선:**

- 모든 인터랙티브 요소에 적절한 ARIA 속성 추가
- `aria-label`, `aria-describedby`, `aria-current="date"` (오늘 날짜) 등
- 키보드 네비게이션 지원 강화

### 3.2 키보드 네비게이션

**개선:**

- 화살표 키로 날짜 이동
- Enter/Space로 날짜 선택
- Tab 순서 최적화

## 4. UI/UX 개선

### 4.1 디자인 시스템 일관성

**문제점:**

- 색상, 간격, 타이포그래피가 완전히 일관되지 않음

**해결:**

- Tailwind CSS 유틸리티 클래스 표준화
- 디자인 토큰 (색상, 간격) 일관화
- Context7 모범 사례: Tailwind CSS와 DayPicker 통합 패턴 적용

### 4.2 애니메이션 및 전환 효과

**개선:**

- 날짜 셀 hover 효과 개선
- 뷰 전환 시 부드러운 애니메이션
- 로딩 상태 개선

### 4.3 반응형 디자인 강화

**개선:**

- 모바일에서 캘린더 레이아웃 최적화
- 터치 인터랙션 개선
- 작은 화면에서의 가독성 향상

## 5. 코드 구조 개선

### 5.1 파일 구조 정리

```
app/(student)/plan/calendar/
├── _components/
│   ├── PlanCalendarView.tsx (메인 뷰)
│   ├── MonthView.tsx (리팩토링)
│   ├── WeekView.tsx (리팩토링)
│   ├── DayView.tsx (리팩토링)
│   ├── CalendarDayCell.tsx (신규 - 공통 날짜 셀)
│   ├── CalendarPlanCard.tsx (기존)
│   └── ...
├── _hooks/
│   ├── useCalendarData.ts (신규)
│   ├── useDayTypeStyling.ts (신규)
│   └── useTimelineSlots.ts (신규)
├── _utils/
│   ├── timelineUtils.ts (기존)
│   └── dateStyling.ts (신규)
└── _types/
    └── plan.ts (기존)
```

### 5.2 TypeScript 타입 안전성 강화

**개선:**

- `any` 타입 제거 (현재 코드 확인 필요)
- 명시적 타입 정의 강화
- 유니온 타입 활용

## 6. 데이터베이스 스키마 확인

**확인 사항:**

- `student_plan` 테이블의 필드들이 캘린더에 올바르게 매핑되는지 확인
- `plan_groups.daily_schedule` JSONB 구조 확인
- 인덱스 최적화 필요 여부 확인

**Supabase MCP로 확인된 주요 테이블:**

- `student_plan`: 플랜 데이터
- `plan_groups`: 플랜 그룹 (daily_schedule 포함)
- `plan_exclusions`: 제외일
- `academy_schedules`: 학원 일정

## 7. 테스트 및 검증

### 7.1 기능 테스트

- 각 뷰 (Month/Week/Day)에서 정상 동작 확인
- 필터링 기능 확인
- 모달 동작 확인

### 7.2 성능 테스트

- 렌더링 시간 측정
- 메모리 사용량 확인
- 대량 데이터 처리 테스트

### 7.3 접근성 테스트

- 스크린 리더 테스트
- 키보드 네비게이션 테스트
- WAI-ARIA 준수 확인

## 구현 순서

1. **Phase 1: 공통 유틸리티 및 훅 생성**

   - `useDayTypeStyling` 훅 생성
   - `useCalendarData` 훅 생성
   - `useTimelineSlots` 훅 생성

2. **Phase 2: 컴포넌트 리팩토링**

   - `CalendarDayCell` 컴포넌트 생성
   - MonthView 리팩토링
   - WeekView 리팩토링
   - DayView 리팩토링

3. **Phase 3: 성능 최적화**

   - useCallback 적용
   - React.memo 적용
   - useMemo 최적화

4. **Phase 4: 접근성 및 UX 개선**

   - ARIA 속성 추가
   - 키보드 네비게이션 구현
   - 애니메이션 개선
   - 반응형 디자인 강화

5. **Phase 5: 테스트 및 문서화**

   - 기능 테스트
   - 성능 테스트
   - 문서 업데이트

### To-dos

- [ ] useDayTypeStyling 커스텀 훅 생성 - 날짜 타입별 스타일링 로직 통합
- [ ] useCalendarData 커스텀 훅 생성 - 날짜별 데이터 그룹화 로직 통합
- [ ] useTimelineSlots 커스텀 훅 생성 - 타임라인 슬롯 처리 로직 통합
- [ ] CalendarDayCell 공통 컴포넌트 생성 - MonthView/WeekView 날짜 셀 로직 추출
- [ ] MonthView 리팩토링 - 공통 훅 및 컴포넌트 사용으로 중복 제거
- [ ] WeekView 리팩토링 - 공통 훅 및 컴포넌트 사용으로 중복 제거
- [ ] DayView 리팩토링 - 공통 훅 사용으로 중복 제거
- [ ] 이벤트 핸들러에 useCallback 적용 - 성능 최적화
- [ ] 컴포넌트에 React.memo 적용 - 불필요한 리렌더링 방지
- [ ] 접근성 개선 - ARIA 속성 추가 및 키보드 네비게이션 구현
- [ ] UI/UX 개선 - 애니메이션 및 전환 효과 추가, 반응형 디자인 강화
- [ ] useMemo 의존성 배열 최적화 및 불필요한 재계산 방지